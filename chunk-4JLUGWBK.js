import{a as le,b as de,c as pe,e as ce,f as ue}from"./chunk-3OMXHM4U.js";import{a as se}from"./chunk-4MFRXZIY.js";import{e as ie,k as ne,l as ae,m as oe}from"./chunk-B465ZTMU.js";import"./chunk-5KPU3EM2.js";import{Ab as U,G as O,Ja as d,Ka as o,La as a,Lb as X,Ma as T,Mb as j,O as p,Qa as D,Ra as C,Sa as c,T as S,U as P,Ub as k,V as I,W as M,Xb as G,Zb as A,_ as b,ba as N,bb as s,cb as v,da as H,db as u,fd as K,gd as Q,ha as W,i as w,id as ee,ja as i,jc as Z,jd as te,kb as $,kd as re,lc as q,m as B,ma as z,mb as L,mc as J,n as F,nb as E,ra as Y,sb as l,tb as g,ub as y,wa as h,x as R,z as V}from"./chunk-D5SNA2MW.js";import"./chunk-GAL4ENT6.js";var ge=(r,e)=>({exercise:r,pbType:e}),xe=(r,e)=>({value:r,unit:e}),he=r=>({reps:r}),fe=r=>({notes:r}),ve=r=>["/history/log",r];function be(r,e){r&1&&(o(0,"div",9)(1,"p",10),s(2),l(3,"translate"),a(),T(4,"div",11),a()),r&2&&(i(2),v(g(3,1,"pbTrend.loading")))}function ye(r,e){if(r&1){let t=D();o(0,"div",12)(1,"p",13),I(),o(2,"svg",14),T(3,"path",15),a(),s(4),a(),M(),o(5,"button",16),C("click",function(){S(t);let m=c();return P(m.goBack())}),s(6),l(7,"translate"),a()()}if(r&2){let t=c();i(4),u(" ",t.errorMessage()," "),i(2),u(" ",g(7,2,"pbTrend.backButton")," ")}}function _e(r,e){if(r&1&&(o(0,"div"),s(1),l(2,"translate"),a()),r&2){let t=c().model;i(),v(y(2,1,"pbTrend.chart.tooltip.reps",L(4,he,t.extra.reps)))}}function Te(r,e){if(r&1&&(o(0,"div",25),s(1),l(2,"translate"),a()),r&2){let t=c().model;i(),v(y(2,1,"pbTrend.chart.tooltip.notes",L(4,fe,t.extra.notes)))}}function Ce(r,e){r&1&&(o(0,"div",26),s(1),l(2,"translate"),a()),r&2&&(i(),v(g(2,1,"pbTrend.chart.tooltip.viewLog")))}function we(r,e){if(r&1&&(o(0,"div",21)(1,"div")(2,"strong"),s(3),l(4,"date"),a()(),o(5,"div"),s(6),l(7,"translate"),a(),h(8,_e,3,6,"div",22)(9,Te,3,6,"div",23)(10,Ce,3,3,"div",24),a()),r&2){let t=e.model,n=c(2);i(3),v(y(4,5,t.name,"mediumDate")),i(3),v(y(7,8,"pbTrend.chart.tooltip.value",E(11,xe,t.value,n.yAxisLabel().split(" ")[0]))),i(2),d("ngIf",t.extra==null?null:t.extra.reps),i(),d("ngIf",t.extra==null?null:t.extra.notes),i(),d("ngIf",t.extra==null?null:t.extra.workoutLogId)}}function Le(r,e){r&1&&(o(0,"th",33),s(1),l(2,"translate"),a()),r&2&&(i(),u(" ",g(2,1,"pbTrend.history.repsHeader")," "))}function ke(r,e){if(r&1&&(o(0,"td",41),s(1),a()),r&2){let t=c().$implicit;i(),u(" ",t.extra==null?null:t.extra.reps," ")}}function Se(r,e){if(r&1&&(o(0,"a",45),T(1,"app-icon",46),s(2),l(3,"translate"),a()),r&2){let t=c().$implicit;d("routerLink",L(4,ve,t.extra==null?null:t.extra.workoutLogId)),i(2),u(" ",g(3,2,"pbTrend.history.viewLog")," ")}}function Pe(r,e){if(r&1&&(o(0,"tr",39)(1,"td",40),s(2),l(3,"date"),a(),o(4,"td",41),s(5),a(),h(6,ke,2,1,"td",42),o(7,"td",43),h(8,Se,4,6,"a",44),a()()),r&2){let t=e.$implicit,n=c(3);i(2),u(" ",y(3,4,t.name,"mediumDate")," "),i(3),u(" ",n.formatTableValue(t)," "),i(),d("ngIf",(n.currentPbType==null?null:n.currentPbType.includes("RM"))||(n.currentPbType==null?null:n.currentPbType.includes("Heaviest Lifted"))),i(2),d("ngIf",t.extra==null?null:t.extra.workoutLogId)}}function Ie(r,e){if(r&1&&(o(0,"div",27)(1,"h2",28),s(2),l(3,"translate"),a(),o(4,"div",29)(5,"table",30)(6,"thead",31)(7,"tr")(8,"th",32),s(9),l(10,"translate"),a(),o(11,"th",33),s(12),a(),h(13,Le,3,3,"th",34),o(14,"th",35)(15,"span",36),s(16),l(17,"translate"),a()()()(),o(18,"tbody",37),h(19,Pe,9,7,"tr",38),a()()()()),r&2){let t=c(2);i(2),u(" ",g(3,6,"pbTrend.history.title")," "),i(7),u(" ",g(10,8,"pbTrend.history.dateHeader")," "),i(3),u(" ",t.yAxisLabel()," "),i(),d("ngIf",(t.currentPbType==null?null:t.currentPbType.includes("RM"))||(t.currentPbType==null?null:t.currentPbType.includes("Heaviest Lifted"))),i(3),v(g(17,10,"pbTrend.history.logHeader")),i(3),d("ngForOf",t.historyTableData())}}function Me(r,e){if(r&1){let t=D();o(0,"div",17)(1,"ngx-charts-line-chart",18),l(2,"translate"),C("select",function(m){S(t);let f=c();return P(f.onChartSelect(m))}),h(3,we,11,14,"ng-template",19),a(),h(4,Ie,20,12,"div",20),a()}if(r&2){let t=c();i(),d("view",t.view)("scheme",t.chartColorScheme)("results",t.chartData())("legend",t.legend)("xAxis",t.xAxis)("yAxis",t.yAxis)("showXAxisLabel",t.showXAxisLabel)("showYAxisLabel",t.showYAxisLabel)("xAxisLabel",g(2,17,"pbTrend.chart.xAxisLabel"))("yAxisLabel",t.yAxisLabel())("timeline",t.timeline)("autoScale",t.autoScale)("roundDomains",t.roundDomains)("xAxisTickFormatting",t.xAxisTickFormatting)("curve",t.lineChartCurve)("referenceLines",t.lineChartReferenceLines()),i(3),d("ngIf",t.historyTableData().length>0)}}var me=class r{route=p(Z);router=p(q);trackingService=p(ne);exerciseService=p(ae);unitsService=p(ie);toastService=p(Q);platformId=p(H);datePipe=new k("en-US");themeService=p(se);renderer=p(z);el=p(N);translate=p(ee);workoutService=p(oe);themeSubscription;chartData=b(null);isLoading=b(!0);errorMessage=b(null);historyTableData=U(()=>{let e=this.chartData();return!e||!e[0]||!e[0].series?[]:[...e[0].series].sort((t,n)=>n.name.getTime()-t.name.getTime())});currentExerciseId=null;currentPbType=null;currentExerciseName=b("Exercise");yAxisLabel=b("Value");lineChartReferenceLines=b([]);view=[700,400];legend=!1;showXAxisLabel=!0;showYAxisLabel=!0;xAxis=!0;yAxis=!0;timeline=!0;autoScale=!0;roundDomains=!0;lineChartCurve=le;chartColorScheme={name:"fitTrackProScheme",selectable:!0,group:pe.Ordinal,domain:["#10B981","#3B82F6","#F97316","#8B5CF6","#F59E0B","#EC4899","#14B8A6","#6366F1"]};xAxisTickFormatting=e=>e instanceof Date?this.datePipe.transform(e,"MMM d, yy")||"":String(e);constructor(){}ngOnInit(){A(this.platformId)&&(this.view=[window.innerWidth>768?700:window.innerWidth-40,400],this.updateChartTextColors(this.themeService.isDarkTheme())),this.themeService.isDarkTheme()?this.updateChartTextColors(!0):this.updateChartTextColors(!1),this.route.paramMap.pipe(V(1),O(e=>{this.isLoading.set(!0),this.errorMessage.set(null),this.chartData.set(null);let t=e.get("exerciseId"),n=e.get("pbType");if(!t||!n)return this.errorMessage.set(this.translate.instant("pbTrend.error.missingParams")),this.isLoading.set(!1),w({pb:null,exercise:null,error:"Missing parameters"});this.currentExerciseId=t;try{this.currentPbType=decodeURIComponent(n)}catch{return this.errorMessage.set(this.translate.instant("pbTrend.error.invalidPbType")),this.isLoading.set(!1),w({pb:null,exercise:null,error:"Invalid PB Type"})}return this.setYAxisLabel(this.currentPbType),F([this.trackingService.getPersonalBestForExerciseByType(this.currentExerciseId,this.currentPbType),this.exerciseService.getExerciseById(this.currentExerciseId)]).pipe(B(([m,f])=>({pb:m,exercise:f,error:null})),R(m=>(console.error("Error fetching PB trend data:",m),this.errorMessage.set(this.translate.instant("pbTrend.error.fetchFailed")),w({pb:null,exercise:null,error:"Fetch error"}))))})).subscribe(({pb:e,exercise:t,error:n})=>{if(n){this.isLoading.set(!1);return}this.currentExerciseName.set(t?.name||"Selected Exercise"),e?this.prepareChartData(e):this.errorMessage.set(this.translate.instant("pbTrend.error.noData",{exercise:this.currentExerciseName(),pbType:this.currentPbType})),this.isLoading.set(!1)})}updateChartTextColors(e){let t=e?"#E5E7EB":"#374151";this.renderer.setStyle(this.el.nativeElement,"--ngx-charts-text-color",t)}setYAxisLabel(e){e.includes("RM")||e.includes("Heaviest Lifted")?this.yAxisLabel.set(this.translate.instant("pbTrend.yAxis.weight",{unit:this.unitsService.getWeightUnitSuffix()})):e.includes("Max Reps")?this.yAxisLabel.set(this.translate.instant("pbTrend.yAxis.reps")):e.includes("Max Duration")?this.yAxisLabel.set(this.translate.instant("pbTrend.yAxis.duration")):e.includes("Max Distance")?this.yAxisLabel.set(this.translate.instant("pbTrend.yAxis.distance",{unit:this.unitsService.getDistanceMeasureUnitSuffix()})):this.yAxisLabel.set(this.translate.instant("pbTrend.yAxis.value"))}prepareChartData(e){let t=[],n=this.extractValueForChart(e,e.pbType);if(n!==null&&e.timestamp&&t.push({name:new Date(e.timestamp),value:n,extra:{reps:e.repsLogged,notes:e.notes,workoutLogId:e.workoutLogId}}),e.history&&e.history.forEach(x=>{let _=this.extractValueForChart(x,e.pbType);_!==null&&x.timestamp&&t.push({name:new Date(x.timestamp),value:_,extra:{reps:x.repsLogged,notes:void 0,workoutLogId:x.workoutLogId}})}),t.length<2){this.errorMessage.set(this.translate.instant("pbTrend.error.notEnoughData")),this.chartData.set(null),this.lineChartReferenceLines.set([]);return}t.sort((x,_)=>x.name.getTime()-_.name.getTime());let f=t.reduce((x,_)=>x+_.value,0)/t.length;this.lineChartReferenceLines.set([{name:this.translate.instant("pbTrend.chart.averageLine",{value:f.toFixed(1)}),value:f}]),this.chartData.set([{name:`${this.currentPbType||"PB"} Trend`,series:t}])}extractValueForChart(e,t){return t.includes("RM")||t.includes("Heaviest Lifted")?e.weightLogged??null:t.includes("Max Reps")?e.repsLogged??null:t.includes("Max Duration")?e.durationLogged??null:t.includes("Max Distance")?e.distanceLogged??null:e.weightLogged&&e.weightLogged>0?e.weightLogged:e.repsLogged&&e.repsLogged>0?e.repsLogged:e.durationLogged&&e.durationLogged>0?e.durationLogged:e.distanceLogged&&e.distanceLogged>0?e.distanceLogged:null}onChartSelect(e){e&&e.extra&&e.extra.workoutLogId?this.router.navigate(["/history/log",e.extra.workoutLogId]):e&&e.extra&&this.toastService.info(this.translate.instant("pbTrend.chart.tooltip.value",{value:e.value,unit:this.yAxisLabel().split(" ")[0]})+` on ${this.datePipe.transform(e.name,"mediumDate")}. ${e.extra.reps?this.translate.instant("pbTrend.chart.tooltip.reps",{reps:e.extra.reps}):""}`,5e3,"PB Detail")}goBack(){this.router.navigate(["/profile/personal-bests"])}onResize(e){if(A(this.platformId)){let t=e.target;this.view=[t.innerWidth>768?700:t.innerWidth-40,400]}}formatTableValue(e){return this.currentPbType?.includes("Max Duration")&&this.workoutService.formatSecondsToTime(e.value)||e.value.toString()}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=Y({type:r,selectors:[["app-pb-trend-chart"]],features:[$([de])],decls:12,vars:12,consts:[[1,"container","mx-auto","p-4",3,"resize"],[1,"mb-6","flex","items-center"],[1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-ml-2","rounded-full","focus:outline-none","focus:ring-2","focus:ring-primary-focus",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"text-xl","sm:text-2xl","font-bold","text-gray-800","dark:text-gray-200","ml-2"],["class","text-center py-10",4,"ngIf"],["class","text-center py-10 bg-red-50 dark:bg-red-900/30 p-4 rounded-md shadow",4,"ngIf"],["class","bg-white dark:bg-gray-800 p-2 sm:p-4 rounded-md shadow-xl",4,"ngIf"],[1,"text-center","py-10"],[1,"text-lg","text-gray-600","dark:text-gray-400"],[1,"mt-4","animate-spin","rounded-full","h-12","w-12","border-b-2","border-primary","mx-auto"],[1,"text-center","py-10","bg-red-50","dark:bg-red-900/30","p-4","rounded-md","shadow"],[1,"text-lg","font-semibold","text-red-700","dark:text-red-300"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-6","h-6","inline-block","mr-2","align-middle"],["stroke-linecap","round","stroke-linejoin","round","d","M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"],[1,"mt-4","px-4","py-2","bg-primary","text-white","rounded-md","hover:bg-primary-dark","transition-colors",3,"click"],[1,"bg-white","dark:bg-gray-800","p-2","sm:p-4","rounded-md","shadow-xl"],[1,"pb-chart-container",3,"select","view","scheme","results","legend","xAxis","yAxis","showXAxisLabel","showYAxisLabel","xAxisLabel","yAxisLabel","timeline","autoScale","roundDomains","xAxisTickFormatting","curve","referenceLines"],["ngx-charts-tooltip-template",""],["class","mt-8",4,"ngIf"],[1,"chart-tooltip","bg-gray-700","text-white","p-2","rounded","shadow-lg","text-xs"],[4,"ngIf"],["class","max-w-xs truncate",4,"ngIf"],["class","mt-1 text-indigo-300",4,"ngIf"],[1,"max-w-xs","truncate"],[1,"mt-1","text-indigo-300"],[1,"mt-8"],[1,"text-lg","font-semibold","text-gray-700","dark:text-gray-300","mb-4","border-t","pt-4","dark:border-gray-700"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-gray-200","dark:divide-gray-600"],[1,"bg-gray-50","dark:bg-gray-700"],["scope","col",1,"px-4","py-3","text-left","text-xs","font-medium","text-gray-500","dark:text-gray-400","uppercase","tracking-wider","rounded-tl-md"],["scope","col",1,"px-4","py-3","text-left","text-xs","font-medium","text-gray-500","dark:text-gray-400","uppercase","tracking-wider"],["scope","col","class","px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",4,"ngIf"],["scope","col",1,"relative","px-4","py-3","border-l-0","rounded-tr-md"],[1,"sr-only"],[1,"bg-white","dark:bg-gray-800","divide-y","divide-gray-200","dark:divide-gray-700"],["class","hover:bg-gray-50 dark:hover:bg-gray-700/50",4,"ngFor","ngForOf"],[1,"hover:bg-gray-50","dark:hover:bg-gray-700/50"],[1,"px-4","py-4","whitespace-nowrap","text-sm","font-medium","text-gray-900","dark:text-gray-200"],[1,"px-4","py-4","whitespace-nowrap","text-sm","text-gray-500","dark:text-gray-300"],["class","px-4 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",4,"ngIf"],[1,"px-4","py-4","whitespace-nowrap","text-right","text-sm","font-medium"],["class","inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-focus dark:focus:ring-offset-gray-800",3,"routerLink",4,"ngIf"],[1,"inline-flex","items-center","px-3","py-1.5","border","border-transparent","text-xs","font-medium","rounded-md","shadow-sm","text-white","bg-primary","hover:bg-primary-dark","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-primary-focus","dark:focus:ring-offset-gray-800",3,"routerLink"],["name","eye",1,"h-5","w-5","mr-1"]],template:function(t,n){t&1&&(o(0,"div",0),C("resize",function(f){return n.onResize(f)},W),o(1,"div",1)(2,"button",2),C("click",function(){return n.goBack()}),I(),o(3,"svg",3),T(4,"path",4),a()(),M(),o(5,"h1",5),s(6),l(7,"translate"),l(8,"translate"),a()(),h(9,be,5,3,"div",6)(10,ye,8,4,"div",7)(11,Me,5,19,"div",8),a()),t&2&&(i(6),u(" ",y(8,6,"pbTrend.title",E(9,ge,n.currentExerciseName(),n.currentPbType||g(7,4,"pbTrend.defaultTitle")))," "),i(3),d("ngIf",n.isLoading()),i(),d("ngIf",n.errorMessage()),i(),d("ngIf",!n.isLoading()&&!n.errorMessage()&&n.chartData()))},dependencies:[G,X,j,ue,ce,J,K,re,k,te],styles:["[_nghost-%COMP%]{--ngx-charts-text-color: #374151}[_nghost-%COMP%]     .ngx-charts text{fill:var(--ngx-charts-text-color)!important}[_nghost-%COMP%]     .ngx-charts .axis-label, [_nghost-%COMP%]     .ngx-charts .legend-label{fill:var(--ngx-charts-text-color)!important}.pb-chart-container[_ngcontent-%COMP%]     .ngx-charts{overflow:visible!important}  .chart-tooltip{pointer-events:none;font-size:.75rem}  .chart-tooltip strong{font-weight:600}","[_nghost-%COMP%]     .pb-chart-container .line-series .circle{fill:#fff;stroke:#10b981;stroke-width:2px;r:4px!important}[_nghost-%COMP%]     .pb-chart-container .x.axis .tick text{transform:rotate(-45deg) translate(-10px,-5px);text-anchor:end!important}[_nghost-%COMP%]     .pb-chart-container .ngx-charts-outer, [_nghost-%COMP%]     .pb-chart-container .axis-label, [_nghost-%COMP%]     .pb-chart-container .tick text{fill:var(--ngx-charts-text-color, #374151)}"],changeDetection:0})};export{me as PbTrendChartComponent};
