import{a as J,c as K,d as Q}from"./chunk-JQDUMUYJ.js";import{a as ee}from"./chunk-XMAO6MMV.js";import{a as q}from"./chunk-OYS4XCOY.js";import"./chunk-3JRNHUAR.js";import{a as j,b as G,c as Z}from"./chunk-WPDJOJEI.js";import{Ba as m,C as A,Ca as o,Cb as W,Da as a,E,Ea as f,I,Ia as P,Ja as h,Jb as b,Ka as p,Mb as z,Nb as T,Oc as X,Q as d,S as C,T as _,U as w,V as y,Va as c,Wa as N,Wb as H,Xa as v,Ya as S,Yb as Y,Z as u,aa as D,ca as M,ga as B,ia as s,jb as F,la as R,lb as $,nb as O,p as x,qa as V,qb as U,s as k,t as L,va as g}from"./chunk-IOVI54RK.js";function re(i,e){i&1&&(o(0,"div",10)(1,"p",11),c(2,"Loading trend data..."),a(),f(3,"div",12),a())}function ie(i,e){if(i&1){let t=P();o(0,"div",13)(1,"p",14),w(),o(2,"svg",15),f(3,"path",16),a(),c(4),a(),y(),o(5,"button",17),h("click",function(){C(t);let r=p();return _(r.goBack())}),c(6," Back to Personal Bests "),a()()}if(i&2){let t=p();s(4),v(" ",t.errorMessage()," ")}}function ne(i,e){if(i&1&&(o(0,"div"),c(1),a()),i&2){let t=p().model;s(),v("Reps: ",t.extra.reps)}}function ae(i,e){if(i&1&&(o(0,"div",24),c(1),a()),i&2){let t=p().model;s(),v("Notes: ",t.extra.notes)}}function oe(i,e){i&1&&(o(0,"div",25),c(1,"Click to view log"),a())}function se(i,e){if(i&1&&(o(0,"div",20)(1,"div")(2,"strong"),c(3),F(4,"date"),a()(),o(5,"div"),c(6),a(),g(7,ne,2,1,"div",21)(8,ae,2,1,"div",22)(9,oe,2,0,"div",23),a()),i&2){let t=e.model,n=p(2);s(3),N($(4,6,t.name,"mediumDate")),s(3),S("Value: ",t.value," ",n.yAxisLabel().split(" ")[0]),s(),m("ngIf",t.extra==null?null:t.extra.reps),s(),m("ngIf",t.extra==null?null:t.extra.notes),s(),m("ngIf",t.extra==null?null:t.extra.workoutLogId)}}function le(i,e){if(i&1){let t=P();o(0,"div",18)(1,"ngx-charts-line-chart",19),h("select",function(r){C(t);let l=p();return _(l.onChartSelect(r))}),g(2,se,10,9,"ng-template",null,0,O),a()()}if(i&2){let t=p();s(),m("view",t.view)("scheme",t.chartColorScheme())("results",t.chartData())("legend",t.legend)("xAxis",t.xAxis)("yAxis",t.yAxis)("showXAxisLabel",t.showXAxisLabel)("showYAxisLabel",t.showYAxisLabel)("xAxisLabel","Date")("yAxisLabel",t.yAxisLabel())("timeline",t.timeline)("autoScale",t.autoScale)("roundDomains",t.roundDomains)("xAxisTickFormatting",t.xAxisTickFormatting)}}var te=class i{route=d(H);router=d(Y);trackingService=d(G);exerciseService=d(j);unitsService=d(q);toastService=d(X);platformId=d(M);datePipe=new b("en-US");appSettingsService=d(ee);themeService=d(Z);renderer=d(R);el=d(D);themeSubscription;chartData=u(null);isLoading=u(!0);errorMessage=u(null);currentExerciseId=null;currentPbType=null;currentExerciseName=u("Exercise");yAxisLabel=u("Value");view=[700,400];legend=!1;showXAxisLabel=!0;showYAxisLabel=!0;xAxis=!0;yAxis=!0;timeline=!0;autoScale=!0;roundDomains=!0;chartColorScheme=U(()=>{let e=this.themeService.isDarkTheme();return{name:"pbTrendScheme",selectable:!0,group:J.Ordinal,domain:e?["#70C0AE","#E9724C","#F0C24B","#CCCCCC"]:["#5AA454","#A10A28","#C7B42C","#333333"]}});xAxisTickFormatting=e=>e instanceof Date?this.datePipe.transform(e,"MMM d, yy")||"":String(e);constructor(){}ngOnInit(){T(this.platformId)&&(this.view=[window.innerWidth>768?700:window.innerWidth-40,400],this.updateChartTextColors(this.themeService.isDarkTheme())),this.route.paramMap.pipe(E(1),I(e=>{this.isLoading.set(!0),this.errorMessage.set(null),this.chartData.set(null);let t=e.get("exerciseId"),n=e.get("pbType");if(!t||!n)return this.errorMessage.set("Exercise ID or PB Type missing in URL."),this.isLoading.set(!1),x({pb:null,exercise:null,error:"Missing parameters"});this.currentExerciseId=t;try{this.currentPbType=decodeURIComponent(n)}catch{return this.errorMessage.set("Invalid PB Type in URL."),this.isLoading.set(!1),x({pb:null,exercise:null,error:"Invalid PB Type"})}return this.setYAxisLabel(this.currentPbType),L([this.trackingService.getPersonalBestForExerciseByType(this.currentExerciseId,this.currentPbType),this.exerciseService.getExerciseById(this.currentExerciseId)]).pipe(k(([r,l])=>({pb:r,exercise:l,error:null})),A(r=>(console.error("Error fetching PB trend data:",r),this.errorMessage.set("Failed to load data for the trend chart."),x({pb:null,exercise:null,error:"Fetch error"}))))})).subscribe(({pb:e,exercise:t,error:n})=>{if(n){this.isLoading.set(!1);return}this.currentExerciseName.set(t?.name||"Selected Exercise"),e?this.prepareChartData(e):this.errorMessage.set(`No Personal Best data found for "${this.currentExerciseName()}" of type "${this.currentPbType}"`),this.isLoading.set(!1)})}updateChartTextColors(e){let t=e?"#E5E7EB":"#374151";this.renderer.setStyle(this.el.nativeElement,"--ngx-charts-text-color",t)}setYAxisLabel(e){e.includes("RM")||e.includes("Heaviest Lifted")?this.yAxisLabel.set(`Weight (${this.unitsService.getUnitSuffix()})`):e.includes("Max Reps")?this.yAxisLabel.set("Repetitions"):e.includes("Max Duration")?this.yAxisLabel.set("Duration (seconds)"):this.yAxisLabel.set("Value")}prepareChartData(e){let t=[],n=this.extractValueForChart(e,e.pbType);if(n!==null&&e.timestamp&&t.push({name:new Date(e.timestamp),value:n,extra:{reps:e.repsAchieved,notes:e.notes,workoutLogId:e.workoutLogId}}),e.history&&e.history.forEach(r=>{let l=this.extractValueForChart(r,e.pbType);l!==null&&r.timestamp&&t.push({name:new Date(r.timestamp),value:l,extra:{reps:r.repsAchieved,notes:void 0,workoutLogId:r.workoutLogId}})}),t.length===0){this.errorMessage.set(`Not enough data points to plot a trend for "${this.currentExerciseName()}" - ${e.pbType}`),this.chartData.set(null);return}if(t.length===1){this.errorMessage.set(`Only one data point available for "${this.currentExerciseName()}" - ${e.pbType}. Trend line cannot be drawn`);let r=t[0],l=new Date(r.name.getTime()-24*60*60*1e3);t.unshift({name:l,value:r.value,extra:r.extra})}t.sort((r,l)=>r.name.getTime()-l.name.getTime()),this.chartData.set([{name:`${this.currentPbType||"PB"} Trend`,series:t}])}extractValueForChart(e,t){return t.includes("RM")||t.includes("Heaviest Lifted")?e.weightUsed??null:t.includes("Max Reps")?e.repsAchieved??null:t.includes("Max Duration")?e.durationPerformed??null:e.weightUsed&&e.weightUsed>0?e.weightUsed:e.repsAchieved>0?e.repsAchieved:e.durationPerformed&&e.durationPerformed>0?e.durationPerformed:null}onChartSelect(e){e&&e.extra&&e.extra.workoutLogId?this.router.navigate(["/workout/summary",e.extra.workoutLogId]):e&&e.extra&&this.toastService.info(`PB achieved: ${e.value} ${this.yAxisLabel().split(" ")[0]} on ${this.datePipe.transform(e.name,"mediumDate")}. ${e.extra.reps?"Reps: "+e.extra.reps:""} ${e.extra.notes?"Notes: "+e.extra.notes:""}`,5e3,"PB Detail")}goBack(){this.router.navigate(["/profile/personal-bests"])}onResize(e){if(T(this.platformId)){let t=e.target;this.view=[t.innerWidth>768?700:t.innerWidth-40,400]}}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=V({type:i,selectors:[["app-pb-trend-chart"]],decls:10,vars:5,consts:[["tooltipTemplate",""],[1,"container","mx-auto","p-4",3,"resize"],[1,"mb-6","flex","items-center"],[1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-ml-2","rounded-full","focus:outline-none","focus:ring-2","focus:ring-primary-focus",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"text-xl","sm:text-2xl","font-bold","text-gray-800","dark:text-gray-200","ml-2"],["class","text-center py-10",4,"ngIf"],["class","text-center py-10 bg-red-50 dark:bg-red-900/30 p-4 rounded-md shadow",4,"ngIf"],["class","bg-white dark:bg-gray-800 p-2 sm:p-4 rounded-md shadow-xl",4,"ngIf"],[1,"text-center","py-10"],[1,"text-lg","text-gray-600","dark:text-gray-400"],[1,"mt-4","animate-spin","rounded-full","h-12","w-12","border-b-2","border-primary","mx-auto"],[1,"text-center","py-10","bg-red-50","dark:bg-red-900/30","p-4","rounded-md","shadow"],[1,"text-lg","font-semibold","text-red-700","dark:text-red-300"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-6","h-6","inline-block","mr-2","align-middle"],["stroke-linecap","round","stroke-linejoin","round","d","M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"],[1,"mt-4","px-4","py-2","bg-primary","text-white","rounded-md","hover:bg-primary-dark","transition-colors",3,"click"],[1,"bg-white","dark:bg-gray-800","p-2","sm:p-4","rounded-md","shadow-xl"],[1,"pb-chart-container",3,"select","view","scheme","results","legend","xAxis","yAxis","showXAxisLabel","showYAxisLabel","xAxisLabel","yAxisLabel","timeline","autoScale","roundDomains","xAxisTickFormatting"],[1,"chart-tooltip","bg-gray-700","text-white","p-2","rounded","shadow-lg","text-xs"],[4,"ngIf"],["class","max-w-xs truncate",4,"ngIf"],["class","mt-1 text-indigo-300",4,"ngIf"],[1,"max-w-xs","truncate"],[1,"mt-1","text-indigo-300"]],template:function(t,n){t&1&&(o(0,"div",1),h("resize",function(l){return n.onResize(l)},B),o(1,"div",2)(2,"button",3),h("click",function(){return n.goBack()}),w(),o(3,"svg",4),f(4,"path",5),a()(),y(),o(5,"h1",6),c(6),a()(),g(7,re,4,0,"div",7)(8,ie,7,1,"div",8)(9,le,4,14,"div",9),a()),t&2&&(s(6),S(" ",n.currentExerciseName()," - ",n.currentPbType||"PB Trend"," "),s(),m("ngIf",n.isLoading()),s(),m("ngIf",n.errorMessage()),s(),m("ngIf",!n.isLoading()&&!n.errorMessage()&&n.chartData()))},dependencies:[z,W,b,Q,K],styles:["[_nghost-%COMP%]{--ngx-charts-text-color: #374151}[_nghost-%COMP%]     .ngx-charts text{fill:var(--ngx-charts-text-color)!important}[_nghost-%COMP%]     .ngx-charts .axis-label, [_nghost-%COMP%]     .ngx-charts .legend-label{fill:var(--ngx-charts-text-color)!important}.pb-chart-container[_ngcontent-%COMP%]     .ngx-charts{overflow:visible!important}  .chart-tooltip{pointer-events:none;font-size:.75rem}  .chart-tooltip strong{font-weight:600}"],changeDetection:0})};export{te as PbTrendChartComponent};
