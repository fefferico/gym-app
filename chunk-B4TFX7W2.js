import{A as D,I as A,M as p,Ub as k,a as l,b as f,f as g,j as w,m as B,p as d,qc as I,rc as W,sc as y,vc as L,wc as T,xc as x,yc as P}from"./chunk-ZPPFHB7I.js";function v(n,e){let t=()=>x(e?.in,NaN),o=e?.additionalDigits??2,s=$(n),i;if(s.date){let u=_(s.date,o);i=M(u.restDateString,u.year)}if(!i||isNaN(+i))return t();let r=+i,a=0,c;if(s.time&&(a=F(s.time),isNaN(a)))return t();if(s.timezone){if(c=j(s.timezone),isNaN(c))return t()}else{let u=new Date(r+a),S=P(0,e?.in);return S.setFullYear(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate()),S.setHours(u.getUTCHours(),u.getUTCMinutes(),u.getUTCSeconds(),u.getUTCMilliseconds()),S}return P(r+a+c,e?.in)}var m={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},E=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,U=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,N=/^([+-])(\d{2})(?::?(\d{2}))?$/;function $(n){let e={},t=n.split(m.dateTimeDelimiter),o;if(t.length>2)return e;if(/:/.test(t[0])?o=t[0]:(e.date=t[0],o=t[1],m.timeZoneDelimiter.test(e.date)&&(e.date=n.split(m.timeZoneDelimiter)[0],o=n.substr(e.date.length,n.length))),o){let s=m.timezone.exec(o);s?(e.time=o.replace(s[1],""),e.timezone=s[1]):e.time=o}return e}function _(n,e){let t=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),o=n.match(t);if(!o)return{year:NaN,restDateString:""};let s=o[1]?parseInt(o[1]):null,i=o[2]?parseInt(o[2]):null;return{year:i===null?s:i*100,restDateString:n.slice((o[1]||o[2]).length)}}function M(n,e){if(e===null)return new Date(NaN);let t=n.match(E);if(!t)return new Date(NaN);let o=!!t[4],s=h(t[1]),i=h(t[2])-1,r=h(t[3]),a=h(t[4]),c=h(t[5])-1;if(o)return G(e,a,c)?C(e,a,c):new Date(NaN);{let u=new Date(0);return!V(e,i,r)||!K(e,s)?new Date(NaN):(u.setUTCFullYear(e,i,Math.max(s,r)),u)}}function h(n){return n?parseInt(n):1}function F(n){let e=n.match(U);if(!e)return NaN;let t=b(e[1]),o=b(e[2]),s=b(e[3]);return z(t,o,s)?t*T+o*L+s*1e3:NaN}function b(n){return n&&parseFloat(n.replace(",","."))||0}function j(n){if(n==="Z")return 0;let e=n.match(N);if(!e)return 0;let t=e[1]==="+"?-1:1,o=parseInt(e[2]),s=e[3]&&parseInt(e[3])||0;return H(o,s)?t*(o*T+s*L):NaN}function C(n,e,t){let o=new Date(0);o.setUTCFullYear(n,0,4);let s=o.getUTCDay()||7,i=(e-1)*7+t+1-s;return o.setUTCDate(o.getUTCDate()+i),o}var Y=[31,null,31,30,31,30,31,31,30,31,30,31];function O(n){return n%400===0||n%4===0&&n%100!==0}function V(n,e,t){return e>=0&&e<=11&&t>=1&&t<=(Y[e]||(O(n)?29:28))}function K(n,e){return e>=1&&e<=(O(n)?366:365)}function G(n,e,t){return e>=1&&e<=53&&t>=0&&t<=6}function z(n,e,t){return n===24?e===0&&t===0:t>=0&&t<60&&e>=0&&e<60&&n>=0&&n<25}function H(n,e){return e>=0&&e<=59}var R=class n{storageService=p(W);alertService=p(I);workoutService=p(y);WORKOUT_LOGS_STORAGE_KEY="fitTrackPro_workoutLogs";PERSONAL_BESTS_STORAGE_KEY="fitTrackPro_personalBests";workoutLogsSubject=new w(this.loadWorkoutLogsFromStorage());workoutLogs$=this.workoutLogsSubject.asObservable();personalBestsSubject=new w(this.loadPBsFromStorage());personalBests$=this.personalBestsSubject.asObservable();constructor(){}loadWorkoutLogsFromStorage(){let e=this.storageService.getItem(this.WORKOUT_LOGS_STORAGE_KEY);return e?e.sort((t,o)=>new Date(o.date).getTime()-new Date(t.date).getTime()):[]}saveWorkoutLogsToStorage(e){this.storageService.setItem(this.WORKOUT_LOGS_STORAGE_KEY,e),this.workoutLogsSubject.next([...e].sort((t,o)=>new Date(o.date).getTime()-new Date(t.date).getTime()))}addWorkoutLog(e){let t=k(),o=this.workoutLogsSubject.getValue(),s=e.exercises.map(a=>f(l({},a),{workoutLogId:t,sets:a.sets.map(c=>f(l({},c),{id:c.id??k(),workoutLogId:t}))})),i=f(l({},e),{exercises:s,id:t,date:new Date(e.startTime).toISOString().split("T")[0]});i.startTime&&i.endTime&&!i.durationMinutes&&(i.durationMinutes=Math.round((i.endTime-i.startTime)/(1e3*60)));let r=[i,...o];return this.saveWorkoutLogsToStorage(r),this.updateAllPersonalBestsFromLog(i),console.log("Added workout log:",i),i}getWorkoutLogById(e){return this.workoutLogs$.pipe(d(t=>t.find(o=>o.id===e)))}clearAllWorkoutLogs_DEV_ONLY(){return this.alertService.showConfirm("Info","DEVELOPMENT: Are you sure you want to delete ALL workout logs? This cannot be undone.").then(e=>g(this,null,function*(){e&&e.data&&(this.saveWorkoutLogsToStorage([]),yield this.alertService.showAlert("Info","All workout logs cleared!"))}))}getLastPerformanceForExercise(e){return this.workoutLogs$.pipe(d(t=>{for(let o of t){let s=o.exercises.find(i=>i.exerciseId===e);if(s&&s.sets.length>0)return{lastPerformedDate:o.date,workoutLogId:o.id,sets:[...s.sets]}}return null}))}findPreviousSetPerformance(e,t,o){return!e||!e.sets||e.sets.length===0?null:o<e.sets.length?e.sets[o]:null}loadPBsFromStorage(){return this.storageService.getItem(this.PERSONAL_BESTS_STORAGE_KEY)||{}}savePBsToStorage(e){this.storageService.setItem(this.PERSONAL_BESTS_STORAGE_KEY,e),this.personalBestsSubject.next(l({},e))}updateAllPersonalBestsFromLog(e){let t=l({},this.personalBestsSubject.getValue());e.exercises.forEach(o=>{t[o.exerciseId]||(t[o.exerciseId]=[]);let s=t[o.exerciseId],i=o.workoutLogId||e.id;o.sets.forEach(r=>{if(r.weightUsed===void 0||r.weightUsed===null||r.weightUsed===0){r.repsAchieved>0&&this.updateSpecificPB(s,r,"Max Reps (Bodyweight)"),r.durationPerformed&&r.durationPerformed>0&&this.updateSpecificPB(s,r,"Max Duration");return}if(r.repsAchieved===1&&this.updateSpecificPB(s,r,"1RM (Actual)"),r.repsAchieved===3&&this.updateSpecificPB(s,r,"3RM (Actual)"),r.repsAchieved===5&&this.updateSpecificPB(s,r,"5RM (Actual)"),this.updateSpecificPB(s,r,"Heaviest Lifted"),r.repsAchieved>1){let a=r.weightUsed*(1+r.repsAchieved/30),c=f(l({},r),{repsAchieved:1,weightUsed:parseFloat(a.toFixed(2))});this.updateSpecificPB(s,c,"1RM (Estimated)")}}),t[o.exerciseId]=s.sort((r,a)=>(a.weightUsed??0)-(r.weightUsed??0))}),this.savePBsToStorage(t),console.log("Personal Bests updated:",t)}updateSpecificPB(e,t,o){let s=f(l({},t),{pbType:o,workoutLogId:t.workoutLogId}),i=e.findIndex(a=>a.pbType===o),r=!1;if(i>-1){let a=e[i];o.includes("Max Reps")?(t.repsAchieved>a.repsAchieved||t.repsAchieved===a.repsAchieved&&(t.weightUsed??-1)>(a.weightUsed??-1))&&(r=!0):o.includes("Max Duration")?(t.durationPerformed??0)>(a.durationPerformed??0)&&(r=!0):(t.weightUsed??-1)>(a.weightUsed??-1)&&(r=!0),r&&(e[i]=s)}else r=!0,e.push(s)}getPersonalBestForExerciseByType(e,t){return this.personalBests$.pipe(d(o=>o[e]?.find(i=>i.pbType===t)||null))}getAllPersonalBestsForExercise(e){return this.personalBests$.pipe(d(t=>t[e]||[]))}getAllPersonalWorkouts(){return this.workoutLogs$}clearAllPersonalBests_DEV_ONLY(){return this.alertService.showConfirm("Info","DEVELOPMENT: Are you sure you want to delete ALL personal bests? This cannot be undone.").then(e=>g(this,null,function*(){e&&e.data&&(this.savePBsToStorage({}),yield this.alertService.showAlert("Info","All personal bests cleared!"))}))}getExercisePerformanceHistory(e){return this.workoutLogs$.pipe(d(t=>{let o=[];return t.filter(i=>i.exercises.some(r=>r.exerciseId===e)).sort((i,r)=>v(i.date).getTime()-v(r.date).getTime()).forEach(i=>{let r,a;i.exercises.forEach(c=>{c.exerciseId===e&&c.sets.forEach(u=>{u.weightUsed!==void 0&&u.weightUsed!==null&&(r===void 0||u.weightUsed>r?(r=u.weightUsed,a=u.repsAchieved):u.weightUsed===r&&(a===void 0||u.repsAchieved>a)&&(a=u.repsAchieved))})}),r!==void 0&&o.push({date:v(i.date),value:r,reps:a,logId:i.id})}),o}))}getLogsForBackup(){return this.workoutLogsSubject.getValue()}getPBsForBackup(){return this.personalBestsSubject.getValue()}replaceLogs(e){if(!Array.isArray(e)){console.error("TrackingService: Imported data for logs is not an array.");return}this.saveWorkoutLogsToStorage(e),console.log("TrackingService: Logs replaced with imported data.")}replacePBs(e){if(typeof e!="object"||e===null||Array.isArray(e)){console.error("TrackingService: Imported data for PBs is not an object.");return}this.savePBsToStorage(e),console.log("TrackingService: PBs replaced with imported data.")}getWorkoutLogsByRoutineId(e){return e?this.workoutLogs$.pipe(d(t=>t.filter(o=>o.routineId===e))):B([])}clearWorkoutLogsByRoutineId(e){return g(this,null,function*(){if(!e)return console.warn("TrackingService: clearWorkoutLogsByRoutineId called with no routineId."),this.alertService.showAlert("Warning","No routine ID provided to clear logs."),!1;let t=this.workoutLogsSubject.getValue(),o=t.filter(r=>r.routineId!==e),s=t.length-o.length,i="";if(this.workoutService.getRoutineById(e).pipe(D(1),d(r=>r?.name||"")).subscribe(r=>{i=r}),s===0)return this.alertService.showConfirm("Info","Are you sure you want to delete this routine? This action cannot be undone.").then(r=>(console.log(r),r&&r.data?(this.workoutService.deleteRoutine(e),this.alertService.showAlert("Info",`Routine "${i}" deleted successfully!`),!0):!1)),!1;{let r=yield this.alertService.showConfirm("Confirm Deletion",`Are you sure you want to delete this routine? There are ${s} workout log(s) associated with this routine: if you confirm you'll delete the routine and loose your previously logged workouts. This action cannot be undone.`);return r&&r.data?(this.saveWorkoutLogsToStorage(o),this.workoutService.deleteRoutine(e),this.alertService.showAlert("Success",`${s} workout log(s) for the routine have been cleared and the routine itself (${i}) it's been deleted.`),console.log(`Cleared ${s} logs for routineId: ${e}`),!0):!1}})}updateWorkoutLog(e){return g(this,null,function*(){if(!e||!e.id)throw console.error("TrackingService: updateWorkoutLog called with invalid data or missing ID."),new Error("Invalid log data for update.");let t=this.workoutLogsSubject.getValue(),o=t.findIndex(s=>s.id===e.id);if(o>-1){let s=[...t];s[o]=l({},e),this.saveWorkoutLogsToStorage(s),this.updateAllPersonalBestsFromLog(e),console.log("Updated workout log:",e)}else throw console.error(`TrackingService: WorkoutLog with ID ${e.id} not found for update.`),new Error(`WorkoutLog with ID ${e.id} not found.`)})}handleExerciseDeletion(e){return g(this,null,function*(){console.log(`Handling deletion repercussions for exercise ID: ${e}`);let t=this.workoutLogsSubject.getValue(),o=!1,s=t.map(r=>{let a=r.exercises.length,c=r.exercises.filter(u=>u.exerciseId!==e);return c.length<a?(o=!0,c.length===0?(console.log(`Workout log ${r.id} will be deleted as it becomes empty after removing exercise ${e}.`),null):f(l({},r),{exercises:c})):r}).filter(r=>r!==null);o&&(console.log("Some workout logs were modified or deleted due to exercise deletion."),this.saveWorkoutLogsToStorage(s));let i=this.personalBestsSubject.getValue();if(i[e]){let r=l({},i);delete r[e],this.savePBsToStorage(r),console.log(`Personal bests cleared for deleted exercise ID: ${e}`)}})}deleteWorkoutLog(e){return g(this,null,function*(){if(!e)throw console.error("TrackingService: deleteWorkoutLog called with invalid logId."),new Error("Invalid log ID for deletion.");let t=this.workoutLogsSubject.getValue();if(t.findIndex(r=>r.id===e)===-1){console.warn(`TrackingService: WorkoutLog with ID ${e} not found for deletion.`);return}let s=t.filter(r=>r.id!==e);this.saveWorkoutLogsToStorage(s);let i={};s.forEach(r=>this.updateAllPersonalBestsFromLog(r)),console.log(`Workout log with ID ${e} deleted.`)})}static \u0275fac=function(t){return new(t||n)};static \u0275prov=A({token:n,factory:n.\u0275fac,providedIn:"root"})};export{v as a,R as b};
