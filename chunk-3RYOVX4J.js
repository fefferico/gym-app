import{e as Ae,f as Me}from"./chunk-P2JYVDYE.js";import{a as Te}from"./chunk-UXDBPO6M.js";import{h as Ie,j as ke}from"./chunk-FVUPAVAO.js";import{a as De}from"./chunk-GI2JYS5A.js";import{$a as d,$c as Se,Gb as me,H as ie,Ha as c,Hb as pe,Ia as o,Ib as xe,Ja as r,Jb as ge,Ka as b,Kb as _e,La as R,Ma as V,N as D,Nb as ue,Oa as A,Pa as C,Qa as l,Qb as fe,Rb as W,S as u,T as f,Tb as he,U as ne,Ub as ve,Xa as M,Ya as ce,Z as h,Za as H,_ as re,aa as ae,ab as _,bb as S,bd as we,ca as oe,db as le,ec as ye,fa as Z,gc as be,hc as Ce,i as Q,ia as a,jb as de,m as ee,mb as N,mc as Ee,nc as X,oc as K,pb as P,q as te,qa as se,qb as q,qc as w,rb as O,sc as z,tb as I,tc as L,va as p,wb as j,z as $}from"./chunk-Q6MEL7MM.js";import{g as J}from"./chunk-GAL4ENT6.js";var G=(i,t)=>({"border-primary dark:border-primary-light text-primary dark:text-primary-light":i,"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 hover:border-gray-300 dark:hover:border-gray-500":t}),Re=(i,t)=>({"bg-white dark:bg-gray-300":i,"bg-gray-400 dark:bg-gray-700":t});function Ve(i,t){i&1&&(o(0,"div",21)(1,"button",22),b(2,"app-icon",23),r(),b(3,"div",24),r()),i&2&&(a(),c("routerLink","/library"))}function Le(i,t){if(i&1){let e=A();o(0,"app-action-menu",31),C("itemClick",function(s){u(e);let m=l(4);return f(m.handleActionMenuItemClick(s))})("closeMenu",function(){u(e);let s=l(4);return f(s.onCloseActionMenu())}),r()}if(i&2){let e=l(2).ngIf,n=l(2);c("items",n.getExerciseDropdownActionItems(e.id,"dropdown"))("isVisible",n.areActionsVisible(e.id))}}function Fe(i,t){if(i&1){let e=A();o(0,"div",27)(1,"button",28),C("click",function(s){u(e);let m=l().ngIf,x=l(2);return f(x.toggleActions(m.id,s))}),b(2,"app-icon",29),r(),p(3,Le,1,2,"app-action-menu",30),r()}if(i&2){let e=l().ngIf,n=l(2);a(3),c("ngIf",n.areActionsVisible(e.id))}}function Be(i,t){if(i&1&&(o(0,"div",25),p(1,Fe,4,1,"div",26),r()),i&2){let e=l(2);a(),c("ngIf",!e.isModal)}}function Ue(i,t){if(i&1){let e=A();o(0,"button",53),C("click",function(){u(e);let s=l(4);return f(s.prevImage())}),d(1," \u276E "),r()}}function Ne(i,t){if(i&1){let e=A();o(0,"button",54),C("click",function(){u(e);let s=l(4);return f(s.nextImage())}),d(1," \u276F "),r()}}function Oe(i,t){if(i&1){let e=A();o(0,"span",57),C("click",function(){let s=u(e).index,m=l(5);return f(m.currentImageIndex.set(s))}),r()}if(i&2){let e=t.index,n=l(5);c("ngClass",N(1,Re,n.currentImageIndex()===e,n.currentImageIndex()!==e))}}function $e(i,t){if(i&1&&(o(0,"div",55),p(1,Oe,1,4,"span",56),r()),i&2){let e=l(3).ngIf;a(),c("ngForOf",e.imageUrls)}}function He(i,t){if(i&1&&(o(0,"div",27),b(1,"img",49),p(2,Ue,2,0,"button",50)(3,Ne,2,0,"button",51)(4,$e,2,1,"div",52),r()),i&2){let e=l(2).ngIf,n=l();a(),c("src",e.imageUrls[n.currentImageIndex()],Z)("alt",e.name+" form "+(n.currentImageIndex()+1)),a(),c("ngIf",e.imageUrls.length>1),a(),c("ngIf",e.imageUrls.length>1),a(),c("ngIf",e.imageUrls.length>1)}}function We(i,t){if(i&1&&(o(0,"div",58)(1,"h1",59),d(2),r()()),i&2){let e=l(2).ngIf;a(2),S("",e.name," ")}}function Xe(i,t){if(i&1&&(o(0,"li"),d(1),r()),i&2){let e=t.$implicit;a(),_(e)}}function je(i,t){if(i&1&&(o(0,"li"),d(1),r()),i&2){let e=t.$implicit;a(),_(e)}}function Ge(i,t){if(i&1&&(o(0,"div",37)(1,"h3",41),d(2,"Equipment Needed"),r(),o(3,"ul",43),p(4,je,2,1,"li",44),r()()),i&2){let e=l(2).ngIf;a(4),c("ngForOf",e.equipmentNeeded)}}function Ye(i,t){if(i&1&&(o(0,"div",37)(1,"h3",41),d(2,"Notes & Tips"),r(),o(3,"p",60),d(4),r()()),i&2){let e=l(2).ngIf;a(4),_(e.notes)}}function Ze(i,t){if(i&1&&(o(0,"div",37)(1,"a",61),ne(),o(2,"svg",62),b(3,"path",63),r(),d(4," Watch Video "),r()()),i&2){let e=l(2).ngIf;a(),c("href",e.videoUrl,Z)}}function qe(i,t){if(i&1&&(o(0,"p",73),d(1),r()),i&2){let e=l().$implicit;c("title",e.notes),a(),S(" Notes: ",e.notes," ")}}function Ke(i,t){if(i&1&&(o(0,"div",68)(1,"p",69),d(2),r(),o(3,"p",70),d(4),r(),o(5,"p",71),d(6),P(7,"date"),r(),p(8,qe,2,2,"p",72),r()),i&2){let e=t.$implicit,n=l(4);a(2),_(e.pbType),a(2),_(n.formatPbValue(e)),a(2),S(" Achieved on: ",O(7,4,e.timestamp,"mediumDate")," "),a(2),c("ngIf",e.notes)}}function ze(i,t){if(i&1&&(o(0,"div",64)(1,"h3",65),d(2,"Your Personal Bests"),r(),o(3,"div",66),p(4,Ke,9,7,"div",67),r()()),i&2){let e=l(3);a(4),c("ngForOf",e.exercisePBs())}}function Je(i,t){i&1&&(o(0,"div",64)(1,"p",74),d(2,"No personal bests recorded for this exercise yet. "),r()())}function Qe(i,t){if(i&1&&(R(0),p(1,Je,3,0,"div",46),V()),i&2){let e=t.ngIf,n=l(3);a(),c("ngIf",n.exercise()&&n.exercisePBs().length===0&&e.length>0)}}function et(i,t){if(i&1&&(o(0,"div"),d(1),r()),i&2){let e=l().model;a(),S("Reps: ",e.extra.reps)}}function tt(i,t){if(i&1&&(o(0,"div",79)(1,"div")(2,"strong"),d(3),P(4,"date"),r()(),o(5,"div"),d(6),P(7,"number"),r(),p(8,et,2,1,"div",47),r()),i&2){let e=t.model,n=l(4);a(3),_(O(4,5,e.name,"mediumDate")),a(3),le("",e.series,": ",O(7,8,e.value,"1.0-2")," ",n.unitService.getWeightUnitSuffix()," "),a(2),c("ngIf",e.extra&&e.extra.reps)}}function it(i,t){}function nt(i,t){if(i&1){let e=A();o(0,"div",75)(1,"h3",76),d(2),r(),o(3,"div",77)(4,"ngx-charts-line-chart",78),C("select",function(s){u(e);let m=l(3);return f(m.onProgressChartSelect(s))}),p(5,tt,9,11,"ng-template",null,1,I)(7,it,0,0,"ng-template",null,2,I),r()()()}if(i&2){let e=l(3);a(2),S("Progress: ",e.progressChartYAxisLabel," Over Time"),a(2),c("view",e.progressChartView)("scheme",e.progressChartColorScheme)("results",e.exerciseProgressChartData())("legend",!1)("xAxis",e.progressChartShowXAxis)("yAxis",e.progressChartShowYAxis)("xAxisLabel",e.progressChartXAxisLabel)("yAxisLabel",e.progressChartYAxisLabel)("timeline",e.progressChartTimeline)("showXAxisLabel",e.progressChartShowXAxisLabel)("showYAxisLabel",e.progressChartShowYAxisLabel)("autoScale",e.progressChartAutoScale)}}function rt(i,t){if(i&1&&(o(0,"div",75)(1,"p",74),d(2," Not enough history for "),o(3,"strong",80),d(4),r(),d(5," to plot a progress trend (need at least 2 workouts for this exercise). Keep logging! "),r()()),i&2){let e,n=l(4);a(4),_((e=n.exercise())==null?null:e.name)}}function at(i,t){if(i&1&&(R(0),p(1,rt,6,1,"div",48),V()),i&2){let e=t.ngIf,n=l(3);a(),c("ngIf",e&&e.length>0&&!n.hasSufficientProgressData)}}function ot(i,t){if(i&1&&(o(0,"div",32)(1,"div",33),p(2,He,5,5,"div",26),o(3,"div",34),p(4,We,3,1,"div",35),o(5,"div",33)(6,"span",36),d(7),r()(),o(8,"div",37)(9,"h2",38),d(10,"Description"),r(),o(11,"p",39),d(12),r()(),o(13,"div",40)(14,"div")(15,"h3",41),d(16,"Primary Muscle Group"),r(),o(17,"p",42),d(18),r()(),o(19,"div")(20,"h3",41),d(21,"Other Muscle Groups"),r(),o(22,"ul",43),p(23,Xe,2,1,"li",44),r()()(),p(24,Ge,5,1,"div",45)(25,Ye,5,1,"div",45)(26,Ze,5,1,"div",45)(27,ze,5,1,"div",46)(28,Qe,2,1,"ng-container",47),P(29,"async"),p(30,nt,9,13,"div",48)(31,at,2,1,"ng-container",47),P(32,"async"),r()()()),i&2){let e=l().ngIf,n=l();H("tab-content-active",n.activeTab()==="description"),a(2),c("ngIf",!1),a(2),c("ngIf",!n.isModal),a(3),S(" ",e.category," "),a(5),_(e.description),a(6),_(e.primaryMuscleGroup),a(5),c("ngForOf",e.muscleGroups),a(),c("ngIf",e.equipmentNeeded&&e.equipmentNeeded.length>0),a(),c("ngIf",e.notes),a(),c("ngIf",e.videoUrl),a(),c("ngIf",n.exercisePBs().length>0),a(),c("ngIf",q(29,15,n.trackingService.workoutLogs$)),a(2),c("ngIf",n.exercise()&&n.hasSufficientProgressData),a(),c("ngIf",n.exercise()&&q(32,17,n.trackingService.workoutLogs$))}}function st(i,t){if(i&1&&(o(0,"span",92),d(1),P(2,"number"),r()),i&2){let e=l().$implicit;a(),S(" 1RM: ",O(2,1,(e.weightUsed??0)*(36/(37-e.repsAchieved)),"1.0-1")," ")}}function ct(i,t){if(i&1&&(o(0,"li",89)(1,"span"),d(2),o(3,"strong",90),d(4),r()(),p(5,st,3,4,"span",91),r()),i&2){let e=t.$implicit,n=t.index,s=l(4).ngIf,m=l();a(2),S("Set ",n+1,": "),a(2),_(m.formatSetDisplay(e)),a(),c("ngIf",s.category!=="cardio"&&e.weightUsed&&e.repsAchieved)}}function lt(i,t){if(i&1&&(o(0,"div",83)(1,"div",84)(2,"h3",85),d(3),r(),o(4,"p",86),d(5),P(6,"date"),r()(),o(7,"ul",87),p(8,ct,6,3,"li",88),r()()),i&2){let e=t.$implicit,n=l(4);a(3),S("",e.routineName||"Ad-hoc Workout"," "),a(2),_(O(6,3,e.startTime,"medium")),a(3),c("ngForOf",n.getSetsForExerciseInLog(e))}}function dt(i,t){if(i&1&&(o(0,"div"),p(1,lt,9,6,"div",82),r()),i&2){let e=l(3);a(),c("ngForOf",e.exerciseHistory())}}function mt(i,t){i&1&&(o(0,"p",93),d(1,"No workout history found for this exercise."),r())}function pt(i,t){if(i&1&&(o(0,"div",81),p(1,dt,2,1,"div",8)(2,mt,2,0,"ng-template",null,3,I),r()),i&2){let e=M(3),n=l(2);H("tab-content-active",n.activeTab()==="history"),a(),c("ngIf",n.exerciseHistory().length>0)("ngIfElse",e)}}function xt(i,t){if(i&1&&(o(0,"div",96),b(1,"ngx-charts-line-chart",97),r()),i&2){let e=l(4);a(),c("results",e.est1rmChartData())("scheme",e.progressChartColorScheme)("xAxis",!0)("yAxis",!0)("timeline",!0)("autoScale",!0)}}function gt(i,t){if(i&1&&(o(0,"div",96),b(1,"ngx-charts-line-chart",97),r()),i&2){let e=l(4);a(),c("results",e.maxWeightChartData())("scheme",e.progressChartColorScheme)("xAxis",!0)("yAxis",!0)("timeline",!0)("autoScale",!0)}}function _t(i,t){if(i&1&&(o(0,"div",96),b(1,"ngx-charts-line-chart",97),r()),i&2){let e=l(4);a(),c("results",e.totalVolumeChartData())("scheme",e.progressChartColorScheme)("xAxis",!0)("yAxis",!0)("timeline",!0)("autoScale",!0)}}function ut(i,t){if(i&1&&(R(0),o(1,"div")(2,"h3",94),d(3,"Miglior set (est. 1RM)"),r(),p(4,xt,2,6,"div",95),r(),o(5,"div")(6,"h3",94),d(7,"Miglior set (peso massimo)"),r(),p(8,gt,2,6,"div",95),r(),o(9,"div")(10,"h3",94),d(11,"Volume totale (kg)"),r(),p(12,_t,2,6,"div",95),r(),V()),i&2){l();let e=M(4),n=l(2);a(4),c("ngIf",n.est1rmChartData().length>0)("ngIfElse",e),a(4),c("ngIf",n.maxWeightChartData().length>0)("ngIfElse",e),a(4),c("ngIf",n.totalVolumeChartData().length>0)("ngIfElse",e)}}function ft(i,t){if(i&1&&(o(0,"div",96),b(1,"ngx-charts-line-chart",97),r()),i&2){let e=l(4);a(),c("results",e.maxDistanceChartData())("scheme",e.progressChartColorScheme)("xAxis",!0)("yAxis",!0)("timeline",!0)("autoScale",!0)}}function ht(i,t){if(i&1&&(o(0,"div",96),b(1,"ngx-charts-line-chart",97),r()),i&2){let e=l(4);a(),c("results",e.maxDurationChartData())("scheme",e.progressChartColorScheme)("xAxis",!0)("yAxis",!0)("timeline",!0)("autoScale",!0)}}function vt(i,t){if(i&1&&(R(0),o(1,"div")(2,"h3",94),d(3),r(),p(4,ft,2,6,"div",95),r(),o(5,"div")(6,"h3",94),d(7,"Max duration (s)"),r(),p(8,ht,2,6,"div",95),r(),V()),i&2){l();let e=M(4),n=l(2);a(3),S("Max distance (",n.unitService.getDistanceMeasureUnitSuffix(),")"),a(),c("ngIf",n.maxDistanceChartData().length>0)("ngIfElse",e),a(4),c("ngIf",n.maxDurationChartData().length>0)("ngIfElse",e)}}function yt(i,t){i&1&&(o(0,"p",98),d(1,"Not enough data to create a chart. Log at least two sessions to see your progress."),r())}function bt(i,t){if(i&1&&(o(0,"div",32),p(1,ut,13,6,"ng-container",47)(2,vt,9,5,"ng-container",47)(3,yt,2,0,"ng-template",null,4,I),r()),i&2){let e=l().ngIf,n=l();H("tab-content-active",n.activeTab()==="graphs"),a(),c("ngIf",e.category!=="cardio"),a(),c("ngIf",e.category==="cardio")}}function Ct(i,t){if(i&1&&(o(0,"div",103)(1,"p",104),d(2),o(3,"span",105),d(4),r()(),o(5,"p",106),d(6),r()()),i&2){let e=t.$implicit;a(2),_(e.value),a(2),_(e.unit),a(2),_(e.label)}}function Et(i,t){if(i&1&&(o(0,"div",101),p(1,Ct,7,3,"div",102),r()),i&2){let e=l(3);a(),c("ngForOf",e.personalRecords())}}function St(i,t){i&1&&(o(0,"p",107),d(1,"No personal records have been set for this exercise yet."),r())}function wt(i,t){i&1&&(R(0),o(1,"div",108),b(2,"table",109),r(),V())}function Dt(i,t){i&1&&(o(0,"p",110),d(1,"Rep-based records are not applicable for this cardio exercise."),r())}function It(i,t){if(i&1&&(o(0,"div",32)(1,"h3",99),d(2,"PERSONAL BESTS"),r(),p(3,Et,2,1,"div",100)(4,St,2,0,"ng-template",null,5,I)(6,wt,3,0,"ng-container",8)(7,Dt,2,0,"ng-template",null,6,I),r()),i&2){let e=M(5),n=M(8),s=l().ngIf,m=l();H("tab-content-active",m.activeTab()==="records"),a(3),c("ngIf",m.personalRecords().length>0)("ngIfElse",e),a(3),c("ngIf",s.category!=="cardio")("ngIfElse",n)}}function kt(i,t){if(i&1){let e=A();R(0),o(1,"header",9),p(2,Ve,4,1,"div",10),o(3,"div",11),p(4,Be,2,1,"div",12),r()(),o(5,"div",13)(6,"nav",14)(7,"button",15),C("click",function(){u(e);let s=l();return f(s.selectTab("description"))}),d(8," DESCRIPTION "),r(),o(9,"button",15),C("click",function(){u(e);let s=l();return f(s.selectTab("history"))}),d(10," HISTORY "),r(),o(11,"button",15),C("click",function(){u(e);let s=l();return f(s.selectTab("graphs"))}),d(12," GRAPHS "),r(),o(13,"button",15),C("click",function(){u(e);let s=l();return f(s.selectTab("records"))}),d(14," RECORDS "),r()()(),o(15,"div",16)(16,"div",17),C("swipeleft",function(){u(e);let s=l();return f(s.onSwipe("left"))})("swiperight",function(){u(e);let s=l();return f(s.onSwipe("right"))}),o(17,"div",18),p(18,ot,33,19,"div",19)(19,pt,4,4,"div",20)(20,bt,5,4,"div",19)(21,It,9,6,"div",19),r()()(),V()}if(i&2){let e=l();a(2),c("ngIf",!e.isModal),a(2),c("ngIf",e.exercise()),a(3),c("ngClass",N(14,G,e.activeTab()==="description",e.activeTab()!=="description")),a(2),c("ngClass",N(17,G,e.activeTab()==="history",e.activeTab()!=="history")),a(2),c("ngClass",N(20,G,e.activeTab()==="graphs",e.activeTab()!=="graphs")),a(2),c("ngClass",N(23,G,e.activeTab()==="records",e.activeTab()!=="records")),a(4),ce("height",e.contentHeight),c("ngSwitch",e.activeTab())("@tabSlide",e.activeTabIndex()),a(),c("ngSwitchCase","description"),a(),c("ngSwitchCase","history"),a(),c("ngSwitchCase","graphs"),a(),c("ngSwitchCase","records")}}function Tt(i,t){i&1&&(o(0,"div",112)(1,"p",113),d(2,"Loading exercise details..."),r()())}function At(i,t){i&1&&(o(0,"a",116),d(1,"Go to Library"),r())}function Mt(i,t){if(i&1&&(o(0,"div",112)(1,"h2",114),d(2,"Exercise Not Found"),r(),o(3,"p",42),d(4,"The exercise you are looking for does not exist or could not be loaded"),r(),p(5,At,2,0,"a",115),r()),i&2){let e=l(2);a(5),c("ngIf",!e.isModal)}}function Pt(i,t){if(i&1&&p(0,Tt,3,0,"div",111)(1,Mt,6,1,"ng-template",null,7,I),i&2){let e=M(2),n=l();c("ngIf",n.exercise()===void 0)("ngIfElse",e)}}var Pe=class i{tabs=["description","history","graphs","records"];decimalPipe=D(W);route=D(ye);router=D(be);exerciseService=D(Ie);trackingService=D(ke);alertService=D(we);unitService=D(De);exercise=h(void 0);muscleDataForMap={primary:[],secondary:[]};currentImageIndex=h(0);exercisePBs=h([]);exerciseProgressChartData=h([]);exerciseDetailSub;progressChartView=[700,300];progressChartColorScheme="cool";progressChartXAxisLabel="Date";progressChartYAxisLabel=`Max Weight Lifted (${this.unitService.getWeightUnitSuffix()})`;progressChartShowXAxis=!0;progressChartShowYAxis=!0;progressChartGradient=!1;progressChartShowXAxisLabel=!0;progressChartShowYAxisLabel=!0;progressChartTimeline=!0;progressChartAutoScale=!0;id;isModal=!1;exerciseIdForLoad=null;platformId=D(oe);isViewMode=h(null);activeTab=h("description");exerciseHistory=h([]);est1rmChartData=h([]);maxWeightChartData=h([]);totalVolumeChartData=h([]);maxDurationChartData=h([]);maxDistanceChartData=h([]);ngOnChanges(t){if(t.id){let e=t.id.currentValue,n=t.id.previousValue;e&&e!==this.exerciseIdForLoad&&(this.exerciseIdForLoad=e,this.loadInitialData())}}ngOnInit(){ve(this.platformId)&&(this.isModal||window.scrollTo(0,0)),this.loadInitialData()}loadInitialData(){let t=this.id?Q(this.id):this.route.paramMap.pipe(ee(e=>e.get("id")));this.exerciseDetailSub?.unsubscribe(),this.exerciseDetailSub=t.pipe(ie(e=>{this.exerciseIdForLoad=e,this.resetComponentState(),e?(this.isViewMode.set(!0),this.loadExerciseData(e)):this.exercise.set(null)})).subscribe()}resetComponentState(){this.exercise.set(void 0),this.exercisePBs.set([]),this.exerciseProgressChartData.set([])}loadExercise(t){this.exerciseService.getExerciseById(t).subscribe(e=>{this.exercise.set(e||null),this.currentImageIndex.set(0)})}nextImage(){let t=this.exercise();t&&t.imageUrls.length>1&&this.currentImageIndex.update(e=>(e+1)%t.imageUrls.length)}prevImage(){let t=this.exercise();t&&t.imageUrls.length>1&&this.currentImageIndex.update(e=>(e-1+t.imageUrls.length)%t.imageUrls.length)}loadExercisePBs(t){this.trackingService.getAllPersonalBestsForExercise(t).pipe($(1)).subscribe(e=>{let n=e.sort((s,m)=>s.pbType.includes("RM (Actual)")&&!m.pbType.includes("RM (Actual)")?-1:!s.pbType.includes("RM (Actual)")&&m.pbType.includes("RM (Actual)")?1:s.pbType.includes("RM (Estimated)")&&!m.pbType.includes("RM (Estimated)")?-1:!s.pbType.includes("RM (Estimated)")&&m.pbType.includes("RM (Estimated)")?1:(m.weightUsed??0)-(s.weightUsed??0)||s.pbType.localeCompare(m.pbType));this.exercisePBs.set(n),console.log(`PBs for ${t}:`,n)})}formatPbValue(t){let e="";return t.weightUsed!==void 0&&t.weightUsed!==null?(e+=`${t.weightUsed}${this.unitService.getWeightUnitSuffix()}`,t.repsAchieved>1&&!t.pbType.includes("RM (Actual)")&&!t.pbType.includes("RM (Estimated)")?e+=` x ${t.repsAchieved}`:t.repsAchieved>1&&t.pbType==="Heaviest Lifted"&&(e+=` x ${t.repsAchieved}`)):t.repsAchieved>0&&t.pbType.includes("Max Reps")?e=`${t.repsAchieved} reps`:t.durationPerformed&&t.durationPerformed>0&&t.pbType.includes("Max Duration")&&(e=`${t.durationPerformed}s`),e||"N/A"}loadExerciseData(t){te({baseExercise:this.exerciseService.getExerciseById(t).pipe($(1)),pbs:this.trackingService.getAllPersonalBestsForExercise(t).pipe($(1)),history:this.trackingService.getLogsForExercise(t).pipe($(1))}).subscribe(({baseExercise:e,pbs:n,history:s})=>{this.exercise.set(e||null),this.currentImageIndex.set(0);let m=n.sort((x,g)=>(g.weightUsed??0)-(x.weightUsed??0)||x.pbType.localeCompare(g.pbType));this.exercisePBs.set(m),this.exerciseHistory.set(s),e&&(this.muscleDataForMap={primary:[e.primaryMuscleGroup],secondary:e.muscleGroups.filter(x=>x!==e.primaryMuscleGroup)}),this.prepareChartData(s,e?.name||"Progress")},e=>{console.error("Error loading exercise details page data:",e),this.exercise.set(null)})}onProgressChartSelect(t){console.log("Progress chart item selected:",t),t.extra&&t.extra.logId}get hasSufficientProgressData(){let t=this.exerciseProgressChartData();return t.length>0&&t[0]&&t[0].series&&t[0].series.length>1}confirmDeleteExercise(t){return J(this,null,function*(){if(!t)return;let e=[{text:"Cancel",role:"cancel",data:!1,cssClass:"bg-gray-300 hover:bg-gray-500"},{text:"Delete Exercise",role:"confirm",data:!0,cssClass:"button-danger"}],n=yield this.alertService.showConfirmationDialog("Confirm Deletion",`Are you sure you want to delete the exercise "${t.name}"? 
      If this exercise is part of any past workout logs, it will be removed from those logs. 
      If a log becomes empty as a result, the entire log might be deleted. This action cannot be undone.`,e);if(n&&n.data===!0)try{yield this.exerciseService.deleteExercise(t.id),this.alertService.showAlert("Success",`Exercise "${t.name}" deleted successfully`),this.router.navigate(["/library"])}catch(s){console.error("Error deleting exercise:",s),this.alertService.showAlert("Error",`Failed to delete exercise: ${s.message||"Unknown error"}`)}})}ngOnDestroy(){this.exerciseDetailSub?.unsubscribe()}getExerciseDropdownActionItems(t,e){let n="rounded text-left px-3 py-1.5 sm:px-4 sm:py-2 font-medium text-gray-600 dark:text-gray-300 hover:bg-primary flex items-center text-sm hover:text-white dark:hover:text-gray-100 dark:hover:text-white",s="rounded text-left px-3 py-1.5 sm:px-4 sm:py-2 font-medium text-gray-600 dark:text-gray-300 hover:bg-red-600 flex items-center text-sm hover:text-gray-100 hover:animate-pulse",m={label:"EDIT",actionKey:"edit",iconSvg:'<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" /></svg>',iconClass:"w-8 h-8 mr-2",buttonClass:(e==="dropdown"?"w-full ":"")+n,data:{routineId:t}},x={label:"DELETE",actionKey:"delete",iconSvg:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.75 1A2.75 2.75 0 006 3.75v.443c-.795.077-1.58.177-2.365.298a.75.75 0 10.23 1.482l.149-.022.841 10.518A2.75 2.75 0 007.596 19h4.807a2.75 2.75 0 002.742-2.53l.841-10.52.149.023a.75.75 0 00.23-1.482A41.03 41.03 0 0014 4.193V3.75A2.75 2.75 0 0011.25 1h-2.5ZM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4ZM8.58 7.72a.75.75 0 00-1.5.06l.3 7.5a.75.75 0 101.5-.06l-.3-7.5Zm4.34.06a.75.75 0 10-1.5-.06l-.3 7.5a.75.75 0 101.5.06l.3-7.5Z" clip-rule="evenodd" /></svg>',iconClass:"w-8 h-8 mr-2",buttonClass:(e==="dropdown"?"w-full ":"")+s,data:{routineId:t}},g=this.exercise,v=[];return this.isViewMode()&&(v.push(m),v.push({isDivider:!0})),v.push(x),v}handleActionMenuItemClick(t,e){let n=this.exercise(),s=n?.id;if(s){switch(t.actionKey){case"edit":this.router.navigate(["/library/edit/",s]);break;case"delete":this.confirmDeleteExercise(n);break}this.activeRoutineIdActions.set(null)}}activeRoutineIdActions=h(null);toggleActions(t,e){e.stopPropagation(),this.activeRoutineIdActions.update(n=>n===t?null:t)}areActionsVisible(t){return this.activeRoutineIdActions()===t}onCloseActionMenu(){this.activeRoutineIdActions.set(null)}personalRecords=j(()=>{let t=this.exercisePBs(),e=this.exercise(),n=[];if(e?.category==="cardio"){let s=t.find(x=>x.pbType==="Max Distance"),m=t.find(x=>x.pbType==="Max Duration");s&&n.push({label:"Max distance",value:this.decimalPipe.transform(s.distanceAchieved,"1.0-2")??"0",unit:this.unitService.getDistanceMeasureUnitSuffix()}),m&&n.push({label:"Max duration",value:this.formatDurationForRecord(m.durationPerformed),unit:""})}else{let s=t.find(g=>g.pbType==="1RM (Estimated)"),m=t.find(g=>g.pbType==="Max Volume"),x=t.find(g=>g.pbType==="Heaviest Lifted");s&&n.push({label:"1RM stimata",value:this.decimalPipe.transform(s.weightUsed,"1.0-1")??"0",unit:"kg"}),m&&n.push({label:"Volume massimo",value:this.decimalPipe.transform(m.volume,"1.0-1")??"0",unit:"kg"}),x&&n.push({label:"Peso massimo",value:this.decimalPipe.transform(x.weightUsed,"1.0-1")??"0",unit:"kg"})}return n});repRecords=j(()=>{let t=this.exerciseHistory(),e=this.exercise()?.id;if(!t.length||!e)return[];let n={};for(let m of t){let x=m.exercises.find(g=>g.exerciseId===e);if(x)for(let g of x.sets){let v=g.repsAchieved,F=g.weightUsed??0;v>0&&F>0&&(!n[v]||F>n[v].weight)&&(n[v]={weight:F,reps:v,date:m.startTime})}}let s=[];for(let m=1;m<=12;m++){let x=n[m];s.push({reps:m,bestPerformance:x||null,estimated1RM:x?x.weight*(36/(37-x.reps)):0})}return s});prepareChartData(t,e){if(!t||t.length<2){this.est1rmChartData.set([]),this.maxWeightChartData.set([]),this.totalVolumeChartData.set([]),this.maxDurationChartData.set([]),this.maxDistanceChartData.set([]);return}let n=this.exercise()?.id,s=this.exercise()?.category==="cardio",m=[],x=[],g=[],v=[],F=[];t.forEach(B=>{let Y=B.exercises.find(E=>E.exerciseId===n);if(Y)if(s){let E=0,k=0;Y.sets.forEach(y=>{y.durationPerformed&&y.durationPerformed>E&&(E=y.durationPerformed),y.distanceAchieved&&y.distanceAchieved>k&&(k=y.distanceAchieved)}),E>0&&v.push({name:new Date(B.startTime),value:E}),k>0&&F.push({name:new Date(B.startTime),value:k})}else{let E=0,k=0,y=null;if(Y.sets.forEach(U=>{let T=U.weightUsed??0;k+=T*U.repsAchieved,T>E&&(E=T),T>0&&(!y||T>y.weight)&&(y={weight:T,reps:U.repsAchieved})}),y){let U=y,T=U.weight*(36/(37-U.reps));m.push({name:new Date(B.startTime),value:T})}E>0&&x.push({name:new Date(B.startTime),value:E}),k>0&&g.push({name:new Date(B.startTime),value:k})}}),s?(this.maxDurationChartData.set([{name:"Max Duration (s)",series:v}]),this.maxDistanceChartData.set([{name:`Max Distance (${this.unitService.getDistanceMeasureUnitSuffix()})`,series:F}])):(this.est1rmChartData.set([{name:e,series:m}]),this.maxWeightChartData.set([{name:e,series:x}]),this.totalVolumeChartData.set([{name:e,series:g}]))}selectTab(t){this.measureContentHeight(),this.activeTab.set(t),setTimeout(()=>this.contentHeight="auto",300)}onSwipe(t){if(this.isAnimating)return;this.isAnimating=!0;let e=this.tabs.indexOf(this.activeTab()),n;t==="left"?n=e+1:n=e-1,n>=0&&n<this.tabs.length&&this.selectTab(this.tabs[n]),setTimeout(()=>this.isAnimating=!1,300)}getSetsForExerciseInLog(t){let e=this.exercise()?.id;return e?t.exercises.find(s=>s.exerciseId===e)?.sets||[]:[]}activeTabIndex=j(()=>this.tabs.indexOf(this.activeTab()));elRef=D(ae);isAnimating=!1;contentHeight="auto";measureContentHeight(){let t=this.elRef.nativeElement.querySelector(".tab-content-active");t&&(this.contentHeight=`${t.offsetHeight}px`)}formatSetDisplay(t){let e=[];return t.weightUsed!=null&&t.weightUsed>0?e.push(`${this.decimalPipe.transform(t.weightUsed,"1.0-2")} ${this.unitService.getWeightUnitSuffix()}`):(t.weightUsed===0||t.weightUsed===null)&&t.repsAchieved>0&&e.push("Bodyweight"),t.repsAchieved>0&&e.push(`${t.repsAchieved} reps`),t.distanceAchieved&&t.distanceAchieved>0&&e.push(`${this.decimalPipe.transform(t.distanceAchieved,"1.0-2")} ${this.unitService.getDistanceMeasureUnitSuffix()}`),t.durationPerformed&&t.durationPerformed>0&&e.push(this.formatDurationForRecord(t.durationPerformed)),e.length>0?e.join(" x "):"Set data not recorded"}formatDurationForRecord(t){if(!t)return"";let e=Math.floor(t/60),n=t%60,s="";return e>0&&(s+=`${e}m `),n>0&&(s+=`${n}s`),s.trim()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=se({type:i,selectors:[["app-exercise-detail"]],inputs:{id:"id",isModal:"isModal"},features:[de([W]),re],decls:3,vars:2,consts:[["loadingOrNotFound",""],["tooltipTemplate",""],["seriesTooltipTemplate",""],["noHistory",""],["noChartData",""],["noRecords",""],["cardioRepRecords",""],["notFound",""],[4,"ngIf","ngIfElse"],[1,"flex","items-center","justify-between","p-2"],["class","flex justify-between items-center",4,"ngIf"],[1,"flex","items-center","space-x-2","flex-shrink-0"],["class","",4,"ngIf"],[1,"border-b","border-gray-200","dark:border-gray-700","px-3","mb-2"],["aria-label","Tabs",1,"-mb-px","flex","space-x-4","sm:space-x-6"],[1,"whitespace-nowrap","py-3","px-1","border-b-2","font-medium","text-sm",3,"click","ngClass"],[1,"rounded-md","shadow-xl","overflow-hidden","mx-1"],[3,"swipeleft","swiperight"],[1,"relative",3,"ngSwitch"],["class","tab-content",3,"tab-content-active",4,"ngSwitchCase"],["class","tab-content bg-gray-200 dark:bg-gray-900",3,"tab-content-active",4,"ngSwitchCase"],[1,"flex","justify-between","items-center"],[1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-ml-1",3,"routerLink"],["name","back",1,"h-7","w-7"],[1,"w-10","h-10"],[1,""],["class","relative",4,"ngIf"],[1,"relative"],[1,"text-gray-500","dark:text-gray-400","hover:bg-gray-200","dark:hover:bg-gray-500","rounded-full","focus:outline-none","flex","items-center",3,"click"],["name","menu-action",1,"h-10","w-10"],["displayMode","dropdown",3,"items","isVisible","itemClick","closeMenu",4,"ngIf"],["displayMode","dropdown",3,"itemClick","closeMenu","items","isVisible"],[1,"tab-content"],[1,"mb-4"],[1,"p-3"],["class","flex justify-between pb-1 sm:flex-row",4,"ngIf"],[1,"px-3","py-1","text-xs","font-semibold","rounded-full","bg-primary-light","text-white","dark:bg-primary-dark","dark:text-primary-light","capitalize"],[1,"mb-6"],[1,"text-xl","font-semibold","mb-2","text-gray-700","dark:text-gray-300"],[1,"text-gray-600","dark:text-gray-400","leading-relaxed"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6","mb-6"],[1,"text-lg","font-semibold","mb-2","text-gray-700","dark:text-gray-300"],[1,"text-gray-600","dark:text-gray-400"],[1,"list-disc","list-inside","text-gray-600","dark:text-gray-400"],[4,"ngFor","ngForOf"],["class","mb-6",4,"ngIf"],["class","mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",4,"ngIf"],[4,"ngIf"],["class","mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",4,"ngIf"],[1,"w-full","h-64","sm:h-80","md:h-96","object-contain","bg-gray-200","dark:bg-gray-700",3,"src","alt"],["class","absolute top-1/2 left-2 transform -translate-y-1/2 bg-black bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-75 focus:outline-none",3,"click",4,"ngIf"],["class","absolute top-1/2 right-2 transform -translate-y-1/2 bg-black bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-75 focus:outline-none",3,"click",4,"ngIf"],["class","absolute bottom-2 left-1/2 transform -translate-x-1/2 flex space-x-2",4,"ngIf"],[1,"absolute","top-1/2","left-2","transform","-translate-y-1/2","bg-black","bg-opacity-50","text-white","p-2","rounded-full","hover:bg-opacity-75","focus:outline-none",3,"click"],[1,"absolute","top-1/2","right-2","transform","-translate-y-1/2","bg-black","bg-opacity-50","text-white","p-2","rounded-full","hover:bg-opacity-75","focus:outline-none",3,"click"],[1,"absolute","bottom-2","left-1/2","transform","-translate-x-1/2","flex","space-x-2"],["class","w-3 h-3 rounded-full cursor-pointer",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"w-3","h-3","rounded-full","cursor-pointer",3,"click","ngClass"],[1,"flex","justify-between","pb-1","sm:flex-row"],[1,"flex","text-3xl","md:text-4xl","font-bold","mb-3","text-gray-800","dark:text-gray-100"],[1,"text-gray-600","dark:text-gray-400","whitespace-pre-line"],["target","_blank","rel","noopener noreferrer",1,"inline-flex","items-center","px-4","py-2","border","border-transparent","text-sm","font-medium","rounded-md","shadow-sm","text-white","bg-red-600","hover:bg-red-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-red-500",3,"href"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"w-5","h-5","mr-2"],["d","M3 4a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H3Zm10 6.004a.75.75 0 0 0-.504-.705l-4.25-2.125a.75.75 0 0 0-1.042.705v4.25a.75.75 0 0 0 1.042.705l4.25-2.125A.75.75 0 0 0 13 10.004Z"],[1,"mt-6","pt-6","border-t","border-gray-200","dark:border-gray-700"],[1,"text-xl","font-semibold","mb-3","text-gray-700","dark:text-gray-300"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-3","gap-4","mb-2"],["class","p-4 bg-gray-50 dark:bg-gray-700 rounded-md border dark:border-gray-600 shadow-sm",4,"ngFor","ngForOf"],[1,"p-4","bg-gray-50","dark:bg-gray-700","rounded-md","border","dark:border-gray-600","shadow-sm"],[1,"text-sm","font-medium","text-primary","dark:text-primary-light"],[1,"text-2xl","font-bold","text-gray-800","dark:text-gray-100","mt-1"],[1,"text-xs","text-gray-500","dark:text-gray-400","mt-1"],["class","mt-2 text-xs italic text-gray-500 dark:text-gray-400 line-clamp-2",3,"title",4,"ngIf"],[1,"mt-2","text-xs","italic","text-gray-500","dark:text-gray-400","line-clamp-2",3,"title"],[1,"text-md","text-gray-600","dark:text-gray-400","italic"],[1,"mt-8","pt-6","border-t","border-gray-200","dark:border-gray-700"],[1,"text-xl","font-semibold","mb-4","text-gray-700","dark:text-gray-300"],[1,"bg-white","dark:bg-gray-700","p-1","rounded-md","shadow-md","min-h-[350px]","overflow-auto"],[3,"select","view","scheme","results","legend","xAxis","yAxis","xAxisLabel","yAxisLabel","timeline","showXAxisLabel","showYAxisLabel","autoScale"],[1,"p-2","bg-gray-700","text-white","rounded","shadow-lg","text-xs"],[1,"dark:text-gray-200"],[1,"tab-content","bg-gray-200","dark:bg-gray-900"],["class","bg-gray-100 dark:bg-gray-700 p-4 rounded-lg border dark:border-gray-600 mb-2",4,"ngFor","ngForOf"],[1,"bg-gray-100","dark:bg-gray-700","p-4","rounded-lg","border","dark:border-gray-600","mb-2"],[1,"flex","justify-between","items-baseline","mb-2"],[1,"font-semibold","text-gray-800","dark:text-gray-100"],[1,"text-xs","text-gray-500","dark:text-gray-400"],[1,"space-y-1","text-sm","text-gray-600","dark:text-gray-300"],["class","flex justify-between",4,"ngFor","ngForOf"],[1,"flex","justify-between"],[1,"text-gray-800","dark:text-white"],["class","font-mono text-xs text-gray-500",4,"ngIf"],[1,"font-mono","text-xs","text-gray-500"],[1,"text-center","text-gray-500","dark:text-gray-400","py-8"],[1,"font-semibold","text-gray-800","dark:text-gray-100","mb-2"],["class","bg-white dark:bg-gray-700 p-1 rounded-md shadow-md h-64",4,"ngIf","ngIfElse"],[1,"bg-white","dark:bg-gray-700","p-1","rounded-md","shadow-md","h-64"],[3,"results","scheme","xAxis","yAxis","timeline","autoScale"],[1,"text-center","text-gray-500","dark:text-gray-400","py-8","text-sm"],[1,"text-lg","font-semibold","text-gray-800","dark:text-gray-100","mb-4"],["class","grid grid-cols-3 gap-4 mb-8",4,"ngIf","ngIfElse"],[1,"grid","grid-cols-3","gap-4","mb-8"],["class","text-center bg-gray-100 dark:bg-gray-700 p-3 rounded-lg",4,"ngFor","ngForOf"],[1,"text-center","bg-gray-100","dark:bg-gray-700","p-3","rounded-lg"],[1,"text-2xl","font-bold","text-gray-900","dark:text-white"],[1,"text-base","font-medium","ml-1"],[1,"text-xs","text-gray-500","dark:text-gray-400","uppercase","tracking-wider"],[1,"text-center","text-gray-500","dark:text-gray-400","mb-8"],[1,"overflow-x-auto"],[1,"min-w-full","text-sm","text-left","text-gray-500","dark:text-gray-400"],[1,"text-center","text-gray-500","dark:text-gray-400","text-sm"],["class","text-center py-10",4,"ngIf","ngIfElse"],[1,"text-center","py-10"],[1,"text-xl","text-gray-600","dark:text-gray-400"],[1,"text-2xl","font-semibold","mb-4","text-gray-700","dark:text-gray-200"],["routerLink","/library","class","mt-4 inline-block bg-primary hover:bg-primary-dark text-white font-semibold py-2 px-4 rounded-md",4,"ngIf"],["routerLink","/library",1,"mt-4","inline-block","bg-primary","hover:bg-primary-dark","text-white","font-semibold","py-2","px-4","rounded-md"]],template:function(e,n){if(e&1&&p(0,kt,22,26,"ng-container",8)(1,Pt,3,2,"ng-template",null,0,I),e&2){let s=M(2);c("ngIf",n.exercise())("ngIfElse",s)}},dependencies:[he,me,pe,xe,ge,_e,Ce,Me,Ae,Te,Se,ue,W,fe],styles:[".chart-container[_ngcontent-%COMP%]{min-height:350px;overflow:auto}"],data:{animation:[Ee("tabSlide",[z(":increment",[w({position:"relative",overflow:"hidden"}),L(":enter, :leave",[w({position:"absolute",top:0,left:0,width:"100%"})],{optional:!0}),K([L(":leave",[X("300ms ease-in-out",w({transform:"translateX(-100%)",opacity:0}))],{optional:!0}),L(":enter",[w({transform:"translateX(100%)",opacity:0}),X("300ms ease-in-out",w({transform:"translateX(0%)",opacity:1}))],{optional:!0})])]),z(":decrement",[w({position:"relative",overflow:"hidden"}),L(":enter, :leave",[w({position:"absolute",top:0,left:0,width:"100%"})],{optional:!0}),K([L(":leave",[X("300ms ease-in-out",w({transform:"translateX(100%)",opacity:0}))],{optional:!0}),L(":enter",[w({transform:"translateX(-100%)",opacity:0}),X("300ms ease-in-out",w({transform:"translateX(0%)",opacity:1}))],{optional:!0})])])])]}})};export{Pe as a};
