import{a as ie,b as ne,c as ae,e as oe,f as se}from"./chunk-XXWJJKPG.js";import{a as re}from"./chunk-47TX2J3B.js";import{h as ee,j as te}from"./chunk-UMYZ2ELG.js";import{a as Q}from"./chunk-QJLX4XMQ.js";import"./chunk-I523BVZL.js";import{$c as J,F as R,Ha as l,Ia as a,Ja as n,Ka as v,Kb as Y,Lb as X,N as m,Ra as k,S as C,Sa as b,T as w,Ta as d,Tb as _,U as T,V as P,Wb as j,Xb as D,Z as h,aa as F,ad as K,ca as N,cb as s,db as U,eb as g,ec as G,fb as S,ga as O,gc as Z,hc as q,i as y,ia as o,la as V,m as E,mb as H,n as M,ob as W,qa as $,sb as L,ub as I,va as u,x as A,z as B,zb as z}from"./chunk-3GHTDBH5.js";import"./chunk-GAL4ENT6.js";var de=r=>["/history/log",r];function ce(r,t){r&1&&(a(0,"div",9)(1,"p",10),s(2,"Loading trend data..."),n(),v(3,"div",11),n())}function me(r,t){if(r&1){let e=k();a(0,"div",12)(1,"p",13),T(),a(2,"svg",14),v(3,"path",15),n(),s(4),n(),P(),a(5,"button",16),b("click",function(){C(e);let c=d();return w(c.goBack())}),s(6," Back to Personal Bests "),n()()}if(r&2){let e=d();o(4),g(" ",e.errorMessage()," ")}}function pe(r,t){if(r&1&&(a(0,"div"),s(1),n()),r&2){let e=d().model;o(),g("Reps: ",e.extra.reps)}}function ue(r,t){if(r&1&&(a(0,"div",25),s(1),n()),r&2){let e=d().model;o(),g("Notes: ",e.extra.notes)}}function xe(r,t){r&1&&(a(0,"div",26),s(1,"Click to view log"),n())}function ge(r,t){if(r&1&&(a(0,"div",21)(1,"div")(2,"strong"),s(3),L(4,"date"),n()(),a(5,"div"),s(6),n(),u(7,pe,2,1,"div",22)(8,ue,2,1,"div",23)(9,xe,2,0,"div",24),n()),r&2){let e=t.model,i=d(2);o(3),U(I(4,6,e.name,"mediumDate")),o(3),S("Value: ",e.value," ",i.yAxisLabel().split(" ")[0]),o(),l("ngIf",e.extra==null?null:e.extra.reps),o(),l("ngIf",e.extra==null?null:e.extra.notes),o(),l("ngIf",e.extra==null?null:e.extra.workoutLogId)}}function he(r,t){r&1&&(a(0,"th",33),s(1," Reps "),n())}function fe(r,t){if(r&1&&(a(0,"td",41),s(1),n()),r&2){let e=d().$implicit;o(),g(" ",e.extra==null?null:e.extra.reps," ")}}function ve(r,t){if(r&1&&(a(0,"a",45),v(1,"app-icon",46),s(2," LOG "),n()),r&2){let e=d().$implicit;l("routerLink",W(1,de,e.extra==null?null:e.extra.workoutLogId))}}function be(r,t){if(r&1&&(a(0,"tr",39)(1,"td",40),s(2),L(3,"date"),n(),a(4,"td",41),s(5),n(),u(6,fe,2,1,"td",42),a(7,"td",43),u(8,ve,3,3,"a",44),n()()),r&2){let e=t.$implicit,i=d(3);o(2),g(" ",I(3,4,e.name,"mediumDate")," "),o(3),g(" ",e.value," "),o(),l("ngIf",(i.currentPbType==null?null:i.currentPbType.includes("RM"))||(i.currentPbType==null?null:i.currentPbType.includes("Heaviest Lifted"))),o(2),l("ngIf",e.extra==null?null:e.extra.workoutLogId)}}function ye(r,t){if(r&1&&(a(0,"div",27)(1,"h2",28),s(2," Personal Best History "),n(),a(3,"div",29)(4,"table",30)(5,"thead",31)(6,"tr")(7,"th",32),s(8," Date "),n(),a(9,"th",33),s(10),n(),u(11,he,2,0,"th",34),a(12,"th",35)(13,"span",36),s(14,"Log"),n()()()(),a(15,"tbody",37),u(16,be,9,7,"tr",38),n()()()()),r&2){let e=d(2);o(10),g(" ",e.yAxisLabel()," "),o(),l("ngIf",(e.currentPbType==null?null:e.currentPbType.includes("RM"))||(e.currentPbType==null?null:e.currentPbType.includes("Heaviest Lifted"))),o(5),l("ngForOf",e.historyTableData())}}function _e(r,t){if(r&1){let e=k();a(0,"div",17)(1,"ngx-charts-line-chart",18),b("select",function(c){C(e);let x=d();return w(x.onChartSelect(c))}),u(2,ge,10,9,"ng-template",19),n(),u(3,ye,17,3,"div",20),n()}if(r&2){let e=d();o(),l("view",e.view)("scheme",e.chartColorScheme)("results",e.chartData())("legend",e.legend)("xAxis",e.xAxis)("yAxis",e.yAxis)("showXAxisLabel",e.showXAxisLabel)("showYAxisLabel",e.showYAxisLabel)("xAxisLabel","Date")("yAxisLabel",e.yAxisLabel())("timeline",e.timeline)("autoScale",e.autoScale)("roundDomains",e.roundDomains)("xAxisTickFormatting",e.xAxisTickFormatting)("curve",e.lineChartCurve)("referenceLines",e.lineChartReferenceLines()),o(2),l("ngIf",e.historyTableData().length>0)}}var le=class r{route=m(G);router=m(Z);trackingService=m(te);exerciseService=m(ee);unitsService=m(Q);toastService=m(K);platformId=m(N);datePipe=new _("en-US");themeService=m(re);renderer=m(V);el=m(F);themeSubscription;chartData=h(null);isLoading=h(!0);errorMessage=h(null);historyTableData=z(()=>{let t=this.chartData();return!t||!t[0]||!t[0].series?[]:[...t[0].series].sort((e,i)=>i.name.getTime()-e.name.getTime())});currentExerciseId=null;currentPbType=null;currentExerciseName=h("Exercise");yAxisLabel=h("Value");lineChartReferenceLines=h([]);view=[700,400];legend=!1;showXAxisLabel=!0;showYAxisLabel=!0;xAxis=!0;yAxis=!0;timeline=!0;autoScale=!0;roundDomains=!0;lineChartCurve=ie;chartColorScheme={name:"fitTrackProScheme",selectable:!0,group:ae.Ordinal,domain:["#10B981","#3B82F6","#F97316","#8B5CF6","#F59E0B","#EC4899","#14B8A6","#6366F1"]};xAxisTickFormatting=t=>t instanceof Date?this.datePipe.transform(t,"MMM d, yy")||"":String(t);constructor(){}ngOnInit(){D(this.platformId)&&(this.view=[window.innerWidth>768?700:window.innerWidth-40,400],this.updateChartTextColors(this.themeService.isDarkTheme())),this.themeService.isDarkTheme()?this.updateChartTextColors(!0):this.updateChartTextColors(!1),this.route.paramMap.pipe(B(1),R(t=>{this.isLoading.set(!0),this.errorMessage.set(null),this.chartData.set(null);let e=t.get("exerciseId"),i=t.get("pbType");if(!e||!i)return this.errorMessage.set("Exercise ID or PB Type missing in URL."),this.isLoading.set(!1),y({pb:null,exercise:null,error:"Missing parameters"});this.currentExerciseId=e;try{this.currentPbType=decodeURIComponent(i)}catch{return this.errorMessage.set("Invalid PB Type in URL."),this.isLoading.set(!1),y({pb:null,exercise:null,error:"Invalid PB Type"})}return this.setYAxisLabel(this.currentPbType),M([this.trackingService.getPersonalBestForExerciseByType(this.currentExerciseId,this.currentPbType),this.exerciseService.getExerciseById(this.currentExerciseId)]).pipe(E(([c,x])=>({pb:c,exercise:x,error:null})),A(c=>(console.error("Error fetching PB trend data:",c),this.errorMessage.set("Failed to load data for the trend chart."),y({pb:null,exercise:null,error:"Fetch error"}))))})).subscribe(({pb:t,exercise:e,error:i})=>{if(i){this.isLoading.set(!1);return}this.currentExerciseName.set(e?.name||"Selected Exercise"),t?this.prepareChartData(t):this.errorMessage.set(`No Personal Best data found for "${this.currentExerciseName()}" of type "${this.currentPbType}"`),this.isLoading.set(!1)})}updateChartTextColors(t){let e=t?"#E5E7EB":"#374151";this.renderer.setStyle(this.el.nativeElement,"--ngx-charts-text-color",e)}setYAxisLabel(t){t.includes("RM")||t.includes("Heaviest Lifted")?this.yAxisLabel.set(`Weight (${this.unitsService.getWeightUnitSuffix()})`):t.includes("Max Reps")?this.yAxisLabel.set("Repetitions"):t.includes("Max Duration")?this.yAxisLabel.set("Duration (seconds)"):this.yAxisLabel.set("Value")}prepareChartData(t){let e=[],i=this.extractValueForChart(t,t.pbType);if(i!==null&&t.timestamp&&e.push({name:new Date(t.timestamp),value:i,extra:{reps:t.repsAchieved,notes:t.notes,workoutLogId:t.workoutLogId}}),t.history&&t.history.forEach(p=>{let f=this.extractValueForChart(p,t.pbType);f!==null&&p.timestamp&&e.push({name:new Date(p.timestamp),value:f,extra:{reps:p.repsAchieved,notes:void 0,workoutLogId:p.workoutLogId}})}),e.length<2){this.errorMessage.set("Not enough data points to plot a trend. At least two records are needed."),this.chartData.set(null),this.lineChartReferenceLines.set([]);return}e.sort((p,f)=>p.name.getTime()-f.name.getTime());let x=e.reduce((p,f)=>p+f.value,0)/e.length;this.lineChartReferenceLines.set([{name:`Avg: ${x.toFixed(1)}`,value:x}]),this.chartData.set([{name:`${this.currentPbType||"PB"} Trend`,series:e}])}extractValueForChart(t,e){return e.includes("RM")||e.includes("Heaviest Lifted")?t.weightUsed??null:e.includes("Max Reps")?t.repsAchieved??null:e.includes("Max Duration")?t.durationPerformed??null:t.weightUsed&&t.weightUsed>0?t.weightUsed:t.repsAchieved>0?t.repsAchieved:t.durationPerformed&&t.durationPerformed>0?t.durationPerformed:null}onChartSelect(t){t&&t.extra&&t.extra.workoutLogId?this.router.navigate(["/history/log",t.extra.workoutLogId]):t&&t.extra&&this.toastService.info(`PB achieved: ${t.value} ${this.yAxisLabel().split(" ")[0]} on ${this.datePipe.transform(t.name,"mediumDate")}. ${t.extra.reps?"Reps: "+t.extra.reps:""}`,5e3,"PB Detail")}goBack(){this.router.navigate(["/profile/personal-bests"])}onResize(t){if(D(this.platformId)){let e=t.target;this.view=[e.innerWidth>768?700:e.innerWidth-40,400]}}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=$({type:r,selectors:[["app-pb-trend-chart"]],features:[H([ne])],decls:10,vars:5,consts:[[1,"container","mx-auto","p-4",3,"resize"],[1,"mb-6","flex","items-center"],[1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-ml-2","rounded-full","focus:outline-none","focus:ring-2","focus:ring-primary-focus",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"text-xl","sm:text-2xl","font-bold","text-gray-800","dark:text-gray-200","ml-2"],["class","text-center py-10",4,"ngIf"],["class","text-center py-10 bg-red-50 dark:bg-red-900/30 p-4 rounded-md shadow",4,"ngIf"],["class","bg-white dark:bg-gray-800 p-2 sm:p-4 rounded-md shadow-xl",4,"ngIf"],[1,"text-center","py-10"],[1,"text-lg","text-gray-600","dark:text-gray-400"],[1,"mt-4","animate-spin","rounded-full","h-12","w-12","border-b-2","border-primary","mx-auto"],[1,"text-center","py-10","bg-red-50","dark:bg-red-900/30","p-4","rounded-md","shadow"],[1,"text-lg","font-semibold","text-red-700","dark:text-red-300"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-6","h-6","inline-block","mr-2","align-middle"],["stroke-linecap","round","stroke-linejoin","round","d","M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"],[1,"mt-4","px-4","py-2","bg-primary","text-white","rounded-md","hover:bg-primary-dark","transition-colors",3,"click"],[1,"bg-white","dark:bg-gray-800","p-2","sm:p-4","rounded-md","shadow-xl"],[1,"pb-chart-container",3,"select","view","scheme","results","legend","xAxis","yAxis","showXAxisLabel","showYAxisLabel","xAxisLabel","yAxisLabel","timeline","autoScale","roundDomains","xAxisTickFormatting","curve","referenceLines"],["ngx-charts-tooltip-template",""],["class","mt-8",4,"ngIf"],[1,"chart-tooltip","bg-gray-700","text-white","p-2","rounded","shadow-lg","text-xs"],[4,"ngIf"],["class","max-w-xs truncate",4,"ngIf"],["class","mt-1 text-indigo-300",4,"ngIf"],[1,"max-w-xs","truncate"],[1,"mt-1","text-indigo-300"],[1,"mt-8"],[1,"text-lg","font-semibold","text-gray-700","dark:text-gray-300","mb-4","border-t","pt-4","dark:border-gray-700"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-gray-200","dark:divide-gray-600"],[1,"bg-gray-50","dark:bg-gray-700"],["scope","col",1,"px-4","py-3","text-left","text-xs","font-medium","text-gray-500","dark:text-gray-400","uppercase","tracking-wider","rounded-tl-md"],["scope","col",1,"px-4","py-3","text-left","text-xs","font-medium","text-gray-500","dark:text-gray-400","uppercase","tracking-wider"],["scope","col","class","px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",4,"ngIf"],["scope","col",1,"relative","px-4","py-3","border-l-0","rounded-tr-md"],[1,"sr-only"],[1,"bg-white","dark:bg-gray-800","divide-y","divide-gray-200","dark:divide-gray-700"],["class","hover:bg-gray-50 dark:hover:bg-gray-700/50",4,"ngFor","ngForOf"],[1,"hover:bg-gray-50","dark:hover:bg-gray-700/50"],[1,"px-4","py-4","whitespace-nowrap","text-sm","font-medium","text-gray-900","dark:text-gray-200"],[1,"px-4","py-4","whitespace-nowrap","text-sm","text-gray-500","dark:text-gray-300"],["class","px-4 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",4,"ngIf"],[1,"px-4","py-4","whitespace-nowrap","text-right","text-sm","font-medium"],["class","inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-focus dark:focus:ring-offset-gray-800",3,"routerLink",4,"ngIf"],[1,"inline-flex","items-center","px-3","py-1.5","border","border-transparent","text-xs","font-medium","rounded-md","shadow-sm","text-white","bg-primary","hover:bg-primary-dark","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-primary-focus","dark:focus:ring-offset-gray-800",3,"routerLink"],["name","eye",1,"h-5","w-5","mr-1"]],template:function(e,i){e&1&&(a(0,"div",0),b("resize",function(x){return i.onResize(x)},O),a(1,"div",1)(2,"button",2),b("click",function(){return i.goBack()}),T(),a(3,"svg",3),v(4,"path",4),n()(),P(),a(5,"h1",5),s(6),n()(),u(7,ce,4,0,"div",6)(8,me,7,1,"div",7)(9,_e,4,17,"div",8),n()),e&2&&(o(6),S(" ",i.currentExerciseName()," - ",i.currentPbType||"PB Trend"," "),o(),l("ngIf",i.isLoading()),o(),l("ngIf",i.errorMessage()),o(),l("ngIf",!i.isLoading()&&!i.errorMessage()&&i.chartData()))},dependencies:[j,Y,X,se,oe,q,J,_],styles:["[_nghost-%COMP%]{--ngx-charts-text-color: #374151}[_nghost-%COMP%]     .ngx-charts text{fill:var(--ngx-charts-text-color)!important}[_nghost-%COMP%]     .ngx-charts .axis-label, [_nghost-%COMP%]     .ngx-charts .legend-label{fill:var(--ngx-charts-text-color)!important}.pb-chart-container[_ngcontent-%COMP%]     .ngx-charts{overflow:visible!important}  .chart-tooltip{pointer-events:none;font-size:.75rem}  .chart-tooltip strong{font-weight:600}","[_nghost-%COMP%]     .pb-chart-container .line-series .circle{fill:#fff;stroke:#10b981;stroke-width:2px;r:4px!important}[_nghost-%COMP%]     .pb-chart-container .x.axis .tick text{transform:rotate(-45deg) translate(-10px,-5px);text-anchor:end!important}[_nghost-%COMP%]     .pb-chart-container .ngx-charts-outer, [_nghost-%COMP%]     .pb-chart-container .axis-label, [_nghost-%COMP%]     .pb-chart-container .tick text{fill:var(--ngx-charts-text-color, #374151)}"],changeDetection:0})};export{le as PbTrendChartComponent};
