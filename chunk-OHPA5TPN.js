import{a as nt}from"./chunk-NTFO3FMT.js";import{v as it}from"./chunk-5KPU3EM2.js";import{Bb as F,Fc as K,Gc as u,Hc as q,Ic as R,Ja as p,Ka as r,Kb as k,La as o,Lb as M,Ma as g,Mb as N,Mc as $,Nc as G,O as y,Ra as L,Rb as O,Rc as j,Uc as z,Vc as H,Wc as J,Xb as D,Xc as U,_ as S,ad as Y,bb as c,cb as s,cd as Q,db as f,eb as B,fd as W,gd as X,id as Z,ja as e,jc as V,jd as tt,kd as et,lc as P,mb as h,q as C,ra as w,sb as l,tb as d,wa as v,z as b}from"./chunk-D5SNA2MW.js";import{a as _}from"./chunk-GAL4ENT6.js";var x=t=>({"input-invalid":t});function ot(t,i){t&1&&(r(0,"span"),c(1),l(2,"translate"),o()),t&2&&(e(),s(d(2,1,"logActivity.logTitle")))}function rt(t,i){t&1&&(r(0,"span"),c(1),l(2,"translate"),o()),t&2&&(e(),s(d(2,1,"logActivity.editTitle")))}function lt(t,i){t&1&&(r(0,"span"),c(1),l(2,"translate"),o()),t&2&&(e(),s(d(2,1,"logActivity.logSubtitle")))}function dt(t,i){t&1&&(r(0,"span"),c(1),l(2,"translate"),o()),t&2&&(e(),s(d(2,1,"logActivity.editSubtitle")))}function pt(t,i){if(t&1&&(r(0,"option",30),c(1),o()),t&2){let a=i.$implicit;p("value",a.id),e(),B(" ",a.name," (",a.category,") ")}}function ct(t,i){t&1&&(r(0,"div",31),c(1),l(2,"translate"),o()),t&2&&(e(),f(" ",d(2,1,"logActivity.activityRequired")," "))}function st(t,i){t&1&&(r(0,"div",31),c(1),l(2,"translate"),o()),t&2&&(e(),f(" ",d(2,1,"logActivity.dateRequired")," "))}function mt(t,i){t&1&&(r(0,"div",31),c(1),l(2,"translate"),o()),t&2&&(e(),f(" ",d(2,1,"logActivity.startTimeRequired")," "))}function vt(t,i){t&1&&(r(0,"div",31),c(1),l(2,"translate"),o()),t&2&&(e(),f(" ",d(2,1,"logActivity.endTimeRequired")," "))}function gt(t,i){t&1&&(r(0,"div",31),c(1),l(2,"translate"),o()),t&2&&(e(),f(" ",d(2,1,"logActivity.timeInvalid")," "))}function yt(t,i){t&1&&(r(0,"div")(1,"label",32),c(2),l(3,"translate"),o(),g(4,"input",33),l(5,"translate"),o()),t&2&&(e(2),s(d(3,2,"logActivity.locationLabel")),e(2),p("placeholder",d(5,4,"logActivity.locationPlaceholder")))}function ut(t,i){t&1&&(r(0,"div")(1,"label",34),c(2),l(3,"translate"),o(),g(4,"input",35),l(5,"translate"),o()),t&2&&(e(2),s(d(3,2,"logActivity.distanceLabel")),e(2),p("placeholder",d(5,4,"logActivity.distancePlaceholder")))}function ft(t,i){t&1&&(r(0,"div")(1,"label",36),c(2),l(3,"translate"),o(),g(4,"input",37),l(5,"translate"),o()),t&2&&(e(2),s(d(3,2,"logActivity.caloriesLabel")),e(2),p("placeholder",d(5,4,"logActivity.caloriesPlaceholder")))}function bt(t,i){t&1&&(r(0,"span"),c(1),l(2,"translate"),o()),t&2&&(e(),s(d(2,1,"logActivity.logButton")))}function ht(t,i){t&1&&(r(0,"span"),c(1),l(2,"translate"),o()),t&2&&(e(),s(d(2,1,"logActivity.updateButton")))}function At(t,i){return a=>{let n=a.get(t)?.value,m=a.get(i)?.value;return n&&m&&n>=m?{timeInvalid:!0}:null}}var at=class t{fb=y(Y);activityService=y(nt);toastService=y(X);router=y(P);route=y(V);subscriptionService=y(it);translate=y(Z);logActivityForm;availableActivities$;selectedActivity=S(null);isEditMode=S(!1);editingLogId=null;constructor(){this.logActivityForm=this.fb.group({activityId:["",[u.required]],date:[new Date().toISOString().split("T")[0],[u.required]],startTime:["12:00",[u.required]],endTime:["13:00",[u.required]],intensity:["Medium",[u.required]],location:["",[]],distanceKm:[{value:null,disabled:!0},[u.min(0)]],caloriesBurned:[{value:null,disabled:!0},[u.min(0)]],notes:[""]},{validators:At("startTime","endTime")}),this.availableActivities$=this.activityService.getActivities(),F(()=>{this.updateFormForSelectedActivity(this.selectedActivity())})}ngOnInit(){this.subscriptionService.canAccess("activity")||this.subscriptionService.showUpgradeModal().then(()=>{this.router.navigate(["profile"])}),this.route.paramMap.pipe(b(1)).subscribe(i=>{let a=i.get("id");a&&(this.isEditMode.set(!0),this.editingLogId=a,this.loadLogForEditing(a))}),this.logActivityForm.get("activityId")?.valueChanges.subscribe(i=>{this.activityService.getActivities().pipe(b(1)).subscribe(a=>{let n=a.find(m=>m.id===i);this.selectedActivity.set(n||null)})})}loadLogForEditing(i){C({log:this.activityService.getActivityLogById(i).pipe(b(1)),activities:this.activityService.getActivities().pipe(b(1))}).subscribe(({log:a,activities:n})=>{if(a&&n){let m=n.find(T=>T.id===a.activityId);m&&this.selectedActivity.set(m);let A=new Date(a.startTime),I=a.endTime?new Date(a.endTime):new Date(a.startTime+a.durationMinutes*6e4),E=T=>T.toTimeString().substring(0,5);this.logActivityForm.patchValue({activityId:a.activityId,date:a.date,startTime:E(A),endTime:E(I),intensity:a.intensity,location:a.location,distanceKm:a.distanceKm,caloriesBurned:a.caloriesBurned,notes:a.notes})}else this.toastService.error(this.translate.instant("logActivity.toasts.editError"),0),this.router.navigate(["/history"])})}updateFormForSelectedActivity(i){if(!i){this.logActivityForm.get("distanceKm")?.disable(),this.logActivityForm.get("caloriesBurned")?.disable();return}this.logActivityForm.get("intensity")?.setValue(i.intensity,{emitEvent:!1});let a=i.defaultTrackingMetrics;a.distance?this.logActivityForm.get("distanceKm")?.enable():this.logActivityForm.get("distanceKm")?.disable(),a.calories?this.logActivityForm.get("caloriesBurned")?.enable():this.logActivityForm.get("caloriesBurned")?.disable(),this.logActivityForm.updateValueAndValidity()}onSubmit(){if(this.logActivityForm.invalid){this.toastService.error(this.translate.instant("logActivity.toasts.invalidForm"),0,this.translate.instant("logActivity.toasts.invalidFormTitle")),Object.values(this.logActivityForm.controls).forEach(i=>{i.markAsTouched()});return}this.isEditMode()?this.updateLog():this.createLog()}createLog(){let i=this.prepareLogData();i&&(this.activityService.addActivityLog(i),this.router.navigate(["/history"]))}updateLog(){if(!this.editingLogId)return;let i=this.prepareLogData();if(!i)return;let a=_({id:this.editingLogId},i);this.activityService.updateActivityLog(a),this.router.navigate(["/activities/log",this.editingLogId])}prepareLogData(){let i=this.logActivityForm.getRawValue(),a=this.selectedActivity();if(!a)return null;let n=i.date,m=new Date(`${n}T${i.startTime}`).getTime(),A=new Date(`${n}T${i.endTime}`).getTime(),I=Math.round((A-m)/6e4);return{activityId:a.id,activityName:a.name,date:i.date,startTime:m,endTime:A,durationMinutes:I,intensity:i.intensity,location:i.location,distanceKm:i.distanceKm,caloriesBurned:i.caloriesBurned,notes:i.notes}}get f(){return this.logActivityForm.controls}static \u0275fac=function(a){return new(a||t)};static \u0275cmp=w({type:t,selectors:[["app-log-activity"]],decls:70,vars:64,consts:[[1,"container","mx-auto","max-w-2xl","p-4","sm:p-6"],[1,"mb-6"],[1,"text-3xl","font-bold","text-gray-800","dark:text-gray-200","flex","items-center"],["name","clipboard-list",1,"w-8","h-8","mr-3","text-primary"],[4,"ngIf"],[1,"text-gray-500","dark:text-gray-400","mt-1"],[1,"space-y-6","bg-white","dark:bg-gray-800","p-6","rounded-lg","shadow-md",3,"ngSubmit","formGroup"],["for","activityId",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-1"],["id","activityId","formControlName","activityId",1,"input-field",3,"ngClass"],["value","","disabled",""],[3,"value",4,"ngFor","ngForOf"],["class","validation-message",4,"ngIf"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],["for","date",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-1"],["type","date","id","date","formControlName","date",1,"input-field","dark:text-gray-300","dark:[color-scheme:dark]",3,"ngClass"],["for","startTime",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-1"],["type","time","id","startTime","formControlName","startTime",1,"input-field","dark:text-gray-300","dark:[color-scheme:dark]",3,"ngClass"],["for","endTime",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-1"],["type","time","id","endTime","formControlName","endTime",1,"input-field","dark:text-gray-300","dark:[color-scheme:dark]",3,"ngClass"],["for","intensity",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-1"],["id","intensity","formControlName","intensity",1,"input-field"],["value","Low"],["value","Medium"],["value","High"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],["for","notes",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-1"],["id","notes","formControlName","notes","rows","3",1,"input-field",3,"placeholder"],[1,"pt-4","border-t","border-gray-200","dark:border-gray-700","flex","justify-center"],["type","submit",1,"flex","items-center","text-m","bg-primary","text-white","hover:bg-primary-dark","font-semibold","rounded-md","disabled:opacity-50","p-2",3,"disabled"],["name","save",1,"w-5","h-5","mr-1"],[3,"value"],[1,"validation-message"],["for","location",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-1"],["type","string","id","location","formControlName","location",1,"input-field",3,"placeholder"],["for","distanceKm",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-1"],["type","number","id","distanceKm","formControlName","distanceKm",1,"input-field",3,"placeholder"],["for","caloriesBurned",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-1"],["type","number","id","caloriesBurned","formControlName","caloriesBurned",1,"input-field",3,"placeholder"]],template:function(a,n){a&1&&(r(0,"div",0)(1,"header",1)(2,"h1",2),g(3,"app-icon",3),v(4,ot,3,3,"span",4)(5,rt,3,3,"span",4),o(),r(6,"p",5),v(7,lt,3,3,"span",4)(8,dt,3,3,"span",4),o()(),r(9,"form",6),L("ngSubmit",function(){return n.onSubmit()}),r(10,"div")(11,"label",7),c(12),l(13,"translate"),o(),r(14,"select",8)(15,"option",9),c(16),l(17,"translate"),o(),v(18,pt,2,3,"option",10),l(19,"async"),o(),v(20,ct,3,3,"div",11),o(),r(21,"div",12)(22,"div")(23,"label",13),c(24),l(25,"translate"),o(),g(26,"input",14),v(27,st,3,3,"div",11),o(),r(28,"div")(29,"label",15),c(30),l(31,"translate"),o(),g(32,"input",16),v(33,mt,3,3,"div",11),o(),r(34,"div")(35,"label",17),c(36),l(37,"translate"),o(),g(38,"input",18),v(39,vt,3,3,"div",11)(40,gt,3,3,"div",11),o()(),r(41,"div")(42,"label",19),c(43),l(44,"translate"),o(),r(45,"select",20)(46,"option",21),c(47),l(48,"translate"),o(),r(49,"option",22),c(50),l(51,"translate"),o(),r(52,"option",23),c(53),l(54,"translate"),o()()(),r(55,"div",24),v(56,yt,6,6,"div",4)(57,ut,6,6,"div",4)(58,ft,6,6,"div",4),o(),r(59,"div")(60,"label",25),c(61),l(62,"translate"),o(),g(63,"textarea",26),l(64,"translate"),o(),r(65,"div",27)(66,"button",28),g(67,"app-icon",29),v(68,bt,3,3,"span",4)(69,ht,3,3,"span",4),o()()()()),a&2&&(e(4),p("ngIf",!n.isEditMode()),e(),p("ngIf",n.isEditMode()),e(2),p("ngIf",!n.isEditMode()),e(),p("ngIf",n.isEditMode()),e(),p("formGroup",n.logActivityForm),e(3),s(d(13,32,"logActivity.activityLabel")),e(2),p("ngClass",h(56,x,n.f.activityId.touched&&n.f.activityId.invalid)),e(2),s(d(17,34,"logActivity.selectActivity")),e(2),p("ngForOf",d(19,36,n.availableActivities$)),e(2),p("ngIf",n.f.activityId.touched&&n.f.activityId.invalid),e(4),s(d(25,38,"logActivity.dateLabel")),e(2),p("ngClass",h(58,x,n.f.date.touched&&n.f.date.invalid)),e(),p("ngIf",n.f.date.touched&&n.f.date.invalid),e(3),s(d(31,40,"logActivity.startTimeLabel")),e(2),p("ngClass",h(60,x,n.f.startTime.touched&&n.f.startTime.invalid)),e(),p("ngIf",n.f.startTime.touched&&n.f.startTime.invalid),e(3),s(d(37,42,"logActivity.endTimeLabel")),e(2),p("ngClass",h(62,x,n.f.endTime.touched&&n.f.endTime.invalid||n.logActivityForm.hasError("timeInvalid"))),e(),p("ngIf",n.f.endTime.touched&&n.f.endTime.invalid),e(),p("ngIf",n.logActivityForm.hasError("timeInvalid")&&n.f.endTime.touched),e(3),s(d(44,44,"logActivity.intensityLabel")),e(4),s(d(48,46,"logActivity.intensityOptions.low")),e(3),s(d(51,48,"logActivity.intensityOptions.medium")),e(3),s(d(54,50,"logActivity.intensityOptions.high")),e(3),p("ngIf",n.f.location.enabled),e(),p("ngIf",n.f.distanceKm.enabled),e(),p("ngIf",n.f.caloriesBurned.enabled),e(3),s(d(62,52,"logActivity.notesLabel")),e(2),p("placeholder",d(64,54,"logActivity.notesPlaceholder")),e(3),p("disabled",n.logActivityForm.invalid),e(2),p("ngIf",!n.isEditMode()),e(),p("ngIf",n.isEditMode()))},dependencies:[D,k,M,N,Q,$,J,U,K,G,H,q,R,j,z,W,et,O,tt],styles:[".input-field[_ngcontent-%COMP%]{display:block;width:100%;border-radius:.375rem;border-width:1px;--tw-border-opacity: 1;border-color:rgb(209 213 219 / var(--tw-border-opacity, 1));padding:.5rem;--tw-shadow: 0 1px 2px 0 rgb(0 0 0 / .05);--tw-shadow-colored: 0 1px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.input-field[_ngcontent-%COMP%]:focus{--tw-border-opacity: 1;border-color:rgb(224 70 13 / var(--tw-border-opacity, 1));--tw-ring-opacity: 1;--tw-ring-color: rgb(224 70 13 / var(--tw-ring-opacity, 1)) }.input-field[_ngcontent-%COMP%]:disabled{opacity:.5}.input-field[_ngcontent-%COMP%]:is(.dark *){--tw-border-opacity: 1;border-color:rgb(75 85 99 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(55 65 81 / var(--tw-bg-opacity, 1));--tw-text-opacity: 1;color:rgb(229 231 235 / var(--tw-text-opacity, 1))}.input-invalid[_ngcontent-%COMP%]{--tw-border-opacity: 1;border-color:rgb(239 68 68 / var(--tw-border-opacity, 1));--tw-ring-opacity: 1;--tw-ring-color: rgb(239 68 68 / var(--tw-ring-opacity, 1)) }.validation-message[_ngcontent-%COMP%]{margin-top:.25rem;font-size:.75rem;line-height:1rem;--tw-text-opacity: 1;color:rgb(239 68 68 / var(--tw-text-opacity, 1))}"]})};export{at as LogActivityComponent,At as timeOrderValidator};
