import{a as tt,b as Ut}from"./chunk-JT2PNM7J.js";import{a as Bt}from"./chunk-NEL3U6CV.js";import{a as ye}from"./chunk-5NUCOBOE.js";import{a as Mt,b as At,c as Lt,d as Ot,e as Nt}from"./chunk-CIDBLQBY.js";import"./chunk-HIGJIKAV.js";import{c as ct,d as Be,g as Pe,h as Re,i as Ue}from"./chunk-PPV5CVAY.js";import{h as re}from"./chunk-SRERKVVT.js";import{a as se}from"./chunk-TFFPMAEJ.js";import{b as ne,c as Ft}from"./chunk-RQMSM3S5.js";import{$b as He,A as j,Aa as me,Ab as Ne,Ba as pe,Bb as xe,Cb as te,Da as w,Db as Q,E as ue,Ea as _,Eb as N,Fa as c,G as le,Ja as Ee,Ka as Ce,La as Te,M as E,Ma as K,Mb as It,Na as vt,Nb as fe,O as x,Oa as de,P as f,Pb as ie,Q as C,Qa as u,Qb as he,R as V,Ra as M,Sa as k,Ta as q,Ub as $,V as I,Va as St,W as xt,Wa as De,Wb as $e,Xa as Fe,Xb as B,Ya as Me,Yb as Ge,Zb as je,_ as ce,_a as Ae,_b as Et,a as G,ab as yt,ac as ze,b as z,ba as ft,bb as ge,bc as qe,ca as ht,cb as bt,cc as Je,da as l,db as ut,dc as Ct,ec as Tt,f as W,fb as kt,fc as Ke,gb as A,gc as Pt,hb as U,hc as Rt,ib as H,ic as Wt,kb as Y,kc as Vt,la as J,lc as Dt,m as ae,mb as L,mc as Ye,na as _t,nc as Ze,o as X,oc as Qe,p as we,pb as Le,pc as _e,qa as S,qc as Xe,r as mt,ra as Ie,rc as ve,sc as Se,t as Ve,tb as Oe,u as pt,ub as ee,va as dt,vb as Z,w as gt,wa as m,xa as o,ya as a,za as y,zb as wt,zc as et}from"./chunk-X5ABKG7B.js";function Gt(s,t){if(s&1&&(o(0,"option",30),u(1),A(2,"titlecase"),a()),s&2){let e=t.$implicit;m("value",e),l(),M(U(2,2,e))}}function jt(s,t){if(s&1&&(o(0,"option",30),u(1),A(2,"titlecase"),a()),s&2){let e=t.$implicit;m("value",e),l(),M(U(2,2,e))}}function Ht(s,t){if(s&1&&(o(0,"span"),u(1," of "),o(2,"strong",32),u(3),a()()),s&2){let e=c(2);l(3),M(e.allRoutinesForList().length)}}function zt(s,t){if(s&1&&(o(0,"div",31),u(1," Showing "),o(2,"strong",32),u(3),a(),S(4,Ht,4,1,"span",33),u(5," routines "),a()),s&2){let e=c();l(3),M(e.filteredRoutines().length),l(),m("ngIf",e.routineSearchTerm()||e.selectedRoutineGoal()||e.selectedRoutineMuscleGroup())}}function qt(s,t){if(s&1&&(o(0,"p",54),u(1),a()),s&2){let e=c().$implicit;m("title",e.description),l(),M(e.description)}}function Jt(s,t){if(s&1&&(o(0,"div")(1,"span",43),u(2,"Goal:"),a(),o(3,"span",55),u(4),A(5,"titlecase"),a()()),s&2){let e=c().$implicit;l(4),k(" ",U(5,1,e.goal)," ")}}function Kt(s,t){if(s&1&&(o(0,"span",58),u(1),A(2,"titlecase"),a()),s&2){let e=t.$implicit;l(),k(" ",U(2,1,e)," ")}}function Yt(s,t){if(s&1&&(o(0,"div",56)(1,"span",43),u(2,"Muscles:"),a(),S(3,Kt,3,3,"span",57),a()),s&2){let e=c().$implicit,i=c(3);l(3),m("ngForOf",i.getRoutineMainMuscleGroups(e))}}function Zt(s,t){if(s&1&&(o(0,"div",59)(1,"span",43),u(2,"Last:"),a(),u(3),A(4,"date"),a()),s&2){let e=c().$implicit;l(3),k(" ",H(4,1,e.lastPerformed,"dd/MM/yy")," ")}}function Qt(s,t){s&1&&(o(0,"div",60),u(1," Not performed "),a())}function Xt(s,t){if(s&1){let e=w();o(0,"div",61)(1,"button",62),_("click",function(r){x(e);let n=c().$implicit,d=c(3);return f(d.viewRoutineDetails(n.id,r))}),C(),o(2,"svg",63),y(3,"path",64)(4,"path",65),a(),u(5," VIEW "),a(),V(),o(6,"button",62),_("click",function(r){x(e);let n=c().$implicit,d=c(3);return f(d.editRoutine(n.id,r))}),C(),o(7,"svg",63),y(8,"path",66),a(),u(9," EDIT "),a(),V(),o(10,"button",67),_("click",function(r){x(e);let n=c().$implicit,d=c(3);return f(d.startWorkout(n.id,r))}),C(),o(11,"svg",68),y(12,"path",69),a(),u(13," START "),a(),V(),y(14,"div",70),o(15,"button",71),_("click",function(r){x(e);let n=c().$implicit,d=c(3);return f(d.deleteRoutine(n.id,r))}),C(),o(16,"svg",63),y(17,"path",72),a(),u(18," DELETE "),a()()}s&2&&m("@dropdownMenu",void 0)}function ei(s,t){if(s&1){let e=w();o(0,"div",73)(1,"button",74),_("click",function(r){x(e);let n=c().$implicit,d=c(3);return f(d.startWorkout(n.id,r))}),C(),o(2,"svg",75),y(3,"path",69),a(),u(4," START "),a(),V(),o(5,"button",76),_("click",function(r){x(e);let n=c().$implicit,d=c(3);return f(d.viewRoutineDetails(n.id,r))}),C(),o(6,"svg",75),y(7,"path",77)(8,"path",78),a(),u(9," DETAILS "),a(),V(),o(10,"button",79),_("click",function(r){x(e);let n=c().$implicit,d=c(3);return f(d.editRoutine(n.id,r))}),C(),o(11,"svg",75),y(12,"path",80),a(),u(13," EDIT "),a(),V(),o(14,"button",81),_("click",function(r){x(e);let n=c().$implicit,d=c(3);return f(d.deleteRoutine(n.id,r))}),C(),o(15,"svg",75),y(16,"path",27),a(),u(17," DELETE "),a()()}s&2&&m("@slideInOutActions",void 0)}function ti(s,t){if(s&1){let e=w();o(0,"div",37)(1,"div",38),_("click",function(){let r=x(e).$implicit,n=c(3);return f(n.viewRoutineDetails(r.id))}),o(2,"div",39)(3,"h2",40),u(4),a()(),S(5,qt,2,2,"p",41),o(6,"div",42),S(7,Jt,6,3,"div",33),o(8,"span")(9,"span",43),u(10,"Ex:"),a(),u(11),a()(),S(12,Yt,4,1,"div",44)(13,Zt,5,4,"div",45)(14,Qt,2,0,"div",46),a(),o(15,"div",47)(16,"div",48)(17,"button",49),_("click",function(r){let n=x(e).$implicit,d=c(3);return f(d.toggleActions(n.id,r))}),C(),o(18,"svg",50),y(19,"path",51),a()(),S(20,Xt,19,1,"div",52),a()(),S(21,ei,18,1,"div",53),a()}if(s&2){let e=t.$implicit,i=c(3);l(3),m("title",e.name),l(),M(e.name),l(),m("ngIf",e.description),l(2),m("ngIf",e.goal),l(4),k(" ",e.exercises.length," "),l(),m("ngIf",i.getRoutineMainMuscleGroups(e).length>0),l(),m("ngIf",e.lastPerformed),l(),m("ngIf",!e.lastPerformed),l(6),m("ngIf",i.areActionsVisible(e.id)&&!i.menuModeCompact),l(),m("ngIf",i.areActionsVisible(e.id)&&i.menuModeCompact)}}function ii(s,t){if(s&1&&(o(0,"div",35),S(1,ti,22,10,"div",36),a()),s&2){let e=c(2);l(),m("ngForOf",e.filteredRoutines())}}function ri(s,t){if(s&1){let e=w();o(0,"button",88),_("click",function(){x(e);let r=c(3);return f(r.navigateToCreateRoutine())}),u(1," Create Your First Routine "),a()}}function ni(s,t){if(s&1&&(o(0,"div",82),C(),o(1,"svg",83),y(2,"path",84),a(),V(),o(3,"h3",85),u(4),a(),o(5,"p",86),u(6),a(),S(7,ri,2,0,"button",87),a()),s&2){let e=c(2);l(4),k(" ",e.routineSearchTerm()||e.selectedRoutineGoal()||e.selectedRoutineMuscleGroup()?"No Routines Match Filters":"No Routines Yet!"," "),l(2),k(" ",e.routineSearchTerm()||e.selectedRoutineGoal()||e.selectedRoutineMuscleGroup()?"Try adjusting your filters.":"Get started by creating your first workout routine."," "),l(),m("ngIf",!(e.routineSearchTerm()||e.selectedRoutineGoal()||e.selectedRoutineMuscleGroup()))}}function si(s,t){if(s&1&&(o(0,"div"),S(1,ii,2,1,"div",34)(2,ni,8,3,"ng-template",null,1,Y),a()),s&2){let e=K(3),i=c();l(),m("ngIf",i.filteredRoutines().length>0)("ngIfElse",e)}}function oi(s,t){s&1&&(o(0,"div",89),C(),o(1,"svg",90),y(2,"circle",91)(3,"path",92),a(),V(),o(4,"p",93),u(5,"Loading routines..."),a()())}var it=class s{workoutService=E(ve);exerciseService=E(se);trackingService=E(ne);router=E(ie);alertService=E(_e);spinnerService=E(et);toastService=E(Se);storageService=E(Xe);themeService=E(Ft);platformId=E(ce);routines$;allRoutinesForList=I([]);routinesSubscription;exercisesSubscription;visibleActionsRutineId=I(null);menuModeCompact=!1;isFilterAccordionOpen=I(!1);routineSearchTerm=I("");selectedRoutineGoal=I(null);selectedRoutineMuscleGroup=I(null);uniqueRoutineGoals=I([]);uniqueRoutineMuscleGroups=I([]);allExercisesMap=new Map;PAUSED_WORKOUT_KEY="fitTrackPro_pausedWorkoutState";filteredRoutines=L(()=>{let t=this.allRoutinesForList(),e=this.routineSearchTerm().toLowerCase(),i=this.selectedRoutineGoal(),r=this.selectedRoutineMuscleGroup();return e&&(t=t.filter(n=>n.name.toLowerCase().includes(e)||n.description&&n.description.toLowerCase().includes(e))),i&&(t=t.filter(n=>n.goal?.toLowerCase()===i.toLowerCase())),r&&(t=t.filter(n=>n.exercises.some(d=>this.allExercisesMap.get(d.exerciseId)?.primaryMuscleGroup.toLowerCase()===r.toLowerCase()))),t});ngOnInit(){N(this.platformId)&&window.scrollTo(0,0),this.menuModeCompact=this.themeService.isMenuModeCompact(),this.exercisesSubscription=this.exerciseService.getExercises().subscribe(t=>{t.forEach(e=>this.allExercisesMap.set(e.id,e)),this.loadRoutinesAndPopulateFilters()}),this.routines$=this.workoutService.routines$}loadRoutinesAndPopulateFilters(){this.routinesSubscription=this.workoutService.routines$.subscribe(t=>{this.allRoutinesForList.set(t),this.populateRoutineFilterOptions(t)})}populateRoutineFilterOptions(t){if(!t)return;let e=new Set,i=new Set;t.forEach(r=>{r.goal&&e.add(r.goal),r.exercises.forEach(n=>{let d=this.allExercisesMap.get(n.exerciseId);d?.primaryMuscleGroup&&i.add(d.primaryMuscleGroup)})}),this.uniqueRoutineGoals.set(Array.from(e).sort()),this.uniqueRoutineMuscleGroups.set(Array.from(i).sort())}toggleFilterAccordion(){this.isFilterAccordionOpen.update(t=>!t)}onRoutineSearchTermChange(t){let e=t.target;this.routineSearchTerm.set(e.value)}onRoutineGoalChange(t){let e=t.target;this.selectedRoutineGoal.set(e.value||null)}onRoutineMuscleGroupChange(t){let e=t.target;this.selectedRoutineMuscleGroup.set(e.value||null)}clearRoutineFilters(){this.routineSearchTerm.set(""),this.selectedRoutineGoal.set(null),this.selectedRoutineMuscleGroup.set(null);let t=document.getElementById("routine-search-term");t&&(t.value="");let e=document.getElementById("routine-goal-filter");e&&(e.value="");let i=document.getElementById("routine-muscle-filter");i&&(i.value="")}navigateToCreateRoutine(){this.router.navigate(["/workout/new"])}editRoutine(t,e){e.stopPropagation(),this.router.navigate(["/workout/edit",t]),this.visibleActionsRutineId.set(null)}deleteRoutine(t,e){return W(this,null,function*(){e.stopPropagation(),this.visibleActionsRutineId.set(null);let i=this.allRoutinesForList().find(p=>p.id===t);if(!i){this.toastService.error("Routine not found for deletion.",0,"Error");return}let r=(yield X(this.trackingService.getWorkoutLogsByRoutineId(t).pipe(j(1))))||[],n=`Are you sure you want to delete the routine "${i.name}"?`;r.length>0&&(n+=` This will also delete ${r.length} associated workout log(s). This action cannot be undone.`);let d=yield this.alertService.showConfirm("Delete Routine",n,"Delete");if(d&&d.data)try{this.spinnerService.show(),r.length>0&&(yield this.trackingService.clearWorkoutLogsByRoutineId(t)),yield this.workoutService.deleteRoutine(t),this.toastService.success(`Routine "${i.name}" deleted successfully.`,4e3,"Routine Deleted")}catch(p){console.error("Error during deletion:",p),this.toastService.error("Failed to delete routine or its logs.",0,"Deletion Failed")}finally{this.spinnerService.hide()}})}startWorkout(t,e){return W(this,null,function*(){if(e.stopPropagation(),this.visibleActionsRutineId.set(null),!N(this.platformId)){this.router.navigate(["/workout/play",t]);return}let i=this.storageService.getItem(this.PAUSED_WORKOUT_KEY);if(i){let r=i.sessionRoutine?.name||"a previous session",n=i.workoutDate?` from ${re(new Date(i.workoutDate),"MMM d, HH:mm")}`:"",d=[{text:"Cancel",role:"cancel",data:"cancel"},{text:"Discard Paused & Start New",role:"confirm",data:"discard_start_new",cssClass:"bg-red-500 hover:bg-red-600 text-white"},{text:`Resume: ${r.substring(0,15)}${r.length>15?"...":""}`,role:"confirm",data:"resume_paused",cssClass:"bg-green-500 hover:bg-green-600 text-white"}],p=yield this.alertService.showConfirmationDialog("Workout in Progress",`You have a paused workout ("${r}"${n}). What would you like to do?`,d);if(p&&p.data==="resume_paused"){let g=i.routineId||"ad-hoc";this.router.navigate(["/workout/play",i.routineId||""],{queryParams:{resume:"true"}})}else p&&p.data==="discard_start_new"?(this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),this.toastService.info("Previous paused workout discarded.",3e3),this.router.navigate(["/workout/play",t])):this.toastService.info("Starting new workout cancelled.",2e3)}else this.router.navigate(["/workout/play",t])})}viewRoutineDetails(t,e){e?.stopPropagation(),this.router.navigate(["/workout/view",t]),this.visibleActionsRutineId.set(null)}toggleActions(t,e){e.stopPropagation(),this.visibleActionsRutineId.update(i=>i===t?null:t)}areActionsVisible(t){return this.visibleActionsRutineId()===t}getRoutineMainMuscleGroups(t){if(!this.allExercisesMap.size||!t.exercises.length)return[];let e=new Set;return t.exercises.forEach(i=>{let r=this.allExercisesMap.get(i.exerciseId);r?.primaryMuscleGroup&&e.add(r.primaryMuscleGroup)}),Array.from(e).slice(0,3)}ngOnDestroy(){this.routinesSubscription?.unsubscribe(),this.exercisesSubscription?.unsubscribe()}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=J({type:s,selectors:[["app-routine-list"]],decls:46,vars:16,consts:[["loadingRoutines",""],["noRoutines",""],[1,"container","mx-auto","p-1","sm:p-4"],[1,"flex","justify-between","items-center","mb-2","pb-2","border-b","border-gray-200","dark:border-gray-700"],[1,"text-2xl","font-bold","text-gray-800","dark:text-gray-200"],["type","button",1,"p-2","rounded-md","text-gray-600","dark:text-gray-300","hover:bg-gray-200","dark:hover:bg-gray-700","focus:outline-none","focus:ring-2","focus:ring-primary","dark:focus:ring-primary-light","transition-all","duration-300","ease-in-out",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-6","h-6","transition-transform","duration-300"],["stroke-linecap","round","stroke-linejoin","round","d","M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0M3.75 18H7.5m3-6h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0M3.75 12H7.5"],[1,"sr-only"],[1,"bg-primary","hover:bg-primary-dark","text-white","font-semibold","py-2","px-3","rounded-md","shadow-sm","hover:shadow-md","transition-all","duration-200","focus:outline-none","focus:ring-2","focus:ring-primary-light","focus:ring-opacity-75","text-sm","mb-2",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"w-4","h-4","mr-1.5","inline-block"],["d","M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z"],[1,"overflow-hidden","transition-all","duration-500","ease-in-out"],[1,"p-4","bg-white","dark:bg-gray-700","rounded-lg","shadow-md","border","dark:border-gray-600"],[1,"text-xl","font-semibold","text-gray-700","dark:text-gray-300","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","items-end"],["for","routine-search-term",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-1"],["type","text","id","routine-search-term","placeholder","Enter routine name or description...",1,"block","w-full","p-2","border","border-gray-300","dark:border-gray-600","rounded-md","shadow-sm","focus:ring-primary","focus:border-primary","dark:bg-gray-600","dark:text-gray-200",3,"input","value"],["for","routine-goal-filter",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-1"],["id","routine-goal-filter",1,"block","w-full","p-2","border","border-gray-300","dark:border-gray-600","rounded-md","shadow-sm","focus:ring-primary","focus:border-primary","dark:bg-gray-600","dark:text-gray-200",3,"change","value"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","routine-muscle-filter",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-1"],["id","routine-muscle-filter",1,"block","w-full","p-2","border","border-gray-300","dark:border-gray-600","rounded-md","shadow-sm","focus:ring-primary","focus:border-primary","dark:bg-gray-600","dark:text-gray-200",3,"change","value"],[1,"mt-4","flex","justify-between","items-center"],[1,"flex","px-4","py-2","bg-yellow-200","dark:bg-yellow-700","text-gray-700","dark:text-gray-200","rounded-md","hover:bg-yellow-300","dark:hover:bg-yellow-500","text-sm","items-center",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-5","mr-2"],["stroke-linecap","round","stroke-linejoin","round","d","m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"],["class","text-sm text-gray-600 dark:text-gray-400",4,"ngIf"],[4,"ngIf","ngIfElse"],[3,"value"],[1,"text-sm","text-gray-600","dark:text-gray-400"],[1,"text-gray-800","dark:text-gray-200"],[4,"ngIf"],["class","grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4",4,"ngIf","ngIfElse"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4","mt-4"],["class","bg-white dark:bg-gray-700 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-200 relative group",4,"ngFor","ngForOf"],[1,"bg-white","dark:bg-gray-700","rounded-lg","shadow-md","hover:shadow-lg","transition-shadow","duration-200","relative","group"],[1,"p-3","cursor-pointer",3,"click"],[1,"flex","justify-between","items-start","mb-1.5"],[1,"text-lg","font-semibold","text-primary","dark:text-primary-light","truncate","pr-8",3,"title"],["class","text-gray-600 dark:text-gray-400 mb-2 line-clamp-2 text-sm sm:text-xs",3,"title",4,"ngIf"],[1,"flex","justify-between","text-xs","text-gray-500","dark:text-gray-300","mb-2","space-x-2"],[1,"font-medium"],["class","text-sm sm:text-xs text-gray-500 dark:text-gray-300 mb-2",4,"ngIf"],["class","text-sm sm:text-xs text-gray-500 dark:text-gray-300",4,"ngIf"],["class","text-sm sm:text-xs text-gray-500 dark:text-gray-300 italic",4,"ngIf"],[1,"absolute","top-2","right-2"],[1,"relative"],[1,"p-1.5","text-gray-500","dark:text-gray-400","hover:bg-gray-200","dark:hover:bg-gray-700","rounded-full","focus:outline-none",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","d","M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"],["class","origin-top-right absolute right-0 top-full mt-1 sm:mt-2 w-40 sm:w-48 rounded-md shadow-lg bg-white dark:bg-gray-800 ring-1 ring-black dark:ring-gray-600 ring-opacity-5 focus:outline-none py-1 z-50 sm:z-50",4,"ngIf"],["class",`absolute inset-x-0 bottom-0 p-2 bg-gray-100 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-700
                           flex flex-wrap gap-1.5 justify-center z-20 rounded-b-lg`,4,"ngIf"],[1,"text-gray-600","dark:text-gray-400","mb-2","line-clamp-2","text-sm","sm:text-xs",3,"title"],[1,"text-2xs","bg-blue-100","text-blue-700","dark:bg-blue-700","dark:text-blue-200","px-1.5","py-0.5","rounded-full","mx-1","inline-block"],[1,"text-sm","sm:text-xs","text-gray-500","dark:text-gray-300","mb-2"],["class","text-2xs bg-purple-100 text-purple-700 dark:bg-purple-700 dark:text-purple-200 px-1.5 py-0.5 rounded-full mx-1 mb-1 inline-block",4,"ngFor","ngForOf"],[1,"text-2xs","bg-purple-100","text-purple-700","dark:bg-purple-700","dark:text-purple-200","px-1.5","py-0.5","rounded-full","mx-1","mb-1","inline-block"],[1,"text-sm","sm:text-xs","text-gray-500","dark:text-gray-300"],[1,"text-sm","sm:text-xs","text-gray-500","dark:text-gray-300","italic"],[1,"origin-top-right","absolute","right-0","top-full","mt-1","sm:mt-2","w-40","sm:w-48","rounded-md","shadow-lg","bg-white","dark:bg-gray-800","ring-1","ring-black","dark:ring-gray-600","ring-opacity-5","focus:outline-none","py-1","z-50","sm:z-50"],[1,"w-full","text-left","px-3","py-1.5","sm:px-4","sm:py-2","text-gray-700","dark:text-gray-200","hover:bg-gray-100","dark:hover:bg-gray-500","flex","items-center",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"w-3.5","h-3.5","sm:w-4","sm:h-4","mr-2"],["d","M10 12.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5Z"],["fill-rule","evenodd","d","M.664 10.59a1.651 1.651 0 010-1.186A10.004 10.004 0 0110 3c4.257 0 7.893 2.66 9.336 6.41.147.381.146.804 0 1.186A10.004 10.004 0 0110 17c-4.257 0-7.893-2.66-9.336-6.41ZM14 10a4 4 0 11-8 0 4 4 0 018 0Z","clip-rule","evenodd"],["d","m13.83 3.393 2.777 2.777-9.333 9.333H4.5v-2.777l9.33-9.333Zm0 0L12.5 2.06M6 13.5V15h1.5l7.5-7.5-1.5-1.5L6 13.5Z"],[1,"w-full","text-left","px-3","py-1.5","sm:px-4","sm:py-2","font-medium","text-green-600","dark:text-green-400","hover:bg-green-50","dark:hover:bg-green-700/30","flex","items-center",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","2","stroke","currentColor",1,"size-4","mr-2"],["stroke-linecap","round","stroke-linejoin","round","d","M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"],[1,"my-0.5","sm:my-1","border-t","border-gray-200","dark:border-gray-600"],[1,"w-full","text-left","px-3","py-1.5","sm:px-4","sm:py-2","text-red-600","dark:text-red-400","hover:bg-red-50","dark:hover:bg-red-600/50","flex","items-center",3,"click"],["fill-rule","evenodd","d","M8.75 1A2.75 2.75 0 006 3.75v.443c-.795.077-1.58.177-2.365.298a.75.75 0 10.23 1.482l.149-.022.841 10.518A2.75 2.75 0 007.596 19h4.807a2.75 2.75 0 002.742-2.53l.841-10.52.149.023a.75.75 0 00.23-1.482A41.03 41.03 0 0014 4.193V3.75A2.75 2.75 0 0011.25 1h-2.5ZM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4ZM8.58 7.72a.75.75 0 00-1.5.06l.3 7.5a.75.75 0 101.5-.06l-.3-7.5Zm4.34.06a.75.75 0 10-1.5-.06l-.3 7.5a.75.75 0 101.5.06l.3-7.5Z","clip-rule","evenodd"],[1,"absolute","inset-x-0","bottom-0","p-2","bg-gray-100","dark:bg-gray-700","border-t","border-gray-200","dark:border-gray-700","flex","flex-wrap","gap-1.5","justify-center","z-20","rounded-b-lg"],["title","Start Workout",1,"flex-1","text-xs","min-w-[70px]","flex","items-center","justify-center","p-1.5","bg-green-500","text-white","rounded-md","hover:bg-green-600","transition-colors",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","2","stroke","currentColor",1,"size-4","mr-1"],["title","View Details",1,"flex-1","text-xs","min-w-[70px]","flex","items-center","justify-center","p-1.5","bg-cyan-500","text-white","rounded-md","hover:bg-cyan-600","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"],["stroke-linecap","round","stroke-linejoin","round","d","M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"],["title","Edit Routine",1,"flex-1","text-xs","min-w-[70px]","flex","items-center","justify-center","p-1.5","bg-yellow-500","text-white","rounded-md","hover:bg-yellow-600","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"],["title","Delete Routine",1,"flex-1","text-xs","min-w-[70px]","flex","items-center","justify-center","p-1.5","bg-red-500","text-white","rounded-md","hover:bg-red-600","transition-colors",3,"click"],[1,"text-center","py-12","px-6","bg-white","dark:bg-gray-700","rounded-lg","shadow-md"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-16","h-16","mx-auto","text-gray-400","dark:text-gray-200","mb-4"],["stroke-linecap","round","stroke-linejoin","round","d","M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 0 1 0 3.75H5.625a1.875 1.875 0 0 1 0-3.75Z"],[1,"text-xl","font-semibold","text-gray-700","dark:text-gray-300","mb-2"],[1,"text-gray-500","dark:text-gray-400","mb-6"],["class","bg-primary hover:bg-primary-dark text-white font-semibold py-2 px-6 rounded-md shadow-md hover:shadow-lg transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-primary-light focus:ring-opacity-75",3,"click",4,"ngIf"],[1,"bg-primary","hover:bg-primary-dark","text-white","font-semibold","py-2","px-6","rounded-md","shadow-md","hover:shadow-lg","transition-all","duration-300","focus:outline-none","focus:ring-2","focus:ring-primary-light","focus:ring-opacity-75",3,"click"],[1,"text-center","py-10"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","h-8","w-8","text-primary","dark:text-primary-light","mx-auto"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"text-lg","text-gray-600","dark:text-gray-400","mt-3"]],template:function(e,i){if(e&1){let r=w();o(0,"div",2)(1,"header",3)(2,"h1",4),u(3,"My Routines"),a(),o(4,"button",5),_("click",function(){return x(r),f(i.toggleFilterAccordion())}),C(),o(5,"svg",6),y(6,"path",7),a(),V(),o(7,"span",8),u(8,"Toggle Filters"),a()()(),o(9,"button",9),_("click",function(){return x(r),f(i.navigateToCreateRoutine())}),C(),o(10,"svg",10),y(11,"path",11),a(),u(12," New Routine "),a(),V(),o(13,"div",12)(14,"div",13)(15,"h2",14),u(16,"Filter Routines"),a(),o(17,"div",15)(18,"div")(19,"label",16),u(20,"Search Name/Desc."),a(),o(21,"input",17),_("input",function(d){return x(r),f(i.onRoutineSearchTermChange(d))}),a()(),o(22,"div")(23,"label",18),u(24,"Goal"),a(),o(25,"select",19),_("change",function(d){return x(r),f(i.onRoutineGoalChange(d))}),o(26,"option",20),u(27,"Any Goal"),a(),S(28,Gt,3,4,"option",21),a()(),o(29,"div")(30,"label",22),u(31,"Targets Muscle"),a(),o(32,"select",23),_("change",function(d){return x(r),f(i.onRoutineMuscleGroupChange(d))}),o(33,"option",20),u(34,"Any Muscle Group"),a(),S(35,jt,3,4,"option",21),a()()(),o(36,"div",24)(37,"button",25),_("click",function(){return x(r),f(i.clearRoutineFilters())}),C(),o(38,"svg",26),y(39,"path",27),a(),u(40," Clear Routine Filters "),a(),S(41,zt,6,2,"div",28),a()()(),S(42,si,4,2,"div",29),A(43,"async"),S(44,oi,6,0,"ng-template",null,0,Y),a()}if(e&2){let r=K(45);l(5),de("rotate-180",i.isFilterAccordionOpen()),l(8),vt("max-height",i.isFilterAccordionOpen()?"1000px":"0px"),de("mb-6",i.isFilterAccordionOpen()),l(8),m("value",i.routineSearchTerm()),l(4),m("value",i.selectedRoutineGoal()||""),l(3),m("ngForOf",i.uniqueRoutineGoals()),l(4),m("value",i.selectedRoutineMuscleGroup()||""),l(3),m("ngForOf",i.uniqueRoutineMuscleGroups()),l(6),m("ngIf",i.allRoutinesForList().length>0),l(),m("ngIf",U(43,14,i.routines$))("ngIfElse",r)}},dependencies:[Q,ee,Z,wt,Ne,xe],encapsulation:2,data:{animation:[ct("slideInOutActions",[Re("void",Pe({height:"0px",opacity:0,overflow:"hidden",paddingTop:"0",paddingBottom:"0",marginTop:"0",marginBottom:"0"})),Re("*",Pe({height:"*",opacity:1,overflow:"hidden",paddingTop:"0.5rem",paddingBottom:"0.5rem"})),Ue("void <=> *",Be("200ms ease-in-out"))]),ct("dropdownMenu",[Re("void",Pe({opacity:0,transform:"scale(0.75) translateY(-10px)",transformOrigin:"top right"})),Re("*",Pe({opacity:1,transform:"scale(1) translateY(0)",transformOrigin:"top right"})),Ue("void => *",[Be("150ms cubic-bezier(0.25, 0.8, 0.25, 1)")]),Ue("* => void",[Be("100ms cubic-bezier(0.25, 0.8, 0.25, 1)")])])]}})};var li=["setRepsInput"],di=["expandedSetElement"],ui=(s,t)=>({"border-red-500 dark:border-red-400":s,"border-gray-300 dark:border-gray-600":t}),ci=(s,t,e,i,r,n,d)=>({"border-orange-500 dark:border-orange-400 bg-orange-50 dark:bg-orange-900/30":s,"ring-2 ring-orange-400 dark:ring-orange-300 shadow-md":t,"dark:bg-orange-900/40":e,"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700":i,"rounded-b-none border-b-transparent dark:border-b-transparent":r,"rounded-t-none":n,"mt-4":d}),mi=(s,t)=>({"border-b border-orange-300 dark:border-orange-600":s,"border-b border-gray-200 dark:border-gray-600":t}),pi=(s,t,e)=>({"bg-blue-100 dark:bg-blue-700":s,"bg-gray-50 dark:bg-gray-700":t,"cursor-default":e}),gi=(s,t)=>({"bg-blue-100 dark:bg-blue-700":s,"bg-gray-100 dark:bg-gray-700":t});function xi(s,t){if(s&1&&(o(0,"div",26),u(1),a()),s&2){let e=c();l(),k(" ",e.errorMessage(),`
`)}}function fi(s,t){if(s&1){let e=w();o(0,"button",34),_("click",function(){x(e);let r=c(2);return f(r.enableEditMode())}),C(),o(1,"svg",29),y(2,"path",35),a(),u(3," Edit "),a()}}function hi(s,t){if(s&1){let e=w();o(0,"div",27)(1,"button",28),_("click",function(){x(e);let r=c();return f(r.startCurrentWorkout())}),C(),o(2,"svg",29),y(3,"path",30),a(),u(4," Start "),a(),S(5,fi,4,0,"button",31),V(),o(6,"button",32),_("click",function(){x(e);let r=c();return f(r.deleteCurrentRoutine())}),C(),o(7,"svg",29),y(8,"path",33),a(),u(9," Delete "),a()()}if(s&2){let e=c();l(5),m("ngIf",e.isViewMode)}}function _i(s,t){s&1&&(o(0,"span"),u(1,"Routine name is required."),a())}function vi(s,t){if(s&1&&(o(0,"div",36),S(1,_i,2,0,"span",37),a()),s&2){let e=c();l(),m("ngIf",e.f.name.errors==null?null:e.f.name.errors.required)}}function Si(s,t){if(s&1&&(o(0,"option",38),u(1),a()),s&2){let e=t.$implicit;m("value",e.value),l(),M(e.label)}}function yi(s,t){if(s&1){let e=w();o(0,"button",46),_("click",function(){x(e);let r=c(2);return f(r.openExerciseSelectionModal())}),u(1," + Add Exercise "),a()}if(s&2){let e=c(2);m("disabled",e.isViewMode)}}function bi(s,t){if(s&1){let e=w();o(0,"div",71)(1,"button",72),_("click",function(){x(e);let r=c(4);return f(r.groupSelectedAsSuperset())}),u(2),a()()}if(s&2){let e=c(4);l(),m("disabled",!e.canGroupSelectedExercises()||e.isViewMode),l(),k(" Group Superset (",e.selectedExerciseIndicesForSuperset().length,") ")}}function ki(s,t){s&1&&(o(0,"div",73),C(),o(1,"svg",74),y(2,"path",75),a()())}function wi(s,t){if(s&1){let e=w();o(0,"input",76),_("change",function(r){x(e);let n=c().index,d=c(3);return f(d.toggleExerciseSelectionForSuperset(n,r))}),a()}if(s&2){let e=c().index,i=c(3);m("id","superset-select-"+e)("checked",i.selectedExerciseIndicesForSuperset().includes(e))("disabled",i.isViewMode)}}function Ii(s,t){if(s&1&&(o(0,"span",77),u(1),a()),s&2){let e,i=c().$implicit;l(),q(" Superset (",(((e=i.get("supersetOrder"))==null?null:e.value)??0)+1," of ",(e=i.get("supersetSize"))==null?null:e.value,") ")}}function Ei(s,t){if(s&1){let e=w();o(0,"button",78),_("click",function(){x(e);let r=c().index,n=c(3);return f(n.removeExercise(r))}),C(),o(1,"svg",79),y(2,"path",80),a(),u(3," Remove "),a()}if(s&2){let e=c(4);m("disabled",e.isViewMode)}}function Ci(s,t){if(s&1){let e=w();o(0,"button",81),_("click",function(){x(e);let r=c().index,n=c(3);return f(n.ungroupSuperset(r))}),C(),o(1,"svg",79),y(2,"path",82),a(),u(3," Ungroup "),a()}if(s&2){let e=c(4);m("disabled",e.isViewMode)}}function Ti(s,t){if(s&1){let e=w();o(0,"button",83),_("click",function(){x(e);let r=c(),n=r.$implicit,d=r.index,p=c(3);return f(p.addSet(n,d))}),u(1," + Add Set "),a()}if(s&2){let e=c(4);m("disabled",e.isViewMode)}}function Pi(s,t){if(s&1&&(o(0,"div",84)(1,"div",85),u(2,"#"),a(),o(3,"div",86),u(4,"Reps"),a(),o(5,"div",86),u(6),a(),o(7,"div",86),u(8,"Time"),a(),o(9,"div",86),u(10,"Rest"),a(),o(11,"div",86),u(12,"Tempo"),a(),y(13,"div",87),a()),s&2){let e=c(4);l(6),k("Weight (",e.unitsService.getUnitLabel(),") ")}}function Ri(s,t){if(s&1){let e=w();o(0,"div",97)(1,"button",98),_("click",function(r){x(e);let n=c(2).index,d=c(),p=d.$implicit,g=d.index;return c(3).removeSet(p,g,n),f(r.stopPropagation())}),C(),o(2,"svg",99),y(3,"path",100),a()()()}if(s&2){let e=c(6);l(),m("disabled",e.isViewMode)}}function Wi(s,t){s&1&&(o(0,"div",101),C(),o(1,"svg",102),y(2,"line",103)(3,"line",104),a()())}function Vi(s,t){if(s&1){let e=w();o(0,"div",91),_("click",function(r){x(e);let n=c().index,d=c().index,p=c(3);return f(p.toggleSetExpansion(d,n,r))}),o(1,"div",92),u(2),a(),o(3,"div",93),u(4),a(),o(5,"div",93),u(6),A(7,"weightUnit"),a(),o(8,"div",93),u(9),a(),o(10,"div",93),u(11),a(),o(12,"div",94),u(13),a(),S(14,Ri,4,1,"div",95)(15,Wi,4,0,"div",96),a()}if(s&2){let e,i,r,n,d,p,g,h=c(),v=h.$implicit,b=h.index,T=c(4);m("ngClass",bt(13,pi,((e=v.get("type"))==null?null:e.value)==="warmup",!((e=v.get("type"))!=null&&e.value)&&!T.isViewMode,T.isViewMode)),l(2),k(" ",b+1),l(2),k(" ",((i=v.get("reps"))==null?null:i.value)||"-"),l(2),k(" ",(r=v.get("weight"))!=null&&r.value?H(7,10,(r=v.get("weight"))==null?null:r.value,"1.0-2"):"-"),l(3),k(" ",(n=v.get("duration"))!=null&&n.value?((n=v.get("duration"))==null?null:n.value)+"s":"-"),l(2),k(" ",(d=v.get("restAfterSet"))==null?null:d.value,"s"),l(),m("title",(p=v.get("tempo"))==null?null:p.value),l(),M(((g=v.get("tempo"))==null?null:g.value)||"-"),l(),m("ngIf",T.isEditMode&&!T.isViewMode),l(),m("ngIf",T.isViewMode)}}function Di(s,t){if(s&1){let e=w();o(0,"div",105,0)(2,"div",106)(3,"div")(4,"label",107),u(5,"Reps"),a(),y(6,"input",108,1),a(),o(8,"div")(9,"label",107),u(10),a(),y(11,"input",109),a(),o(12,"div")(13,"label",107),u(14,"Time (s)"),a(),y(15,"input",110),a(),o(16,"div")(17,"label",107),u(18,"Tempo"),a(),y(19,"input",111),a(),o(20,"div",112)(21,"label",107),u(22,"Rest (s)"),a(),y(23,"input",113),a(),o(24,"div",114)(25,"label",107),u(26,"Set Notes (Opt.)"),a(),y(27,"input",115),a()(),o(28,"div",116)(29,"button",117),_("click",function(){x(e);let r=c(5);return f(r.collapseExpandedSet())}),u(30),a()()()}if(s&2){let e,i=c(),r=i.$implicit,n=i.index,d=c().index,p=c(3);m("ngClass",ge(15,gi,((e=r.get("type"))==null?null:e.value)==="warmup",!((e=r.get("type"))!=null&&e.value))),l(4),m("for","reps-exp-"+d+"-"+n),l(2),m("id","reps-exp-"+d+"-"+n),l(3),m("for","weight-exp-"+d+"-"+n),l(),k("Weight (",p.unitsService.getUnitLabel(),")"),l(),m("id","weight-exp-"+d+"-"+n),l(2),m("for","duration-exp-"+d+"-"+n),l(2),m("id","duration-exp-"+d+"-"+n),l(2),m("for","tempo-exp-"+d+"-"+n),l(2),m("id","tempo-exp-"+d+"-"+n),l(2),m("for","rest-exp-"+d+"-"+n),l(2),m("id","rest-exp-"+d+"-"+n),l(2),m("for","setNotes-exp-"+d+"-"+n),l(2),m("id","setNotes-exp-"+d+"-"+n),l(3),k(" ",p.isViewMode?"Collapse":p.isEditMode?"Done":"Close"," ")}}function Fi(s,t){if(s&1&&(o(0,"div",88),S(1,Vi,16,17,"div",89)(2,Di,31,18,"div",90),a()),s&2){let e=t.index,i=c().index,r=c(3);m("formGroupName",e),l(),m("ngIf",!r.isSetExpanded(i,e)),l(),m("ngIf",r.isSetExpanded(i,e))}}function Mi(s,t){if(s&1){let e=w();me(0),o(1,"div",49),S(2,bi,3,2,"div",50),o(3,"div",51),S(4,ki,3,0,"div",52),o(5,"div",53)(6,"div",54),S(7,wi,1,3,"input",55),o(8,"h3",56),S(9,Ii,2,2,"span",57),u(10),a()(),o(11,"div",58)(12,"div",59)(13,"label",60),u(14,"Rounds:"),a(),o(15,"input",61),_("change",function(){let r,n=x(e),d=n.$implicit,p=n.index,g=c(3);return f(g.syncSupersetRounds((r=d.get("supersetId"))==null?null:r.value,(r=d.get("rounds"))==null?null:r.value,p))}),a()(),S(16,Ei,4,1,"button",62)(17,Ci,4,1,"button",63),a()(),o(18,"div",64)(19,"div",65)(20,"h4",66),u(21,"Sets:"),a(),S(22,Ti,2,1,"button",67),a(),o(23,"div",68),S(24,Pi,14,1,"div",69)(25,Fi,3,3,"div",70),a()()()(),pe()}if(s&2){let e,i,r,n,d,p,g,h=t.$implicit,v=t.index,b=c(3);l(2),m("ngIf",b.isEditMode&&b.selectedExerciseIndicesForSuperset().length>=2&&v===b.firstSelectedExerciseIndexForSuperset),l(),m("cdkDragDisabled",b.isViewMode||!b.isEditMode)("cdkDragData",h)("formGroupName",v)("ngClass",kt(18,ci,(e=h.get("supersetId"))==null?null:e.value,b.selectedExerciseIndicesForSuperset().includes(v),((e=h.get("supersetId"))==null?null:e.value)&&b.selectedExerciseIndicesForSuperset().includes(v),!((e=h.get("supersetId"))!=null&&e.value)&&!b.selectedExerciseIndicesForSuperset().includes(v),((e=h.get("supersetId"))==null?null:e.value)&&(((e=h.get("supersetOrder"))==null?null:e.value)??-1)<(((e=h.get("supersetSize"))==null?null:e.value)??0)-1,((e=h.get("supersetId"))==null?null:e.value)&&(((e=h.get("supersetOrder"))==null?null:e.value)??0)>0,b.isEditMode&&b.selectedExerciseIndicesForSuperset().length>=2&&v===b.firstSelectedExerciseIndexForSuperset)),l(),m("ngIf",b.isEditMode),l(),m("ngClass",ge(26,mi,((i=h.get("supersetId"))==null?null:i.value)&&(((i=h.get("supersetOrder"))==null?null:i.value)??-1)<(((i=h.get("supersetSize"))==null?null:i.value)??0)-1,!((i=h.get("supersetId"))!=null&&i.value)||(((i=h.get("supersetOrder"))==null?null:i.value)??-1)===(((i=h.get("supersetSize"))==null?null:i.value)??0)-1)),l(2),m("ngIf",b.isEditMode),l(2),m("ngIf",(r=h.get("supersetId"))==null?null:r.value),l(),k(" ",((n=h.get("exerciseName"))==null?null:n.value)||"Select Exercise"," "),l(3),m("for","rounds-"+v),l(2),m("id","rounds-"+v)("readonly",((d=h.get("supersetId"))==null?null:d.value)&&(((d=h.get("supersetOrder"))==null?null:d.value)??0)>0||b.isViewMode),l(),m("ngIf",b.isEditMode),l(),m("ngIf",b.isEditMode&&((p=h.get("supersetId"))==null?null:p.value)),l(5),m("ngIf",b.isEditMode),l(2),m("ngIf",b.getSetsFormArray(h).controls.length>0&&((g=b.expandedSetPath())==null?null:g.exerciseIndex)!==v),l(),m("ngForOf",b.getSetsFormArray(h).controls)}}function Ai(s,t){if(s&1){let e=w();o(0,"div",47),_("cdkDropListDropped",function(r){x(e);let n=c(2);return f(n.onExerciseDrop(r))}),S(1,Mi,26,29,"ng-container",48),a()}if(s&2){let e=c(2);m("cdkDropListData",e.exercisesFormArray.controls),l(),m("ngForOf",e.exercisesFormArray.controls)}}function Li(s,t){if(s&1){let e=w();o(0,"div",118)(1,"p",119),u(2,"No exercises added to this routine yet."),a(),o(3,"button",120),_("click",function(){x(e);let r=c(2);return f(r.openExerciseSelectionModal())}),u(4," + Add First Exercise "),a()()}if(s&2){let e=c(2);l(3),m("disabled",e.isViewMode)}}function Oi(s,t){if(s&1){let e=w();o(0,"div",121)(1,"button",122),_("click",function(){x(e);let r=c(2);return f(r.openExerciseSelectionModal())}),C(),o(2,"svg",123),y(3,"path",124),a(),u(4," Add Another Exercise "),a()()}if(s&2){let e=c(2);l(),m("disabled",e.isViewMode)}}function Ni(s,t){if(s&1&&(o(0,"section",39)(1,"div",40)(2,"h2",41),u(3,"Exercises"),a(),S(4,yi,2,1,"button",42),a(),S(5,Ai,2,2,"div",43)(6,Li,5,1,"div",44)(7,Oi,5,1,"div",45),a()),s&2){let e=c();l(4),m("ngIf",e.isEditMode&&e.exercisesFormArray.length>0),l(),m("ngIf",e.exercisesFormArray.length>0),l(),m("ngIf",e.isEditMode&&e.exercisesFormArray.length===0),l(),m("ngIf",e.isEditMode&&e.exercisesFormArray.length>0)}}function Bi(s,t){s&1&&(o(0,"section",125)(1,"p",126),u(2," This is a rest day routine. No exercises are needed. "),a()())}function Ui(s,t){if(s&1&&(o(0,"div",127)(1,"a",128),u(2," Cancel "),a(),o(3,"button",129),u(4),a()()),s&2){let e=c();l(3),m("disabled",e.routineForm.invalid&&(e.routineForm.touched||e.routineForm.dirty)),l(),k(" ",e.isNewMode?"Create Routine":"Save Changes"," ")}}function $i(s,t){if(s&1){let e=w();o(0,"li",147),_("click",function(){let r=x(e).$implicit,n=c(2);return f(n.selectExercise(r))}),o(1,"div")(2,"span",148),u(3),a(),o(4,"span",149),u(5),A(6,"titlecase"),A(7,"titlecase"),a()(),C(),o(8,"svg",150),y(9,"path",151),a()()}if(s&2){let e=t.$implicit;l(3),M(e.name),l(2),q("",U(6,3,e.category)," - ",U(7,5,e.primaryMuscleGroup))}}function Gi(s,t){s&1&&(o(0,"li",152),u(1,"No exercises match your search."),a())}function ji(s,t){s&1&&(o(0,"li",152),u(1,"Exercise library is empty or still loading."),a())}function Hi(s,t){if(s&1){let e=w();o(0,"div",130),_("click",function(){x(e);let r=c();return f(r.closeExerciseSelectionModal())}),o(1,"div",131),_("click",function(r){return x(e),f(r.stopPropagation())}),o(2,"div",132)(3,"div",133)(4,"div",134)(5,"div",135)(6,"h3",136),u(7,"Select an Exercise"),a(),o(8,"button",137),_("click",function(){x(e);let r=c();return f(r.closeExerciseSelectionModal())}),C(),o(9,"svg",138),y(10,"path",139),a()()(),V(),o(11,"div",140)(12,"input",141),_("ngModelChange",function(r){x(e);let n=c();return f(n.modalSearchTerm.set(r))}),a()(),o(13,"div",142)(14,"ul",64),S(15,$i,10,7,"li",143)(16,Gi,2,0,"li",144)(17,ji,2,0,"li",144),a()()()()(),o(18,"div",145)(19,"button",146),_("click",function(){x(e);let r=c();return f(r.closeExerciseSelectionModal())}),u(20,"Cancel"),a()()()()}if(s&2){let e=c();l(12),m("ngModel",e.modalSearchTerm()),l(3),m("ngForOf",e.filteredAvailableExercises()),l(),m("ngIf",e.filteredAvailableExercises().length===0&&e.availableExercises.length>0),l(),m("ngIf",e.availableExercises.length===0)}}var be=class s{fb=E(Ye);router=E(ie);route=E(fe);workoutService=E(ve);exerciseService=E(se);unitsService=E(ye);spinnerService=E(et);alertService=E(_e);toastService=E(Se);trackingService=E(ne);PAUSED_WORKOUT_KEY="fitTrackPro_pausedWorkoutState";PAUSED_STATE_VERSION="1.1";setRepsInputs;expandedSetElements;cdr=E(Le);routineForm;isEditMode=!1;isNewMode=!1;isViewMode=!1;currentRoutineId=null;routeSub;expandedSetPath=I(null);routineGoals=[{value:"hypertrophy",label:"Hypertrophy"},{value:"strength",label:"Strength"},{value:"muscular endurance",label:"Muscular endurance"},{value:"cardiovascular endurance",label:"Cardiovascular endurance"},{value:"fat loss / body composition",label:"Fat loss / body composition"},{value:"mobility & flexibility",label:"Mobility & flexibility"},{value:"power / explosiveness",label:"Power / explosiveness"},{value:"speed & agility",label:"Speed & agility"},{value:"balance & coordination",label:"Balance & coordination"},{value:"skill acquisition",label:"Skill acquisition"},{value:"rehabilitation / injury prevention",label:"Rehabilitation / injury prevention"},{value:"mental health / stress relief",label:"Mental health"},{value:"general health & longevity",label:"General health & longevity"},{value:"sport-specific performance",label:"Sport-specific performance"},{value:"maintenance",label:"Maintenance"},{value:"rest",label:"Rest"},{value:"custom",label:"Custom"}];isExerciseModalOpen=I(!1);availableExercises=[];modalSearchTerm=I("");filteredAvailableExercises=L(()=>{let t=this.modalSearchTerm().toLowerCase();return t?this.availableExercises.filter(e=>e.name.toLowerCase().includes(t)||e.category.toLowerCase().includes(t)||e.primaryMuscleGroup.toLowerCase().includes(t)):this.availableExercises});selectedExerciseIndicesForSuperset=I([]);constructor(){this.routineForm=this.fb.group({name:["",B.required],description:[""],goal:["custom"],exercises:this.fb.array([])})}platformId=E(ce);ngOnInit(){N(this.platformId)&&window.scrollTo(0,0),this.loadAvailableExercises(),this.routeSub=this.route.paramMap.pipe(ue(t=>{this.currentRoutineId=t.get("routineId");let e=this.route.snapshot.url[0]?.path;return this.isNewMode=e==="new",this.isViewMode=e==="view"&&!!this.currentRoutineId,this.isEditMode=e==="edit"&&!!this.currentRoutineId||this.isNewMode,this.expandedSetPath.set(null),this.currentRoutineId&&(this.isEditMode||this.isViewMode)&&!this.isNewMode?this.workoutService.getRoutineById(this.currentRoutineId):(this.exercisesFormArray.clear(),this.routineForm.reset({goal:"custom",exercises:[]}),this.isNewMode&&this.toggleFormState(!1),ae(null))}),le(t=>{t?(this.patchFormWithRoutineData(t),this.isViewMode?this.toggleFormState(!0):this.isEditMode&&!this.isNewMode&&this.toggleFormState(!1)):(this.isEditMode||this.isViewMode)&&!this.isNewMode&&this.currentRoutineId&&(this.toastService.error(`Routine with ID ${this.currentRoutineId} not found.`,0,"Error"),this.router.navigate(["/workout"]))})).subscribe(),this.routineForm.get("goal")?.valueChanges.subscribe(t=>{let e=this.exercisesFormArray;if(t==="rest"){for(;e.length;)e.removeAt(0);e.clearValidators()}e.updateValueAndValidity()})}toggleFormState(t){t?this.routineForm.disable({emitEvent:!1}):(this.routineForm.enable({emitEvent:!1}),this.exercisesFormArray.controls.forEach(e=>{this.updateRoundsControlability(e)}))}get exercisesFormArray(){return this.routineForm.get("exercises")}getSetsFormArray(t){return t.get("sets")}loadAvailableExercises(){this.exerciseService.getExercises().subscribe(t=>{this.availableExercises=t})}patchFormWithRoutineData(t){this.routineForm.patchValue({name:t.name,description:t.description,goal:t.goal}),this.exercisesFormArray.clear(),t.exercises.forEach(e=>{let i=this.createExerciseFormGroup(e);this.exercisesFormArray.push(i)}),this.isViewMode?this.toggleFormState(!0):this.toggleFormState(!1),this.expandedSetPath.set(null)}createExerciseFormGroup(t){let e=t?.exerciseId?this.availableExercises.find(r=>r.id===t.exerciseId):null,i=this.fb.group({id:[t?.id||this.workoutService.generateWorkoutExerciseId()],exerciseId:[t?.exerciseId||"",B.required],exerciseName:[t?.exerciseName||e?.name||"Select Exercise"],notes:[t?.notes||""],sets:this.fb.array(t?.sets.map(r=>this.createSetFormGroup(r))||[]),supersetId:[t?.supersetId||null],supersetOrder:[t?.supersetOrder??null],supersetSize:[t?.supersetSize??null],rounds:[t?.rounds??1,[B.min(1)]]});return i.get("supersetId")?.valueChanges.subscribe(()=>this.updateRoundsControlability(i)),i.get("supersetOrder")?.valueChanges.subscribe(()=>this.updateRoundsControlability(i)),this.updateRoundsControlability(i),i.get("exerciseId")?.valueChanges.subscribe(r=>{let n=this.availableExercises.find(d=>d.id===r);i.get("exerciseName")?.setValue(n?.name||"Unknown Exercise",{emitEvent:!1})}),i}createSetFormGroup(t){return this.fb.group({id:[t?.id||this.workoutService.generateExerciseSetId()],reps:[t?.reps??null,[B.min(0)]],weight:[this.unitsService.convertFromKg(t?.weight,this.unitsService.currentUnit())??null,[B.min(0)]],duration:[t?.duration??null,[B.min(0)]],tempo:[t?.tempo||""],restAfterSet:[t?.restAfterSet??60,[B.required,B.min(0)]],notes:[t?.notes||""],type:[t?.type||"standard"]})}openExerciseSelectionModal(){this.isViewMode||(this.modalSearchTerm.set(""),this.isExerciseModalOpen.set(!0))}closeExerciseSelectionModal(){this.isExerciseModalOpen.set(!1)}onModalSearchTermChange(t){let e=t.target;this.modalSearchTerm.set(e.value)}selectExercise(t){let e=this.createExerciseFormGroup({id:this.workoutService.generateWorkoutExerciseId(),exerciseId:t.id,exerciseName:t.name,sets:[{id:this.workoutService.generateExerciseSetId(),reps:8,weight:0,restAfterSet:60,duration:0,tempo:"-",notes:""}],supersetId:null,supersetOrder:null,supersetSize:null,rounds:1});this.exercisesFormArray.push(e),this.closeExerciseSelectionModal(),this.toggleSetExpansion(this.exercisesFormArray.length-1,0)}ngAfterViewInit(){this.expandedSetElements.changes.subscribe(t=>{t.first&&this.expandedSetPath()&&setTimeout(()=>{t.first.nativeElement.scrollIntoView({behavior:"smooth",block:"center"})},0)})}addSet(t,e){if(this.isViewMode)return;let i=this.getSetsFormArray(t);i.push(this.createSetFormGroup()),this.cdr.detectChanges();let r=i.length-1;this.toggleSetExpansion(e,r)}removeSet(t,e,i){if(this.isViewMode)return;this.getSetsFormArray(t).removeAt(i);let n=this.expandedSetPath();n&&n.exerciseIndex===e&&n.setIndex===i?this.expandedSetPath.set(null):n&&n.exerciseIndex===e&&n.setIndex>i&&this.expandedSetPath.set({exerciseIndex:e,setIndex:n.setIndex-1})}toggleSetExpansion(t,e,i){if(i?.stopPropagation(),!(this.isViewMode&&!(this.expandedSetPath()?.exerciseIndex===t&&this.expandedSetPath()?.setIndex===e))){if(this.isViewMode){this.expandedSetPath.set(null);return}}let r=this.expandedSetPath();r?.exerciseIndex===t&&r?.setIndex===e?this.expandedSetPath.set(null):(this.expandedSetPath.set({exerciseIndex:t,setIndex:e}),this.cdr.detectChanges(),setTimeout(()=>{let n=this.expandedSetElements.find((d,p)=>!0);if(n){let d=n.nativeElement.querySelector('input[formControlName="reps"], input[formControlName="weight"], input[formControlName="duration"]');d instanceof HTMLInputElement&&(d.focus(),d.select())}},50))}isSetExpanded(t,e){let i=this.expandedSetPath();return i?.exerciseIndex===t&&i?.setIndex===e}collapseExpandedSet(){this.expandedSetPath.set(null)}getFormErrors(t){let e={};return Object.keys(t.controls).forEach(i=>{let r=t.get(i).errors;if(r&&(e[i]=r),t.get(i)instanceof Et||t.get(i)instanceof Dt){let n=this.getFormErrors(t.get(i));Object.keys(n).length>0&&(e[i]=n)}}),e}get f(){return this.routineForm.controls}toggleExerciseSelectionForSuperset(t,e){if(this.isViewMode)return;let i=e.target;this.selectedExerciseIndicesForSuperset.update(r=>{let n;return i.checked?n=r.includes(t)?r:[...r,t]:n=r.filter(d=>d!==t),n.sort((d,p)=>d-p)})}canGroupSelectedExercises(){let t=this.selectedExerciseIndicesForSuperset();if(t.length<2)return!1;let e=this.exercisesFormArray.at(t[0]).get("supersetId")?.value;for(let i=1;i<t.length;i++){let r=t[i],n=this.exercisesFormArray.at(r).get("supersetId")?.value;if(e&&n&&e!==n||!e&&n)return!1}return!0}onExerciseDrop(t){if(!this.isViewMode&&t.previousContainer===t.container){let e=this.exercisesFormArray;Mt(e.controls,t.previousIndex,t.currentIndex),e.updateValueAndValidity(),this.selectedExerciseIndicesForSuperset.set([]),this.handleSupersetIntegrityAfterDrag(t.previousIndex,t.currentIndex),this.recalculateSupersetOrders(),this.expandedSetPath.set(null)}}handleSupersetIntegrityAfterDrag(t,e){let i=new Set;if(i.add(t),i.add(e),t<e)for(let n=t;n<=e;n++)i.add(n);else for(let n=e;n<=t;n++)i.add(n);let r=new Set;i.forEach(n=>{if(n<this.exercisesFormArray.length){let p=this.exercisesFormArray.at(n).get("supersetId")?.value;p&&r.add(p)}}),r.forEach(n=>{this.exercisesFormArray.controls.forEach(d=>{let p=d;p.get("supersetId")?.value===n&&p.patchValue({supersetId:null,supersetOrder:null,supersetSize:null})})}),this.recalculateSupersetOrders()}recalculateSupersetOrders(){let t=new Map;this.exercisesFormArray.controls.forEach(e=>{let i=e,r=i.get("supersetId")?.value;r?(t.has(r)||t.set(r,[]),t.get(r).push(i)):(i.patchValue({supersetOrder:null,supersetSize:null},{emitEvent:!1}),this.updateRoundsControlability(i))}),t.forEach((e,i)=>{e.length<2?e.forEach(r=>{r.patchValue({supersetId:null,supersetOrder:null,supersetSize:null}),this.updateRoundsControlability(r)}):(e.sort((r,n)=>this.exercisesFormArray.controls.indexOf(r)-this.exercisesFormArray.controls.indexOf(n)),e.forEach((r,n)=>{r.patchValue({supersetOrder:n,supersetSize:e.length},{emitEvent:!1}),this.updateRoundsControlability(r)}))}),this.exercisesFormArray.updateValueAndValidity({emitEvent:!1})}groupSelectedAsSuperset(){if(this.isViewMode)return;let t=this.selectedExerciseIndicesForSuperset().sort((d,p)=>d-p);if(t.length<2){this.toastService.warning("Select at least two exercises.",3e3,"Superset Error");return}for(let d=1;d<t.length;d++)if(t[d]!==t[d-1]+1){this.toastService.warning("Selected exercises must be next to each other to form a superset.",5e3,"Superset Error");return}let e=$(),i=t.length,n=this.exercisesFormArray.at(t[0]).get("rounds")?.value??1;t.forEach((d,p)=>{let g=this.exercisesFormArray.at(d);g.patchValue({supersetId:e,supersetOrder:p,supersetSize:i,rounds:n}),this.updateRoundsControlability(g),g.get("sets").controls.forEach(v=>{p<i-1&&v.get("restAfterSet")?.setValue(0)})}),this.selectedExerciseIndicesForSuperset.set([]),this.toastService.success("Superset created!",3e3,"Success")}ungroupSuperset(t){if(this.isViewMode)return;let i=this.exercisesFormArray.at(t).get("supersetId")?.value;i&&(this.exercisesFormArray.controls.forEach(r=>{let n=r;n.get("supersetId")?.value===i&&(n.patchValue({supersetId:null,supersetOrder:null,supersetSize:null}),this.updateRoundsControlability(n))}),this.selectedExerciseIndicesForSuperset.set([]),this.toastService.info("Superset ungrouped.",3e3,"Ungrouped"))}removeExercise(t){if(this.isViewMode)return;let i=this.exercisesFormArray.at(t).get("supersetId")?.value;this.exercisesFormArray.removeAt(t),this.selectedExerciseIndicesForSuperset.set([]),i&&this.recalculateSupersetOrders(),this.toastService.info("Exercise removed.",2e3),this.expandedSetPath.set(null)}errorMessage=I(null);onSubmit(){if(this.isViewMode){this.toastService.info("Currently in view mode. No changes to save.",3e3,"View Mode");return}this.recalculateSupersetOrders();let t=this.routineForm.get("goal")?.value==="rest";if(this.routineForm.get("name")?.invalid||this.routineForm.get("goal")?.invalid){this.routineForm.markAllAsTouched(),this.toastService.error("Please fill all required routine details (Name, Goal).",0,"Validation Error"),console.log("Form Errors (Details):",this.getFormErrors(this.routineForm));return}if(!t&&this.exercisesFormArray.length>0&&!this.validateSupersetIntegrity()){this.toastService.error("Superset configuration is invalid. Ensure supersets have at least two contiguous exercises.",0,"Validation Error");return}if(!t){if(!this.exercisesFormArray||this.exercisesFormArray.length===0){this.routineForm.markAllAsTouched(),this.toastService.error("A non-rest routine must have at least one exercise.",0,"Validation Error");return}let r=this.exercisesFormArray.value;for(let n=0;n<r.length;n++){let d=r[n],p=this.availableExercises.find(b=>b.id===d.exerciseId),g=d.exerciseName||p?.name||`Exercise ${n+1}`;if(!d.sets||d.sets.length===0){this.toastService.error(`The exercise "${g}" must have at least one set.`,0,"Validation Error"),this.exercisesFormArray.at(n).markAllAsTouched();return}let v=this.exercisesFormArray.at(n).get("rounds")?.value;if(v!=null&&v<1){this.toastService.error(`The exercise "${g}" must have at least 1 round.`,0,"Validation Error"),this.exercisesFormArray.at(n).get("rounds")?.markAsTouched();return}for(let b=0;b<d.sets.length;b++){let T=d.sets[b],P=`Set ${b+1} of "${g}"`,D=T.reps??0,O=T.weight??0,F=T.duration??0,R=F>0;if(!R&&p&&["cardio","stretching","plank","isometric"].includes(p.category.toLowerCase())&&(R=!0),R){if(F<=0){this.toastService.error(`${P} is timed but has no duration.`,0,"Validation Error"),this.exercisesFormArray.at(n).get("sets").at(b).markAllAsTouched();return}}else{if(D<=0&&O<=0&&F<=0){this.toastService.error(`${P} must have reps, weight, or duration.`,0,"Validation Error"),this.exercisesFormArray.at(n).get("sets").at(b).markAllAsTouched();return}if(D<=0&&O>0){this.toastService.error(`${P} with weight must also have reps.`,0,"Validation Error"),this.exercisesFormArray.at(n).get("sets").at(b).markAllAsTouched();return}}}}}let e=this.routineForm.getRawValue(),i={id:(this.isEditMode||this.isNewMode)&&this.currentRoutineId?this.currentRoutineId:$(),name:e.name,description:e.description,goal:e.goal,exercises:t?[]:e.exercises.map(r=>z(G({},r),{sets:r.sets.map(n=>z(G({},n),{weight:this.unitsService.convertToKg(n.weight,this.unitsService.currentUnit())??null,restAfterSet:n.restAfterSet??0}))}))};this.isNewMode&&!this.currentRoutineId&&(i.id=$());try{if(this.spinnerService.show("Saving routine..."),this.isNewMode)this.workoutService.addRoutine(i),this.toastService.success("Routine created successfully!",4e3,"Success");else if(this.isEditMode&&this.currentRoutineId)this.workoutService.updateRoutine(i),this.toastService.success("Routine updated successfully!",4e3,"Success");else{this.toastService.warning("No save operation performed. Mode is unclear or ID missing.",0,"Save Warning"),this.spinnerService.hide();return}this.routineForm.markAsPristine(),this.router.navigate(["/workout"])}catch(r){console.error("Error saving routine:",r),this.toastService.error(`Failed to save routine: ${r.message||"Unknown error"}`,0,"Save Error")}finally{this.spinnerService.hide()}}validateSupersetIntegrity(){let t=this.exercisesFormArray.value,e=new Map;for(let i of t)i.supersetId&&(e.has(i.supersetId)||e.set(i.supersetId,[]),e.get(i.supersetId).push(i));for(let[i,r]of e.entries()){if(r.length<2)return!1;let n=r.sort((d,p)=>(d.supersetOrder??1/0)-(p.supersetOrder??1/0));for(let d=0;d<n.length;d++)if(n[d].supersetOrder!==d)return!1}return!0}get firstSelectedExerciseIndexForSuperset(){let t=this.selectedExerciseIndicesForSuperset();return t.length>0?t[0]:null}updateRoundsControlability(t){let e=t.get("supersetId")?.value,i=t.get("supersetOrder")?.value,r=t.get("rounds");if(this.isViewMode){r?.disable({emitEvent:!1});return}if(e&&i!==null&&i>0){r?.disable({emitEvent:!1});let n=this.exercisesFormArray.controls.find(d=>d.get("supersetId")?.value===e&&d.get("supersetOrder")?.value===0);n&&r?.setValue(n.get("rounds")?.value??1,{emitEvent:!1})}else r?.enable({emitEvent:!1})}syncSupersetRounds(t,e,i){this.isViewMode||!t||e===null||e===void 0||e<1||this.exercisesFormArray.at(i).get("supersetOrder")?.value!==0||this.exercisesFormArray.controls.forEach(n=>{let d=n;d.get("supersetId")?.value===t&&d.get("rounds")?.value!==e&&d.get("rounds")?.setValue(e,{emitEvent:!1})})}startCurrentWorkout(){this.currentRoutineId?this.router.navigate(["/workout/play",this.currentRoutineId]):this.toastService.error("Cannot start workout: Routine ID is missing.",0,"Error")}enableEditMode(){this.isViewMode&&this.currentRoutineId&&(this.isViewMode=!1,this.isEditMode=!0,this.toggleFormState(!1),this.router.navigate(["/workout/edit",this.currentRoutineId],{replaceUrl:!0}),this.toastService.info("Edit mode enabled.",3e3,"Mode Changed"))}deleteCurrentRoutine(){return W(this,null,function*(){if(!this.currentRoutineId){this.toastService.error("Cannot delete: Routine ID is missing.",0,"Error");return}let t=yield X(this.workoutService.getRoutineById(this.currentRoutineId).pipe(j(1)));if(!t){this.toastService.error("Routine not found for deletion.",0,"Error");return}let e=(yield X(this.trackingService.getWorkoutLogsByRoutineId(this.currentRoutineId).pipe(j(1))))||[],i=`Are you sure you want to delete the routine "${t.name}"?`;e.length>0&&(i+=` This will also delete ${e.length} associated workout log(s). This action cannot be undone.`);let r=yield this.alertService.showConfirm("Delete Routine",i,"Delete");if(r&&r.data)try{this.spinnerService.show(),e.length>0&&(yield this.trackingService.clearWorkoutLogsByRoutineId(this.currentRoutineId),this.toastService.info(`${e.length} workout log(s) deleted.`,3e3,"Logs Cleared")),yield this.workoutService.deleteRoutine(this.currentRoutineId),this.toastService.success(`Routine "${t.name}" deleted.`,4e3,"Routine Deleted"),this.router.navigate(["/workout"])}catch(n){console.error("Error during deletion:",n),this.toastService.error("Failed to delete routine or logs. Please try again.",0,"Deletion Failed")}finally{this.spinnerService.hide()}})}ngOnDestroy(){this.routeSub&&this.routeSub.unsubscribe()}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=J({type:s,selectors:[["app-workout-builder"]],viewQuery:function(e,i){if(e&1&&(Ee(li,5),Ee(di,5)),e&2){let r;Ce(r=Te())&&(i.setRepsInputs=r),Ce(r=Te())&&(i.expandedSetElements=r)}},features:[Ae([te])],decls:31,vars:14,consts:[["expandedSetElement",""],["setRepsInput",""],["class","my-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-md dark:bg-red-900/30 dark:border-red-600 dark:text-red-300",4,"ngIf"],[1,"container","mx-auto","p-1","sm:p-4"],[1,"mb-6","pb-4","border-b","border-gray-200","dark:border-gray-700"],[1,"flex","justify-between","items-center"],["routerLink","/workout",1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-ml-1"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"text-xl","sm:text-2xl","md:text-2xl","font-bold","text-gray-800","dark:text-gray-200","text-center","flex-grow","truncate","px-2"],[1,"w-10","h-10"],["class","mt-4 flex flex-wrap gap-2 justify-center sm:justify-start",4,"ngIf"],[1,"space-y-6","mb-6",3,"ngSubmit","formGroup"],[1,"space-y-4","p-4","bg-white","dark:bg-gray-700","rounded-lg","shadow-sm"],["for","name",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300"],["type","text","id","name","formControlName","name",1,"mt-1","block","w-full","p-2","border","rounded-md","shadow-sm","focus:ring-primary","focus:border-primary","dark:bg-gray-600","dark:border-gray-600","dark:text-gray-200",3,"ngClass"],["class","text-red-500 dark:text-red-400 text-xs mt-1",4,"ngIf"],["for","description",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300"],["id","description","formControlName","description","rows","3",1,"mt-1","block","w-full","p-2","border","border-gray-300","dark:border-gray-600","rounded-md","shadow-sm","focus:ring-primary","focus:border-primary","dark:bg-gray-600","dark:text-gray-200"],["for","goal",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300"],["id","goal","formControlName","goal",1,"mt-1","block","w-full","p-2","border","border-gray-300","dark:border-gray-600","rounded-md","shadow-sm","focus:ring-primary","focus:border-primary","dark:bg-gray-600","dark:text-gray-200"],[3,"value",4,"ngFor","ngForOf"],["class","pt-4",4,"ngIf"],["class","p-4 bg-blue-50 dark:bg-blue-900/30 rounded-lg text-center",4,"ngIf"],["class","pt-6 flex justify-end space-x-3",4,"ngIf"],["class","fixed inset-0 bg-gray-700 bg-opacity-75 transition-opacity overflow-y-auto h-full w-full z-[70] flex items-center justify-center p-4",3,"click",4,"ngIf"],[1,"my-4","p-3","bg-red-100","border","border-red-400","text-red-700","rounded-md","dark:bg-red-900/30","dark:border-red-600","dark:text-red-300"],[1,"mt-4","flex","flex-wrap","gap-2","justify-center","sm:justify-start"],["type","button",1,"bg-green-500","hover:bg-green-600","text-white","font-semibold","py-2","px-3","rounded-md","shadow-sm","text-xs","sm:text-sm","flex","items-center",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-4","sm:size-5","mr-1"],["stroke-linecap","round","stroke-linejoin","round","d","M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"],["type","button","class","bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-2 px-3 rounded-md shadow-sm text-xs sm:text-sm flex items-center",3,"click",4,"ngIf"],["type","button",1,"bg-red-500","hover:bg-red-600","text-white","font-semibold","py-2","px-3","rounded-md","shadow-sm","text-xs","sm:text-sm","flex","items-center",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"],["type","button",1,"bg-yellow-500","hover:bg-yellow-600","text-white","font-semibold","py-2","px-3","rounded-md","shadow-sm","text-xs","sm:text-sm","flex","items-center",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"],[1,"text-red-500","dark:text-red-400","text-xs","mt-1"],[4,"ngIf"],[3,"value"],[1,"pt-4"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-xl","font-semibold","text-gray-700","dark:text-gray-300"],["type","button","class","bg-green-500 hover:enabled:bg-green-600 text-white text-sm font-medium py-2 px-3 rounded-md transition-all duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed",3,"disabled","click",4,"ngIf"],["cdkDropList","","formArrayName","exercises","class","exercise-list-container space-y-4",3,"cdkDropListData","cdkDropListDropped",4,"ngIf"],["class","text-center py-6 text-gray-500 dark:text-gray-400 border border-dashed dark:border-gray-700 rounded-md mt-4",4,"ngIf"],["class","mt-6 text-center",4,"ngIf"],["type","button",1,"bg-green-500","hover:enabled:bg-green-600","text-white","text-sm","font-medium","py-2","px-3","rounded-md","transition-all","duration-150","ease-in-out","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["cdkDropList","","formArrayName","exercises",1,"exercise-list-container","space-y-4",3,"cdkDropListDropped","cdkDropListData"],[4,"ngFor","ngForOf"],[1,"relative","group","exercise-card-wrapper"],["class","absolute left-1/2 -translate-x-1/2 z-20","style","top: -1.25rem;",4,"ngIf"],["cdkDrag","",1,"p-2","border","rounded-lg","shadow-sm","space-y-2","exercise-item","relative","transition-all","duration-150","ease-in-out",3,"cdkDragDisabled","cdkDragData","formGroupName","ngClass"],["cdkDragHandle","","class","absolute top-2 right-2 cursor-grab p-1 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300","title","Drag to reorder",4,"ngIf"],[1,"flex","flex-col","sm:flex-row","justify-between","items-start","sm:items-center","pb-2","pt-6",3,"ngClass"],[1,"flex","items-center","pr-8","mb-2","sm:mb-0"],["type","checkbox","class","h-5 w-5 text-orange-600 border-gray-300 rounded focus:ring-orange-500 mr-3 self-start mt-1 disabled:opacity-50",3,"id","checked","disabled","change",4,"ngIf"],[1,"text-lg","font-semibold","text-gray-800","dark:text-gray-100"],["class","text-xs text-orange-600 dark:text-orange-400 font-normal block",4,"ngIf"],[1,"flex","flex-col","items-start","sm:items-end","space-y-1","flex-shrink-0","w-full","sm:w-auto"],[1,"flex","items-center","space-x-1"],[1,"text-xs","font-medium","text-gray-600","dark:text-gray-400","whitespace-nowrap",3,"for"],["type","number","formControlName","rounds","min","1",1,"w-16","p-1","text-sm","border-gray-300","dark:border-gray-600","border-2","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-600","dark:text-gray-200","disabled:opacity-50","disabled:bg-gray-300","dark:disabled:bg-gray-500",3,"change","id","readonly"],["type","button","class","flex items-center text-xs text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 font-medium py-1 px-2 rounded-md hover:enabled:bg-red-100 dark:enabled:hover:bg-red-900/50 disabled:opacity-50",3,"disabled","click",4,"ngIf"],["type","button","class","flex items-center text-xs text-violet-600 hover:text-violet-700 dark:text-violet-400 dark:hover:text-violet-300 font-medium py-1 px-2 rounded-md hover:bg-violet-100 dark:hover:bg-violet-900/50 disabled:opacity-50",3,"disabled","click",4,"ngIf"],[1,"space-y-1"],[1,"flex","justify-between","items-center","mb-1"],[1,"text-sm","font-semibold","text-gray-700","dark:text-gray-300"],["type","button","class","text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 font-medium py-0.5 px-1.5 rounded-md hover:enabled:bg-blue-100 dark:hover:bg-blue-900/50 disabled:opacity-50",3,"disabled","click",4,"ngIf"],["formArrayName","sets",1,"space-y-1.5"],["class","flex justify-between grid grid-cols-12 gap-x-2 py-1 px-2 text-xs font-medium text-gray-500 dark:text-gray-400 border-b dark:border-gray-600",4,"ngIf"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"absolute","left-1/2","-translate-x-1/2","z-20",2,"top","-1.25rem"],["type","button",1,"bg-orange-600","hover:bg-orange-700","text-white","text-xs","font-semibold","py-1.5","px-3","rounded-full","shadow-lg","whitespace-nowrap","transition-all","duration-150","ease-in-out","hover:scale-105","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["cdkDragHandle","","title","Drag to reorder",1,"absolute","top-2","right-2","cursor-grab","p-1","text-gray-400","hover:text-gray-600","dark:text-gray-500","dark:hover:text-gray-300"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"w-5","h-5"],["fill-rule","evenodd","d","M10 3a.75.75 0 0 1 .75.75v12.5a.75.75 0 0 1-1.5 0V3.75A.75.75 0 0 1 10 3ZM5.75 6.75a.75.75 0 0 0 0 1.5h8.5a.75.75 0 0 0 0-1.5h-8.5Zm0 5a.75.75 0 0 0 0 1.5h8.5a.75.75 0 0 0 0-1.5h-8.5Z","clip-rule","evenodd"],["type","checkbox",1,"h-5","w-5","text-orange-600","border-gray-300","rounded","focus:ring-orange-500","mr-3","self-start","mt-1","disabled:opacity-50",3,"change","id","checked","disabled"],[1,"text-xs","text-orange-600","dark:text-orange-400","font-normal","block"],["type","button",1,"flex","items-center","text-xs","text-red-600","hover:text-red-700","dark:text-red-400","dark:hover:text-red-300","font-medium","py-1","px-2","rounded-md","hover:enabled:bg-red-100","dark:enabled:hover:bg-red-900/50","disabled:opacity-50",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-4","h-4","mr-1"],["stroke-linecap","round","stroke-linejoin","round","d","m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12.56 0c.342.052.682.107 1.022.166m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"],["type","button",1,"flex","items-center","text-xs","text-violet-600","hover:text-violet-700","dark:text-violet-400","dark:hover:text-violet-300","font-medium","py-1","px-2","rounded-md","hover:bg-violet-100","dark:hover:bg-violet-900/50","disabled:opacity-50",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","d","M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75v4.5m0-4.5h-4.5m4.5 0L15 9m5.25 11.25v-4.5m0 4.5h-4.5m4.5 0L15 15"],["type","button",1,"text-xs","text-blue-600","hover:text-blue-700","dark:text-blue-400","dark:hover:text-blue-300","font-medium","py-0.5","px-1.5","rounded-md","hover:enabled:bg-blue-100","dark:hover:bg-blue-900/50","disabled:opacity-50",3,"click","disabled"],[1,"flex","justify-between","grid","grid-cols-12","gap-x-2","py-1","px-2","text-xs","font-medium","text-gray-500","dark:text-gray-400","border-b","dark:border-gray-600"],[1,"col-span-1","text-center"],[1,"col-span-2","text-center"],[1,"col-span-2"],[3,"formGroupName"],["class","grid grid-cols-12 gap-x-2 items-center py-1.5 px-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer border dark:border-gray-700 dark:text-gray-200",3,"ngClass","click",4,"ngIf"],["class","mt-1 p-3 rounded-md border border-gray-300 dark:border-gray-500 shadow-inner space-y-2",3,"ngClass",4,"ngIf"],[1,"grid","grid-cols-12","gap-x-2","items-center","py-1.5","px-2","rounded-md","hover:bg-gray-100","dark:hover:bg-gray-700","cursor-pointer","border","dark:border-gray-700","dark:text-gray-200",3,"click","ngClass"],[1,"col-span-1","text-xs","text-gray-600","dark:text-gray-400","text-center","font-medium"],[1,"col-span-2","text-xs","text-gray-300","text-center"],[1,"col-span-2","text-xs","text-gray-300","text-center","truncate",3,"title"],["class","col-span-1 flex items-center justify-end",4,"ngIf"],["class","col-span-1",4,"ngIf"],[1,"col-span-1","flex","items-center","justify-end"],["type","button","title","Remove Set",1,"text-red-500","hover:text-red-600","dark:text-red-400","dark:hover:text-red-300","p-1","rounded-full","hover:bg-red-100","dark:hover:bg-red-900/30","disabled:opacity-50",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 16 16","fill","currentColor",1,"w-3.5","h-3.5"],["fill-rule","evenodd","d","M5 3.25A2.25 2.25 0 0 0 2.75 5.5v5A2.25 2.25 0 0 0 5 12.75h6a2.25 2.25 0 0 0 2.25-2.25v-5A2.25 2.25 0 0 0 11 3.25H5Zm.97 3.97a.75.75 0 0 1 1.06 0L8 8.28l.97-.97a.75.75 0 1 1 1.06 1.06L9.06 9.25l.97.97a.75.75 0 1 1-1.06 1.06L8 10.43l-.97.97a.75.75 0 0 1-1.06-1.06L6.94 9.25l-.97-.97a.75.75 0 0 1 0-1.06Z","clip-rule","evenodd"],[1,"col-span-1"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["x1","12","y1","5","x2","12","y2","19"],["x1","5","y1","12","x2","19","y2","12"],[1,"mt-1","p-3","rounded-md","border","border-gray-300","dark:border-gray-500","shadow-inner","space-y-2",3,"ngClass"],[1,"grid","grid-cols-2","sm:grid-cols-3","md:grid-cols-4","gap-x-3","gap-y-2","items-center"],[1,"block","text-xs","font-medium","text-gray-600","dark:text-gray-400",3,"for"],["type","number","formControlName","reps","placeholder","Reps",1,"mt-0.5","w-full","p-1.5","text-sm","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-500","dark:text-gray-200",3,"id"],["type","number","formControlName","weight","placeholder","Weight",1,"mt-0.5","w-full","p-1.5","text-sm","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-500","dark:text-gray-200",3,"id"],["type","number","formControlName","duration","placeholder","Secs",1,"mt-0.5","w-full","p-1.5","text-sm","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-500","dark:text-gray-200",3,"id"],["type","text","formControlName","tempo","placeholder","e.g. 2010",1,"mt-0.5","w-full","p-1.5","text-sm","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-500","dark:text-gray-200",3,"id"],[1,"col-span-2","sm:col-span-1","md:col-span-2"],["type","number","formControlName","restAfterSet","placeholder","Rest",1,"mt-0.5","w-full","p-1.5","text-sm","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-500","dark:text-gray-200",3,"id"],[1,"col-span-full"],["type","text","formControlName","notes","placeholder","e.g. Drop set",1,"mt-0.5","w-full","p-1.5","text-sm","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-500","dark:text-gray-200",3,"id"],[1,"mt-2","text-right"],["type","button",1,"text-xs","text-blue-600","hover:text-blue-700","dark:text-blue-400","dark:hover:text-blue-300","font-medium","py-1","px-2","rounded-md","hover:bg-blue-100","dark:hover:bg-blue-900/30",3,"click"],[1,"text-center","py-6","text-gray-500","dark:text-gray-400","border","border-dashed","dark:border-gray-700","rounded-md","mt-4"],[1,"mb-2"],["type","button",1,"bg-green-500","hover:bg-green-600","text-white","text-sm","font-medium","py-2","px-3","rounded-md","transition-all","duration-150","ease-in-out","disabled:opacity-50",3,"click","disabled"],[1,"mt-6","text-center"],["type","button",1,"bg-green-500","hover:bg-green-600","text-white","font-semibold","py-2","px-6","rounded-md","shadow-md","hover:shadow-lg","transition-all","duration-300","focus:outline-none","focus:ring-2","focus:ring-green-400","focus:ring-opacity-75","disabled:opacity-50",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"w-5","h-5","mr-2","inline-block"],["d","M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z"],[1,"p-4","bg-blue-50","dark:bg-blue-900/30","rounded-lg","text-center"],[1,"text-sm","text-blue-700","dark:text-blue-300"],[1,"pt-6","flex","justify-end","space-x-3"],["routerLink","/workout",1,"px-4","py-2","border","border-gray-300","dark:border-gray-600","rounded-md","shadow-sm","text-sm","font-medium","text-gray-700","dark:text-gray-200","hover:bg-gray-50","dark:hover:bg-gray-700"],["type","submit",1,"px-4","py-2","border","border-transparent","rounded-md","shadow-sm","text-sm","font-medium","text-white","bg-primary","hover:bg-primary-dark","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-primary-dark","disabled:opacity-50","transition-all","duration-150","ease-in-out",3,"disabled"],[1,"fixed","inset-0","bg-gray-700","bg-opacity-75","transition-opacity","overflow-y-auto","h-full","w-full","z-[70]","flex","items-center","justify-center","p-4",3,"click"],[1,"relative","transform","overflow-hidden","rounded-lg","bg-white","dark:bg-gray-700","text-left","shadow-xl","transition-all","sm:my-8","sm:w-full","sm:max-w-lg",3,"click"],[1,"bg-white","dark:bg-gray-700","px-4","pt-5","pb-4","sm:p-6","sm:pb-4"],[1,"sm:flex","sm:items-start","w-full"],[1,"mt-3","text-center","sm:mt-0","sm:text-left","w-full"],[1,"flex","justify-between","items-center","pb-3"],["id","modal-title",1,"text-xl","font-semibold","leading-6","text-gray-900","dark:text-gray-100"],["type","button",1,"p-1","rounded-full","text-gray-400","hover:text-gray-600","dark:hover:text-gray-300","focus:outline-none",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","d","M6 18L18 6M6 6l12 12"],[1,"my-4"],["type","text","placeholder","Search exercises...",1,"w-full","p-2","border","border-gray-300","dark:border-gray-600","rounded-md","shadow-sm","focus:ring-primary","focus:border-primary","dark:bg-gray-700","dark:text-gray-200",3,"ngModelChange","ngModel"],[1,"mt-2","max-h-80","overflow-y-auto","pr-2"],["class","p-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md cursor-pointer transition-all duration-150 ease-in-out flex justify-between items-center",3,"click",4,"ngFor","ngForOf"],["class","text-gray-500 dark:text-gray-400 text-center p-4",4,"ngIf"],[1,"bg-gray-50","dark:bg-gray-700","px-4","py-3","sm:flex","sm:flex-row-reverse","sm:px-6"],["type","button",1,"mt-3","inline-flex","w-full","justify-center","rounded-md","bg-white","dark:bg-gray-700","px-3","py-2","text-sm","font-semibold","text-gray-900","dark:text-gray-200","shadow-sm","ring-1","ring-inset","ring-gray-300","dark:ring-gray-500","hover:bg-gray-50","dark:hover:bg-gray-500","sm:mt-0","sm:w-auto",3,"click"],[1,"p-3","hover:bg-gray-100","dark:hover:bg-gray-700","rounded-md","cursor-pointer","transition-all","duration-150","ease-in-out","flex","justify-between","items-center",3,"click"],[1,"font-medium","text-gray-800","dark:text-gray-200"],[1,"block","text-xs","text-gray-500","dark:text-gray-400"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"w-5","h-5","text-primary","dark:text-primary-light"],["fill-rule","evenodd","d","M8.22 5.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06-1.06L11.94 10 8.22 6.28a.75.75 0 0 1 0-1.06Z","clip-rule","evenodd"],[1,"text-gray-500","dark:text-gray-400","text-center","p-4"]],template:function(e,i){if(e&1&&(S(0,xi,2,1,"div",2),o(1,"div",3)(2,"header",4)(3,"div",5)(4,"button",6),C(),o(5,"svg",7),y(6,"path",8),a()(),V(),o(7,"h1",9),u(8),a(),y(9,"div",10),a(),S(10,hi,10,1,"div",11),a(),o(11,"form",12),_("ngSubmit",function(){return i.onSubmit()}),o(12,"section",13)(13,"div")(14,"label",14),u(15,"Routine Name"),a(),y(16,"input",15),S(17,vi,2,1,"div",16),a(),o(18,"div")(19,"label",17),u(20,"Description (Optional)"),a(),y(21,"textarea",18),a(),o(22,"div")(23,"label",19),u(24,"Primary Goal"),a(),o(25,"select",20),S(26,Si,2,2,"option",21),a()()(),S(27,Ni,8,4,"section",22)(28,Bi,3,0,"section",23)(29,Ui,5,2,"div",24),a(),S(30,Hi,21,4,"div",25),a()),e&2){let r,n,d;m("ngIf",i.errorMessage()),l(8),k(" ",i.isNewMode?"New Routine":i.isViewMode?((r=i.routineForm.get("name"))==null?null:r.value)||"View Routine":"Edit: "+(((r=i.routineForm.get("name"))==null?null:r.value)||"Routine")," "),l(2),m("ngIf",!i.isNewMode&&i.currentRoutineId),l(),m("formGroup",i.routineForm),l(5),m("ngClass",ge(11,ui,i.f.name.invalid&&i.f.name.touched,!(i.f.name.invalid&&i.f.name.touched))),l(),m("ngIf",i.f.name.invalid&&(i.f.name.dirty||i.f.name.touched)),l(9),m("ngForOf",i.routineGoals),l(),m("ngIf",((n=i.routineForm.get("goal"))==null?null:n.value)!=="rest"),l(),m("ngIf",((d=i.routineForm.get("goal"))==null?null:d.value)==="rest"),l(),m("ngIf",i.isEditMode||i.isNewMode),l(),m("ngIf",i.isExerciseModalOpen())}},dependencies:[Q,Oe,ee,Z,Ne,Qe,ze,Rt,Wt,$e,qe,Pt,Ge,je,Vt,Je,Ke,Ct,Tt,he,Ze,He,Nt,Ot,Lt,At,tt],styles:[".exercise-list-container[_ngcontent-%COMP%]{min-height:60px}.exercise-item[_ngcontent-%COMP%]{transition:box-shadow .2s ease-in-out}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:.4;background:#ccc;border:dotted 2px #999;min-height:100px;transition:transform .25s cubic-bezier(0,0,.2,1);display:block;margin-bottom:.5rem}.cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f;border-radius:.5rem;background-color:var(--card-background-color, white)}body.dark[_ngcontent-%COMP%]   .cdk-drag-preview[_ngcontent-%COMP%]{background-color:var(--dark-card-background-color, #1f2937)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .exercise-item[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"]})};var zi=["progressCircleSvg"];function qi(s,t){if(s&1&&(o(0,"div",12),u(1),a()),s&2){let e=c(2);l(),k(" Prepare for: ",e.nextUpText," ")}}function Ji(s,t){if(s&1){let e=w();o(0,"div",2)(1,"div",3),C(),o(2,"svg",4,0),y(4,"circle",5)(5,"circle",6),a(),V(),o(6,"div",7)(7,"div",8),u(8),a(),o(9,"div",9),u(10),a()()(),o(11,"button",10),_("click",function(){x(e);let r=c();return f(r.skipTimer())}),u(12," Skip "),a(),S(13,qi,2,1,"div",11),a()}if(s&2){let e=c();de("opacity-100",e.isVisible)("opacity-0",!e.isVisible),l(4),dt("r",e.getCircleRadius()),l(),dt("r",e.getCircleRadius())("stroke-dasharray",e.getCircleCircumference())("stroke-dashoffset",e.strokeDashoffset()),l(3),k(" ",e.displayTime()," "),l(2),k(" ",e.mainText," "),l(3),m("ngIf",e.nextUpText)}}var st=class s{isVisible=!1;durationSeconds=60;mainText="RESTING";nextUpText=null;timerFinished=new Ie;timerSkipped=new Ie;progressCircleSvg;timerIntervalId;circleRadius=90;circumference=2*Math.PI*this.circleRadius;remainingTime=I(0);initialDuration=I(0);strokeDashoffset=L(()=>{if(this.initialDuration()<=0)return this.circumference;let t=this.remainingTime()/this.initialDuration();return this.circumference*(1-t)});displayTime=L(()=>{let t=this.remainingTime(),e=Math.floor(t/60),i=t%60;return`${e.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`});ngOnChanges(t){t.isVisible&&(this.isVisible?this.startTimer():this.stopTimer()),t.durationSeconds&&this.isVisible&&this.startTimer()}ngAfterViewInit(){}startTimer(){if(this.stopTimer(),this.initialDuration.set(this.durationSeconds),this.remainingTime.set(this.durationSeconds),this.durationSeconds<=0){this.timerFinished.emit();return}this.timerIntervalId=setInterval(()=>{this.remainingTime.update(t=>{let e=t-1;return e<=0?(this.stopTimer(),this.timerFinished.emit(),0):e})},1e3)}stopTimer(){this.timerIntervalId&&(clearInterval(this.timerIntervalId),this.timerIntervalId=null)}skipTimer(){this.stopTimer(),this.timerSkipped.emit()}ngOnDestroy(){this.stopTimer()}getCircleCircumference(){return this.circumference}getCircleRadius(){return this.circleRadius}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=J({type:s,selectors:[["app-full-screen-rest-timer"]],viewQuery:function(e,i){if(e&1&&Ee(zi,5),e&2){let r;Ce(r=Te())&&(i.progressCircleSvg=r.first)}},inputs:{isVisible:"isVisible",durationSeconds:"durationSeconds",mainText:"mainText",nextUpText:"nextUpText"},outputs:{timerFinished:"timerFinished",timerSkipped:"timerSkipped"},features:[xt],decls:1,vars:1,consts:[["progressCircleSvg",""],["class","fixed inset-0 z-50 flex flex-col items-center justify-center bg-black/70 backdrop-blur-sm transition-opacity duration-300 ease-in-out",3,"opacity-100","opacity-0",4,"ngIf"],[1,"fixed","inset-0","z-50","flex","flex-col","items-center","justify-center","bg-black/70","backdrop-blur-sm","transition-opacity","duration-300","ease-in-out"],[1,"relative","flex","flex-col","items-center","justify-center","text-white"],["viewBox","0 0 200 200",1,"w-64","h-64","md:w-80","md:h-80","transform","-rotate-90"],["cx","100","cy","100","fill","transparent","stroke","rgba(255, 255, 255, 0.2)","stroke-width","12"],["cx","100","cy","100","fill","transparent","stroke","currentColor","stroke-width","14","stroke-linecap","round",1,"text-blue-500","dark:text-blue-400"],[1,"absolute","inset-0","flex","flex-col","items-center","justify-center","text-center"],[1,"text-6xl","md:text-7xl","font-bold","tabular-nums"],[1,"mt-2","text-xl","md:text-2xl","font-medium","uppercase","tracking-wider"],[1,"mt-12","py-3","px-8","bg-white/20","hover:bg-white/30","text-white","font-semibold","rounded-lg","shadow-md","transition-colors","duration-150","text-lg",3,"click"],["class","mt-5 text-sm md:text-base text-gray-300",4,"ngIf"],[1,"mt-5","text-sm","md:text-base","text-gray-300"]],template:function(e,i){e&1&&S(0,Ji,14,11,"div",1),e&2&&m("ngIf",i.isVisible)},dependencies:[Q,Z],encapsulation:2,changeDetection:0})};var ot=class s{longPress=new Ie;pressTimer;longPressDuration=500;onPressStart(t){this.clearTimeout(),this.pressTimer=setTimeout(()=>{this.longPress.emit(t)},this.longPressDuration)}onPressEnd(){this.clearTimeout()}clearTimeout(){this.pressTimer&&(clearTimeout(this.pressTimer),this.pressTimer=null)}static \u0275fac=function(e){return new(e||s)};static \u0275dir=_t({type:s,selectors:[["","appLongPress",""]],hostBindings:function(e,i){e&1&&_("mousedown",function(n){return i.onPressStart(n)})("touchstart",function(n){return i.onPressStart(n)})("mouseup",function(){return i.onPressEnd()})("mouseleave",function(){return i.onPressEnd()})("touchend",function(){return i.onPressEnd()})("touchcancel",function(){return i.onPressEnd()})},outputs:{longPress:"longPress"}})};var Ki=s=>({"filter dark:invert":s}),Yi=(s,t,e,i)=>({"text-red-500":s,"animate-pulse":t,"text-green-500 dark:text-green-400":e,"text-gray-800 dark:text-gray-100":i}),Zi=(s,t)=>({"bg-green-500 hover:bg-green-600":s,"bg-yellow-500 hover:bg-yellow-600 text-black":t}),Qi=(s,t,e,i)=>({"bg-red-500 hover:bg-red-600 focus:ring-red-400":s,"bg-green-500 hover:bg-green-600 focus:ring-green-400":t,"bg-blue-500 hover:bg-blue-600 focus:ring-blue-400":e,"bg-gray-400 dark:bg-gray-600 text-gray-800 dark:text-gray-200 cursor-not-allowed":i});function Xi(s,t){if(s&1){let e=w();o(0,"div",11)(1,"h2",12),u(2,"Session Paused"),a(),o(3,"p",13),u(4),a(),o(5,"button",14),_("click",function(){x(e);let r=c(2);return f(r.resumeSession())}),u(6," Resume Workout "),a(),o(7,"button",15),_("click",function(){x(e);let r=c(2);return f(r.quitWorkout())}),u(8," Quit Workout (No Save) "),a()()}if(s&2){let e=c(2);l(4),k("Elapsed Time: ",e.sessionTimerDisplay())}}function er(s,t){if(s&1&&y(0,"img",44),s&2){let e=c().ngIf,i=c(4);m("src",i.getIconPath(e.iconName),ft)("alt",e.name+" icon")("ngClass",yt(3,Ki,e.iconName!=="default-exercise"&&e.iconName!==""&&e.iconName!==null))}}function tr(s,t){if(s&1&&(o(0,"div",42),S(1,er,1,5,"img",43),a()),s&2){let e=t.ngIf;l(),m("ngIf",e.iconName)}}function ir(s,t){s&1&&y(0,"div",45)}function rr(s,t){if(s&1&&(o(0,"span"),u(1),a()),s&2){let e=c(5);l(),k("/",e.getTotalWarmupSetsForCurrentExercise())}}function nr(s,t){if(s&1&&(o(0,"span",46),u(1),S(2,rr,2,1,"span",36),a()),s&2){let e=c(4);l(),k(" Warm-up Set ",e.getCurrentWarmupSetNumber()," "),l(),m("ngIf",e.getTotalWarmupSetsForCurrentExercise()>0)}}function sr(s,t){if(s&1&&(o(0,"span"),u(1),a()),s&2){let e=c(4);l(),q(" Set ",e.getCurrentWorkingSetNumber(),"/",e.getWorkingSetCountForCurrentExercise()," ")}}function or(s,t){if(s&1&&(o(0,"span",47),u(1),a()),s&2){let e=c(4);l(),q(" (Round ",e.currentBlockRound(),"/",e.totalBlockRounds(),") ")}}function ar(s,t){if(s&1&&(o(0,"span",48),u(1),a()),s&2){let e=c().ngIf;l(),q(" (Superset ",(e.exerciseData.supersetOrder??0)+1,"/",e.exerciseData.supersetSize??"?",") ")}}function lr(s,t){s&1&&(o(0,"span",52),u(1,"Marked as Skipped"),a())}function dr(s,t){s&1&&(o(0,"span",53),u(1,"Marked for Later"),a())}function ur(s,t){if(s&1&&(o(0,"div",49),S(1,lr,2,0,"span",50)(2,dr,2,0,"span",51),a()),s&2){let e=c().ngIf;l(),m("ngIf",e.exerciseData.sessionStatus==="skipped"),l(),m("ngIf",e.exerciseData.sessionStatus==="do_later")}}function cr(s,t){if(s&1){let e=w();o(0,"div",54)(1,"h3",55),u(2,"Get Ready!"),a(),o(3,"p",56),u(4),a(),o(5,"p",57),u(6),A(7,"weightUnit"),a(),o(8,"button",58),_("click",function(){x(e);let r=c(4);return f(r.skipPresetTimer())}),u(9," Skip Countdown & Start Set "),a()()}if(s&2){let e=c().ngIf,i=c(3);l(4),k("",i.presetTimerCountdownDisplay(),"s"),l(2),St(" Upcoming: ",e.setData.reps?e.setData.reps+" reps":""," ",e.setData.reps&&e.setData.weight?" at ":""," ",e.setData.weight?U(7,5,e.setData.weight):""," ",e.setData.duration?e.setData.duration+"s":""," ")}}function mr(s,t){if(s&1){let e=w();o(0,"div")(1,"label",63),u(2,"Weight"),a(),o(3,"div",64)(4,"button",65),_("click",function(){x(e);let r=c(5);return f(r.decrementWeight())}),C(),o(5,"svg",66),y(6,"path",67),a()(),V(),o(7,"div",68),_("click",function(){x(e);let r=c(5);return f(r.editWeightWithPrompt())}),u(8),A(9,"number"),a(),y(10,"input",69),o(11,"span",70),u(12),a(),o(13,"button",71),_("mousedown",function(r){x(e);let n=c(5);return f(n.onWeightPointerDown(r))})("longPress",function(r){x(e);let n=c(5);return f(n.onWeightPointerDown(r))}),C(),o(14,"svg",66),y(15,"path",72),a()()()()}if(s&2){let e=c(5);l(4),m("disabled",e.getDisabled()),l(4),k(" ",H(9,4,e.csf.actualWeight.value,"1.0-2")??"0"," "),l(4),M(e.weightUnitDisplaySymbol),l(),m("disabled",e.getDisabled())}}function pr(s,t){if(s&1){let e=w();o(0,"div")(1,"label",63),u(2,"Reps"),a(),o(3,"div",64)(4,"button",65),_("click",function(){x(e);let r=c(5);return f(r.decrementReps(1))}),C(),o(5,"svg",66),y(6,"path",67),a()(),V(),y(7,"input",73),o(8,"button",65),_("click",function(){x(e);let r=c(5);return f(r.incrementReps(1))}),C(),o(9,"svg",66),y(10,"path",72),a()()()()}if(s&2){let e=c(5);l(4),m("disabled",e.getDisabled()),l(4),m("disabled",e.getDisabled())}}function gr(s,t){if(s&1&&(o(0,"span"),u(1),a()),s&2){let e=c(3).ngIf;l(),k("(Target: ",e.setData.duration,"s)")}}function xr(s,t){s&1&&(o(0,"span"),u(1,"Start Timer"),a())}function fr(s,t){s&1&&(o(0,"span"),u(1,"Pause Timer"),a())}function hr(s,t){s&1&&(o(0,"span"),u(1,"Resume Timer"),a())}function _r(s,t){if(s&1){let e=w();o(0,"button",80),_("click",function(){x(e);let r=c(6);return f(r.resetTimedSet())}),u(1," Reset "),a()}if(s&2){let e=c(6);m("disabled",e.getDisabled())}}function vr(s,t){if(s&1){let e=w();o(0,"div")(1,"label",74),u(2," Time (seconds) "),S(3,gr,2,1,"span",36),a(),o(4,"div",75),u(5),a(),y(6,"input",76),o(7,"div",77)(8,"button",78),_("click",function(){x(e);let r=c(5);return f(r.toggleTimedSetTimer())}),S(9,xr,2,0,"span",36)(10,fr,2,0,"span",36)(11,hr,2,0,"span",36),a(),S(12,_r,2,1,"button",79),a()()}if(s&2){let e,i=c(2).ngIf,r=c(3);l(3),m("ngIf",i.setData.duration>0),l(),m("ngClass",ut(9,Yi,r.isTimedSetOvertime(),r.isTimedSetOvertime()&&r.timedSetTimerState()==="running",!r.isTimedSetOvertime()&&r.timedSetTimerState()==="running"&&(((e=r.activeSetInfo())==null||e.setData==null?null:e.setData.duration)??0)>0&&r.timedSetElapsedSeconds()>0,r.timedSetTimerState()==="idle"||r.timedSetTimerState()==="paused"||!((((e=r.activeSetInfo())==null||e.setData==null?null:e.setData.duration)??0)>0&&r.timedSetElapsedSeconds()>0&&!r.isTimedSetOvertime()))),l(),k(" ",r.timedSetDisplay()," "),l(3),m("disabled",r.getDisabled())("ngClass",ge(14,Zi,r.timedSetTimerState()==="idle"||r.timedSetTimerState()==="paused",r.timedSetTimerState()==="running")),l(),m("ngIf",r.timedSetTimerState()==="idle"),l(),m("ngIf",r.timedSetTimerState()==="running"),l(),m("ngIf",r.timedSetTimerState()==="paused"),l(),m("ngIf",r.timedSetTimerState()!=="idle")}}function Sr(s,t){if(s&1&&(o(0,"div")(1,"form",59),S(2,mr,16,7,"div",36)(3,pr,11,2,"div",36)(4,vr,13,17,"div",36),o(5,"div",60)(6,"label",61),u(7,"Set Notes (Optional)"),a(),y(8,"textarea",62),a()()()),s&2){let e=c().ngIf,i=c(3);l(),m("formGroup",i.currentSetForm),l(),m("ngIf",i.csf.actualWeight),l(),m("ngIf",i.csf.actualReps&&e.setData.reps!==void 0),l(),m("ngIf",e.setData.duration!==void 0),l(4),m("disabled",i.getDisabled())}}function yr(s,t){if(s&1){let e=w();o(0,"div",81)(1,"div",82)(2,"button",83),_("click",function(){x(e);let r=c(4);return f(r.handleMainAction())}),u(3),a()()()}if(s&2){let e=c(4);l(2),m("disabled",e.sessionState()==="paused"||e.playerSubState()===e.PlayerSubState.PresetCountdown&&e.presetTimerCountdownDisplay()!=="0"&&e.presetTimerCountdownDisplay()!==null||e.playerSubState()===e.PlayerSubState.Resting&&e.isRestTimerVisible())("ngClass",ut(3,Qi,e.playerSubState()===e.PlayerSubState.PerformingSet&&!e.checkIfLatestSetOfWorkoutConsideringPending(),e.playerSubState()===e.PlayerSubState.PerformingSet&&e.checkIfLatestSetOfWorkoutConsideringPending(),e.playerSubState()===e.PlayerSubState.PresetCountdown,e.playerSubState()===e.PlayerSubState.Resting&&e.isRestTimerVisible())),l(),k(" ",e.mainActionButtonLabel()," ")}}function br(s,t){if(s&1&&(o(0,"div",29)(1,"div",30),S(2,tr,2,1,"div",31)(3,ir,1,0,"ng-template",null,3,Y),o(5,"h2",32),u(6),a()(),o(7,"div",33)(8,"p",34),S(9,nr,3,2,"span",35)(10,sr,2,2,"span",36)(11,or,2,2,"span",37)(12,ar,2,2,"span",38),a()(),S(13,ur,3,2,"div",39)(14,cr,10,7,"div",40)(15,Sr,9,5,"div",36)(16,yr,4,8,"div",41),a()),s&2){let e=t.ngIf,i=K(4),r=c(3);l(2),m("ngIf",r.currentBaseExercise())("ngIfElse",i),l(3),m("title",e.exerciseData.exerciseName),l(),k(" ",e.exerciseData.exerciseName||"Loading Exercise..."," "),l(3),m("ngIf",e.type==="warmup"),l(),m("ngIf",e.type!=="warmup"),l(),m("ngIf",r.totalBlockRounds()>1&&r.currentBlockRound()>0),l(),m("ngIf",e.exerciseData.supersetId),l(),m("ngIf",e.exerciseData.sessionStatus&&e.exerciseData.sessionStatus!=="pending"),l(),m("ngIf",r.playerSubState()===r.PlayerSubState.PresetCountdown),l(),m("ngIf",r.playerSubState()===r.PlayerSubState.PerformingSet),l(),m("ngIf",r.routine()&&r.sessionState()==="playing"&&r.activeSetInfo())}}function kr(s,t){if(s&1&&(o(0,"p",90),u(1),a()),s&2){let e=c(4);l(),k(" ",e.currentWorkoutLogExercises().length===0?"No sets were logged.":"All planned sets are done. Well done!"," ")}}function wr(s,t){if(s&1){let e=w();o(0,"button",91),_("click",function(){x(e);let r=c(4);return f(r.finishWorkoutAndReportStatus())}),u(1," Confirm & Save Workout "),a()}}function Ir(s,t){s&1&&(o(0,"button",92),u(1," Back to Workouts "),a())}function Er(s,t){s&1&&(o(0,"button",93),u(1," Go Back "),a())}function Cr(s,t){if(s&1&&(o(0,"div",84)(1,"h2",85),u(2),a(),S(3,kr,2,1,"p",86)(4,wr,2,0,"button",87)(5,Ir,2,0,"button",88)(6,Er,2,0,"button",89),a()),s&2){let e=c(3);l(2),k(" ",e.sessionState()==="error"?"Error Loading Workout":e.currentWorkoutLogExercises().length===0?"Workout Ended":"Workout Complete!"," "),l(),m("ngIf",e.sessionState()!=="error"),l(),m("ngIf",e.sessionState()!=="error"&&e.currentWorkoutLogExercises().length>0),l(),m("ngIf",e.sessionState()!=="error"&&e.currentWorkoutLogExercises().length===0),l(),m("ngIf",e.sessionState()==="error")}}function Tr(s,t){if(s&1){let e=w();o(0,"div")(1,"div",96),u(2,"UP NEXT"),a(),o(3,"div",97),u(4),a(),o(5,"div",98),u(6),A(7,"number"),o(8,"button",99),_("click",function(){x(e);let r=c(4);return f(r.skipRest())}),u(9,"(Skip)"),a()()()}if(s&2){let e=c(4);l(3),m("title",e.restTimerNextUpText()),l(),k(" ",e.restTimerNextUpText()||"Next Exercise"," "),l(2),k(" Rest: ",e.restTimerDisplay()||H(7,3,e.restDuration(),"1.0-0")+"s"," ")}}function Pr(s,t){if(s&1){let e=w();o(0,"div")(1,"div",97),u(2),a(),o(3,"div",100),u(4),a(),o(5,"button",101),_("click",function(){x(e);let r=c(4);return f(r.skipPresetTimer())}),u(6,"(Skip Countdown)"),a()()}if(s&2){let e=c(4);l(),m("title",e.restTimerMainText()),l(),k(" ",e.restTimerMainText()," "),l(2),k(" ",e.presetTimerCountdownDisplay(),"s ")}}function Rr(s,t){if(s&1&&(o(0,"footer",94)(1,"div",95),S(2,Tr,10,6,"div",36)(3,Pr,7,3,"div",36),a()()),s&2){let e=c(3);l(2),m("ngIf",e.playerSubState()===e.PlayerSubState.Resting&&!e.isRestTimerVisible()),l(),m("ngIf",e.playerSubState()===e.PlayerSubState.PresetCountdown)}}function Wr(s,t){if(s&1){let e=w();me(0),o(1,"header",16)(2,"button",17),_("click",function(){x(e);let r=c(2);return f(r.goBack())}),C(),o(3,"svg",18),y(4,"path",19),a()(),V(),o(5,"div",20)(6,"h1",21),u(7),a(),o(8,"div",22),u(9),a()(),o(10,"button",23),_("click",function(){x(e);let r=c(2);return f(r.toggleWorkoutMenu())}),C(),o(11,"svg",24),y(12,"path",25),a()()(),V(),o(13,"main",26),S(14,br,17,12,"div",27)(15,Cr,7,5,"ng-template",null,2,Y),a(),S(17,Rr,4,2,"footer",28),pe()}if(s&2){let e=t.ngIf,i=K(16),r=c(2);l(6),m("title",e.name),l(),k(" ",e.name||"Workout"," "),l(2),M(r.sessionTimerDisplay()),l(),m("disabled",r.sessionState()==="loading"||r.sessionState()==="error"||r.sessionState()==="paused"&&!r.isWorkoutMenuVisible()),l(3),de("pb-24",!0),l(),m("ngIf",r.activeSetInfo())("ngIfElse",i),l(3),m("ngIf",r.routine()&&r.sessionState()==="playing"&&r.activeSetInfo()&&(r.playerSubState()===r.PlayerSubState.Resting&&!r.isRestTimerVisible()||r.playerSubState()===r.PlayerSubState.PresetCountdown))}}function Vr(s,t){if(s&1){let e=w();o(0,"div",102)(1,"button",103),_("click",function(){x(e);let r=c(2);return f(r.goBack())}),C(),o(2,"svg",18),y(3,"path",19),a()(),V(),o(4,"div",20)(5,"h1",104),u(6,"Error"),a()(),y(7,"div",105),a(),o(8,"div",106)(9,"h2",107),u(10,"Routine Not Found"),a(),o(11,"p",108),u(12,"The selected routine could not be loaded."),a(),o(13,"button",109),C(),o(14,"svg",18),y(15,"path",19),a()()()}}function Dr(s,t){if(s&1&&(o(0,"div",8),S(1,Xi,9,1,"div",9)(2,Wr,18,9,"ng-container",10)(3,Vr,16,0,"ng-template",null,1,Y),a()),s&2){let e=K(4),i=c();l(),m("ngIf",i.sessionState()==="paused"),l(),m("ngIf",i.routine())("ngIfElse",e)}}function Fr(s,t){s&1&&(o(0,"span",124),u(1,"(already started main sets)"),a())}function Mr(s,t){if(s&1){let e=w();o(0,"div",110)(1,"h2",111),u(2,"Workout Menu"),a(),o(3,"button",112),_("click",function(){x(e);let r=c();return f(r.pauseSession())}),u(4," Pause Workout "),a(),o(5,"button",113),_("click",function(){x(e);let r=c();return f(r.jumpToExercise())}),u(6," Jump to Exercise "),a(),o(7,"button",114),_("click",function(){x(e);let r=c();return f(r.openPerformanceInsightsFromMenu())}),u(8," Performance Insights "),a(),o(9,"button",115),_("click",function(){x(e);let r=c();return f(r.addWarmupSet())}),o(10,"p"),u(11,"+ Add Warm-up Set"),a(),S(12,Fr,2,0,"span",116),a(),o(13,"button",117),_("click",function(){x(e);let r=c();return f(r.addCustomExercise())}),u(14," + Add Custom Exercise "),a(),o(15,"button",118),_("click",function(){x(e);let r=c();return f(r.skipCurrentSet())}),u(16," Skip Current Set "),a(),o(17,"button",119),_("click",function(){x(e);let r=c();return f(r.skipCurrentExercise())}),u(18," Mark Exercise as Skipped "),a(),o(19,"button",120),_("click",function(){x(e);let r=c();return f(r.markCurrentExerciseDoLater())}),u(20," Mark Exercise for Later "),a(),o(21,"button",121),_("click",function(){x(e);let r=c();return f(r.finishWorkoutEarly())}),u(22," Finish Workout Early "),a(),o(23,"button",122),_("click",function(){x(e);let r=c();return f(r.quitWorkout())}),u(24," Quit Workout (No Save) "),a(),o(25,"button",123),_("click",function(){x(e);let r=c();return f(r.closeWorkoutMenu())}),u(26," Close Menu "),a()()}if(s&2){let e,i=c();l(3),m("disabled",i.sessionState()!=="playing"),l(2),m("disabled",i.sessionState()==="paused"||!(!((e=i.routine())==null||e.exercises==null)&&e.exercises.length)),l(2),m("disabled",i.sessionState()==="paused"||!i.activeSetInfo()),l(2),m("disabled",!i.canAddWarmupSet()||i.sessionState()==="paused"||!i.activeSetInfo()),l(3),m("ngIf",!i.canAddWarmupSet()),l(),m("disabled",i.sessionState()==="paused"),l(2),m("disabled",!i.activeSetInfo()||i.sessionState()==="paused"),l(2),m("disabled",!i.activeSetInfo()||i.sessionState()==="paused"),l(2),m("disabled",!i.activeSetInfo()||i.sessionState()==="paused"),l(2),m("disabled",i.sessionState()==="paused")}}function Ar(s,t){s&1&&(o(0,"span",46),u(1,"(Warm-up) "),a())}function Lr(s,t){if(s&1&&(o(0,"span",149),u(1,"Reps: "),o(2,"strong",150),u(3),a()()),s&2){let e=c().$implicit;l(3),M(e.repsAchieved)}}function Or(s,t){if(s&1&&(o(0,"span",149),u(1,"Weight: "),o(2,"strong",150),u(3),A(4,"weightUnit"),a()()),s&2){let e=c().$implicit;l(3),M(U(4,1,e.weightUsed))}}function Nr(s,t){if(s&1&&(o(0,"span"),u(1,"Time: "),o(2,"strong",150),u(3),a()()),s&2){let e=c().$implicit;l(3),k("",e.durationPerformed,"s")}}function Br(s,t){if(s&1&&(o(0,"p",151),u(1),a()),s&2){let e=c().$implicit;l(),k("Notes: ",e.notes," ")}}function Ur(s,t){if(s&1&&(o(0,"div",145)(1,"p",146),S(2,Ar,2,0,"span",35),u(3),a(),S(4,Lr,4,1,"span",147)(5,Or,5,3,"span",147)(6,Nr,4,1,"span",36)(7,Br,2,1,"p",148),a()),s&2){let e=t.$implicit,i=t.index;l(2),m("ngIf",e.type==="warmup"),l(),k(" Set ",i+1,": "),l(),m("ngIf",e.repsAchieved!==void 0),l(),m("ngIf",e.weightUsed!==void 0&&e.weightUsed!==null),l(),m("ngIf",e.durationPerformed!==void 0),l(),m("ngIf",e.notes)}}function $r(s,t){if(s&1&&(o(0,"div",143),S(1,Ur,8,6,"div",144),a()),s&2){let e=c(3);l(),m("ngForOf",e.allPreviousLoggedSetsForCurrentExercise())}}function Gr(s,t){if(s&1&&(o(0,"li"),u(1),a()),s&2){let e=c().ngIf;l(),k("Reps: ",e.repsAchieved)}}function jr(s,t){if(s&1&&(o(0,"li"),u(1),A(2,"weightUnit"),a()),s&2){let e=c().ngIf;l(),k("Weight: ",U(2,1,e.weightUsed))}}function Hr(s,t){if(s&1&&(o(0,"li"),u(1),a()),s&2){let e=c().ngIf;l(),k("Time: ",e.durationPerformed,"s")}}function zr(s,t){if(s&1&&(o(0,"li"),u(1),a()),s&2){let e=c().ngIf;l(),k("Notes: ",e.notes)}}function qr(s,t){if(s&1&&(o(0,"div",152)(1,"p",153),u(2),A(3,"date"),a(),o(4,"ul",154),S(5,Gr,2,1,"li",36)(6,jr,3,3,"li",36)(7,Hr,2,1,"li",36)(8,zr,2,1,"li",36),a()()),s&2){let e=t.ngIf,i=c(3);l(2),k("Last time (",H(3,5,i.lastPerformanceForCurrentExercise==null?null:i.lastPerformanceForCurrentExercise.lastPerformedDate,"dd/MM/yyyy HH:mm"),"):"),l(3),m("ngIf",e.repsAchieved!==void 0),l(),m("ngIf",e.weightUsed!==void 0&&e.weightUsed!==null),l(),m("ngIf",e.durationPerformed!==void 0),l(),m("ngIf",e.notes)}}function Jr(s,t){s&1&&(o(0,"div",152)(1,"p",155),u(2,"No previous performance recorded for this exercise yet."),a()())}function Kr(s,t){if(s&1&&(o(0,"div")(1,"span",160),u(2),a(),o(3,"strong",150),u(4),a(),o(5,"em",161),u(6),A(7,"date"),a()()),s&2){let e=t.$implicit,i=c(4);l(2),k("",e.pbType,": "),l(2),M(i.formatPbValue(e)),l(2),k(" (",H(7,3,e.timestamp,"shortDate"),")")}}function Yr(s,t){if(s&1&&(o(0,"div",156)(1,"p",157),u(2),a(),o(3,"div",158),S(4,Kr,8,6,"div",159),a()()),s&2){let e,i=c(3);l(2),k("Personal Bests for ",((e=i.currentBaseExercise())==null?null:e.name)||"this exercise",":"),l(2),m("ngForOf",i.exercisePBs())}}function Zr(s,t){if(s&1&&(o(0,"div",156)(1,"p",155),u(2),a()()),s&2){let e,i=c(3);l(2),k("No personal bests recorded yet for ",(e=i.currentBaseExercise())==null?null:e.name,".")}}function Qr(s,t){if(s&1){let e=w();o(0,"div",166),_("click",function(){x(e);let r=c(4);return f(r.startEditTarget("reps"))}),u(1),a()}if(s&2){let e=c(2).ngIf;l(),k(" ",e.setData.reps," ")}}function Xr(s,t){if(s&1){let e=w();o(0,"div",167)(1,"input",168),Me("ngModelChange",function(r){x(e);let n=c(4);return Fe(n.editingTargetValue,r)||(n.editingTargetValue=r),f(r)}),_("keyup.enter",function(){x(e);let r=c(4);return f(r.confirmEditTarget())})("keyup.escape",function(){x(e);let r=c(4);return f(r.cancelEditTarget())}),a(),o(2,"button",169),_("click",function(){x(e);let r=c(4);return f(r.confirmEditTarget())}),u(3,"\u2713"),a(),o(4,"button",170),_("click",function(){x(e);let r=c(4);return f(r.cancelEditTarget())}),u(5,"\u2715"),a()()}if(s&2){let e=c(4);l(),De("ngModel",e.editingTargetValue)}}function en(s,t){if(s&1&&(o(0,"div",162)(1,"span",163),u(2,"Target Reps"),a(),S(3,Qr,2,1,"div",164)(4,Xr,6,1,"div",165),a()),s&2){let e=c(3);l(3),m("ngIf",e.editingTarget!=="reps"),l(),m("ngIf",e.editingTarget==="reps")}}function tn(s,t){if(s&1){let e=w();o(0,"div",166),_("click",function(){x(e);let r=c(4);return f(r.startEditTarget("weight"))}),u(1),A(2,"weightUnit"),a()}if(s&2){let e=c(2).ngIf;l(),k(" ",U(2,1,e.setData.weight)," ")}}function rn(s,t){if(s&1){let e=w();o(0,"div",167)(1,"input",168),Me("ngModelChange",function(r){x(e);let n=c(4);return Fe(n.editingTargetValue,r)||(n.editingTargetValue=r),f(r)}),_("keyup.enter",function(){x(e);let r=c(4);return f(r.confirmEditTarget())})("keyup.escape",function(){x(e);let r=c(4);return f(r.cancelEditTarget())}),a(),o(2,"button",169),_("click",function(){x(e);let r=c(4);return f(r.confirmEditTarget())}),u(3,"\u2713"),a(),o(4,"button",170),_("click",function(){x(e);let r=c(4);return f(r.cancelEditTarget())}),u(5,"\u2715"),a()()}if(s&2){let e=c(4);l(),De("ngModel",e.editingTargetValue)}}function nn(s,t){if(s&1&&(o(0,"div",162)(1,"span",163),u(2,"Target Weight"),a(),S(3,tn,3,3,"div",164)(4,rn,6,1,"div",165),a()),s&2){let e=c(3);l(3),m("ngIf",e.editingTarget!=="weight"),l(),m("ngIf",e.editingTarget==="weight")}}function sn(s,t){if(s&1){let e=w();o(0,"div",166),_("click",function(){x(e);let r=c(4);return f(r.startEditTarget("duration"))}),u(1),o(2,"span",171),u(3,"s"),a()()}if(s&2){let e=c(2).ngIf;l(),k(" ",e.setData.duration)}}function on(s,t){if(s&1){let e=w();o(0,"div",167)(1,"input",168),Me("ngModelChange",function(r){x(e);let n=c(4);return Fe(n.editingTargetValue,r)||(n.editingTargetValue=r),f(r)}),_("keyup.enter",function(){x(e);let r=c(4);return f(r.confirmEditTarget())})("keyup.escape",function(){x(e);let r=c(4);return f(r.cancelEditTarget())}),a(),o(2,"button",169),_("click",function(){x(e);let r=c(4);return f(r.confirmEditTarget())}),u(3,"\u2713"),a(),o(4,"button",170),_("click",function(){x(e);let r=c(4);return f(r.cancelEditTarget())}),u(5,"\u2715"),a()()}if(s&2){let e=c(4);l(),De("ngModel",e.editingTargetValue)}}function an(s,t){if(s&1&&(o(0,"div",162)(1,"span",163),u(2,"Target Time"),a(),S(3,sn,4,1,"div",164)(4,on,6,1,"div",165),a()),s&2){let e=c(3);l(3),m("ngIf",e.editingTarget!=="duration"),l(),m("ngIf",e.editingTarget==="duration")}}function ln(s,t){if(s&1&&(o(0,"div",162)(1,"span",163),u(2,"Target Tempo"),a(),o(3,"span",172),u(4),a()()),s&2){let e=c().ngIf;l(4),M(e.setData.tempo)}}function dn(s,t){if(s&1&&(o(0,"div",173)(1,"span",163),u(2,"Planned Notes for this Set"),a(),o(3,"p",174),u(4),a()()),s&2){let e=c().ngIf;l(4),M(e.setData.notes)}}function un(s,t){if(s&1){let e=w();o(0,"div",134)(1,"div",135)(2,"button",136),_("click",function(){x(e);let r=c(2);return f(r.toggleCompletedSetsInfo())}),u(3),a()(),S(4,$r,2,1,"div",137),o(5,"div",138),S(6,qr,9,8,"div",139)(7,Jr,3,0,"div",139)(8,Yr,5,2,"div",140)(9,Zr,3,1,"div",140)(10,en,5,2,"div",141)(11,nn,5,2,"div",141)(12,an,5,2,"div",141)(13,ln,5,1,"div",141)(14,dn,5,1,"div",142),a()()}if(s&2){let e,i,r=t.ngIf,n=c(2);l(3),q(" ",n.showCompletedSetsInfo()?"Hide":"Show"," Completed Sets This Session (",n.allPreviousLoggedSetsForCurrentExercise().length,") "),l(),m("ngIf",n.allPreviousLoggedSetsForCurrentExercise().length>0&&n.showCompletedSetsInfo()),l(2),m("ngIf",n.trackingService.findPreviousSetPerformance(n.lastPerformanceForCurrentExercise,r.setData,r.setIndex)),l(),m("ngIf",!n.lastPerformanceForCurrentExercise&&n.activeSetInfo()&&!(!((e=n.activeSetInfo())==null||e.exerciseData==null||e.exerciseData.exerciseId==null)&&e.exerciseData.exerciseId.startsWith("custom-"))),l(),m("ngIf",n.exercisePBs().length>0),l(),m("ngIf",n.currentBaseExercise()&&n.exercisePBs().length===0&&!(!((i=n.currentBaseExercise())==null||i.id==null)&&i.id.startsWith("custom-"))),l(),m("ngIf",r.setData.reps!==void 0),l(),m("ngIf",r.setData.weight!==void 0&&r.setData.weight!==null),l(),m("ngIf",r.setData.duration!==void 0),l(),m("ngIf",r.setData.tempo),l(),m("ngIf",r.setData.notes)}}function cn(s,t){if(s&1){let e=w();o(0,"div",125)(1,"div",126)(2,"header",127)(3,"h3",128),u(4,"Performance Insights & Targets"),a(),o(5,"button",129),_("click",function(){x(e);let r=c();return f(r.closePerformanceInsights())}),C(),o(6,"svg",24),y(7,"path",130),a()()(),S(8,un,15,12,"div",131),V(),o(9,"footer",132)(10,"button",133),_("click",function(){x(e);let r=c();return f(r.closePerformanceInsights())}),u(11," Done "),a()()()()}if(s&2){let e=c();l(8),m("ngIf",e.activeSetInfo())}}function mn(s,t){s&1&&(o(0,"div",175)(1,"p",176),u(2,"Loading workout player..."),a()())}var $t=(i=>(i.PerformingSet="performing_set",i.PresetCountdown="preset_countdown",i.Resting="resting",i))($t||{}),at=class s{route=E(fe);router=E(ie);workoutService=E(ve);exerciseService=E(se);trackingService=E(ne);alertService=E(_e);toastService=E(Se);fb=E(Ye);storageService=E(Xe);cdr=E(Le);unitService=E(ye);appSettingsService=E(Bt);platformId=E(ce);routine=I(void 0);program=I(void 0);sessionState=I("loading");PlayerSubState=$t;playerSubState=I("performing_set");currentExerciseIndex=I(0);currentSetIndex=I(0);currentBlockRound=I(1);totalBlockRounds=I(1);sessionTimerDisplay=I("00:00:00");workoutStartTime=0;sessionTimerElapsedSecondsBeforePause=0;timerSub;timedSetTimerState=I("idle");timedSetElapsedSeconds=I(0);timedSetIntervalSub;soundPlayedForThisCountdownSegment=!1;presetTimerCountdownDisplay=I(null);presetTimerDuration=I(0);presetTimerSub;isRestTimerVisible=I(!1);restDuration=I(0);restTimerDisplay=I(null);restTimerMainText=I("RESTING");restTimerNextUpText=I(null);nextActionButtonLabel=L(()=>{switch(this.playerSubState()){case"preset_countdown":return"GETTING READY...";case"resting":return"RESTING...";case"performing_set":default:return"SET DONE"}});currentSetForm;lastPerformanceForCurrentExercise=null;editingTarget=null;editingTargetValue="";routineId=null;PAUSED_WORKOUT_KEY="fitTrackPro_pausedWorkoutState";PAUSED_STATE_VERSION="1.2";originalRoutineSnapshot=[];currentWorkoutLogExercises=I([]);wasRestTimerVisibleOnPause=!1;restTimerRemainingSecondsOnPause=0;restTimerInitialDurationOnPause=0;restTimerMainTextOnPause="RESTING";restTimerNextUpTextOnPause=null;wasTimedSetRunningOnPause=!1;autoSaveSub;AUTO_SAVE_INTERVAL_MS=15e3;isSessionConcluded=!1;routerEventsSub;isInitialLoadComplete=!1;exercisesProposedThisCycle={doLater:!1,skipped:!1};shouldStartWithPresetTimer=L(()=>{let t=this.activeSetInfo();if(!t)return!1;let e=this.appSettingsService.enablePresetTimer(),i=this.appSettingsService.presetTimerDurationSeconds();if(!e||i<=0)return!1;let r=this.routine(),n=t.exerciseIndex,d=t.setIndex;if(!r||!r.exercises[n]||!r.exercises[n].sets[d])return!1;let p=n===0&&d===0&&this.currentBlockRound()===1,g=1/0;if(d>0)g=r.exercises[n].sets[d-1].restAfterSet;else if(n>0){let h=r.exercises[n-1];g=h.sets[h.sets.length-1].restAfterSet}return p||g===0});mainActionButtonLabel=L(()=>{switch(this.playerSubState()){case"preset_countdown":return`PREPARING... ${this.presetTimerCountdownDisplay()}s`;case"resting":return`RESTING: ${this.restTimerDisplay()}`;case"performing_set":if(this.checkIfLatestSetOfWorkoutConsideringPending()){let t=this.activeSetInfo()?.exerciseData.sessionStatus;if(t==="skipped"||t==="do_later"){let e=this.activeSetInfo(),i=this.routine();if(e&&i&&e.exerciseData.sets.length>0){let r=this.currentWorkoutLogExercises().find(d=>d.exerciseId===e.exerciseData.exerciseId);if(!(r&&r.sets.length===e.exerciseData.sets.length))return this.checkIfLatestSetOfExercise()?"COMPLETE EXERCISE":"SET DONE"}return t==="skipped"?"SKIPPED":"DO LATER"}return"FINISH WORKOUT"}else return this.checkIfLatestSetOfExercise()?"COMPLETE EXERCISE":"SET DONE";default:return"SET DONE"}});routeSub;rpeValue=I(null);rpeOptions=Array.from({length:10},(t,e)=>e+1);showRpeSlider=I(!1);timedSetDisplay=L(()=>{let t=this.timedSetTimerState(),e=this.timedSetElapsedSeconds(),r=this.activeSetInfo()?.setData?.duration;return t==="idle"?(r!==void 0&&r>0?r:this.csf?.actualDuration?.value??0).toString():r!==void 0&&r>0?(r-e).toString():e.toString()});isTimedSetOvertime=L(()=>{if(this.timedSetTimerState()==="idle")return!1;let e=this.timedSetElapsedSeconds(),i=this.activeSetInfo()?.setData?.duration;return i!==void 0&&i>0&&e>i});unloadNotification(t){this.sessionState()==="playing"&&this.routine()&&this.currentWorkoutLogExercises().length>0&&this.captureAndSaveStateForUnload()}get weightUnitDisplaySymbol(){return this.unitService.getUnitLabel()}getWorkingSetCountForCurrentExercise=L(()=>{let t=this.routine(),e=this.currentExerciseIndex();return t&&t.exercises[e]?t.exercises[e].sets.filter(i=>i.type!=="warmup").length:0});getCurrentWorkingSetNumber=L(()=>{let t=this.activeSetInfo(),e=this.routine();if(!t||!e||t.type==="warmup")return 0;let i=e.exercises[t.exerciseIndex],r=0;for(let n=0;n<=t.setIndex;n++)i.sets[n].type!=="warmup"&&r++;return r});getCurrentWarmupSetNumber=L(()=>{let t=this.activeSetInfo(),e=this.routine();if(!t||!e||t.type!=="warmup")return 0;let i=e.exercises[t.exerciseIndex],r=0;for(let n=0;n<=t.setIndex;n++)i.sets[n].type==="warmup"&&r++;return r});activeSetInfo=L(()=>{let t=this.routine(),e=this.currentExerciseIndex(),i=this.currentSetIndex();if(t&&t.exercises[e]&&t.exercises[e].sets[i]){let r=t.exercises[e],n=t.exercises[e].sets[i],p=this.currentWorkoutLogExercises().find(g=>g.exerciseId===r.exerciseId)?.sets.find(g=>g.plannedSetId===n.id);return{exerciseIndex:e,setIndex:i,exerciseData:r,setData:n,type:n.type??"standard",baseExerciseInfo:void 0,isCompleted:!!p,actualReps:p?.repsAchieved,actualWeight:p?.weightUsed,actualDuration:p?.durationPerformed,notes:p?.notes}}return null});currentBaseExercise=I(void 0);exercisePBs=I([]);allPreviousLoggedSetsForCurrentExercise=L(()=>{let t=this.activeSetInfo();if(!t||t.setIndex===0)return[];let e=this.currentWorkoutLogExercises().find(i=>i.exerciseId===t.exerciseData.exerciseId);if(e&&e.sets.length>0){let i=[];for(let r=0;r<t.setIndex;r++){let n=t.exerciseData.sets[r]?.id;if(n){let d=e.sets.find(p=>p.plannedSetId===n);d&&i.push(d)}}return i}return[]});isWorkoutMenuVisible=I(!1);isPerformanceInsightsVisible=I(!1);showCompletedSetsInfo=I(!1);isPerformingDeferredExercise=!1;lastActivatedDeferredExerciseId=null;constructor(){this.initializeCurrentSetForm()}resetAndPatchCurrentSetForm(){this.currentSetForm.reset({rpe:null,setNotes:""}),this.rpeValue.set(null),this.showRpeSlider.set(!1),this.resetTimedSet(),this.patchActualsFormBasedOnSessionTargets()}startSessionTimer(){this.sessionState()!=="paused"&&(this.timerSub&&this.timerSub.unsubscribe(),this.timerSub=Ve(0,1e3).subscribe(()=>{if(this.sessionState()==="playing"){let t=Math.floor((Date.now()-this.workoutStartTime)/1e3),e=this.sessionTimerElapsedSecondsBeforePause+t,i=Math.floor(e/3600),r=Math.floor(e%3600/60),n=e%60;this.sessionTimerDisplay.set(`${String(i).padStart(2,"0")}:${String(r).padStart(2,"0")}:${String(n).padStart(2,"0")}`)}}))}updateRestTimerDisplay(t){let e=Math.floor(t/60),i=t%60;this.restTimerDisplay.set(`${String(e).padStart(2,"0")}:${String(i).padStart(2,"0")}`)}addLoggedSetToCurrentLog(t,e){let i=this.currentWorkoutLogExercises(),r=i.find(n=>n.exerciseId===t.exerciseId);if(r){let n=r.sets.findIndex(d=>d.plannedSetId===e.plannedSetId&&d.id===e.id);n>-1?r.sets[n]=e:r.sets.push(e)}else r={exerciseId:t.exerciseId,exerciseName:this.currentBaseExercise()?.name||t.exerciseName||"Unknown Exercise",sets:[e]},i.push(r);this.currentWorkoutLogExercises.set([...i])}finishWorkout(){return W(this,null,function*(){yield this.finishWorkoutAndReportStatus()})}comparePerformedToOriginal(t,e){let i=[],r=!1,n=e.filter(g=>t.some(h=>h.exerciseId===g.exerciseId)),d=t.filter(g=>e.some(h=>h.exerciseId===g.exerciseId||g.exerciseName===h.exerciseName)),p=t.filter(g=>!e.some(h=>h.exerciseId===g.exerciseId)&&g.exerciseId.startsWith("custom-exercise-"));(d.length!==e.length||p.length>0)&&(i.push("Number of exercises or their content changed."),r=!0),p.length>0&&i.push(`${p.length} custom exercise(s) added.`);for(let g of e){let h=t.find(v=>v.exerciseId===g.exerciseId);if(!h){i.push(`Exercise "${g.exerciseName||g.exerciseId}" was in the plan but not performed.`),r=!0;continue}if(h.sets.length!==g.sets.length)i.push(`Set count for "${h.exerciseName||h.exerciseId}" changed (was ${g.sets.length}, now ${h.sets.length}).`),r=!0;else for(let v=0;v<h.sets.length;v++){let b=g.sets[v]?.type==="warmup",T=h.sets[v]?.type==="warmup";if(b!==T){i.push(`Warm-up status for set ${v+1} of "${h.exerciseName}" changed.`),r=!0;break}}}return{majorDifference:r,details:i}}convertLoggedToWorkoutExercises(t){let e=this.routine();return t.map(i=>{let r=e?.exercises.find(d=>d.exerciseId===i.exerciseId);return{id:$(),exerciseId:i.exerciseId,exerciseName:i.exerciseName,supersetId:r?.supersetId||null,supersetOrder:r?.supersetOrder??null,supersetSize:r?.supersetSize??null,rounds:r?.rounds??1,notes:r?.notes,sets:i.sets.map(d=>{let p=r?.sets.find(g=>g.id===d.plannedSetId);return{id:$(),reps:d.targetReps??d.repsAchieved,weight:d.targetWeight??d.weightUsed,duration:d.targetDuration??d.durationPerformed,tempo:d.targetTempo||p?.tempo,restAfterSet:p?.restAfterSet||60,notes:d.notes,type:d.type}})}})}get csf(){return this.currentSetForm.controls}toggleTimedSetTimer(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Please resume to use the timer.",3e3,"Paused");return}let t=this.timedSetTimerState();t==="idle"||t==="paused"?this.startOrResumeTimedSet():t==="running"&&this.pauseTimedSet()}startOrResumeTimedSet(){if(this.timedSetTimerState()==="idle"){this.timedSetElapsedSeconds.set(0);let t=this.activeSetInfo()?.setData?.duration;t!==void 0&&t>0&&this.currentSetForm.get("actualDuration")?.setValue(t,{emitEvent:!1}),this.soundPlayedForThisCountdownSegment=!1}this.timedSetTimerState.set("running"),this.timedSetIntervalSub&&this.timedSetIntervalSub.unsubscribe(),this.timedSetIntervalSub=Ve(0,1e3).subscribe(()=>{if(this.timedSetTimerState()==="running"){this.timedSetElapsedSeconds.update(d=>d+1);let t=this.timedSetElapsedSeconds();this.currentSetForm.get("actualDuration")?.setValue(t,{emitEvent:!1});let i=this.activeSetInfo()?.setData?.duration,r=this.appSettingsService.enableTimerCountdownSound(),n=this.appSettingsService.countdownSoundSeconds();if(r&&i&&i>20&&t>0){let d=i-t;d<=n&&d>=0&&(d===0?(this.playClientGong(),this.soundPlayedForThisCountdownSegment=!0):this.playClientBeep())}}else this.timedSetIntervalSub&&this.timedSetIntervalSub.unsubscribe()})}pauseTimedSet(){this.timedSetIntervalSub&&(this.timedSetIntervalSub.unsubscribe(),this.timedSetIntervalSub=void 0),this.timedSetTimerState.set("paused")}resetTimedSet(){this.timedSetIntervalSub&&(this.timedSetIntervalSub.unsubscribe(),this.timedSetIntervalSub=void 0),this.timedSetTimerState.set("idle"),this.timedSetElapsedSeconds.set(0);let t=this.activeSetInfo()?.setData?.duration;this.currentSetForm.get("actualDuration")?.setValue(t??0,{emitEvent:!1}),this.soundPlayedForThisCountdownSegment=!1}stopAndLogTimedSet(){(this.timedSetTimerState()==="running"||this.timedSetTimerState()==="paused")&&this.pauseTimedSet()}checkIfLatestSetOfExercise(){let t=this.activeSetInfo(),e=this.routine();if(!t||!e)return!1;if(t.exerciseData.sessionStatus&&t.exerciseData.sessionStatus!=="pending")return!0;let i=e.exercises[t.exerciseIndex];if(t.setIndex===i.sets.length-1)return!0;for(let r=t.setIndex+1;r<i.sets.length;r++)if(i.sets[r].type!=="warmup")return!1;return!0}checkIfLatestSetOfWorkout(){return this.checkIfLatestSetOfWorkoutConsideringPending()}checkIfLatestSetOfWorkoutConsideringPending(){let t=this.activeSetInfo(),e=this.routine();if(!t||!e)return!1;if(t.exerciseData.sessionStatus&&t.exerciseData.sessionStatus!=="pending"){for(let n=t.exerciseIndex+1;n<e.exercises.length;n++)if(e.exercises[n].sessionStatus==="pending")return!1;return!e.exercises.some(n=>(n.sessionStatus==="do_later"||n.sessionStatus==="skipped")&&!this.isExerciseFullyLogged(n.exerciseId,n.sets.length))}if(!this.checkIfLatestSetOfExercise())return!1;for(let r=t.exerciseIndex+1;r<e.exercises.length;r++)if(e.exercises[r].sessionStatus==="pending"&&e.exercises[r].sets.length>0)return!1;return!e.exercises.some(r=>(r.sessionStatus==="do_later"||r.sessionStatus==="skipped")&&!this.isExerciseFullyLogged(r.exerciseId,r.sets.length))}tryProceedToDeferredExercisesOrFinish(t){return W(this,null,function*(){console.log("tryProceedToDeferredExercisesOrFinish: ENTERED. Proposed flags before:",JSON.stringify(this.exercisesProposedThisCycle));let e=new Set(this.currentWorkoutLogExercises().map(r=>r.exerciseId)),i=t.exercises.map((r,n)=>z(G({},r),{originalIndex:n})).filter(r=>(r.sessionStatus==="do_later"||r.sessionStatus==="skipped")&&!this.isExerciseFullyLogged(r.exerciseId,r.sets.length)).sort((r,n)=>r.sessionStatus==="do_later"&&n.sessionStatus==="skipped"?-1:r.sessionStatus==="skipped"&&n.sessionStatus==="do_later"?1:r.originalIndex-n.originalIndex);if(console.log("tryProceedToDeferredExercisesOrFinish: Found unfinished deferred/skipped:",i.map(r=>`${r.exerciseName} (${r.sessionStatus})`)),i.length>0){let r=!1,n,d=!1,p=!1;if(i.length===1){let g=i[0],h=yield this.alertService.showConfirmationDialog(`Unfinished: ${g.exerciseName}`,`You have "${g.exerciseName}" (${g.sessionStatus==="do_later"?"Do Later":"Skipped"}) remaining. Complete it now?`,[{text:"Complete It",role:"confirm",data:g.originalIndex,cssClass:"bg-blue-500 hover:bg-blue-600 text-white"},{text:"Finish Workout",role:"destructive",data:"finish_now",cssClass:"bg-green-500 hover:bg-green-600 text-white"},{text:"Cancel (Decide Later)",role:"cancel",data:"cancel_deferred_choice"}]);h&&typeof h.data=="number"?(r=!0,n=h.data):h&&h.data==="finish_now"?d=!0:p=!0}else{let h=[...i.map(b=>({text:`${b.exerciseName} (${b.sessionStatus})`,role:"confirm",data:b.originalIndex,cssClass:b.sessionStatus==="do_later"?"bg-orange-500 hover:bg-orange-600 text-white":"bg-yellow-500 hover:bg-yellow-600 text-black"})),{text:"Finish Workout Now",role:"destructive",data:"finish_now",cssClass:"bg-green-500 hover:bg-green-600 text-white mt-4"},{text:"Cancel (Decide Later)",role:"cancel",data:"cancel_deferred_choice"}],v=yield this.alertService.showConfirmationDialog("Unfinished Exercises","You have unfinished exercises. Would you like to complete any of them now, or finish the workout?",h);v&&typeof v.data=="number"?(r=!0,n=v.data):v&&v.data==="finish_now"?d=!0:p=!0}if(d){console.log("tryProceedToDeferredExercisesOrFinish: User chose 'Finish Workout Now'."),yield this.finishWorkoutAndReportStatus();return}if(p){console.log("tryProceedToDeferredExercisesOrFinish: User cancelled choice of deferred exercises. Setting proposal flags."),i.forEach(g=>{g.sessionStatus==="do_later"&&(this.exercisesProposedThisCycle.doLater=!0),g.sessionStatus==="skipped"&&(this.exercisesProposedThisCycle.skipped=!0)}),console.log("tryProceedToDeferredExercisesOrFinish: Proposed flags after cancel:",JSON.stringify(this.exercisesProposedThisCycle)),this.cdr.detectChanges();return}if(r&&n!==void 0){let g=t.exercises[n];console.log(`tryProceedToDeferredExercisesOrFinish: User selected exercise: ${g.exerciseName}`),this.isPerformingDeferredExercise=!0,this.lastActivatedDeferredExerciseId=g.id;let h=JSON.parse(JSON.stringify(t));h.exercises[n].sessionStatus="pending",this.routine.set(h),this.currentExerciseIndex.set(n),this.currentSetIndex.set(this.findFirstUnloggedSetIndex(g.exerciseId,g.sets.map(b=>b.id))||0),this.currentBlockRound.set(1);let v=h.exercises[n];if(!v.supersetId||v.supersetOrder===0)this.totalBlockRounds.set(v.rounds??1);else{let b=h.exercises.find(T=>T.supersetId===v.supersetId&&T.supersetOrder===0);this.totalBlockRounds.set(b?.rounds??1)}this.lastPerformanceForCurrentExercise=null,this.playerSubState.set("performing_set"),yield this.prepareCurrentSet();return}}console.log("tryProceedToDeferredExercisesOrFinish: No unfinished exercises to propose or all paths handled. Finishing workout."),yield this.finishWorkoutAndReportStatus()})}isExerciseFullyLogged(t,e){let i=this.currentWorkoutLogExercises().find(r=>r.exerciseId===t);return i?i.sets.length>=e:!1}findFirstUnloggedSetIndex(t,e){let i=this.currentWorkoutLogExercises().find(n=>n.exerciseId===t);if(!i)return 0;let r=new Set(i.sets.map(n=>n.plannedSetId));for(let n=0;n<e.length;n++)if(!r.has(e[n]))return n;return null}fetchLastPerformanceAndPatchForm(){return W(this,null,function*(){yield this.prepareCurrentSet()})}patchCurrentSetFormWithData(t){this.patchActualsFormBasedOnSessionTargets()}startEditTarget(t){let e=this.activeSetInfo();if(e)switch(this.editingTarget=t,t){case"reps":this.editingTargetValue=e.setData.reps??"";break;case"weight":this.editingTargetValue=e.setData.weight??"";break;case"duration":this.editingTargetValue=e.setData.duration??"";break}}cancelEditTarget(){this.editingTarget=null,this.editingTargetValue=""}formatPbValue(t){let e="";return t.weightUsed!==void 0&&t.weightUsed!==null?(e+=`${t.weightUsed}${this.unitService.getUnitSuffix()}`,t.repsAchieved>1&&!t.pbType.includes("RM (Actual)")&&(e+=` x ${t.repsAchieved}`)):t.repsAchieved>0&&t.pbType.includes("Max Reps")?e=`${t.repsAchieved} reps`:t.durationPerformed&&t.durationPerformed>0&&t.pbType.includes("Max Duration")&&(e=`${t.durationPerformed}s`),e||"N/A"}initializeCurrentSetForm(){this.currentSetForm=this.fb.group({actualReps:[null,[B.min(0)]],actualWeight:[null,[B.min(0)]],actualDuration:[null,[B.min(0)]],setNotes:[""],rpe:[null,[B.min(1),B.max(10)]]})}prepareCurrentSet(){return W(this,null,function*(){if(console.log("prepareCurrentSet: START"),this.sessionState()==="paused"){console.log("prepareCurrentSet: Session is paused, deferring preparation.");return}let t=this.routine();if(!t||t.exercises.length===0){console.warn("prepareCurrentSet: No sessionRoutine or no exercises in routine. Current routine:",t),this.sessionState.set("error"),this.toastService.error("Cannot prepare set: Routine data is missing or empty.",0,"Error");return}let e=this.currentExerciseIndex(),i=this.currentSetIndex();if(console.log(`prepareCurrentSet: Initial target - exIndex: ${e}, sIndex: ${i}, sessionStatus: ${t.exercises[e]?.sessionStatus}`),t.exercises[e]?.sessionStatus!=="pending"){console.log(`prepareCurrentSet: Initial target Ex ${e} (name: ${t.exercises[e]?.exerciseName}) is ${t.exercises[e]?.sessionStatus}. Finding first 'pending'.`);let R=this.findFirstPendingExerciseAndSet(t);if(R)e=R.exerciseIndex,i=R.setIndex,this.currentExerciseIndex.set(e),this.currentSetIndex.set(i),this.isPerformingDeferredExercise=!1,console.log(`prepareCurrentSet: Found first pending - exIndex: ${e} (name: ${t.exercises[e]?.exerciseName}), sIndex: ${i}`);else{console.log("prepareCurrentSet: No 'pending' exercises found in the entire routine. Proceeding to deferred/finish evaluation."),this.exercisesProposedThisCycle={doLater:!1,skipped:!1},yield this.tryProceedToDeferredExercisesOrFinish(t);return}}if(e>=t.exercises.length||!t.exercises[e]||i>=t.exercises[e].sets.length||!t.exercises[e].sets[i]){this.currentSetForm.reset({rpe:null,setNotes:""}),this.resetTimedSet(),this.currentBaseExercise.set(null),this.exercisePBs.set([]),this.lastPerformanceForCurrentExercise=null,this.rpeValue.set(null),this.showRpeSlider.set(!1),console.error(`prepareCurrentSet: CRITICAL ERROR - Calculated exIndex ${e} or sIndex ${i} is out of bounds or data is invalid.`),this.sessionState.set("error"),this.toastService.error("Error preparing set: Invalid exercise or set index.",0,"Load Error");return}let r=t.exercises[e],n=r.sets[i];console.log(`prepareCurrentSet: Preparing for Ex: "${r.exerciseName}", Set: ${i+1}, Type: ${n.type}`);let p=(this.originalRoutineSnapshot.find(R=>R.exerciseId===r.exerciseId)||r)?.sets[i]||n;this.loadBaseExerciseAndPBs(r.exerciseId),(!this.lastPerformanceForCurrentExercise||this.lastPerformanceForCurrentExercise.sets[0]?.exerciseId!==r.exerciseId)&&(this.lastPerformanceForCurrentExercise=yield X(this.trackingService.getLastPerformanceForExercise(r.exerciseId).pipe(j(1))));let g=this.trackingService.findPreviousSetPerformance(this.lastPerformanceForCurrentExercise,p,i),h;p.type==="warmup"?h=G({},p):h=this.workoutService.suggestNextSetParameters(g,p,t.goal),h.id=n.id,h.type=n.type,h.notes=n.notes||h.notes;let v=JSON.parse(JSON.stringify(t));v.exercises[e].sets[i]=h,this.routine.set(v),this.patchActualsFormBasedOnSessionTargets();let b=this.appSettingsService.enablePresetTimer(),T=this.appSettingsService.enablePresetTimerAfterRest(),P=this.appSettingsService.presetTimerDurationSeconds(),D=this.currentWorkoutLogExercises().length===0&&this.currentBlockRound()===1&&e===this.findFirstPendingExerciseAndSet(t)?.exerciseIndex&&i===this.findFirstPendingExerciseAndSet(t)?.setIndex,O=1/0;if(i>0)O=r.sets[i-1].restAfterSet;else if(e>0){let R=e-1,oe=!1;for(;R>=0;){if(this.isExerciseFullyLogged(t.exercises[R].exerciseId,t.exercises[R].sets.length)||t.exercises[R].sessionStatus==="pending"&&this.currentWorkoutLogExercises().some(ke=>ke.exerciseId===t.exercises[R].exerciseId)){let ke=t.exercises[R];ke.sets.length>0&&(O=ke.sets[ke.sets.length-1].restAfterSet,oe=!0);break}R--}oe||(O=1/0)}if(b&&P>0&&(this.playerSubState()!=="resting"&&(D||O===0)||T)){console.log("prepareCurrentSet: Starting pre-set timer for:",r.exerciseName,"Set:",i+1),this.playerSubState.set("preset_countdown");let R=this.activeSetInfo();R?this.startPresetTimer(P,R):(console.error("prepareCurrentSet: ActiveSetInfo is null before starting preset timer. Aborting preset."),this.playerSubState.set("performing_set"))}else console.log("prepareCurrentSet: No pre-set timer, setting to PerformingSet for:",r.exerciseName,"Set:",i+1),this.playerSubState.set("performing_set");this.sessionState()!=="playing"&&this.sessionState()!=="paused"&&(console.log("prepareCurrentSet: Setting sessionState to Playing."),this.sessionState.set("playing")),console.log("prepareCurrentSet: END")})}findFirstPendingExerciseAndSet(t){if(!t||!t.exercises)return null;for(let e=0;e<t.exercises.length;e++){let i=t.exercises[e];if(i.sessionStatus==="pending"&&i.sets&&i.sets.length>0){let r=this.findFirstUnloggedSetIndex(i.exerciseId,i.sets.map(n=>n.id))??0;if(r<i.sets.length)return{exerciseIndex:e,setIndex:r};console.warn(`Exercise ${i.exerciseName} is pending, but all sets appear logged or index is invalid.`)}}return null}patchActualsFormBasedOnSessionTargets(){if(this.sessionState()==="paused"){console.log("patchActualsFormBasedOnSessionTargets: Session is paused, deferring preparation.");return}this.currentSetForm.patchValue({rpe:null},{emitEvent:!1}),this.rpeValue.set(null),this.showRpeSlider.set(!1),this.resetTimedSet();let t=this.activeSetInfo();if(!t)return;let i=this.currentWorkoutLogExercises().find(d=>d.exerciseId===t.exerciseData.exerciseId)?.sets.find(d=>d.plannedSetId===t.setData.id),r=t.setData.duration??null;i&&i.durationPerformed!==void 0&&(r=i.durationPerformed);let n=t.setData.weight;if(n==null){let p=(this.currentWorkoutLogExercises().find(g=>g.exerciseId===t.exerciseData.exerciseId)?.sets||[]).filter(g=>{let h=t.exerciseData.sets.find(v=>v.id===g.plannedSetId);return h&&t.exerciseData.sets.indexOf(h)<t.setIndex}).sort((g,h)=>t.exerciseData.sets.findIndex(v=>v.id===g.plannedSetId)-t.exerciseData.sets.findIndex(v=>v.id===h.plannedSetId));if(p.length>0){let g=p[p.length-1];g.weightUsed!==null&&g.weightUsed!==void 0&&(n=g.weightUsed,t.type)}else t.type==="warmup"&&(t.setData.weight===null||t.setData.weight===void 0)&&(n=t.setData.weight??null)}i?(this.currentSetForm.patchValue({actualReps:i.repsAchieved,actualWeight:i.weightUsed,actualDuration:r,setNotes:i.notes??"",rpe:i.rpe},{emitEvent:!1}),i.rpe&&this.rpeValue.set(i.rpe)):this.currentSetForm.patchValue({actualReps:t.setData.reps??(t.type==="warmup"?8:null),actualWeight:n??null,actualDuration:r,setNotes:t.setData.notes||(t.type==="warmup"?"Warm-up":""),rpe:null},{emitEvent:!1})}editWeightWithPrompt(){return W(this,null,function*(){if(this.getDisabled()||this.playerSubState()!=="performing_set"){this.toastService.warning("Cannot edit weight now.",2e3);return}if(!this.activeSetInfo())return;let e=this.csf.actualWeight.value,i=yield this.alertService.showPromptDialog("Enter Weight","",[{name:"newWeight",type:"number",placeholder:`Current: ${e??"0"} ${this.weightUnitDisplaySymbol}`,value:e??void 0,attributes:{step:1,min:"0",inputmode:"decimal"}}],"Set Weight");if(i&&i.newWeight!==void 0&&i.newWeight!==null){let r=parseFloat(String(i.newWeight));!isNaN(r)&&r>=0?this.currentSetForm.patchValue({actualWeight:r}):this.toastService.error("Invalid weight entered.",3e3,"Error")}})}loadBaseExerciseAndPBs(t){if(t.startsWith("custom-exercise-")){this.currentBaseExercise.set({id:t,name:this.activeSetInfo()?.exerciseData.exerciseName||"Custom Exercise",category:"custom",description:"",iconName:"custom-exercise",muscleGroups:[],primaryMuscleGroup:"",equipment:"",imageUrls:[]}),this.exercisePBs.set([]);return}this.currentBaseExercise.set(void 0),this.exercisePBs.set([]),this.exerciseService.getExerciseById(t).subscribe(e=>{this.currentBaseExercise.set(e?z(G({},e),{iconName:this.exerciseService.determineExerciseIcon(e,e?.name)}):null)}),this.trackingService.getAllPersonalBestsForExercise(t).pipe(j(1)).subscribe(e=>this.exercisePBs.set(e))}confirmEditTarget(){let t=this.activeSetInfo();if(!t||this.editingTarget===null)return;let e=parseFloat(this.editingTargetValue);if(isNaN(e)||e<0){this.toastService.error(`Invalid value for ${this.editingTarget}. Must be non-negative.`,3e3,"Input Error");return}let i=this.routine,r=i();if(!r)return;let n=JSON.parse(JSON.stringify(r)),p=n.exercises[t.exerciseIndex].sets[t.setIndex];switch(this.editingTarget){case"reps":p.reps=e;break;case"weight":p.weight=e;break;case"duration":p.duration=e;break}i.set(n),this.toastService.success(`Target ${this.editingTarget} updated to ${e}.`,3e3,"Target Updated"),this.cancelEditTarget(),this.patchActualsFormBasedOnSessionTargets()}completeAndLogCurrentSet(){let t=this.activeSetInfo(),e=this.routine();if(!t||!e){this.toastService.error("Cannot log set: data unavailable.",0);return}if(t.setData.duration&&t.setData.duration>0&&(this.timedSetTimerState()==="running"||this.timedSetTimerState()==="paused")&&this.stopAndLogTimedSet(),this.soundPlayedForThisCountdownSegment=!1,this.currentSetForm.invalid){this.currentSetForm.markAllAsTouched();let d="";for(let p of Object.keys(this.currentSetForm.controls))if(this.currentSetForm.controls[p].invalid){d=p;break}this.toastService.error(`Please correct input: ${d?d+" is invalid.":"form invalid."}`,0,"Validation Error");return}let i=this.currentSetForm.value,r=i.actualDuration;t.setData.duration&&t.setData.duration>0&&this.timedSetElapsedSeconds()>0?r=this.timedSetElapsedSeconds():i.actualDuration===null&&t.setData.duration&&(r=t.setData.duration);let n={id:$(),plannedSetId:t.setData.id,exerciseId:t.exerciseData.exerciseId,type:t.setData.type,repsAchieved:i.actualReps??(t.setData.type==="warmup"?0:t.setData.reps??0),weightUsed:i.actualWeight??(t.setData.type==="warmup"?null:t.setData.weight),durationPerformed:r,rpe:i.rpe??void 0,targetReps:t.setData.reps,targetWeight:t.setData.weight,targetDuration:t.setData.duration,targetTempo:t.setData.tempo,notes:i.setNotes?.trim()||void 0,timestamp:new Date().toISOString()};this.addLoggedSetToCurrentLog(t.exerciseData,n),this.sessionState()==="playing"&&this.captureAndSaveStateForUnload(),this.rpeValue.set(null),this.showRpeSlider.set(!1),this.editingTarget=null,this.currentSetForm.patchValue({setNotes:""},{emitEvent:!1}),this.navigateToNextStepInWorkout(t,e)}findNextExerciseBlockStartIndex(t,e){for(let i=t+1;i<e.exercises.length;i++){let r=e.exercises[i];if(r.sessionStatus==="pending"&&(!r.supersetId||r.supersetOrder===0))return i}return-1}getNextUpText(t,e){if(!t||!e)return"Next Set/Exercise";let{nextExIdx:i,nextSetIdx:r,isEndOfAllPending:n}=this.findNextPlayableItemIndices(t.exerciseIndex,t.setIndex,e);if(n)return e.exercises.some(T=>T.sessionStatus==="do_later"&&!this.exercisesProposedThisCycle.doLater)?"Do Later Exercises":e.exercises.some(T=>T.sessionStatus==="skipped"&&!this.exercisesProposedThisCycle.skipped)?"Skipped Exercises":"Finish Workout!";let d=e.exercises[i],p=d.sets[r],g=p.type==="warmup"?"Warm-up":"Set",h=0;for(let v=0;v<=r;v++)!!d.sets[v].type!=!!p.type&&h++;return`${g} ${h} of ${d.exerciseName}`}skipRest(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Resume to skip rest.",3e3,"Paused");return}(this.isRestTimerVisible()||this.playerSubState()==="resting")&&this.handleRestTimerSkipped()}pauseSession(){return W(this,null,function*(){this.sessionState()==="playing"&&(this.isPerformanceInsightsVisible.set(!1),this.closeWorkoutMenu(),this.sessionTimerElapsedSecondsBeforePause+=Math.floor((Date.now()-this.workoutStartTime)/1e3),this.timerSub&&this.timerSub.unsubscribe(),this.wasTimedSetRunningOnPause=this.timedSetTimerState()==="running",this.timedSetTimerState()==="running"&&this.pauseTimedSet(),this.wasRestTimerVisibleOnPause=this.isRestTimerVisible(),this.wasRestTimerVisibleOnPause&&(this.restTimerRemainingSecondsOnPause=this.restDuration(),this.restTimerInitialDurationOnPause=this.restDuration(),this.restTimerMainTextOnPause=this.restTimerMainText(),this.restTimerNextUpTextOnPause=this.restTimerNextUpText(),this.isRestTimerVisible.set(!1)),this.stopAutoSave(),this.sessionState.set("paused"),this.savePausedSessionState(),this.toastService.info("Workout Paused",3e3))})}loadStateFromPausedSession(t){return W(this,null,function*(){this.routineId=t.routineId,this.routine.set(t.sessionRoutine),this.originalRoutineSnapshot=t.originalRoutineSnapshot?JSON.parse(JSON.stringify(t.originalRoutineSnapshot)):[],this.currentExerciseIndex.set(t.currentExerciseIndex),this.currentSetIndex.set(t.currentSetIndex),this.currentWorkoutLogExercises.set(t.currentWorkoutLogExercises),this.workoutStartTime=Date.now(),this.sessionTimerElapsedSecondsBeforePause=t.sessionTimerElapsedSecondsBeforePause,this.currentBlockRound.set(t.currentBlockRound),this.totalBlockRounds.set(t.totalBlockRounds),this.timedSetTimerState.set(t.timedSetTimerState),this.timedSetElapsedSeconds.set(t.timedSetElapsedSeconds),this.wasTimedSetRunningOnPause=t.timedSetTimerState==="running"||t.timedSetTimerState==="paused",this.lastPerformanceForCurrentExercise=t.lastPerformanceForCurrentExercise,this.wasRestTimerVisibleOnPause=t.isRestTimerVisibleOnPause,this.restTimerRemainingSecondsOnPause=t.restTimerRemainingSecondsOnPause,this.restTimerInitialDurationOnPause=t.restTimerInitialDurationOnPause,this.restTimerMainTextOnPause=t.restTimerMainTextOnPause,this.restTimerNextUpTextOnPause=t.restTimerNextUpTextOnPause,this.exercisesProposedThisCycle={doLater:!1,skipped:!1},this.isPerformingDeferredExercise=!1,this.lastActivatedDeferredExerciseId=null,yield this.prepareCurrentSet(),this.sessionState()!=="error"&&this.routine()&&(this.sessionState.set("playing"),this.startSessionTimer(),this.startAutoSave()),(t.timedSetTimerState==="running"||t.timedSetTimerState==="paused")&&(this.startOrResumeTimedSet(),t.timedSetTimerState==="paused"&&this.pauseTimedSet()),this.wasRestTimerVisibleOnPause&&this.restTimerRemainingSecondsOnPause>0&&this.startRestPeriod(this.restTimerRemainingSecondsOnPause,!0),this.cdr.detectChanges(),this.toastService.success("Workout session resumed.",3e3,"Resumed")})}savePausedSessionState(){let t=this.routine();if(!t){console.warn("Cannot save paused state: routine data is not available.");return}let e=this.sessionTimerElapsedSecondsBeforePause;this.sessionState()==="playing"&&this.workoutStartTime>0&&(e+=Math.floor((Date.now()-this.workoutStartTime)/1e3));let i,r=this.currentWorkoutLogExercises()[0]?.sets[0]?.timestamp,n=r?new Date(r):this.workoutStartTime>0?new Date(this.workoutStartTime-this.sessionTimerElapsedSecondsBeforePause*1e3):new Date;i=re(n,"yyyy-MM-dd");let d={version:this.PAUSED_STATE_VERSION,routineId:this.routineId,sessionRoutine:JSON.parse(JSON.stringify(t)),originalRoutineSnapshot:JSON.parse(JSON.stringify(this.originalRoutineSnapshot)),currentExerciseIndex:this.currentExerciseIndex(),currentSetIndex:this.currentSetIndex(),currentWorkoutLogExercises:JSON.parse(JSON.stringify(this.currentWorkoutLogExercises())),workoutStartTimeOriginal:this.workoutStartTime,sessionTimerElapsedSecondsBeforePause:e,currentBlockRound:this.currentBlockRound(),totalBlockRounds:this.totalBlockRounds(),timedSetTimerState:this.timedSetTimerState(),timedSetElapsedSeconds:this.timedSetElapsedSeconds(),isResting:this.isRestTimerVisible(),isRestTimerVisibleOnPause:this.playerSubState()==="resting",restTimerRemainingSecondsOnPause:this.restDuration(),restTimerInitialDurationOnPause:this.restTimerInitialDurationOnPause,restTimerMainTextOnPause:this.restTimerMainText(),restTimerNextUpTextOnPause:this.restTimerNextUpText(),lastPerformanceForCurrentExercise:this.lastPerformanceForCurrentExercise?JSON.parse(JSON.stringify(this.lastPerformanceForCurrentExercise)):null,workoutDate:i};this.storageService.setItem(this.PAUSED_WORKOUT_KEY,d),console.log("Paused session state saved.",d)}captureAndSaveStateForUnload(){let t=this.sessionTimerElapsedSecondsBeforePause;this.sessionState()==="playing"&&this.workoutStartTime>0&&(t+=Math.floor((Date.now()-this.workoutStartTime)/1e3));let e=this.sessionTimerElapsedSecondsBeforePause;this.sessionTimerElapsedSecondsBeforePause=t,this.savePausedSessionState(),this.sessionTimerElapsedSecondsBeforePause=e,console.log("Session state attempt saved via beforeunload.")}addWarmupSet(){return W(this,null,function*(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Resume to add warm-up.",3e3,"Paused");return}let t=this.routine(),e=this.activeSetInfo();if(!t||!e){this.toastService.error("Cannot add warm-up: data unavailable.",0,"Error");return}let r=t.exercises[e.exerciseIndex].sets.findIndex(g=>g.type!=="warmup");if(e.setIndex>0&&e.setIndex>r&&r!==-1){let g=yield this.alertService.showConfirm("Add Warm-up Set","You are past the first working set. Adding a warm-up set now will insert it before the current set. Continue?");if(!g||!g.data)return}let n={id:`warmup-${$()}`,type:"warmup",reps:8,weight:0,duration:void 0,restAfterSet:30,notes:"Warm-up set"},d=JSON.parse(JSON.stringify(t));d.exercises[e.exerciseIndex].sets.splice(e.setIndex,0,n),this.routine.set(d),this.toastService.success("Warm-up set added. Fill details & complete.",4e3,"Warm-up Added"),yield this.prepareCurrentSet(),this.closeWorkoutMenu(),this.closePerformanceInsights()})}getSets(){let t=this.activeSetInfo(),e=t?.exerciseData.sets||[];return t?.setData.type==="warmup"?e.filter(i=>i.type!=="warmup"):e}getWarmUpSets(){let t=this.activeSetInfo(),e=t?.exerciseData.sets||[];return t?.setData.type==="warmup"?e.filter(i=>i.type==="warmup"):[]}getTotalWarmupSetsForCurrentExercise=L(()=>{let t=this.routine(),e=this.currentExerciseIndex();return t&&t.exercises[e]?t.exercises[e].sets.filter(i=>i.type==="warmup").length:0});canAddWarmupSet=L(()=>{let t=this.activeSetInfo(),e=this.routine();if(!t||!e||this.sessionState()==="paused")return!1;let i=e.exercises[t.exerciseIndex].sets;return!(this.currentWorkoutLogExercises().find(n=>n.exerciseId===t.exerciseData.exerciseId)?.sets.some(n=>n.plannedSetId===t.setData.id)&&t.type!=="warmup")});getIconPath(t){return this.exerciseService.getIconPath(t)}toggleWorkoutMenu(){this.sessionState()==="paused"&&!this.isWorkoutMenuVisible()||(this.isWorkoutMenuVisible.update(t=>!t),this.isWorkoutMenuVisible()&&this.isPerformanceInsightsVisible.set(!1))}closeWorkoutMenu(){this.isWorkoutMenuVisible.set(!1)}skipCurrentSet(){return W(this,null,function*(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Resume to skip set.",3e3,"Paused");return}let t=this.activeSetInfo(),e=this.routine();if(!t||!e){this.toastService.error("Cannot skip set: No active set information.",0,"Error");return}if(t.setIndex===t.exerciseData.sets.length-1&&t.exerciseData.sessionStatus==="pending"){let i=yield this.alertService.showConfirmationDialog("Last Set",`This is the last set of "${t.exerciseData.exerciseName}". Skip the entire exercise instead?`,[{text:"Skip Set Only",role:"cancel",data:"skip_set"},{text:"Skip Exercise",role:"confirm",data:"skip_exercise",cssClass:"bg-orange-500"}]);if(i&&i.data==="skip_exercise"){yield this.markCurrentExerciseStatus("skipped"),this.closeWorkoutMenu();return}else if(!i||i.role==="cancel"&&i.data!=="skip_set")return}else{let i=yield this.alertService.showConfirm("Skip Current Set",`Skip current ${t.type==="warmup"?"warm-up":"set "+this.getCurrentWorkingSetNumber()} of "${t.exerciseData.exerciseName}"? It won't be logged.`);if(!i||!i.data)return}this.soundPlayedForThisCountdownSegment=!1,this.toastService.info(`Skipped set of ${t.exerciseData.exerciseName}.`,2e3),this.resetTimedSet(),this.navigateToNextStepInWorkout(t,e),this.closeWorkoutMenu(),this.closePerformanceInsights()})}skipCurrentExercise(){return W(this,null,function*(){yield this.markCurrentExerciseStatus("skipped")})}markCurrentExerciseDoLater(){return W(this,null,function*(){yield this.markCurrentExerciseStatus("do_later")})}markCurrentExerciseStatus(t){return W(this,null,function*(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Resume to mark exercise.",3e3,"Paused");return}let e=this.routine(),i=this.activeSetInfo();if(!e||!i){this.toastService.error("Cannot update exercise status: data unavailable.",0,"Error");return}let r=i.exerciseData.exerciseName,n=t==="skipped"?"Skip":"Mark for Later",d=JSON.parse(JSON.stringify(e)),p=d.exercises.find(g=>g.id===i.exerciseData.id);if(p){let g=p.sessionStatus;p.sessionStatus=t,this.routine.set(d),this.toastService.info(`"${r}" marked as ${t}.`,2e3),this.resetTimedSet(),this.isPerformingDeferredExercise&&i.exerciseData.id===this.lastActivatedDeferredExerciseId?(console.log(`markCurrentExerciseStatus: Re-marking a deferred exercise (${r}) as ${t}. Re-evaluating all deferred.`),this.isPerformingDeferredExercise=!1,this.lastActivatedDeferredExerciseId=null,this.exercisesProposedThisCycle={doLater:!1,skipped:!1},yield this.tryProceedToDeferredExercisesOrFinish(d)):(console.log(`markCurrentExerciseStatus: Marking main sequence exercise (${r}) as ${t}. Advancing.`),yield this.navigateToNextStepInWorkout(i,d,!0))}this.closeWorkoutMenu(),this.closePerformanceInsights()})}addCustomExercise(){return W(this,null,function*(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Resume to add exercise.",3e3,"Paused");return}let t=this.routine();if(!t){this.toastService.error("Cannot add exercise: routine data unavailable.",0,"Error");return}let e=[{name:"exerciseName",type:"text",placeholder:"Exercise Name (e.g., Custom Bicep Curl)",value:"",attributes:{required:!0}},{name:"numSets",type:"number",placeholder:"Number of Sets (e.g., 3)",value:"3",attributes:{min:"1",required:!0}},{name:"repsPerSet",type:"number",placeholder:"Reps per Set (e.g., 10)",value:"10",attributes:{min:"0"}},{name:"weightPerSet",type:"number",placeholder:"Weight (optional)",value:"",attributes:{min:"0",step:"any"}},{name:"restAfterSet",type:"number",placeholder:"Rest after set (sec, e.g., 60)",value:"60",attributes:{min:"0"}}],i=yield this.alertService.showPromptDialog("Add Custom Exercise","Define the new exercise:",e,"Add Exercise");if(i&&i.exerciseName&&i.numSets){let r=String(i.exerciseName).trim(),n=parseInt(String(i.numSets),10),d=i.repsPerSet?parseInt(String(i.repsPerSet),10):null,p=i.weightPerSet!==""&&i.weightPerSet!==null?parseFloat(String(i.weightPerSet)):null,g=i.restAfterSet?parseInt(String(i.restAfterSet),10):60;if(!r||n<=0){this.toastService.error("Invalid input for custom exercise.",0,"Error");return}let h=[];for(let O=0;O<n;O++)h.push({id:`custom-set-${$()}`,reps:d||8,weight:p,duration:void 0,restAfterSet:g,type:"standard",notes:""});let v={id:`custom-ex-${$()}`,exerciseId:`custom-exercise-${$()}`,exerciseName:r,sets:h,rounds:1,supersetId:null,sessionStatus:"pending",supersetOrder:null},b=JSON.parse(JSON.stringify(t)),T=this.currentExerciseIndex()+1,P=this.activeSetInfo();P&&P.exerciseData.supersetId&&P.exerciseData.supersetOrder!==null&&P.exerciseData.supersetSize&&(T=P.exerciseIndex-P.exerciseData.supersetOrder+P.exerciseData.supersetSize),b.exercises.splice(T,0,v),this.routine.set(b);let D=yield this.alertService.showConfirm("Exercise Added",`"${r}" added. Start it now? (Otherwise, it will appear after your current block)`);D&&D.data?(this.currentExerciseIndex.set(T),this.currentSetIndex.set(0),this.currentBlockRound.set(1),this.totalBlockRounds.set(v.rounds??1),this.lastPerformanceForCurrentExercise=null,this.playerSubState.set("performing_set"),yield this.prepareCurrentSet()):this.toastService.success(`"${r}" added to the queue.`,3e3,"Exercise Added")}this.closeWorkoutMenu()})}finishWorkoutEarly(){return W(this,null,function*(){if(this.sessionState()==="paused"){this.toastService.warning("Please resume before finishing early.",3e3,"Paused");return}let t=yield this.alertService.showConfirm("Finish Workout Early","Finish workout now? Current progress will be saved.");t&&t.data&&(this.closeWorkoutMenu(),this.closePerformanceInsights(),(yield this.finishWorkoutAndReportStatus())||(this.toastService.info("Workout finished early. Paused session cleared.",4e3),this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),this.router.url.includes("/play")&&this.router.navigate(["/workout"])))})}finishWorkoutAndReportStatus(){return W(this,null,function*(){if(this.stopAutoSave(),this.sessionState()==="paused")return this.toastService.warning("Please resume workout before finishing.",3e3,"Session Paused"),!1;if(this.sessionState()==="loading")return this.toastService.info("Workout is still loading.",3e3,"Loading"),!1;let t=this.currentWorkoutLogExercises().filter(F=>F.sets.length>0);if(t.length===0)return this.toastService.info("No sets logged. Workout not saved.",3e3,"Empty Workout"),this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),this.router.url.includes("/play")&&this.router.navigate(["/workout"]),!1;this.timerSub&&this.timerSub.unsubscribe();let e=this.routine(),i=this.program(),r=!0,n=!1,d=!1,p=e?.name?`${e.name} - ${re(new Date,"MMM d")}`:`Ad-hoc Workout - ${re(new Date,"MMM d, HH:mm")}`,g=this.originalRoutineSnapshot.filter(F=>e?.exercises.find(R=>R.id===F.id&&R.sessionStatus==="pending")||t.some(R=>R.exerciseId===F.exerciseId));if(this.routineId&&this.originalRoutineSnapshot&&this.originalRoutineSnapshot.length>0&&e){let F=this.comparePerformedToOriginal(t,g);if(F.majorDifference){let R=yield this.alertService.showConfirmationDialog("Routine Structure Changed",`You made significant changes to the routine structure:

${F.details.join(`
`)}

Would you like to save this as a new routine, update the original, or cancel?`,[{text:"Save as New Routine",role:"confirm",data:"new",cssClass:"bg-green-600"},{text:"Update Original Routine",role:"destructive",data:"update",cssClass:"bg-blue-600"},{text:"Cancel",role:"cancel",data:"cancel"}]);if(R&&R.data==="new"){let oe=yield this.alertService.showPromptDialog("New Routine Name","Enter a name for your new routine:",[{name:"newRoutineName",type:"text",placeholder:p,value:p,attributes:{required:!0}}],"Save Routine");oe&&String(oe.newRoutineName).trim()?(p=String(oe.newRoutineName).trim(),n=!0):r=!1}else R&&R.data==="update"?d=!0:r=!1}}else if(!this.routineId&&t.length>0){n=!0;let F=yield this.alertService.showPromptDialog("Save as New Routine","Enter a name for your new routine:",[{name:"newRoutineName",type:"text",placeholder:p,value:p,attributes:{required:!0}}],"Save Routine");F&&String(F.newRoutineName).trim()?p=String(F.newRoutineName).trim():F||(r=!1)}if(!r)return this.toastService.info("Finish workout cancelled. Session remains active/paused.",3e3,"Cancelled"),this.sessionState()==="playing"&&this.startAutoSave(),!1;let h=Date.now(),v=this.workoutStartTime-this.sessionTimerElapsedSecondsBeforePause*1e3,b=Math.round((h-v)/(1e3*60)),T=this.routineId||void 0,P=e?.name||"Ad-hoc Workout";if(n){let F={name:p,description:e?.description||"Workout performed on "+re(new Date,"MMM d, yyyy"),goal:e?.goal||"custom",exercises:this.convertLoggedToWorkoutExercises(t)},R=this.workoutService.addRoutine(F);T=R.id,P=R.name,this.toastService.success(`New routine "${R.name}" created.`,4e3)}let D={routineId:T,routineName:P,date:re(new Date(v),"yyyy-MM-dd"),startTime:v,endTime:h,durationMinutes:b,exercises:t,notes:e?.notes,programId:i?.id},O=this.trackingService.addWorkoutLog(D);if(this.toastService.success("Congrats! Workout completed!",5e3,"Workout Finished"),T){let F=yield X(this.workoutService.getRoutineById(T).pipe(j(1)));if(F){let R=z(G({},F),{lastPerformed:new Date(v).toISOString()});d&&!n&&this.routineId===T&&(R.exercises=this.convertLoggedToWorkoutExercises(t)),this.workoutService.updateRoutine(R)}}return this.isSessionConcluded=!0,this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),this.router.navigate(["/workout/summary",O.id]),!0})}quitWorkout(){return W(this,null,function*(){let t=yield this.alertService.showConfirm("Quit Workout","Quit workout? Unsaved progress (if not paused) will be lost.");t&&t.data&&(this.stopAllActivity(),this.isSessionConcluded=!0,this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),this.closeWorkoutMenu(),this.closePerformanceInsights(),this.router.navigate(["/workout"]),this.toastService.info("Workout quit. No progress saved for this session.",4e3))})}toggleCompletedSetsInfo(){this.showCompletedSetsInfo.update(t=>!t)}openPerformanceInsights(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Resume to view insights.",3e3,"Paused");return}this.isPerformanceInsightsVisible.set(!0),this.isWorkoutMenuVisible.set(!1)}closePerformanceInsights(){this.isPerformanceInsightsVisible.set(!1),this.editingTarget&&this.cancelEditTarget()}openPerformanceInsightsFromMenu(){this.closeWorkoutMenu(),this.openPerformanceInsights()}goBack(){this.currentWorkoutLogExercises().length>0&&this.sessionState()==="playing"?this.alertService.showConfirm("Exit Workout?","You have an active workout. Are you sure you want to exit? Your progress might be lost unless you pause first.").then(t=>{t&&t.data&&this.router.navigate(["/workout"])}):this.router.navigate(["/workout"])}incrementWeight(t=.5){let i=this.csf.actualWeight.value??0;this.currentSetForm.patchValue({actualWeight:parseFloat((i+1).toFixed(2))})}pressStartTime=null;weightIncrementIntervalId=null;onWeightPointerDown(t){if(this.weightIncrementIntervalId!==null)return;this.incrementWeight(),this.weightIncrementIntervalId=setInterval(()=>{this.incrementWeight()},100);let e=()=>{this.weightIncrementIntervalId!==null&&(clearInterval(this.weightIncrementIntervalId),this.weightIncrementIntervalId=null),document.removeEventListener("mouseup",e),document.removeEventListener("touchend",e),document.removeEventListener("mouseleave",e)};document.addEventListener("mouseup",e),document.addEventListener("touchend",e),document.addEventListener("mouseleave",e)}onWeightPointerUp(t){this.weightIncrementIntervalId!==null&&(clearInterval(this.weightIncrementIntervalId),this.weightIncrementIntervalId=null),document.removeEventListener("mouseup",this.onWeightPointerUp),document.removeEventListener("touchend",this.onWeightPointerUp),document.removeEventListener("mouseleave",this.onWeightPointerUp)}decrementWeight(t=.5){let i=this.csf.actualWeight.value??0;this.currentSetForm.patchValue({actualWeight:Math.max(0,parseFloat((i-1).toFixed(2)))})}incrementReps(t=1){let e=t,i=this.csf.actualReps.value??0;this.currentSetForm.patchValue({actualReps:i+e})}decrementReps(t=1){let e=t,i=this.csf.actualReps.value??0;this.currentSetForm.patchValue({actualReps:Math.max(0,i-e)})}toggleRpeInput(){this.showRpeSlider.update(t=>!t)}updateRpe(t){let e=typeof t=="string"?parseInt(t,10):t;e!==null&&!isNaN(e)&&e>=1&&e<=10?(this.rpeValue.set(e),this.currentSetForm.patchValue({rpe:e})):e===null&&(this.rpeValue.set(null),this.currentSetForm.patchValue({rpe:null}))}startAutoSave(){N(this.platformId)&&(this.autoSaveSub&&this.autoSaveSub.unsubscribe(),this.autoSaveSub=pt(this.AUTO_SAVE_INTERVAL_MS).subscribe(()=>{this.sessionState()==="playing"&&this.routine()&&(console.log("Auto-saving workout state..."),this.savePausedSessionState())}))}stopAutoSave(){this.autoSaveSub&&(this.autoSaveSub.unsubscribe(),this.autoSaveSub=void 0)}ngOnInit(){return W(this,null,function*(){N(this.platformId)&&window.scrollTo(0,0),(yield this.checkForPausedSession(!1))?this.isInitialLoadComplete=!0:this.loadNewWorkoutFromRoute(),N(this.platformId)&&(this.routerEventsSub=this.router.events.pipe(gt(e=>e instanceof It),le(e=>W(this,null,function*(){let i=this.route.snapshot,r=e.urlAfterRedirects.startsWith("/workout/play/"),n=i.paramMap.get("routineId");r&&(this.routineId===n&&this.isInitialLoadComplete&&this.sessionState()!=="playing"?!(yield this.checkForPausedSession(!0))&&this.sessionState()!=="playing"&&this.loadNewWorkoutFromRoute():this.routineId)}))).subscribe())})}loadNewWorkoutFromRoute(){return W(this,null,function*(){console.log("loadNewWorkoutFromRoute - START"),this.isInitialLoadComplete=!1,this.sessionState.set("loading"),this.exercisesProposedThisCycle={doLater:!1,skipped:!1},this.isPerformingDeferredExercise=!1,this.lastActivatedDeferredExerciseId=null,this.stopAllActivity(),this.workoutStartTime=Date.now(),this.sessionTimerElapsedSecondsBeforePause=0,this.originalRoutineSnapshot=[],this.currentWorkoutLogExercises.set([]),this.currentSetIndex.set(0),this.currentBlockRound.set(1),this.routine.set(void 0),this.program.set(void 0),this.routeSub&&this.routeSub.unsubscribe(),this.routeSub=this.route.paramMap.pipe(ue(t=>{let e=t.get("routineId");return console.log("loadNewWorkoutFromRoute - paramMap emitted, newRoutineId:",e),e?(this.routineId=e,this.workoutService.getRoutineById(this.routineId).pipe(we(i=>{if(i){console.log("loadNewWorkoutFromRoute: Fetched original routine -",i.name),this.originalRoutineSnapshot=JSON.parse(JSON.stringify(i.exercises));let r=JSON.parse(JSON.stringify(i));return r.exercises.forEach(n=>{n.sessionStatus="pending",n.id||(n.id=$()),n.sets.forEach(d=>{d.id||(d.id=$()),d.type||(d.type="standard")})}),r}return console.warn("loadNewWorkoutFromRoute: No original routine found for ID:",this.routineId),null}))):(this.toastService.error("No routine specified to play.",0,"Error"),this.router.navigate(["/workout"]),this.sessionState.set("error"),ae(null))}),le(t=>W(this,null,function*(){if(console.log("loadNewWorkoutFromRoute - tap operator. Session routine copy:",t?t.name:"null"),this.sessionState()==="paused"){console.log("loadNewWorkoutFromRoute - tap: Session is paused, skipping setup."),this.isInitialLoadComplete=!0;return}if(t){this.exercisesProposedThisCycle={doLater:!1,skipped:!1},this.isPerformingDeferredExercise=!1,this.lastActivatedDeferredExerciseId=null,this.routine.set(t);let e=this.findFirstPendingExerciseAndSet(t);if(e){this.currentExerciseIndex.set(e.exerciseIndex),this.currentSetIndex.set(e.setIndex),console.log(`loadNewWorkoutFromRoute - Initial pending set to Ex: ${e.exerciseIndex}, Set: ${e.setIndex}`);let i=t.exercises[e.exerciseIndex];if(!i.supersetId||i.supersetOrder===0)this.totalBlockRounds.set(i.rounds??1);else{let r=t.exercises.find(n=>n.supersetId===i.supersetId&&n.supersetOrder===0);this.totalBlockRounds.set(r?.rounds??1)}}else{console.log("loadNewWorkoutFromRoute: Routine loaded but no initial pending exercises. Will try deferred/finish."),this.currentExerciseIndex.set(0),this.currentSetIndex.set(0),this.totalBlockRounds.set(1),this.exercisesProposedThisCycle={doLater:!1,skipped:!1},yield this.tryProceedToDeferredExercisesOrFinish(t),this.isInitialLoadComplete=!0;return}this.currentBlockRound.set(1),this.currentWorkoutLogExercises.set([]),yield this.prepareCurrentSet(),this.sessionState()!=="error"&&this.sessionState()!=="paused"&&(this.startSessionTimer(),this.startAutoSave())}else this.routineId&&(console.error("loadNewWorkoutFromRoute - tap: Failed to load routine for ID or routine was null:",this.routineId),this.routine.set(null),this.sessionState.set("error"),this.toastService.error("Failed to load workout routine.",0,"Load Error"),N(this.platformId)&&this.router.navigate(["/workout"]),this.stopAutoSave());this.isInitialLoadComplete=!0,console.log("loadNewWorkoutFromRoute - END tap operator. Final sessionState:",this.sessionState())}))).subscribe({error:t=>{console.error("loadNewWorkoutFromRoute - Error in observable pipeline:",t),this.routine.set(null),this.sessionState.set("error"),this.toastService.error("Critical error loading workout.",0,"Load Error"),N(this.platformId)&&this.router.navigate(["/workout"]),this.isInitialLoadComplete=!0}})})}checkForPausedSession(t=!1){return W(this,null,function*(){let e=this.storageService.getItem(this.PAUSED_WORKOUT_KEY),i=this.route.snapshot.paramMap.get("routineId"),r=this.route.snapshot.queryParamMap.get("resume")==="true";if(console.log("WorkoutPlayer.checkForPausedSession ...",!!e),e&&e.version===this.PAUSED_STATE_VERSION){if(i&&e.routineId===null)return console.log("WorkoutPlayer.checkForPausedSession - Current route is for a specific routine, but paused session was ad-hoc. Discarding paused session."),this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),!1;if(!i&&e.routineId!==null)return console.log("WorkoutPlayer.checkForPausedSession - Current route is ad-hoc, but paused session was for a specific routine. Discarding paused session."),this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),!1;if(i&&e.routineId&&i!==e.routineId)return console.log("WorkoutPlayer.checkForPausedSession - Paused session routine ID does not match current route routine ID. Discarding paused session."),this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),!1;let n=!1;if(r)n=!0,this.router.navigate([],{relativeTo:this.route,queryParams:{resume:null},queryParamsHandling:"merge",replaceUrl:!0});else if(t)n=!0;else{let d=yield this.alertService.showConfirmationDialog("Resume Paused Workout?","You have a paused workout session. Would you like to resume it?",[{text:"Resume",role:"confirm",data:!0,cssClass:"bg-green-600"},{text:"Discard",role:"cancel",data:!1,cssClass:"bg-red-600"}]);n=!!(d&&d.data===!0)}return n?(this.stopAllActivity(),this.routeSub&&this.routeSub.unsubscribe(),yield this.loadStateFromPausedSession(e),this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),this.isInitialLoadComplete=!0,!0):(this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),this.toastService.info("Paused session discarded.",3e3),!1)}return!1})}stopAllActivity(){console.log("stopAllActivity - Stopping timers and auto-save."),this.stopAutoSave(),this.timerSub&&this.timerSub.unsubscribe(),this.timedSetIntervalSub&&this.timedSetIntervalSub.unsubscribe(),this.isRestTimerVisible.set(!1)}resumeSession(){return W(this,null,function*(){this.sessionState()==="paused"?(console.log("resumeSession button clicked - transitioning from Paused to Playing"),this.workoutStartTime=Date.now(),this.sessionState.set("playing"),this.startSessionTimer(),this.startAutoSave(),this.wasTimedSetRunningOnPause&&this.timedSetTimerState()==="paused"&&this.startOrResumeTimedSet(),this.wasTimedSetRunningOnPause=!1,this.wasRestTimerVisibleOnPause&&this.restTimerRemainingSecondsOnPause>0&&this.startRestPeriod(this.restTimerRemainingSecondsOnPause,!0),this.wasRestTimerVisibleOnPause=!1,this.closeWorkoutMenu(),this.closePerformanceInsights(),this.toastService.info("Workout session resumed.",3e3)):!(yield this.checkForPausedSession(!0))&&this.sessionState()!=="playing"&&this.routineId&&this.loadNewWorkoutFromRoute()})}ngOnDestroy(){this.routeSub&&this.routeSub.unsubscribe(),this.timerSub&&this.timerSub.unsubscribe(),this.timedSetIntervalSub&&this.timedSetIntervalSub.unsubscribe(),this.routerEventsSub&&this.routerEventsSub.unsubscribe(),this.presetTimerSub&&this.presetTimerSub.unsubscribe(),this.stopAutoSave(),this.isRestTimerVisible.set(!1),N(this.platformId)&&!this.isSessionConcluded&&(this.sessionState()==="playing"||this.sessionState()==="paused")&&this.routine()&&this.currentWorkoutLogExercises().length>0&&(console.log("WorkoutPlayer ngOnDestroy - Saving state..."),this.savePausedSessionState())}playClientBeep(t=800,e=150){if(N(this.platformId))try{let i=window.AudioContext||window.webkitAudioContext;if(!i){console.warn("Web Audio API not supported in this browser.");return}let r=new i,n=r.createOscillator();n.type="sine",n.frequency.setValueAtTime(t,r.currentTime),n.connect(r.destination),n.start(),n.stop(r.currentTime+e/1e3),setTimeout(()=>{r.state!=="closed"&&r.close()},e+50)}catch(i){console.error("Error playing beep sound:",i)}}playClientGong(t=440,e=700){if(N(this.platformId))try{let i=window.AudioContext||window.webkitAudioContext;if(!i){console.warn("Web Audio API not supported in this browser.");return}let r=new i,n=r.createOscillator(),d=r.createGain();n.type="triangle",n.frequency.setValueAtTime(200,r.currentTime),d.gain.setValueAtTime(1,r.currentTime),d.gain.exponentialRampToValueAtTime(.001,r.currentTime+2),n.connect(d),d.connect(r.destination),n.start(),n.stop(r.currentTime+2)}catch(i){console.error("Error playing gong sound:",i)}}startPresetTimer(t,e){this.playerSubState.set("preset_countdown"),this.presetTimerDuration.set(t);let i=t;this.presetTimerCountdownDisplay.set(String(i)),this.restTimerMainText.set(`GET READY: ${e.exerciseData.exerciseName}`);let r=e.type==="warmup"?`Warm-up ${this.getWarmupSetNumberForDisplay(e.exerciseData,e.setIndex)}/${this.getTotalWarmupSetsForExercise(e.exerciseData)}`:`Set ${this.getWorkingSetNumberForDisplay(e.exerciseData,e.setIndex)}/${this.getWorkingSetCountForExercise(e.exerciseData)}`;this.restTimerNextUpText.set(r),this.presetTimerSub&&this.presetTimerSub.unsubscribe(),this.presetTimerSub=Ve(0,1e3).pipe(j(t+1)).subscribe({next:()=>{this.presetTimerCountdownDisplay.set(String(i)),i<=this.appSettingsService.countdownSoundSeconds()&&i>0&&this.appSettingsService.enableTimerCountdownSound()&&t>5&&this.playClientBeep(600,150),i--},complete:()=>{this.playerSubState()==="preset_countdown"&&(this.playClientBeep(1e3,250),this.handlePresetTimerFinished())}})}handlePresetTimerFinished(){this.presetTimerSub&&(this.presetTimerSub.unsubscribe(),this.presetTimerSub=void 0),this.presetTimerCountdownDisplay.set(null),this.playerSubState.set("performing_set"),this.cdr.detectChanges(),console.log("Pre-set timer finished. Player state set to PerformingSet.")}skipPresetTimer(){this.playerSubState()==="preset_countdown"&&(this.presetTimerSub&&(this.presetTimerSub.unsubscribe(),this.presetTimerSub=void 0),this.handlePresetTimerFinished())}getWarmupSetNumberForDisplay(t,e){let i=0;for(let r=0;r<=e;r++)t.sets[r].type==="warmup"&&i++;return i}getTotalWarmupSetsForExercise(t){return t.sets.filter(e=>e.type==="warmup").length}getWorkingSetNumberForDisplay(t,e){let i=0;for(let r=0;r<=e;r++)t.sets[r].type!=="warmup"&&i++;return i}getWorkingSetCountForExercise(t){return t.sets.filter(e=>e.type!=="warmup").length}findNextPlayableItemIndices(t,e,i,r=!1){let n=t,d=e,p=!1,g=!1,h=!1,v=i.exercises[t];if(r||d>=v.sets.length-1){if(d=0,!r&&v.supersetId&&v.supersetOrder!==null&&v.supersetOrder<(v.supersetSize||1)-1){let P=t+1;for(;P<i.exercises.length&&(i.exercises[P].supersetId!==v.supersetId||i.exercises[P].sessionStatus!=="pending");)P++;if(P<i.exercises.length&&i.exercises[P].supersetId===v.supersetId)return n=P,{nextExIdx:n,nextSetIdx:d,blockChanged:p,isEndOfAllPending:g,roundIncremented:h}}let b=this.totalBlockRounds();if(!r&&this.currentBlockRound()<b){this.currentBlockRound.update(F=>F+1),h=!0;let P=t;v.supersetId&&v.supersetOrder!==null&&(P=t-v.supersetOrder);let D=P,O=!1;for(;D<i.exercises.length&&(v.supersetId?i.exercises[D].supersetId===v.supersetId:D===P);){if(i.exercises[D].sessionStatus==="pending"){n=D,O=!0;break}D++}if(!O)this.currentBlockRound.set(b),h=!1;else return{nextExIdx:n,nextSetIdx:d,blockChanged:p,isEndOfAllPending:g,roundIncremented:h}}p=!0,this.currentBlockRound.set(1),h=!1;let T=t+1;v.supersetId&&v.supersetOrder!==null&&(T=t-v.supersetOrder+(v.supersetSize||1)),n=-1;for(let P=T;P<i.exercises.length;P++){let D=i.exercises[P];if(D.sessionStatus==="pending"){if(!D.supersetId||D.supersetOrder===0){n=P;break}let O=P-(D.supersetOrder||0);if(O>=0&&i.exercises[O].sessionStatus==="pending"&&i.exercises[O].supersetId===D.supersetId){n=O;break}}}}else d++;return(n===-1||n>=i.exercises.length||n!==-1&&i.exercises[n].sessionStatus!=="pending")&&(g=!0,n=-1),{nextExIdx:n,nextSetIdx:d,blockChanged:p,isEndOfAllPending:g,roundIncremented:h}}navigateToNextStepInWorkout(t,e,i=!1){return W(this,null,function*(){let r=t.exerciseData,n=this.isExerciseFullyLogged(r.exerciseId,r.sets.length);if(this.isPerformingDeferredExercise&&r.id===this.lastActivatedDeferredExerciseId&&n){console.log("navigateToNextStepInWorkout: Completed an explicitly chosen deferred/skipped exercise. Re-evaluating all remaining."),this.isPerformingDeferredExercise=!1,this.lastActivatedDeferredExerciseId=null,this.exercisesProposedThisCycle={doLater:!1,skipped:!1},yield this.tryProceedToDeferredExercisesOrFinish(e);return}let{nextExIdx:d,nextSetIdx:p,blockChanged:g,isEndOfAllPending:h,roundIncremented:v}=this.findNextPlayableItemIndices(t.exerciseIndex,t.setIndex,e,i);if(h){console.log("navigateToNextStepInWorkout: No more 'pending' exercises in main sequence. Attempting to proceed to deferred or finish."),this.isPerformingDeferredExercise=!1,this.lastActivatedDeferredExerciseId=null,this.exercisesProposedThisCycle={doLater:!1,skipped:!1},yield this.tryProceedToDeferredExercisesOrFinish(e);return}if(this.currentExerciseIndex.set(d),this.currentSetIndex.set(p),t.exerciseIndex!==d&&e.exercises[d].id!==this.lastActivatedDeferredExerciseId&&(this.isPerformingDeferredExercise=!1,this.lastActivatedDeferredExerciseId=null),(g||v||i||t.exerciseIndex!==d)&&(this.lastPerformanceForCurrentExercise=null),g){let T=e.exercises[d];if(!T.supersetId||T.supersetOrder===0)this.totalBlockRounds.set(T.rounds??1);else{let P=e.exercises.find(D=>D.supersetId===T.supersetId&&D.supersetOrder===0);this.totalBlockRounds.set(P?.rounds??1)}}let b=t.setData.restAfterSet;b>0&&!i?this.startRestPeriod(b):(this.playerSubState.set("performing_set"),yield this.prepareCurrentSet())})}startRestPeriod(t,e=!1){if(this.playerSubState.set("resting"),this.restDuration.set(t),N(this.platformId)&&t>0){let i=this.activeSetInfo(),r=this.routine();if(e)this.restTimerMainText.set(this.restTimerMainTextOnPause),this.restTimerNextUpText.set(this.restTimerNextUpTextOnPause);else{this.restTimerMainText.set("RESTING");let n=this.peekNextSetInfo();this.restTimerNextUpText.set(n?`${n.type==="warmup"?"Warm-up ":""}Set ${n.type==="warmup"?this.getWarmupSetNumberForDisplay(n.exerciseData,n.setIndex):this.getWorkingSetNumberForDisplay(n.exerciseData,n.setIndex)} of ${n.exerciseData.exerciseName}`:"Next Exercise")}this.playerSubState.set("resting"),this.restDuration.set(t),this.isRestTimerVisible.set(!0),this.updateRestTimerDisplay(t)}else this.isRestTimerVisible.set(!1),this.playerSubState.set("performing_set"),this.prepareCurrentSet()}peekNextSetInfo(){let t=this.routine(),e=this.currentExerciseIndex(),i=this.currentSetIndex();if(t&&t.exercises[e]&&t.exercises[e].sets[i]){let r=t.exercises[e],n=t.exercises[e].sets[i];return{exerciseIndex:e,setIndex:i,exerciseData:r,setData:n,type:n.type??"standard",isCompleted:!1}}return null}handleRestTimerFinished(){console.log("Rest timer finished."),this.isRestTimerVisible.set(!1),this.prepareCurrentSet()}handleRestTimerSkipped(){console.log("Rest timer skipped."),this.isRestTimerVisible.set(!1),this.toastService.info("Rest skipped.",2e3),this.playerSubState.set("performing_set"),this.prepareCurrentSet()}getDisabled(){return this.timedSetTimerState()==="running"||this.sessionState()==="paused"||this.playerSubState()==="preset_countdown"||this.playerSubState()==="resting"}handleMainAction(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Please resume to continue.",3e3,"Paused");return}switch(this.playerSubState()){case"performing_set":{this.completeAndLogCurrentSet();break}case"preset_countdown":this.skipPresetTimer();break;case"resting":this.skipRest();break}}shouldRunPresetTimerForCurrentSet=L(()=>{let t=this.appSettingsService.enablePresetTimer(),e=this.appSettingsService.presetTimerDurationSeconds();if(!t||e<=0)return!1;let i=this.routine(),r=this.currentExerciseIndex(),n=this.currentSetIndex();if(!i||!i.exercises[r]||!i.exercises[r].sets[n])return!1;let d=r===0&&n===0&&this.currentBlockRound()===1,p=1/0;if(n>0)p=i.exercises[r].sets[n-1].restAfterSet;else if(r>0){let g=i.exercises[r-1];p=g.sets[g.sets.length-1].restAfterSet}return d||p===0});getIncompleteExercises(){let t=this.routine(),e=this.currentWorkoutLogExercises();return t?t.exercises.filter(i=>{if(i.sessionStatus!=="pending")return!1;let r=e.find(n=>n.exerciseId===i.exerciseId);return r?r.sets.length<i.sets.length:!0}):[]}jumpToExercise(){return W(this,null,function*(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Resume to jump to an exercise.",3e3,"Paused"),this.closeWorkoutMenu();return}let t=this.routine();if(!t||!t.exercises||t.exercises.length===0){this.toastService.error("No exercises available to jump to.",0,"Error"),this.closeWorkoutMenu();return}let e=t.exercises.map((n,d)=>z(G({},n),{originalIndex:d,isFullyLogged:this.isExerciseFullyLogged(n.exerciseId,n.sets.length)})).filter(n=>!n.isFullyLogged||n.sessionStatus==="pending"||n.sessionStatus==="do_later"||n.sessionStatus==="skipped");if(e.length===0){this.toastService.info("All exercises are completed or no suitable exercises to jump to.",3e3),this.closeWorkoutMenu();return}let i=e.map(n=>{let d="";return n.id===this.activeSetInfo()?.exerciseData.id&&n.sessionStatus==="pending"&&!n.isFullyLogged?d=" (Current)":n.isFullyLogged&&n.sessionStatus!=="skipped"&&n.sessionStatus!=="do_later"?d=" (Completed - Restart?)":n.sessionStatus==="skipped"?d=" (Skipped)":n.sessionStatus==="do_later"&&(d=" (Do Later)"),{text:`${n.exerciseName}${d}`,role:"confirm",data:n.originalIndex,cssClass:n.id===this.activeSetInfo()?.exerciseData.id&&n.sessionStatus==="pending"?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 dark:text-gray-100"}});i.push({text:"Cancel",role:"cancel",data:"cancel_jump"}),this.closeWorkoutMenu();let r=yield this.alertService.showConfirmationDialog("Jump to Exercise","Select an exercise to start or continue:",i);if(r&&r.data!=="cancel_jump"&&typeof r.data=="number"){let n=r.data,d=t.exercises[n];if(!d){this.toastService.error("Selected exercise not found.",0,"Error");return}console.log(`Jumping to exercise: ${d.exerciseName} at index ${n}`),this.stopOngoingTimers();let p=JSON.parse(JSON.stringify(t)),g=p.exercises[n],h=g.sessionStatus==="do_later"||g.sessionStatus==="skipped";if(g.sessionStatus="pending",this.routine.set(p),this.currentExerciseIndex.set(n),this.currentSetIndex.set(this.findFirstUnloggedSetIndex(d.exerciseId,d.sets.map(v=>v.id))||0),this.currentBlockRound.set(1),!d.supersetId||d.supersetOrder===0)this.totalBlockRounds.set(d.rounds??1);else{let v=p.exercises.find(b=>b.supersetId===d.supersetId&&b.supersetOrder===0);this.totalBlockRounds.set(v?.rounds??1)}this.lastPerformanceForCurrentExercise=null,this.isPerformingDeferredExercise=h,this.lastActivatedDeferredExerciseId=h?d.id:null,this.playerSubState.set("performing_set"),yield this.prepareCurrentSet(),this.toastService.info(`Jumped to ${d.exerciseName}.`,2500)}})}stopOngoingTimers(){this.isRestTimerVisible()&&this.isRestTimerVisible.set(!1),this.playerSubState(),this.playerSubState()==="preset_countdown"&&this.presetTimerSub&&(this.presetTimerSub.unsubscribe(),this.presetTimerSub=void 0,this.presetTimerCountdownDisplay.set(null)),this.timedSetTimerState()!=="idle"&&this.timedSetIntervalSub&&this.resetTimedSet()}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=J({type:s,selectors:[["app-workout-player"]],hostBindings:function(e,i){e&1&&_("beforeunload",function(n){return i.unloadNotification(n)},ht)},features:[Ae([te])],decls:6,vars:8,consts:[["loadingOrError",""],["routineNotFound",""],["workoutCompleteOrError",""],["loadingBaseExIcon",""],["class","workout-player-container bg-gray-50 dark:bg-gray-950 min-h-screen flex flex-col",4,"ngIf","ngIfElse"],[3,"timerFinished","timerSkipped","isVisible","durationSeconds","mainText","nextUpText"],["class","fixed inset-0 z-50 bg-black/70 backdrop-blur-md flex flex-col items-center justify-center p-4 space-y-2 sm:space-y-3","style","padding-top: env(safe-area-inset-top); padding-bottom: env(safe-area-inset-bottom);",4,"ngIf"],["style","z-index: 100","class","fixed inset-0 bg-gray-700/80 dark:bg-black/80 backdrop-blur-sm flex items-center justify-center p-4",4,"ngIf"],[1,"workout-player-container","bg-gray-50","dark:bg-gray-950","min-h-screen","flex","flex-col"],["class","fixed inset-0 z-[60] bg-black/70 backdrop-blur-sm flex flex-col items-center justify-center space-y-6 p-4",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"fixed","inset-0","z-[60]","bg-black/70","backdrop-blur-sm","flex","flex-col","items-center","justify-center","space-y-6","p-4"],[1,"text-4xl","font-bold","text-white"],[1,"text-lg","text-gray-200"],[1,"bg-green-500","hover:bg-green-600","text-white","font-bold","py-3","px-8","rounded-lg","text-xl","shadow-lg","w-full","max-w-xs",3,"click"],[1,"text-sm","text-red-300","hover:text-red-100","font-medium","py-2","px-4","rounded-md","border","border-red-300","hover:bg-red-700/30","w-full","max-w-xs","mt-2",3,"click"],[1,"fixed","top-0","left-0","right-0","z-30","bg-gray-50","dark:bg-gray-950","border-b","border-gray-200","dark:border-gray-800","p-2","flex","items-center","justify-between","h-14"],[1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-ml-1",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"text-center"],[1,"text-sm","font-semibold","text-gray-700","dark:text-gray-300","uppercase","tracking-wider","truncate","max-w-[calc(100vw-120px)]",3,"title"],[1,"text-xs","text-gray-500","dark:text-gray-400"],[1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-mr-1","disabled:opacity-50",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-6","w-6"],["stroke-linecap","round","stroke-linejoin","round","d","M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"],[1,"flex-grow","overflow-y-auto","pt-10"],["class","p-4 max-w-md mx-auto",4,"ngIf","ngIfElse"],["class","fixed bottom-[76px] left-0 right-0 z-10 bg-gray-100 dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 p-2 text-center h-auto min-h-[60px] flex flex-col justify-center shadow-[0_-1px_3px_rgba(0,0,0,0.07)]",4,"ngIf"],[1,"p-4","max-w-md","mx-auto"],[1,"flex","text-center","justify-center","items-center","mb-1"],["class","mr-2 h-8 w-8 flex-shrink-0",4,"ngIf","ngIfElse"],[1,"text-2xl","font-bold","text-gray-800","dark:text-gray-100","truncate",3,"title"],[1,"text-center","mb-2"],[1,"text-sm","text-gray-500","dark:text-gray-400"],["class","text-blue-500 dark:text-blue-400",4,"ngIf"],[4,"ngIf"],["class","ml-2",4,"ngIf"],["class","ml-2 text-purple-500 dark:text-purple-400 italic",4,"ngIf"],["class","text-center mb-3",4,"ngIf"],["class","text-center mb-6 animate-fadeIn",4,"ngIf"],["class","left-0 right-0 z-20 bg-gray-50 dark:bg-gray-950 border-t border-gray-200 dark:border-gray-800 p-3 shadow-[0_-2px_5px_-1px_rgba(0,0,0,0.1)]",4,"ngIf"],[1,"mr-2","h-8","w-8","flex-shrink-0"],["class","w-full h-full object-contain",3,"src","alt","ngClass",4,"ngIf"],[1,"w-full","h-full","object-contain",3,"src","alt","ngClass"],[1,"w-8","h-8","bg-gray-200","dark:bg-gray-700","rounded-md","animate-pulse","mr-2","flex-shrink-0"],[1,"text-blue-500","dark:text-blue-400"],[1,"ml-2"],[1,"ml-2","text-purple-500","dark:text-purple-400","italic"],[1,"text-center","mb-3"],["class","px-2 py-0.5 text-xs font-semibold text-red-700 bg-red-100 dark:bg-red-900 dark:text-red-200 rounded-full",4,"ngIf"],["class","px-2 py-0.5 text-xs font-semibold text-yellow-700 bg-yellow-100 dark:bg-yellow-800 dark:text-yellow-200 rounded-full",4,"ngIf"],[1,"px-2","py-0.5","text-xs","font-semibold","text-red-700","bg-red-100","dark:bg-red-900","dark:text-red-200","rounded-full"],[1,"px-2","py-0.5","text-xs","font-semibold","text-yellow-700","bg-yellow-100","dark:bg-yellow-800","dark:text-yellow-200","rounded-full"],[1,"text-center","mb-6","animate-fadeIn"],[1,"text-xl","font-semibold","text-blue-600","dark:text-blue-400"],[1,"text-4xl","sm:text-5xl","font-bold","text-blue-500","dark:text-blue-300","my-3"],[1,"text-sm","text-gray-600","dark:text-gray-400"],[1,"mt-4","text-xs","text-primary","dark:text-primary-light","hover:underline",3,"click"],[1,"space-y-4","mb-6",3,"formGroup"],[1,"mt-3"],["for","setNotes",1,"block","text-xs","font-medium","text-gray-500","dark:text-gray-400","uppercase","tracking-wider","text-center","mb-1"],["id","setNotes","formControlName","setNotes","rows","2","placeholder","e.g., felt good, struggled on last rep...",1,"w-full","p-2","border","border-gray-300","dark:border-gray-600","rounded-md","shadow-sm","focus:ring-primary","focus:border-primary","dark:bg-gray-800","dark:text-gray-200","text-sm","disabled:opacity-60",3,"disabled"],[1,"block","text-xs","font-medium","text-gray-500","dark:text-gray-400","uppercase","tracking-wider","text-center","mb-1"],[1,"flex","items-center","justify-center","space-x-2"],["type","button",1,"p-3","bg-gray-200","dark:bg-gray-700","rounded-lg","text-gray-700","dark:text-gray-200","hover:bg-gray-300","dark:hover:bg-gray-600","disabled:opacity-50",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M20 12H4"],[1,"w-28","text-center","text-3xl","font-bold","bg-transparent","p-0","text-gray-800","dark:text-gray-100","cursor-pointer","hover:bg-gray-100","dark:hover:bg-gray-800","rounded-md","py-1",3,"click"],["type","number","formControlName","actualWeight",1,"hidden"],[1,"text-lg","text-gray-700","dark:text-gray-200","-ml-1"],["type","button","appLongPress","",1,"p-3","bg-gray-200","dark:bg-gray-700","rounded-lg","text-gray-700","dark:text-gray-200","hover:bg-gray-300","dark:hover:bg-gray-600","disabled:opacity-50",3,"mousedown","longPress","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],["type","number","formControlName","actualReps","readonly","","placeholder","0",1,"w-28","text-center","text-3xl","font-bold","bg-transparent","border-none","p-0","focus:ring-0","text-gray-800","dark:text-gray-100"],["for","timedSetDisplay",1,"block","text-xs","font-medium","text-gray-500","dark:text-gray-400","uppercase","tracking-wider","text-center","mb-2"],["id","timedSetDisplay",1,"mt-1","block","w-full","p-3","border-none","text-3xl","font-bold","text-center","bg-transparent","focus:ring-0",3,"ngClass"],["type","number","formControlName","actualDuration",1,"hidden"],[1,"flex","space-x-2","mt-2","justify-center"],["type","button",1,"flex-grow","max-w-[150px]","text-white","font-medium","py-2","px-3","rounded-full","transition-colors","text-sm","disabled:opacity-50",3,"click","disabled","ngClass"],["type","button","class","flex-grow max-w-[150px] bg-gray-300 hover:bg-gray-400 dark:bg-gray-700 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 font-medium py-2 px-3 rounded-md transition-colors text-sm disabled:opacity-50",3,"disabled","click",4,"ngIf"],["type","button",1,"flex-grow","max-w-[150px]","bg-gray-300","hover:bg-gray-400","dark:bg-gray-700","dark:hover:bg-gray-500","text-gray-800","dark:text-gray-200","font-medium","py-2","px-3","rounded-md","transition-colors","text-sm","disabled:opacity-50",3,"click","disabled"],[1,"left-0","right-0","z-20","bg-gray-50","dark:bg-gray-950","border-t","border-gray-200","dark:border-gray-800","p-3","shadow-[0_-2px_5px_-1px_rgba(0,0,0,0.1)]"],[1,"max-w-md","mx-auto"],[1,"w-full","font-bold","py-3.5","px-4","rounded-full","shadow-md","text-lg","transition-colors","focus:outline-none","focus:ring-2","disabled:opacity-70","text-white",3,"click","disabled","ngClass"],[1,"text-center","py-10","pt-16"],[1,"text-2xl","font-semibold","text-gray-700","dark:text-gray-200"],["class","text-gray-600 dark:text-gray-400 mt-2",4,"ngIf"],["class","mt-6 bg-primary hover:bg-primary-dark text-white font-bold py-3 px-6 rounded-lg shadow-md text-lg transition-colors",3,"click",4,"ngIf"],["routerLink","/workout","class","mt-6 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg shadow-md text-lg transition-colors",4,"ngIf"],["routerLink","/workout","class","mt-6 text-primary dark:text-primary-light hover:underline p-2",4,"ngIf"],[1,"text-gray-600","dark:text-gray-400","mt-2"],[1,"mt-6","bg-primary","hover:bg-primary-dark","text-white","font-bold","py-3","px-6","rounded-lg","shadow-md","text-lg","transition-colors",3,"click"],["routerLink","/workout",1,"mt-6","bg-gray-500","hover:bg-gray-600","text-white","font-bold","py-3","px-6","rounded-lg","shadow-md","text-lg","transition-colors"],["routerLink","/workout",1,"mt-6","text-primary","dark:text-primary-light","hover:underline","p-2"],[1,"fixed","bottom-[76px]","left-0","right-0","z-10","bg-gray-100","dark:bg-gray-900","border-t","border-gray-200","dark:border-gray-700","p-2","text-center","h-auto","min-h-[60px]","flex","flex-col","justify-center","shadow-[0_-1px_3px_rgba(0,0,0,0.07)]"],[1,"max-w-md","mx-auto","w-full"],[1,"text-xs","font-semibold","text-gray-500","dark:text-gray-400","uppercase","tracking-wider"],[1,"text-base","font-medium","text-gray-800","dark:text-gray-100","truncate","px-4",3,"title"],[1,"text-sm","text-gray-600","dark:text-gray-300"],[1,"ml-2","text-xs","text-primary","dark:text-primary-light","hover:underline",3,"click"],[1,"text-xl","font-bold","text-blue-600","dark:text-blue-300"],[1,"mt-0.5","text-xs","text-primary","dark:text-primary-light","hover:underline",3,"click"],[1,"fixed","top-0","left-0","right-0","z-30","bg-gray-50","dark:bg-gray-950","border-b","border-gray-200","dark:border-gray-800","p-4","flex","items-center","justify-between","h-16"],[1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-ml-2",3,"click"],[1,"text-sm","font-semibold","text-gray-700","dark:text-gray-300","uppercase","tracking-wider"],[1,"w-6"],[1,"text-center","py-20","pt-24"],[1,"text-2xl","font-semibold","text-red-600","dark:text-red-400","mb-4"],[1,"text-gray-600","dark:text-gray-400"],["routerLink","/workout",1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-ml-1"],[1,"fixed","inset-0","z-50","bg-black/70","backdrop-blur-md","flex","flex-col","items-center","justify-center","p-4","space-y-2","sm:space-y-3",2,"padding-top","env(safe-area-inset-top)","padding-bottom","env(safe-area-inset-bottom)"],[1,"text-2xl","sm:text-3xl","font-bold","text-white","mb-2"],[1,"w-full","max-w-xs","bg-yellow-500","hover:bg-yellow-600","text-white","font-bold","py-2.5","px-6","rounded-lg","text-lg","shadow-lg","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","max-w-xs","bg-fuchsia-500","hover:bg-fuchsia-600","text-white","font-semibold","py-2","px-6","rounded-lg","text-md","shadow-md","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","max-w-xs","bg-cyan-500","hover:bg-cyan-600","text-white","font-semibold","py-2","px-6","rounded-lg","text-md","shadow-md","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","max-w-xs","bg-sky-500","hover:bg-sky-600","text-white","font-semibold","py-2","px-6","rounded-lg","text-md","shadow-md","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],["class","text-xs text-white ml-2",4,"ngIf"],[1,"w-full","max-w-xs","bg-purple-500","hover:bg-purple-600","text-white","font-semibold","py-2","px-6","rounded-lg","text-md","shadow-md","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","max-w-xs","bg-blue-500","hover:bg-blue-600","text-white","font-semibold","py-2","px-6","rounded-lg","text-md","shadow-md","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","max-w-xs","bg-indigo-500","hover:bg-indigo-600","text-white","font-semibold","py-2","px-6","rounded-lg","text-md","shadow-md","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","max-w-xs","bg-orange-500","hover:bg-orange-600","text-white","font-semibold","py-2","px-6","rounded-lg","text-md","shadow-md","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","max-w-xs","bg-teal-500","hover:bg-teal-600","text-white","font-semibold","py-2","px-6","rounded-lg","text-md","shadow-md","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","max-w-xs","text-red-300","hover:text-red-100","font-medium","py-2","px-6","rounded-lg","border","border-red-400","hover:bg-red-700/50","text-md",3,"click"],[1,"mt-3","text-gray-300","hover:text-white","font-medium","py-2","px-4","rounded-md","text-sm",3,"click"],[1,"text-xs","text-white","ml-2"],[1,"fixed","inset-0","bg-gray-700/80","dark:bg-black/80","backdrop-blur-sm","flex","items-center","justify-center","p-4",2,"z-index","100"],[1,"bg-white","dark:bg-gray-800","rounded-lg","shadow-2xl","w-full","max-w-lg","max-h-[90vh]","flex","flex-col"],[1,"p-4","border-b","border-gray-200","dark:border-gray-700","flex","justify-between","items-center"],[1,"text-xl","font-semibold","text-gray-800","dark:text-gray-100"],[1,"p-1","rounded-full","text-gray-500","hover:text-gray-700","dark:text-gray-400","dark:hover:text-gray-200","hover:bg-gray-200","dark:hover:bg-gray-700","focus:outline-none",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M6 18L18 6M6 6l12 12"],["class","p-4 pt-1 overflow-y-auto",4,"ngIf"],[1,"p-4","border-t","border-gray-200","dark:border-gray-700","text-right"],[1,"bg-primary","hover:bg-primary-dark","text-white","font-semibold","py-2","px-6","rounded-md","text-sm",3,"click"],[1,"p-4","pt-1","overflow-y-auto"],[1,"mb-3"],[1,"text-xs","text-primary","dark:text-primary-light","hover:underline",3,"click"],["class","mb-4 mt-1 space-y-2 max-h-32 overflow-y-auto p-2 border dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700",4,"ngIf"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-2"],["class","col-span-full pt-2 text-xs",4,"ngIf"],["class","col-span-full mt-2 pt-2 border-t border-dashed border-gray-300 dark:border-gray-600 text-xs",4,"ngIf"],["class","col-span-2 md:col-span-2 mt-2 pt-2 border-t border-dashed border-gray-300 dark:border-gray-600",4,"ngIf"],["class","col-span-full mt-2 pt-2 border-t border-dashed border-gray-300 dark:border-gray-600",4,"ngIf"],[1,"mb-4","mt-1","space-y-2","max-h-32","overflow-y-auto","p-2","border","dark:border-gray-600","rounded-md","bg-gray-50","dark:bg-gray-700"],["class","p-1.5 border-b border-gray-200 dark:border-gray-500 last:border-b-0 text-xs",4,"ngFor","ngForOf"],[1,"p-1.5","border-b","border-gray-200","dark:border-gray-500","last:border-b-0","text-xs"],[1,"font-medium","text-gray-600","dark:text-gray-200","mb-0.5"],["class","mr-3",4,"ngIf"],["class","mt-1 text-gray-500 dark:text-gray-400 italic",4,"ngIf"],[1,"mr-3"],[1,"text-gray-700","dark:text-gray-300"],[1,"mt-1","text-gray-500","dark:text-gray-400","italic"],[1,"col-span-full","pt-2","text-xs"],[1,"font-medium","text-gray-500","dark:text-gray-400"],[1,"list-disc","list-inside","ml-2","text-gray-500","dark:text-gray-400"],[1,"text-gray-500","dark:text-gray-400","italic"],[1,"col-span-full","mt-2","pt-2","border-t","border-dashed","border-gray-300","dark:border-gray-600","text-xs"],[1,"font-medium","text-gray-500","dark:text-gray-400","mb-1"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-x-4","gap-y-1"],[4,"ngFor","ngForOf"],[1,"text-gray-500","dark:text-gray-400"],[1,"text-gray-400","dark:text-gray-500","text-2xs","ml-1"],[1,"col-span-2","md:col-span-2","mt-2","pt-2","border-t","border-dashed","border-gray-300","dark:border-gray-600"],[1,"block","text-sm","text-gray-500","dark:text-gray-400","mb-1"],["class","text-2xl font-bold text-gray-800 dark:text-gray-100 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 p-1 rounded",3,"click",4,"ngIf"],["class","flex items-center space-x-1",4,"ngIf"],[1,"text-2xl","font-bold","text-gray-800","dark:text-gray-100","cursor-pointer","hover:bg-gray-100","dark:hover:bg-gray-700","p-1","rounded",3,"click"],[1,"flex","items-center","space-x-1"],["type","number","autofocus","",1,"w-20","p-1","text-xl","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-700","dark:text-gray-100",3,"ngModelChange","keyup.enter","keyup.escape","ngModel"],[1,"p-1","text-green-500","hover:text-green-700",3,"click"],[1,"p-1","text-red-500","hover:text-red-700",3,"click"],[1,"text-lg"],[1,"text-lg","font-semibold","text-gray-800","dark:text-gray-100","p-1"],[1,"col-span-full","mt-2","pt-2","border-t","border-dashed","border-gray-300","dark:border-gray-600"],[1,"text-sm","text-gray-700","dark:text-gray-200","p-1","italic"],[1,"text-center","py-20"],[1,"text-xl","text-gray-600","dark:text-gray-400"]],template:function(e,i){if(e&1){let r=w();S(0,Dr,5,3,"div",4),o(1,"app-full-screen-rest-timer",5),_("timerFinished",function(){return x(r),f(i.handleRestTimerFinished())})("timerSkipped",function(){return x(r),f(i.handleRestTimerSkipped())}),a(),S(2,Mr,27,10,"div",6)(3,cn,12,1,"div",7)(4,mn,3,0,"ng-template",null,0,Y)}if(e&2){let r=K(5);m("ngIf",i.routine()!==void 0)("ngIfElse",r),l(),m("isVisible",i.playerSubState()===i.PlayerSubState.Resting&&i.isRestTimerVisible())("durationSeconds",i.restDuration())("mainText",i.restTimerMainText())("nextUpText",i.restTimerNextUpText()),l(),m("ngIf",i.isWorkoutMenuVisible()),l(),m("ngIf",i.isPerformanceInsightsVisible())}},dependencies:[Q,Oe,ee,Z,te,xe,he,Qe,ze,$e,qe,Ge,je,Je,Ke,Ze,He,tt,st,ot],encapsulation:2})};function pn(s,t){if(s&1&&(o(0,"div",14)(1,"span",15),u(2,"Total Volume:"),a(),o(3,"span",16),u(4),A(5,"number"),a()()),s&2){let e=c(2);l(4),q("",H(5,2,e.sessionTotalVolume(),"1.0-0")," ",e.unitsService.getUnitLabel())}}function gn(s,t){if(s&1&&(o(0,"li",29)(1,"p",30),u(2),a(),o(3,"p",31),u(4),a()()),s&2){let e=t.$implicit;l(2),q("",e.exerciseName," - ",e.pbType," "),l(2),M(e.value)}}function xn(s,t){if(s&1&&(o(0,"div",25)(1,"h2",26),u(2," \u{1F389} New Personal Bests! \u{1F389} "),a(),o(3,"ul",27),S(4,gn,5,3,"li",28),a()()),s&2){let e=c(2);l(4),m("ngForOf",e.sessionPBs())}}function fn(s,t){if(s&1&&(o(0,"div",32)(1,"h3",33),u(2,"Your Notes for this Session:"),a(),o(3,"p",34),u(4),a()()),s&2){let e=c().ngIf;l(4),M(e.notes)}}function hn(s,t){if(s&1){let e=w();me(0),o(1,"div",3)(2,"div",4)(3,"div",5),C(),o(4,"svg",6)(5,"defs")(6,"mask",7),y(7,"rect",8)(8,"path",9),a()(),y(9,"circle",10),a()(),V(),o(10,"h1",11),u(11,"Workout Complete!"),a(),o(12,"p",12),u(13,"Great job on finishing your session."),a()(),o(14,"div",13)(15,"div",14)(16,"span",15),u(17,"Routine:"),a(),o(18,"span",16),u(19),a()(),o(20,"div",14)(21,"span",15),u(22,"Date:"),a(),o(23,"span",16),u(24),A(25,"date"),a()(),o(26,"div",14)(27,"span",15),u(28,"Duration:"),a(),o(29,"span",16),u(30),a()(),S(31,pn,6,5,"div",17),a(),S(32,xn,5,1,"div",18)(33,fn,5,1,"div",19),o(34,"div",20)(35,"button",21),_("click",function(){x(e);let r=c();return f(r.viewFullLog())}),u(36," View Full Log Details "),a(),o(37,"button",22),C(),o(38,"svg",23),y(39,"path",24),a()()()(),pe()}if(s&2){let e=t.ngIf,i=c();l(19),M(e.routineName||"Ad-hoc Workout"),l(5),M(H(25,6,e.startTime,"fullDate")),l(6),k("",e.durationMinutes," minutes"),l(),m("ngIf",i.sessionTotalVolume()>0),l(),m("ngIf",i.sessionPBs().length>0),l(),m("ngIf",e.notes)}}function _n(s,t){s&1&&(o(0,"div",35)(1,"p",36),u(2,"Loading workout summary..."),a()())}var lt=class s{route=E(fe);router=E(ie);trackingService=E(ne);exerciseService=E(se);statsService=E(Ut);unitsService=E(ye);workoutLog=I(void 0);displayExercisesSummary=I([]);sessionPBs=I([]);sessionTotalVolume=I(0);logId;ngOnInit(){(this.logId?ae(this.logId):this.route.paramMap.pipe(we(e=>e.get("logId")))).pipe(ue(e=>e?this.trackingService.getWorkoutLogById(e):ae(null)),le(e=>{e?(this.workoutLog.set(e),this.sessionTotalVolume.set(this.statsService.calculateWorkoutVolume(e)),this.prepareDisplayExercisesSummary(e.exercises),this.identifySessionPBs(e)):(this.workoutLog.set(null),this.displayExercisesSummary.set([]),this.sessionPBs.set([]))})).subscribe()}prepareDisplayExercisesSummary(t){if(!t||t.length===0){this.displayExercisesSummary.set([]);return}let e=t.map(i=>this.exerciseService.getExerciseById(i.exerciseId).pipe(we(r=>{let n=0;return i.sets.forEach(d=>{n+=(d.repsAchieved||0)*(d.weightUsed||0)}),z(G({},i),{baseExercise:r||null,sessionVolume:n})})));mt(e).subscribe({next:i=>this.displayExercisesSummary.set(i),error:i=>{console.error("Error fetching exercise details for summary:",i),this.displayExercisesSummary.set(t.map(r=>z(G({},r),{baseExercise:null,sessionVolume:0})))}})}identifySessionPBs(t){let e=[];this.trackingService.personalBests$.pipe(j(1)).subscribe(i=>{t.exercises.forEach(n=>{let d=i[n.exerciseId];d&&n.sets.forEach(p=>{d.forEach(g=>{g.id===p.id&&g.timestamp===p.timestamp&&p.weightUsed===g.weightUsed&&p.repsAchieved===g.repsAchieved&&e.push({exerciseName:n.exerciseName,pbType:g.pbType,value:this.formatPbValueForSummary(g),isNewOrImproved:!0})})})});let r=Array.from(new Map(e.map(n=>[`${n.exerciseName}-${n.pbType}`,n])).values());this.sessionPBs.set(r)})}formatPbValueForSummary(t){let e="";return t.weightUsed!==void 0&&t.weightUsed!==null&&t.weightUsed!==0?(e+=`${t.weightUsed}kg`,t.repsAchieved>0&&(t.pbType.includes("Heaviest")||t.repsAchieved>1&&!t.pbType.includes("RM"))&&(e+=` x ${t.repsAchieved}`)):t.repsAchieved>0&&t.pbType.includes("Max Reps")?e=`${t.repsAchieved} reps`:t.durationPerformed&&t.durationPerformed>0&&t.pbType.includes("Max Duration")&&(e=`${t.durationPerformed}s`),e||"N/A"}viewFullLog(){this.workoutLog()&&this.router.navigate(["/history/log",this.workoutLog().id])}navigateToRoutines(){this.router.navigate(["/workout"])}startNewWorkout(){this.router.navigate(["/workout"])}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=J({type:s,selectors:[["app-workout-summary"]],inputs:{logId:"logId"},decls:4,vars:2,consts:[["loadingOrNotFoundSummary",""],[1,"container","mx-auto","p-1","py-8"],[4,"ngIf","ngIfElse"],[1,"bg-white","dark:bg-gray-700","rounded-xl","shadow-2xl","p-6","md:p-8","max-w-2xl","mx-auto"],[1,"text-center","mb-8"],[1,"flex","justify-center","text-center"],["width","36","height","36","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg",1,"w-16","h-16","text-green-500","mx-auto","mb-3"],["id","tickCutoutMask"],["x","0","y","0","width","24","height","24","fill","white"],["d","M7.5 12.5L10.5 15.5L16.5 9.5","stroke","black","stroke-width","2.5","stroke-linecap","round","stroke-linejoin","round","fill","none"],["cx","12","cy","12","r","10","fill","#2fd636","mask","url(#tickCutoutMask)"],[1,"text-4xl","font-bold","text-gray-800","dark:text-gray-100"],[1,"text-lg","text-gray-600","dark:text-gray-400","mt-1"],[1,"space-y-4","mb-8"],[1,"flex","justify-between","items-baseline","p-3","bg-gray-50","dark:bg-gray-700","rounded-md"],[1,"text-sm","font-medium","text-gray-600","dark:text-gray-300"],[1,"text-md","font-semibold","text-gray-800","dark:text-gray-100"],["class","flex justify-between items-baseline p-3 bg-gray-50 dark:bg-gray-700 rounded-md",4,"ngIf"],["class","mb-8",4,"ngIf"],["class","mb-8 p-3 bg-yellow-50 dark:bg-yellow-900/30 rounded-md",4,"ngIf"],[1,"mt-8","pt-6","border-t","border-gray-200","dark:border-gray-700","space-y-3","md:space-y-0","md:flex","md:justify-center","md:space-x-4"],[1,"w-full","md:w-auto","flex","items-center","justify-center","px-6","py-3","border","border-transparent","rounded-md","shadow-sm","text-base","font-medium","text-white","bg-primary","hover:bg-primary-dark","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-primary-dark",3,"click"],["routerLink","/history/list",1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-ml-1"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"mb-8"],[1,"text-xl","font-semibold","text-gray-700","dark:text-gray-300","mb-3","text-center","border-b","pb-2","dark:border-gray-700"],[1,"space-y-2","mt-3"],["class","p-2 bg-green-50 dark:bg-green-900/30 rounded-md text-center",4,"ngFor","ngForOf"],[1,"p-2","bg-green-50","dark:bg-green-900/30","rounded-md","text-center"],[1,"text-sm","font-medium","text-green-700","dark:text-green-300"],[1,"text-lg","font-bold","text-green-600","dark:text-green-200"],[1,"mb-8","p-3","bg-yellow-50","dark:bg-yellow-900/30","rounded-md"],[1,"text-sm","font-medium","text-yellow-800","dark:text-yellow-300","mb-1"],[1,"text-sm","text-yellow-700","dark:text-yellow-200","italic","whitespace-pre-line"],[1,"text-center","py-20"],[1,"text-xl","text-gray-600","dark:text-gray-400"]],template:function(e,i){if(e&1&&(o(0,"div",1),S(1,hn,40,9,"ng-container",2)(2,_n,3,0,"ng-template",null,0,Y),a()),e&2){let r=K(3);l(),m("ngIf",i.workoutLog())("ngIfElse",r)}},dependencies:[Q,ee,Z,te,xe,he],encapsulation:2})};var Ao=[{path:"",component:it,title:"My Routines"},{path:"new",component:be,title:"Create New Routine"},{path:"edit/:routineId",component:be,title:"Edit Routine"},{path:"view/:routineId",component:be,title:"View Routine"},{path:"play/:routineId",component:at,title:"Workout Session"},{path:"summary/:logId",component:lt,title:"Workout Summary"}];export{Ao as WORKOUT_TRACKER_ROUTES};
