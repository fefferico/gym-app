import{a as v,b as ne}from"./chunk-GEUFF77W.js";import{a as ee}from"./chunk-W2P3PYWU.js";import{c as O,d as j,f as x,g as h,h as N}from"./chunk-4PTIEP3X.js";import{b as te,e as M,g as re}from"./chunk-TCTC4TXN.js";import{f as Z,h as b,n as oe,o as S}from"./chunk-DIEGCICC.js";import{Ba as L,C as G,Db as q,Eb as U,Fb as J,Ia as k,Ja as u,Ka as w,La as Y,O as A,Ob as Q,S as W,Sa as V,Ta as y,Ua as f,Va as z,W as C,Wa as I,X as D,Y as F,Zb as X,db as $,fb as K,ga as H,na as T,oa as g,wa as B,za as R}from"./chunk-KOY7XQTY.js";import{g as P}from"./chunk-GAL4ENT6.js";var ie=class r{transform(t){return t?.sets?.length?t.sets.some(e=>typeof e.weightUsed=="number"||typeof e.weight=="number"||typeof e.targetWeight=="number"):!1}static \u0275fac=function(e){return new(e||r)};static \u0275pipe=R({name:"isWeighted",type:r,pure:!0})};var de=["*",[["","modal-footer",""]]],pe=["*","[modal-footer]"];function fe(r,t){if(r&1&&(u(0,"h3",11),$(1),w()),r&2){let e=f(3);g(),K(" ",e.modalTitle()," ")}}function ke(r,t){if(r&1){let e=V();u(0,"div",6),L(1,fe,2,1,"h3",7),u(2,"button",8),y("click",function(){C(e);let n=f(2);return D(n.closeModal())}),F(),u(3,"svg",9),Y(4,"path",10),w()()()}if(r&2){let e=f(2);g(),k("ngIf",e.modalTitle())}}function ge(r,t){if(r&1){let e=V();u(0,"div",1),y("click",function(){C(e);let n=f();return D(n.closeModal())}),u(1,"div",2),y("click",function(n){C(e);let i=f();return D(i.onDialogClick(n))}),L(2,ke,5,1,"div",3),u(3,"div",4),I(4),w(),u(5,"div",5),I(6,1),w()()()}if(r&2){let e=f();k("@modalAnimation",e.animationState),g(),k("@dialogAnimation",e.animationState),g(),k("ngIf",e.modalTitle()||!0)}}var se=class r{elementRef=W(H);isOpen=J(!1);modalTitle=U();closed=q();get animationState(){return this.isOpen()?"open":"closed"}closeModal(){this.isOpen.set(!1),this.closed.emit()}onDialogClick(t){t.stopPropagation()}onDocumentMouseDown(t){this.isOpen()&&this.elementRef.nativeElement.contains(t.target)&&t.target.classList.contains("modal-container")&&this.closeModal()}onEscapeKey(){this.isOpen()&&this.closeModal()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=B({type:r,selectors:[["app-modal"]],hostBindings:function(e,o){e&1&&y("mousedown",function(i){return o.onDocumentMouseDown(i)},T)("keydown.escape",function(){return o.onEscapeKey()},T)},inputs:{isOpen:[1,"isOpen"],modalTitle:[1,"modalTitle"]},outputs:{isOpen:"isOpenChange",closed:"closed"},ngContentSelectors:pe,decls:1,vars:1,consts:[["class","modal-container fixed inset-0 z-[1000] flex items-center justify-center bg-black bg-opacity-60",3,"click",4,"ngIf"],[1,"modal-container","fixed","inset-0","z-[1000]","flex","items-center","justify-center","bg-black","bg-opacity-60",3,"click"],[1,"modal-dialog","mx-2","bg-white","dark:bg-gray-800","rounded-md","shadow-xl","min-w-[300px]","w-full","max-w-lg","md:max-w-xl","lg:max-w-2xl","max-h-[90vh]","flex","flex-col","overflow-hidden",3,"click"],["class","modal-header flex items-center justify-between ml-1 p-1 md:p-1 border-gray-200 dark:border-gray-700",4,"ngIf"],[1,"modal-body","p-1","md:p-1","space-y-4","overflow-y-auto","flex-grow"],[1,"modal-footer","flex","items-center","p-4","md:p-5","border-t","border-gray-200","dark:border-gray-700","rounded-b"],[1,"modal-header","flex","items-center","justify-between","ml-1","p-1","md:p-1","border-gray-200","dark:border-gray-700"],["class","text-xl font-semibold text-gray-900 dark:text-white",4,"ngIf"],["type","button","aria-label","Close modal",1,"modal-close-button","text-gray-400","bg-transparent","hover:bg-gray-200","hover:text-gray-900","dark:hover:bg-gray-600","dark:hover:text-white","rounded-md","text-sm","w-8","h-8","ms-auto","inline-flex","justify-center","items-center",3,"click"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 14 14",1,"w-3","h-3"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"],[1,"text-xl","font-semibold","text-gray-900","dark:text-white"]],template:function(e,o){e&1&&(z(de),L(0,ge,7,3,"div",0)),e&2&&k("ngIf",o.isOpen())},dependencies:[X,Q],styles:[".modal-footer[_ngcontent-%COMP%]:empty{display:none}"],data:{animation:[O("modalAnimation",[h("closed",x({opacity:0,visibility:"hidden"})),h("open",x({opacity:1,visibility:"visible"})),N("closed <=> open",[j("300ms ease-in-out")])]),O("dialogAnimation",[h("closed",x({opacity:0,transform:"scale(0.95) translateY(20px)",visibility:"hidden"})),h("open",x({opacity:1,transform:"scale(1) translateY(0)",visibility:"visible"})),N("closed <=> open",[j("300ms ease-in-out")])])]}})};function E(r,t,e){return ee(r,t*7,e)}function le(r){return t=>{let o=(r?Math[r]:Math.trunc)(t);return o===0?0:o}}function me(r,t,e){let o=te(r,t,e)/7;return le(e?.roundingMethod)(o)}function ce(r,t){return Z(r,t?.in).getFullYear()}function _(r,t,e){return E(r,-t,e)}var ue=class r{exerciseService=W(re);constructor(){}calculateSetVolume(t){return(t.repsAchieved||0)*(t.weightUsed||0)}calculateWorkoutVolume(t){let e=0;return t.exercises.forEach(o=>{o.sets.forEach(n=>{e+=this.calculateSetVolume(n)})}),e}calculateTotalVolumeForAllLogs(t){return t.reduce((e,o)=>e+this.calculateWorkoutVolume(o),0)}getWeeklySummaries(t){if(!t||t.length===0)return[];let e=new Map;return t.forEach(o=>{let n=new Date(o.startTime),i=ce(n),s=oe(n,{weekStartsOn:1}),a=`${i}-W${String(s).padStart(2,"0")}`,m=b(n,{weekStartsOn:1}),c=`Week ${s}, ${i}`,d=S(m,"dd/MM"),l=S(ne(m,-6),"dd/MM");e.has(a)||e.set(a,{weekNumber:s,year:i,weekLabel:c,weekLabelStart:d,weekLabelEnd:l,workoutCount:0,totalVolume:0});let p=e.get(a);p.workoutCount++,p.totalVolume+=this.calculateWorkoutVolume(o)}),Array.from(e.values()).sort((o,n)=>o.year===n.year?o.weekNumber-n.weekNumber:o.year-n.year)}getWeeklyVolumeForChart(t){return this.getWeeklySummaries(t).map(o=>({date:new Date(o.year,0,o.weekNumber*7-6),weekLabel:o.weekLabel,totalVolume:o.totalVolume})).sort((o,n)=>o.date.getTime()-n.date.getTime())}getPerformanceByMuscleGroup(t){return P(this,null,function*(){if(!t||t.length===0)return[];let e=new Map,o=yield new Promise(i=>{this.exerciseService.getExercises().pipe(G(1)).subscribe(s=>i(s))}),n=new Map(o.map(i=>[i.id,i]));return t.forEach(i=>{let s=new Set;i.exercises.forEach(a=>{let m=n.get(a.exerciseId);if(m&&m.muscleGroups){let c=a.sets.reduce((d,l)=>d+this.calculateSetVolume(l),0);m.muscleGroups.forEach(d=>{let l=d.toLowerCase().trim();e.has(l)||e.set(l,{volume:0,workoutCountSet:new Set});let p=e.get(l);p.volume+=c,s.add(l)})}}),s.forEach(a=>{e.get(a)?.workoutCountSet.add(i.id)})}),Array.from(e.entries()).map(([i,s])=>({muscleGroup:i,volume:Math.round(s.volume),workoutCount:s.workoutCountSet.size})).sort((i,s)=>s.volume-i.volume)})}calculateCurrentWorkoutStreak(t){let e={length:0};if(!t||t.length===0)return e;let o=[...new Set(t.map(l=>S(b(M(l.date),{weekStartsOn:1}),"yyyy-MM-dd")))].map(l=>M(l)).sort((l,p)=>p.getTime()-l.getTime());if(o.length===0)return e;let n=0,i,s,a=b(new Date,{weekStartsOn:1}),m=_(a,1),c;if(o.some(l=>v(l,a)))n=1,i=a,s=a,c=_(a,1);else if(o.some(p=>v(p,m)))n=1,i=m,s=m,c=_(m,1);else return e;for(let l of o.slice(1))if(v(l,c))n++,s=l,c=_(c,1);else if(me(c,l)>0)break;return{length:n,startDate:s,endDate:i}}calculateLongestWorkoutStreak(t){let e={length:0};if(!t||t.length<1)return e;let o=[...new Set(t.map(a=>S(b(M(a.date),{weekStartsOn:1}),"yyyy-MM-dd")))].map(a=>M(a)).sort((a,m)=>a.getTime()-m.getTime());if(o.length===0)return e;let n={length:0},i=0,s;for(let a=0;a<o.length;a++){let m=o[a];if(a===0)i=1,s=m;else{let c=o[a-1],d=E(c,1);v(m,d)?i++:(i=1,s=m)}i>n.length&&(n={length:i,startDate:s,endDate:m})}return n}static \u0275fac=function(e){return new(e||r)};static \u0275prov=A({token:r,factory:r.\u0275fac,providedIn:"root"})};export{ie as a,se as b,ue as c};
