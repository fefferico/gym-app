import{a as Qe,b as M,c as Je,d as Xe,e as yi,f as et,g as tt,h as it,i as rt,j as bi,k as Si,l as nt,m as wi,n as ki,o as Ci,p as Ei,q as Ii,r as ot,s as st,t as at,v as Di,w as Ri}from"./chunk-FXHFGG6X.js";import{a as we,b as lt}from"./chunk-AUXKSYPA.js";import{a as ke}from"./chunk-LGJQQVXF.js";import{$ as ci,$a as hi,A as X,Aa as ce,Ab as vi,B as he,Ba as ue,C as ai,D as re,Da as w,Ea as y,Fa as p,G as R,H as Be,Hb as Se,I as ee,J as Rt,Ja as Ot,Jb as ne,K as h,Ka as Vt,Kb as Ye,L as ze,La as Lt,M as x,Ma as z,N as v,O as T,Oa as He,Ob as At,P as te,Pa as mi,Q as Te,Qa as c,R as ae,Ra as D,Sa as b,T as C,Ta as L,U as Tt,Ua as Ue,Va as $e,Vb as dt,W as le,Wa as Ze,X as li,Xa as gi,Y as di,Ya as pe,_a as me,a as q,ab as _i,b as K,ba as ui,bb as P,ca as d,cb as fe,d as Y,db as B,e as se,ea as _e,f as De,fb as G,g as I,h as Re,ha as Pt,i as It,ib as Fe,ka as V,kb as Mt,l as Q,la as Ge,lb as xe,m as ie,ma as Pe,mb as ge,nb as fi,o as ni,ob as qe,pa as f,q as Ae,qa as F,qb as ve,r as oi,ra as de,rb as j,s as Ne,sa as Ft,sb as H,t as si,u as Dt,ua as je,ub as xi,va as pi,vb as Ke,w as J,wa as m,wb as ye,xa as l,xb as be,ya as a,z as We,za as k,zb as U}from"./chunk-NCGJLB7D.js";function gr(n,t){if(n&1&&(l(0,"header",7)(1,"h3",8),c(2),a()()),n&2){let e=p(2);d(2),D(e.options.header)}}function hr(n,t){if(n&1){let e=w();l(0,"button",11),y("click",function(){let r=x(e).$implicit,o=p(3);return v(o.onButtonClick(r))}),c(1),a()}if(n&2){let e=t.$implicit,i=p(3);m("ngClass",i.getButtonClass(e)),d(),b(" ",e.text," ")}}function _r(n,t){if(n&1&&(l(0,"footer",9),f(1,hr,2,2,"button",10),a()),n&2){let e=p(2);d(),m("ngForOf",e.options.buttons)}}function fr(n,t){if(n&1){let e=w();l(0,"div",1),y("click",function(){x(e);let r=p();return v(r.onBackdropClick())}),l(1,"div",2),y("click",function(r){return x(e),v(r.stopPropagation())}),f(2,gr,3,1,"header",3),l(3,"main",4)(4,"p",5),c(5),a()(),f(6,_r,2,1,"footer",6),a()()}if(n&2){let e=p();d(),mi(gi("bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md dark:text-gray-200 ",e.options.customCssClass)),d(),m("ngIf",e.options.header),d(3),D(e.options.message),d(),m("ngIf",e.options.buttons&&e.options.buttons.length>0)}}var ct=class n{options=null;dismissed=new F;onEscapeKey(t){t instanceof KeyboardEvent&&this.options?.backdropDismiss!==!1&&this.dismissWith(void 0)}onButtonClick(t){this.dismissWith({role:t.role,data:t.data})}onBackdropClick(){this.options?.backdropDismiss!==!1&&this.dismissWith(void 0)}dismissWith(t){this.dismissed.emit(t)}getButtonClass(t){let e="px-4 py-2 rounded text-sm font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 ";switch(t.cssClass&&(e+=t.cssClass+" "),t.role){case"confirm":e+="bg-indigo-600 hover:bg-indigo-700 text-white focus:ring-indigo-500 dark:bg-indigo-500 dark:hover:bg-indigo-400 dark:focus:ring-indigo-600";break;case"cancel":e+="bg-gray-200 hover:bg-gray-300 text-gray-700 focus:ring-gray-400 dark:bg-gray-600 dark:hover:bg-gray-500 dark:text-gray-200 dark:focus:ring-gray-500";break;default:e+="bg-blue-500 hover:bg-blue-600 text-white focus:ring-blue-400 dark:bg-blue-600 dark:hover:bg-blue-500 dark:focus:ring-blue-500";break}return e}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-alert"]],hostBindings:function(e,i){e&1&&y("keydown.escape",function(o){return i.onEscapeKey(o)},ui)},inputs:{options:"options"},outputs:{dismissed:"dismissed"},decls:1,vars:1,consts:[["class","fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",3,"click",4,"ngIf"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50","p-4",3,"click"],[3,"click"],["class","mb-4",4,"ngIf"],[1,"mb-6"],[1,"text-sm","text-gray-600","dark:text-gray-300","whitespace-pre-wrap"],["class","flex justify-end gap-3",4,"ngIf"],[1,"mb-4"],[1,"text-xl","font-semibold","text-gray-800","dark:text-gray-100"],[1,"flex","justify-end","gap-3"],[3,"ngClass","click",4,"ngFor","ngForOf"],[3,"click","ngClass"]],template:function(e,i){e&1&&f(0,fr,7,6,"div",0),e&2&&m("ngIf",i.options)},dependencies:[U,ve,j,H],styles:["[_nghost-%COMP%]{display:block}","[_nghost-%COMP%]{position:fixed!important;inset:0!important;z-index:9999!important;pointer-events:none}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{pointer-events:auto}"],changeDetection:0})};var Ce=class n{constructor(t,e){this.appRef=t;this.injector=e}alertComponentRef=null;present(t){return Y(this,null,function*(){return this.alertComponentRef&&this.dismiss(void 0),new Promise(e=>{let i=qe(ct,{environmentInjector:this.injector});this.appRef.attachView(i.hostView);let r=i.hostView.rootNodes[0];document.body.appendChild(r),this.alertComponentRef=i,i.instance.options=t,i.instance.dismissed.subscribe(o=>{this.dismiss(o),e(o)}),i.changeDetectorRef.detectChanges()})})}dismiss(t){if(this.alertComponentRef){let e=t?.role,i=this.alertComponentRef.instance.options?.buttons.find(r=>r.role===e);if(i&&i.handler)try{i.handler()}catch(r){console.error("Error in alert button handler:",r)}this.appRef.detachView(this.alertComponentRef.hostView),this.alertComponentRef.destroy(),this.alertComponentRef=null}}showAlert(t,e,i="OK"){return Y(this,null,function*(){yield this.present({header:t,message:e,buttons:[{text:i,role:"confirm"}]})})}showConfirm(t,e,i="OK",r="Annulla"){return Y(this,null,function*(){return yield this.present({header:t,message:e,buttons:[{text:r,role:"cancel"},{text:i,role:"confirm",data:!0}]})})}showCustomAlert(t,e){return Y(this,null,function*(){let i=yield this.present({header:t,message:e,buttons:[{text:"Non fare nulla",role:"cancel",cssClass:"bg-gray-300 hover:bg-gray-500"},{text:"Fai Qualcosa",role:"custom",cssClass:"bg-teal-500 hover:bg-teal-600",handler:()=>{console.log('Handler del bottone "Fai Qualcosa" eseguito!')},data:{action:"custom_action"}},{text:"OK",role:"confirm",data:"ok_confirmed"}],backdropDismiss:!1});i?(console.log("Bottone cliccato:",i?.role,"con dati:",i?.data),i?.role==="confirm"||i?.role):console.log("Allerta personalizzata dismessa (probabilmente ESC se backdropDismiss fosse true)")})}showConfirmationDialog(t,e,i){return Y(this,null,function*(){let r=yield this.present({header:t,message:e,buttons:i||[{text:"Annulla",role:"cancel",cssClass:"bg-gray-300 hover:bg-gray-500"},{text:"OK",role:"confirm",data:"ok_confirmed"}],backdropDismiss:!1});if(r)return console.log("Bottone cliccato:",r?.role,"con dati:",r?.data),r;console.log("Allerta showConfirmationDialog")})}static \u0275fac=function(e){return new(e||n)(Rt(je),Rt(ze))};static \u0275prov=R({token:n,factory:n.\u0275fac,providedIn:"root"})};function xr(n,t){if(n&1&&(l(0,"p",32),c(1),a()),n&2){let e=p().$implicit;m("title",e.description),d(),D(e.description)}}function vr(n,t){if(n&1&&(l(0,"div",33)(1,"span",17),c(2,"Last Performed:"),a(),c(3),P(4,"date"),a()),n&2){let e=p().$implicit;d(3),b(" ",B(4,1,e.lastPerformed,"dd/MM/yyyy HH:mm")," ")}}function yr(n,t){n&1&&(l(0,"div",34),c(1," Not performed yet "),a())}function br(n,t){if(n&1){let e=w();l(0,"div",12),y("click",function(r){let o=x(e).$implicit,s=p(3);return v(s.viewRoutineDetails(o.id,r))}),l(1,"div",13)(2,"h2",14),c(3),a(),f(4,xr,2,2,"p",15),l(5,"div",16)(6,"span",17),c(7,"Goal:"),a(),c(8),P(9,"titlecase"),a(),l(10,"div",18)(11,"span",17),c(12,"Exercises:"),a(),c(13),a(),f(14,vr,5,4,"div",19)(15,yr,2,0,"div",20),l(16,"div",21)(17,"button",22),y("click",function(r){let o=x(e).$implicit,s=p(3);return v(s.startWorkout(o.id,r))}),T(),l(18,"svg",23),k(19,"path",24),a(),c(20," Start "),a(),te(),l(21,"button",25),y("click",function(r){let o=x(e).$implicit,s=p(3);return v(s.viewRoutineDetails(o.id,r))}),T(),l(22,"svg",23),k(23,"path",26)(24,"path",27),a(),c(25," View "),a(),te(),l(26,"button",28),y("click",function(r){let o=x(e).$implicit,s=p(3);return v(s.editRoutine(o.id,r))}),T(),l(27,"svg",23),k(28,"path",29),a(),c(29," Edit "),a(),te(),l(30,"button",30),y("click",function(r){let o=x(e).$implicit,s=p(3);return v(s.deleteRoutine(o.id,r))}),T(),l(31,"svg",23),k(32,"path",31),a(),c(33," Delete "),a()()()()}if(n&2){let e=t.$implicit;d(2),m("title",e.name),d(),D(e.name),d(),m("ngIf",e.description),d(4),b(" ",fe(9,7,e.goal)??"N/A"," "),d(5),b(" ",e.exercises.length," "),d(),m("ngIf",e.lastPerformed),d(),m("ngIf",!e.lastPerformed)}}function Sr(n,t){if(n&1&&(l(0,"div",10),f(1,br,34,9,"div",11),a()),n&2){let e=p().ngIf;d(),m("ngForOf",e)}}function wr(n,t){if(n&1){let e=w();l(0,"div",35),T(),l(1,"svg",36),k(2,"path",37),a(),te(),l(3,"h3",38),c(4,"No Routines Yet!"),a(),l(5,"p",39),c(6,"Get started by creating your first workout routine."),a(),l(7,"button",40),y("click",function(){x(e);let r=p(2);return v(r.navigateToCreateRoutine())}),c(8," Create Your First Routine "),a()()}}function kr(n,t){if(n&1&&(l(0,"div"),f(1,Sr,2,1,"div",9)(2,wr,9,0,"ng-template",null,1,G),a()),n&2){let e=t.ngIf,i=z(3);d(),m("ngIf",e.length>0)("ngIfElse",i)}}function Cr(n,t){n&1&&(l(0,"div",41)(1,"p",42),c(2,"Loading routines..."),a()())}var mt=class n{workoutService=h(we);router=h(ne);alertService=h(Ce);routines$;ADD_DUMMY_DATA_IF_EMPTY=!0;ngOnInit(){window.scrollTo(0,0),this.routines$=this.workoutService.routines$,this.ADD_DUMMY_DATA_IF_EMPTY&&this.routines$.subscribe(t=>{t.length})}navigateToCreateRoutine(){this.router.navigate(["/workout/new"])}editRoutine(t,e){e.stopPropagation(),this.router.navigate(["/workout/edit",t])}deleteRoutine(t,e){e.stopPropagation(),this.alertService.showConfirm("Info","Are you sure you want to delete this routine? This action cannot be undone.").then(i=>{console.log(i),i&&i.data&&(this.workoutService.deleteRoutine(t),this.alertService.showAlert("Info","Routine deleted successfully!"))})}startWorkout(t,e){e.stopPropagation(),this.router.navigate(["/workout/play",t])}viewRoutineDetails(t,e){this.router.navigate(["/workout/view",t]),console.log("Viewing routine details for ID (or navigating to edit):",t)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-routine-list"]],decls:12,vars:4,consts:[["loadingRoutines",""],["noRoutines",""],[1,"container","mx-auto","p-4"],[1,"flex","justify-between","items-center","mb-6","pb-4","border-b","border-gray-200","dark:border-gray-700"],[1,"text-3xl","font-bold","text-gray-800","dark:text-gray-200"],[1,"bg-primary","hover:bg-primary-dark","text-white","font-semibold","py-2","px-4","rounded-md","shadow-md","hover:shadow-lg","transition-all","duration-300","focus:outline-none","focus:ring-2","focus:ring-primary-light","focus:ring-opacity-75",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"w-5","h-5","mr-2","inline-block"],["d","M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z"],[4,"ngIf","ngIfElse"],["class","grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",4,"ngIf","ngIfElse"],[1,"grid","grid-cols-1","md:grid-cols-2","xl:grid-cols-3","gap-6"],["class","bg-white dark:bg-gray-800 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300 cursor-pointer overflow-hidden hover:bg-orange-50 dark:hover:bg-gray-700",3,"click",4,"ngFor","ngForOf"],[1,"bg-white","dark:bg-gray-800","rounded-lg","shadow-lg","hover:shadow-xl","transition-shadow","duration-300","cursor-pointer","overflow-hidden","hover:bg-orange-50","dark:hover:bg-gray-700",3,"click"],[1,"p-4"],[1,"text-xl","font-semibold","mb-2","text-primary","dark:text-primary-light","truncate",3,"title"],["class","text-gray-600 dark:text-gray-400 text-sm mb-3 line-clamp-2",3,"title",4,"ngIf"],[1,"text-xs","text-gray-500","dark:text-gray-200","mb-1"],[1,"font-medium"],[1,"text-xs","text-gray-500","dark:text-gray-200","mb-3"],["class","text-xs text-gray-500 dark:text-gray-200 mb-4",4,"ngIf"],["class","text-xs text-gray-500 dark:text-gray-200 mb-4 italic",4,"ngIf"],[1,"pt-4","mt-4","border-t","text-white","border-gray-200","dark:border-gray-700","flex","flex-col","space-y-2","sm:flex-row","sm:space-y-0","sm:space-x-2","sm:justify-between","items-center"],["title","Start Workout",1,"flex","items-center","justify-center","w-full","p-2","bg-green-500","rounded-md","focus:outline-none","focus:ring-2","focus:ring-green-300","transition-all","duration-150","ease-in-out","hover:bg-green-600","whitespace-nowrap",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-5","mr-1"],["stroke-linecap","round","stroke-linejoin","round","d","M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"],["title","View Details",1,"flex","items-center","justify-center","w-full","p-2","bg-cyan-500","rounded-md","focus:outline-none","focus:ring-2","focus:ring-cyan-300","transition-all","duration-150","ease-in-out","hover:bg-cyan-600","whitespace-nowrap",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"],["stroke-linecap","round","stroke-linejoin","round","d","M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"],["title","Edit Routine",1,"flex","items-center","justify-center","w-full","p-2","bg-yellow-500","rounded-md","focus:outline-none","focus:ring-2","focus:ring-yellow-300","transition-all","duration-150","ease-in-out","hover:bg-yellow-600","whitespace-nowrap",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"],["title","Delete Routine",1,"flex","items-center","justify-center","w-full","p-2","bg-red-500","rounded-md","focus:outline-none","focus:ring-2","focus:ring-red-300","transition-all","duration-150","ease-in-out","hover:bg-red-600","whitespace-nowrap",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"],[1,"text-gray-600","dark:text-gray-400","text-sm","mb-3","line-clamp-2",3,"title"],[1,"text-xs","text-gray-500","dark:text-gray-200","mb-4"],[1,"text-xs","text-gray-500","dark:text-gray-200","mb-4","italic"],[1,"text-center","py-12","px-6","bg-white","dark:bg-gray-800","rounded-lg","shadow-md"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-16","h-16","mx-auto","text-gray-400","dark:text-gray-200","mb-4"],["stroke-linecap","round","stroke-linejoin","round","d","M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 0 1 0 3.75H5.625a1.875 1.875 0 0 1 0-3.75Z"],[1,"text-xl","font-semibold","text-gray-700","dark:text-gray-300","mb-2"],[1,"text-gray-500","dark:text-gray-400","mb-6"],[1,"bg-primary","hover:bg-primary-dark","text-white","font-semibold","py-2","px-6","rounded-md","shadow-md","hover:shadow-lg","transition-all","duration-300","focus:outline-none","focus:ring-2","focus:ring-primary-light","focus:ring-opacity-75",3,"click"],[1,"text-center","py-10"],[1,"text-xl","text-gray-600","dark:text-gray-400"]],template:function(e,i){if(e&1){let r=w();l(0,"div",2)(1,"header",3)(2,"h1",4),c(3,"My Routines"),a(),l(4,"button",5),y("click",function(){return x(r),v(i.navigateToCreateRoutine())}),T(),l(5,"svg",6),k(6,"path",7),a(),c(7," Create New Routine "),a()(),f(8,kr,4,2,"div",8),P(9,"async"),f(10,Cr,3,0,"ng-template",null,0,G),a()}if(e&2){let r=z(11);d(8),m("ngIf",fe(9,2,i.routines$))("ngIfElse",r)}},dependencies:[U,j,H,xi,Ke,ye],encapsulation:2})};var Nt;function Er(){if(Nt==null){let n=typeof document<"u"?document.head:null;Nt=!!(n&&(n.createShadowRoot||n.attachShadow))}return Nt}function gt(n){if(Er()){let t=n.getRootNode?n.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}function Oe(n){return n.composedPath?n.composedPath()[0]:n.target}function Ti(n){return n.buttons===0||n.detail===0}function Pi(n){let t=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0];return!!t&&t.identifier===-1&&(t.radiusX==null||t.radiusX===1)&&(t.radiusY==null||t.radiusY===1)}function ht(n,t=0){return Ir(n)?Number(n):arguments.length===2?t:0}function Ir(n){return!isNaN(parseFloat(n))&&!isNaN(Number(n))}function $(n){return n instanceof le?n.nativeElement:n}function oe(n,t,e,i,r){let o=parseInt(Mt.major),s=parseInt(Mt.minor);return o>19||o===19&&s>0||o===0&&s===0?n.listen(t,e,i,r):(t.addEventListener(e,i,r),()=>{t.removeEventListener(e,i,r)})}var _t=new WeakMap,Fi=(()=>{class n{_appRef;_injector=h(Te);_environmentInjector=h(ze);load(e){let i=this._appRef=this._appRef||this._injector.get(je),r=_t.get(i);r||(r={loaders:new Set,refs:[]},_t.set(i,r),i.onDestroy(()=>{_t.get(i)?.refs.forEach(o=>o.destroy()),_t.delete(i)})),r.loaders.has(e)||(r.loaders.add(e),r.refs.push(qe(e,{environmentInjector:this._environmentInjector})))}static \u0275fac=function(i){return new(i||n)};static \u0275prov=R({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Wt;try{Wt=typeof Intl<"u"&&Intl.v8BreakIterator}catch{Wt=!1}var Bt=(()=>{class n{_platformId=h(di);isBrowser=this._platformId?vi(this._platformId):typeof document=="object"&&!!document;EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent);TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent);BLINK=this.isBrowser&&!!(window.chrome||Wt)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT;WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT;IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window);FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent);ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT;SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT;constructor(){}static \u0275fac=function(i){return new(i||n)};static \u0275prov=R({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Dr=new ee("cdk-dir-doc",{providedIn:"root",factory:Rr});function Rr(){return h(ae)}var Tr=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function Pr(n){let t=n?.toLowerCase()||"";return t==="auto"&&typeof navigator<"u"&&navigator?.language?Tr.test(navigator.language)?"rtl":"ltr":t==="rtl"?"rtl":"ltr"}var zt=(()=>{class n{value="ltr";change=new F;constructor(){let e=h(Dr,{optional:!0});if(e){let i=e.body?e.body.dir:null,r=e.documentElement?e.documentElement.dir:null;this.value=Pr(i||r||"ltr")}}ngOnDestroy(){this.change.complete()}static \u0275fac=function(i){return new(i||n)};static \u0275prov=R({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Or=20,Oi=(()=>{class n{_ngZone=h(de);_platform=h(Bt);_renderer=h(_e).createRenderer(null,null);_cleanupGlobalListener;constructor(){}_scrolled=new I;_scrolledCount=0;scrollContainers=new Map;register(e){this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe(()=>this._scrolled.next(e)))}deregister(e){let i=this.scrollContainers.get(e);i&&(i.unsubscribe(),this.scrollContainers.delete(e))}scrolled(e=Or){return this._platform.isBrowser?new De(i=>{this._cleanupGlobalListener||(this._cleanupGlobalListener=this._ngZone.runOutsideAngular(()=>this._renderer.listen("document","scroll",()=>this._scrolled.next())));let r=e>0?this._scrolled.pipe(Dt(e)).subscribe(i):this._scrolled.subscribe(i);return this._scrolledCount++,()=>{r.unsubscribe(),this._scrolledCount--,this._scrolledCount||(this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0)}}):Q()}ngOnDestroy(){this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0,this.scrollContainers.forEach((e,i)=>this.deregister(i)),this._scrolled.complete()}ancestorScrolled(e,i){let r=this.getAncestorScrollContainers(e);return this.scrolled(i).pipe(si(o=>!o||r.indexOf(o)>-1))}getAncestorScrollContainers(e){let i=[];return this.scrollContainers.forEach((r,o)=>{this._scrollableContainsElement(o,e)&&i.push(o)}),i}_scrollableContainsElement(e,i){let r=$(i),o=e.getElementRef().nativeElement;do if(r==o)return!0;while(r=r.parentElement);return!1}static \u0275fac=function(i){return new(i||n)};static \u0275prov=R({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Vr=20,Vi=(()=>{class n{_platform=h(Bt);_listeners;_viewportSize;_change=new I;_document=h(ae,{optional:!0});constructor(){let e=h(de),i=h(_e).createRenderer(null,null);e.runOutsideAngular(()=>{if(this._platform.isBrowser){let r=o=>this._change.next(o);this._listeners=[i.listen("window","resize",r),i.listen("window","orientationchange",r)]}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){this._listeners?.forEach(e=>e()),this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();let e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}getViewportRect(){let e=this.getViewportScrollPosition(),{width:i,height:r}=this.getViewportSize();return{top:e.top,left:e.left,bottom:e.top+r,right:e.left+i,height:r,width:i}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};let e=this._document,i=this._getWindow(),r=e.documentElement,o=r.getBoundingClientRect(),s=-o.top||e.body.scrollTop||i.scrollY||r.scrollTop||0,u=-o.left||e.body.scrollLeft||i.scrollX||r.scrollLeft||0;return{top:s,left:u}}change(e=Vr){return e>0?this._change.pipe(Dt(e)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){let e=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:e.innerWidth,height:e.innerHeight}:{width:0,height:0}}static \u0275fac=function(i){return new(i||n)};static \u0275prov=R({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Li=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=Ge({type:n});static \u0275inj=Be({})}return n})();var Gt={},Mi=(()=>{class n{_appId=h(li);getId(e){return this._appId!=="ng"&&(e+=this._appId),Gt.hasOwnProperty(e)||(Gt[e]=0),`${e}${Gt[e]++}`}static \u0275fac=function(i){return new(i||n)};static \u0275prov=R({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Ai(n){return Array.isArray(n)?n:[n]}function Ji(n){let t=n.cloneNode(!0),e=t.querySelectorAll("[id]"),i=n.nodeName.toLowerCase();t.removeAttribute("id");for(let r=0;r<e.length;r++)e[r].removeAttribute("id");return i==="canvas"?Bi(n,t):(i==="input"||i==="select"||i==="textarea")&&Wi(n,t),Ni("canvas",n,t,Bi),Ni("input, textarea, select",n,t,Wi),t}function Ni(n,t,e,i){let r=t.querySelectorAll(n);if(r.length){let o=e.querySelectorAll(n);for(let s=0;s<r.length;s++)i(r[s],o[s])}}var Lr=0;function Wi(n,t){t.type!=="file"&&(t.value=n.value),t.type==="radio"&&t.name&&(t.name=`mat-clone-${t.name}-${Lr++}`)}function Bi(n,t){let e=t.getContext("2d");if(e)try{e.drawImage(n,0,0)}catch{}}function Qt(n){let t=n.getBoundingClientRect();return{top:t.top,right:t.right,bottom:t.bottom,left:t.left,width:t.width,height:t.height,x:t.x,y:t.y}}function Ut(n,t,e){let{top:i,bottom:r,left:o,right:s}=n;return e>=i&&e<=r&&t>=o&&t<=s}function Me(n,t,e){n.top+=t,n.bottom=n.top+n.height,n.left+=e,n.right=n.left+n.width}function zi(n,t,e,i){let{top:r,right:o,bottom:s,left:u,width:g,height:_}=n,S=g*t,E=_*t;return i>r-E&&i<s+E&&e>u-S&&e<o+S}var ft=class{_document;positions=new Map;constructor(t){this._document=t}clear(){this.positions.clear()}cache(t){this.clear(),this.positions.set(this._document,{scrollPosition:this.getViewportScrollPosition()}),t.forEach(e=>{this.positions.set(e,{scrollPosition:{top:e.scrollTop,left:e.scrollLeft},clientRect:Qt(e)})})}handleScroll(t){let e=Oe(t),i=this.positions.get(e);if(!i)return null;let r=i.scrollPosition,o,s;if(e===this._document){let _=this.getViewportScrollPosition();o=_.top,s=_.left}else o=e.scrollTop,s=e.scrollLeft;let u=r.top-o,g=r.left-s;return this.positions.forEach((_,S)=>{_.clientRect&&e!==S&&e.contains(S)&&Me(_.clientRect,u,g)}),r.top=o,r.left=s,{top:u,left:g}}getViewportScrollPosition(){return{top:window.scrollY,left:window.scrollX}}};function Xi(n,t){let e=n.rootNodes;if(e.length===1&&e[0].nodeType===t.ELEMENT_NODE)return e[0];let i=t.createElement("div");return e.forEach(r=>i.appendChild(r)),i}function Jt(n,t,e){for(let i in t)if(t.hasOwnProperty(i)){let r=t[i];r?n.setProperty(i,r,e?.has(i)?"important":""):n.removeProperty(i)}return n}function Ee(n,t){let e=t?"":"none";Jt(n.style,{"touch-action":t?"":"none","-webkit-user-drag":t?"":"none","-webkit-tap-highlight-color":t?"":"transparent","user-select":e,"-ms-user-select":e,"-webkit-user-select":e,"-moz-user-select":e})}function Gi(n,t,e){Jt(n.style,{position:t?"":"fixed",top:t?"":"0",opacity:t?"":"0",left:t?"":"-999em"},e)}function xt(n,t){return t&&t!="none"?n+" "+t:n}function ji(n,t){n.style.width=`${t.width}px`,n.style.height=`${t.height}px`,n.style.transform=vt(t.left,t.top)}function vt(n,t){return`translate3d(${Math.round(n)}px, ${Math.round(t)}px, 0)`}function Hi(n){let t=n.toLowerCase().indexOf("ms")>-1?1:1e3;return parseFloat(n)*t}function Mr(n){let t=getComputedStyle(n),e=jt(t,"transition-property"),i=e.find(u=>u==="transform"||u==="all");if(!i)return 0;let r=e.indexOf(i),o=jt(t,"transition-duration"),s=jt(t,"transition-delay");return Hi(o[r])+Hi(s[r])}function jt(n,t){return n.getPropertyValue(t).split(",").map(i=>i.trim())}var Ar=new Set(["position"]),$t=class{_document;_rootElement;_direction;_initialDomRect;_previewTemplate;_previewClass;_pickupPositionOnPage;_initialTransform;_zIndex;_renderer;_previewEmbeddedView;_preview;get element(){return this._preview}constructor(t,e,i,r,o,s,u,g,_,S){this._document=t,this._rootElement=e,this._direction=i,this._initialDomRect=r,this._previewTemplate=o,this._previewClass=s,this._pickupPositionOnPage=u,this._initialTransform=g,this._zIndex=_,this._renderer=S}attach(t){this._preview=this._createPreview(),t.appendChild(this._preview),Ui(this._preview)&&this._preview.showPopover()}destroy(){this._preview.remove(),this._previewEmbeddedView?.destroy(),this._preview=this._previewEmbeddedView=null}setTransform(t){this._preview.style.transform=t}getBoundingClientRect(){return this._preview.getBoundingClientRect()}addClass(t){this._preview.classList.add(t)}getTransitionDuration(){return Mr(this._preview)}addEventListener(t,e){return this._renderer.listen(this._preview,t,e)}_createPreview(){let t=this._previewTemplate,e=this._previewClass,i=t?t.template:null,r;if(i&&t){let o=t.matchSize?this._initialDomRect:null,s=t.viewContainer.createEmbeddedView(i,t.context);s.detectChanges(),r=Xi(s,this._document),this._previewEmbeddedView=s,t.matchSize?ji(r,o):r.style.transform=vt(this._pickupPositionOnPage.x,this._pickupPositionOnPage.y)}else r=Ji(this._rootElement),ji(r,this._initialDomRect),this._initialTransform&&(r.style.transform=this._initialTransform);return Jt(r.style,{"pointer-events":"none",margin:Ui(r)?"0 auto 0 0":"0",position:"fixed",top:"0",left:"0","z-index":this._zIndex+""},Ar),Ee(r,!1),r.classList.add("cdk-drag-preview"),r.setAttribute("popover","manual"),r.setAttribute("dir",this._direction),e&&(Array.isArray(e)?e.forEach(o=>r.classList.add(o)):r.classList.add(e)),r}};function Ui(n){return"showPopover"in n}var Nr={passive:!0},$i={passive:!1},Wr={passive:!1,capture:!0},Br=800,Zi=new Set(["position"]),Zt=class{_config;_document;_ngZone;_viewportRuler;_dragDropRegistry;_renderer;_rootElementCleanups;_cleanupShadowRootSelectStart;_preview;_previewContainer;_placeholderRef;_placeholder;_pickupPositionInElement;_pickupPositionOnPage;_anchor;_passiveTransform={x:0,y:0};_activeTransform={x:0,y:0};_initialTransform;_hasStartedDragging=C(!1);_hasMoved;_initialContainer;_initialIndex;_parentPositions;_moveEvents=new I;_pointerDirectionDelta;_pointerPositionAtLastDirectionChange;_lastKnownPointerPosition;_rootElement;_ownerSVGElement;_rootElementTapHighlight;_pointerMoveSubscription=se.EMPTY;_pointerUpSubscription=se.EMPTY;_scrollSubscription=se.EMPTY;_resizeSubscription=se.EMPTY;_lastTouchEventTime;_dragStartTime;_boundaryElement=null;_nativeInteractionsEnabled=!0;_initialDomRect;_previewRect;_boundaryRect;_previewTemplate;_placeholderTemplate;_handles=[];_disabledHandles=new Set;_dropContainer;_direction="ltr";_parentDragRef;_cachedShadowRoot;lockAxis;dragStartDelay=0;previewClass;scale=1;get disabled(){return this._disabled||!!(this._dropContainer&&this._dropContainer.disabled)}set disabled(t){t!==this._disabled&&(this._disabled=t,this._toggleNativeDragInteractions(),this._handles.forEach(e=>Ee(e,t)))}_disabled=!1;beforeStarted=new I;started=new I;released=new I;ended=new I;entered=new I;exited=new I;dropped=new I;moved=this._moveEvents;data;constrainPosition;constructor(t,e,i,r,o,s,u){this._config=e,this._document=i,this._ngZone=r,this._viewportRuler=o,this._dragDropRegistry=s,this._renderer=u,this.withRootElement(t).withParent(e.parentDragRef||null),this._parentPositions=new ft(i),s.registerDragItem(this)}getPlaceholderElement(){return this._placeholder}getRootElement(){return this._rootElement}getVisibleElement(){return this.isDragging()?this.getPlaceholderElement():this.getRootElement()}withHandles(t){this._handles=t.map(i=>$(i)),this._handles.forEach(i=>Ee(i,this.disabled)),this._toggleNativeDragInteractions();let e=new Set;return this._disabledHandles.forEach(i=>{this._handles.indexOf(i)>-1&&e.add(i)}),this._disabledHandles=e,this}withPreviewTemplate(t){return this._previewTemplate=t,this}withPlaceholderTemplate(t){return this._placeholderTemplate=t,this}withRootElement(t){let e=$(t);return e!==this._rootElement&&(this._removeRootElementListeners(),this._rootElementCleanups=this._ngZone.runOutsideAngular(()=>[oe(this._renderer,e,"mousedown",this._pointerDown,$i),oe(this._renderer,e,"touchstart",this._pointerDown,Nr),oe(this._renderer,e,"dragstart",this._nativeDragStart,$i)]),this._initialTransform=void 0,this._rootElement=e),typeof SVGElement<"u"&&this._rootElement instanceof SVGElement&&(this._ownerSVGElement=this._rootElement.ownerSVGElement),this}withBoundaryElement(t){return this._boundaryElement=t?$(t):null,this._resizeSubscription.unsubscribe(),t&&(this._resizeSubscription=this._viewportRuler.change(10).subscribe(()=>this._containInsideBoundaryOnResize())),this}withParent(t){return this._parentDragRef=t,this}dispose(){this._removeRootElementListeners(),this.isDragging()&&this._rootElement?.remove(),this._anchor?.remove(),this._destroyPreview(),this._destroyPlaceholder(),this._dragDropRegistry.removeDragItem(this),this._removeListeners(),this.beforeStarted.complete(),this.started.complete(),this.released.complete(),this.ended.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this._moveEvents.complete(),this._handles=[],this._disabledHandles.clear(),this._dropContainer=void 0,this._resizeSubscription.unsubscribe(),this._parentPositions.clear(),this._boundaryElement=this._rootElement=this._ownerSVGElement=this._placeholderTemplate=this._previewTemplate=this._anchor=this._parentDragRef=null}isDragging(){return this._hasStartedDragging()&&this._dragDropRegistry.isDragging(this)}reset(){this._rootElement.style.transform=this._initialTransform||"",this._activeTransform={x:0,y:0},this._passiveTransform={x:0,y:0}}disableHandle(t){!this._disabledHandles.has(t)&&this._handles.indexOf(t)>-1&&(this._disabledHandles.add(t),Ee(t,!0))}enableHandle(t){this._disabledHandles.has(t)&&(this._disabledHandles.delete(t),Ee(t,this.disabled))}withDirection(t){return this._direction=t,this}_withDropContainer(t){this._dropContainer=t}getFreeDragPosition(){let t=this.isDragging()?this._activeTransform:this._passiveTransform;return{x:t.x,y:t.y}}setFreeDragPosition(t){return this._activeTransform={x:0,y:0},this._passiveTransform.x=t.x,this._passiveTransform.y=t.y,this._dropContainer||this._applyRootElementTransform(t.x,t.y),this}withPreviewContainer(t){return this._previewContainer=t,this}_sortFromLastPointerPosition(){let t=this._lastKnownPointerPosition;t&&this._dropContainer&&this._updateActiveDropContainer(this._getConstrainedPointerPosition(t),t)}_removeListeners(){this._pointerMoveSubscription.unsubscribe(),this._pointerUpSubscription.unsubscribe(),this._scrollSubscription.unsubscribe(),this._cleanupShadowRootSelectStart?.(),this._cleanupShadowRootSelectStart=void 0}_destroyPreview(){this._preview?.destroy(),this._preview=null}_destroyPlaceholder(){this._placeholder?.remove(),this._placeholderRef?.destroy(),this._placeholder=this._placeholderRef=null}_pointerDown=t=>{if(this.beforeStarted.next(),this._handles.length){let e=this._getTargetHandle(t);e&&!this._disabledHandles.has(e)&&!this.disabled&&this._initializeDragSequence(e,t)}else this.disabled||this._initializeDragSequence(this._rootElement,t)};_pointerMove=t=>{let e=this._getPointerPositionOnPage(t);if(!this._hasStartedDragging()){let r=Math.abs(e.x-this._pickupPositionOnPage.x),o=Math.abs(e.y-this._pickupPositionOnPage.y);if(r+o>=this._config.dragStartThreshold){let u=Date.now()>=this._dragStartTime+this._getDragStartDelay(t),g=this._dropContainer;if(!u){this._endDragSequence(t);return}(!g||!g.isDragging()&&!g.isReceiving())&&(t.cancelable&&t.preventDefault(),this._hasStartedDragging.set(!0),this._ngZone.run(()=>this._startDragSequence(t)))}return}t.cancelable&&t.preventDefault();let i=this._getConstrainedPointerPosition(e);if(this._hasMoved=!0,this._lastKnownPointerPosition=e,this._updatePointerDirectionDelta(i),this._dropContainer)this._updateActiveDropContainer(i,e);else{let r=this.constrainPosition?this._initialDomRect:this._pickupPositionOnPage,o=this._activeTransform;o.x=i.x-r.x+this._passiveTransform.x,o.y=i.y-r.y+this._passiveTransform.y,this._applyRootElementTransform(o.x,o.y)}this._moveEvents.observers.length&&this._ngZone.run(()=>{this._moveEvents.next({source:this,pointerPosition:i,event:t,distance:this._getDragDistance(i),delta:this._pointerDirectionDelta})})};_pointerUp=t=>{this._endDragSequence(t)};_endDragSequence(t){if(this._dragDropRegistry.isDragging(this)&&(this._removeListeners(),this._dragDropRegistry.stopDragging(this),this._toggleNativeDragInteractions(),this._handles&&(this._rootElement.style.webkitTapHighlightColor=this._rootElementTapHighlight),!!this._hasStartedDragging()))if(this.released.next({source:this,event:t}),this._dropContainer)this._dropContainer._stopScrolling(),this._animatePreviewToPlaceholder().then(()=>{this._cleanupDragArtifacts(t),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)});else{this._passiveTransform.x=this._activeTransform.x;let e=this._getPointerPositionOnPage(t);this._passiveTransform.y=this._activeTransform.y,this._ngZone.run(()=>{this.ended.next({source:this,distance:this._getDragDistance(e),dropPoint:e,event:t})}),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)}}_startDragSequence(t){Ve(t)&&(this._lastTouchEventTime=Date.now()),this._toggleNativeDragInteractions();let e=this._getShadowRoot(),i=this._dropContainer;if(e&&this._ngZone.runOutsideAngular(()=>{this._cleanupShadowRootSelectStart=oe(this._renderer,e,"selectstart",zr,Wr)}),i){let r=this._rootElement,o=r.parentNode,s=this._placeholder=this._createPlaceholderElement(),u=this._anchor=this._anchor||this._document.createComment("");o.insertBefore(u,r),this._initialTransform=r.style.transform||"",this._preview=new $t(this._document,this._rootElement,this._direction,this._initialDomRect,this._previewTemplate||null,this.previewClass||null,this._pickupPositionOnPage,this._initialTransform,this._config.zIndex||1e3,this._renderer),this._preview.attach(this._getPreviewInsertionPoint(o,e)),Gi(r,!1,Zi),this._document.body.appendChild(o.replaceChild(s,r)),this.started.next({source:this,event:t}),i.start(),this._initialContainer=i,this._initialIndex=i.getItemIndex(this)}else this.started.next({source:this,event:t}),this._initialContainer=this._initialIndex=void 0;this._parentPositions.cache(i?i.getScrollableParents():[])}_initializeDragSequence(t,e){this._parentDragRef&&e.stopPropagation();let i=this.isDragging(),r=Ve(e),o=!r&&e.button!==0,s=this._rootElement,u=Oe(e),g=!r&&this._lastTouchEventTime&&this._lastTouchEventTime+Br>Date.now(),_=r?Pi(e):Ti(e);if(u&&u.draggable&&e.type==="mousedown"&&e.preventDefault(),i||o||g||_)return;if(this._handles.length){let Z=s.style;this._rootElementTapHighlight=Z.webkitTapHighlightColor||"",Z.webkitTapHighlightColor="transparent"}this._hasMoved=!1,this._hasStartedDragging.set(this._hasMoved),this._removeListeners(),this._initialDomRect=this._rootElement.getBoundingClientRect(),this._pointerMoveSubscription=this._dragDropRegistry.pointerMove.subscribe(this._pointerMove),this._pointerUpSubscription=this._dragDropRegistry.pointerUp.subscribe(this._pointerUp),this._scrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(Z=>this._updateOnScroll(Z)),this._boundaryElement&&(this._boundaryRect=Qt(this._boundaryElement));let S=this._previewTemplate;this._pickupPositionInElement=S&&S.template&&!S.matchSize?{x:0,y:0}:this._getPointerPositionInElement(this._initialDomRect,t,e);let E=this._pickupPositionOnPage=this._lastKnownPointerPosition=this._getPointerPositionOnPage(e);this._pointerDirectionDelta={x:0,y:0},this._pointerPositionAtLastDirectionChange={x:E.x,y:E.y},this._dragStartTime=Date.now(),this._dragDropRegistry.startDragging(this,e)}_cleanupDragArtifacts(t){Gi(this._rootElement,!0,Zi),this._anchor.parentNode.replaceChild(this._rootElement,this._anchor),this._destroyPreview(),this._destroyPlaceholder(),this._initialDomRect=this._boundaryRect=this._previewRect=this._initialTransform=void 0,this._ngZone.run(()=>{let e=this._dropContainer,i=e.getItemIndex(this),r=this._getPointerPositionOnPage(t),o=this._getDragDistance(r),s=e._isOverContainer(r.x,r.y);this.ended.next({source:this,distance:o,dropPoint:r,event:t}),this.dropped.next({item:this,currentIndex:i,previousIndex:this._initialIndex,container:e,previousContainer:this._initialContainer,isPointerOverContainer:s,distance:o,dropPoint:r,event:t}),e.drop(this,i,this._initialIndex,this._initialContainer,s,o,r,t),this._dropContainer=this._initialContainer})}_updateActiveDropContainer({x:t,y:e},{x:i,y:r}){let o=this._initialContainer._getSiblingContainerFromPosition(this,t,e);!o&&this._dropContainer!==this._initialContainer&&this._initialContainer._isOverContainer(t,e)&&(o=this._initialContainer),o&&o!==this._dropContainer&&this._ngZone.run(()=>{this.exited.next({item:this,container:this._dropContainer}),this._dropContainer.exit(this),this._dropContainer=o,this._dropContainer.enter(this,t,e,o===this._initialContainer&&o.sortingDisabled?this._initialIndex:void 0),this.entered.next({item:this,container:o,currentIndex:o.getItemIndex(this)})}),this.isDragging()&&(this._dropContainer._startScrollingIfNecessary(i,r),this._dropContainer._sortItem(this,t,e,this._pointerDirectionDelta),this.constrainPosition?this._applyPreviewTransform(t,e):this._applyPreviewTransform(t-this._pickupPositionInElement.x,e-this._pickupPositionInElement.y))}_animatePreviewToPlaceholder(){if(!this._hasMoved)return Promise.resolve();let t=this._placeholder.getBoundingClientRect();this._preview.addClass("cdk-drag-animating"),this._applyPreviewTransform(t.left,t.top);let e=this._preview.getTransitionDuration();return e===0?Promise.resolve():this._ngZone.runOutsideAngular(()=>new Promise(i=>{let r=u=>{(!u||this._preview&&Oe(u)===this._preview.element&&u.propertyName==="transform")&&(s(),i(),clearTimeout(o))},o=setTimeout(r,e*1.5),s=this._preview.addEventListener("transitionend",r)}))}_createPlaceholderElement(){let t=this._placeholderTemplate,e=t?t.template:null,i;return e?(this._placeholderRef=t.viewContainer.createEmbeddedView(e,t.context),this._placeholderRef.detectChanges(),i=Xi(this._placeholderRef,this._document)):i=Ji(this._rootElement),i.style.pointerEvents="none",i.classList.add("cdk-drag-placeholder"),i}_getPointerPositionInElement(t,e,i){let r=e===this._rootElement?null:e,o=r?r.getBoundingClientRect():t,s=Ve(i)?i.targetTouches[0]:i,u=this._getViewportScrollPosition(),g=s.pageX-o.left-u.left,_=s.pageY-o.top-u.top;return{x:o.left-t.left+g,y:o.top-t.top+_}}_getPointerPositionOnPage(t){let e=this._getViewportScrollPosition(),i=Ve(t)?t.touches[0]||t.changedTouches[0]||{pageX:0,pageY:0}:t,r=i.pageX-e.left,o=i.pageY-e.top;if(this._ownerSVGElement){let s=this._ownerSVGElement.getScreenCTM();if(s){let u=this._ownerSVGElement.createSVGPoint();return u.x=r,u.y=o,u.matrixTransform(s.inverse())}}return{x:r,y:o}}_getConstrainedPointerPosition(t){let e=this._dropContainer?this._dropContainer.lockAxis:null,{x:i,y:r}=this.constrainPosition?this.constrainPosition(t,this,this._initialDomRect,this._pickupPositionInElement):t;if(this.lockAxis==="x"||e==="x"?r=this._pickupPositionOnPage.y-(this.constrainPosition?this._pickupPositionInElement.y:0):(this.lockAxis==="y"||e==="y")&&(i=this._pickupPositionOnPage.x-(this.constrainPosition?this._pickupPositionInElement.x:0)),this._boundaryRect){let{x:o,y:s}=this.constrainPosition?{x:0,y:0}:this._pickupPositionInElement,u=this._boundaryRect,{width:g,height:_}=this._getPreviewRect(),S=u.top+s,E=u.bottom-(_-s),Z=u.left+o,Ct=u.right-(g-o);i=qi(i,Z,Ct),r=qi(r,S,E)}return{x:i,y:r}}_updatePointerDirectionDelta(t){let{x:e,y:i}=t,r=this._pointerDirectionDelta,o=this._pointerPositionAtLastDirectionChange,s=Math.abs(e-o.x),u=Math.abs(i-o.y);return s>this._config.pointerDirectionChangeThreshold&&(r.x=e>o.x?1:-1,o.x=e),u>this._config.pointerDirectionChangeThreshold&&(r.y=i>o.y?1:-1,o.y=i),r}_toggleNativeDragInteractions(){if(!this._rootElement||!this._handles)return;let t=this._handles.length>0||!this.isDragging();t!==this._nativeInteractionsEnabled&&(this._nativeInteractionsEnabled=t,Ee(this._rootElement,t))}_removeRootElementListeners(){this._rootElementCleanups?.forEach(t=>t()),this._rootElementCleanups=void 0}_applyRootElementTransform(t,e){let i=1/this.scale,r=vt(t*i,e*i),o=this._rootElement.style;this._initialTransform==null&&(this._initialTransform=o.transform&&o.transform!="none"?o.transform:""),o.transform=xt(r,this._initialTransform)}_applyPreviewTransform(t,e){let i=this._previewTemplate?.template?void 0:this._initialTransform,r=vt(t,e);this._preview.setTransform(xt(r,i))}_getDragDistance(t){let e=this._pickupPositionOnPage;return e?{x:t.x-e.x,y:t.y-e.y}:{x:0,y:0}}_cleanupCachedDimensions(){this._boundaryRect=this._previewRect=void 0,this._parentPositions.clear()}_containInsideBoundaryOnResize(){let{x:t,y:e}=this._passiveTransform;if(t===0&&e===0||this.isDragging()||!this._boundaryElement)return;let i=this._rootElement.getBoundingClientRect(),r=this._boundaryElement.getBoundingClientRect();if(r.width===0&&r.height===0||i.width===0&&i.height===0)return;let o=r.left-i.left,s=i.right-r.right,u=r.top-i.top,g=i.bottom-r.bottom;r.width>i.width?(o>0&&(t+=o),s>0&&(t-=s)):t=0,r.height>i.height?(u>0&&(e+=u),g>0&&(e-=g)):e=0,(t!==this._passiveTransform.x||e!==this._passiveTransform.y)&&this.setFreeDragPosition({y:e,x:t})}_getDragStartDelay(t){let e=this.dragStartDelay;return typeof e=="number"?e:Ve(t)?e.touch:e?e.mouse:0}_updateOnScroll(t){let e=this._parentPositions.handleScroll(t);if(e){let i=Oe(t);this._boundaryRect&&i!==this._boundaryElement&&i.contains(this._boundaryElement)&&Me(this._boundaryRect,e.top,e.left),this._pickupPositionOnPage.x+=e.left,this._pickupPositionOnPage.y+=e.top,this._dropContainer||(this._activeTransform.x-=e.left,this._activeTransform.y-=e.top,this._applyRootElementTransform(this._activeTransform.x,this._activeTransform.y))}}_getViewportScrollPosition(){return this._parentPositions.positions.get(this._document)?.scrollPosition||this._parentPositions.getViewportScrollPosition()}_getShadowRoot(){return this._cachedShadowRoot===void 0&&(this._cachedShadowRoot=gt(this._rootElement)),this._cachedShadowRoot}_getPreviewInsertionPoint(t,e){let i=this._previewContainer||"global";if(i==="parent")return t;if(i==="global"){let r=this._document;return e||r.fullscreenElement||r.webkitFullscreenElement||r.mozFullScreenElement||r.msFullscreenElement||r.body}return $(i)}_getPreviewRect(){return(!this._previewRect||!this._previewRect.width&&!this._previewRect.height)&&(this._previewRect=this._preview?this._preview.getBoundingClientRect():this._initialDomRect),this._previewRect}_nativeDragStart=t=>{if(this._handles.length){let e=this._getTargetHandle(t);e&&!this._disabledHandles.has(e)&&!this.disabled&&t.preventDefault()}else this.disabled||t.preventDefault()};_getTargetHandle(t){return this._handles.find(e=>t.target&&(t.target===e||e.contains(t.target)))}};function qi(n,t,e){return Math.max(t,Math.min(e,n))}function Ve(n){return n.type[0]==="t"}function zr(n){n.preventDefault()}function bt(n,t,e){let i=Ki(t,n.length-1),r=Ki(e,n.length-1);if(i===r)return;let o=n[i],s=r<i?-1:1;for(let u=i;u!==r;u+=s)n[u]=n[u+s];n[r]=o}function Ki(n,t){return Math.max(0,Math.min(t,n))}var yt=class{_dragDropRegistry;_element;_sortPredicate;_itemPositions=[];_activeDraggables;orientation="vertical";direction;constructor(t){this._dragDropRegistry=t}_previousSwap={drag:null,delta:0,overlaps:!1};start(t){this.withItems(t)}sort(t,e,i,r){let o=this._itemPositions,s=this._getItemIndexFromPointerPosition(t,e,i,r);if(s===-1&&o.length>0)return null;let u=this.orientation==="horizontal",g=o.findIndex(A=>A.drag===t),_=o[s],S=o[g].clientRect,E=_.clientRect,Z=g>s?1:-1,Ct=this._getItemOffsetPx(S,E,Z),ur=this._getSiblingOffsetPx(g,o,Z),pr=o.slice();return bt(o,g,s),o.forEach((A,mr)=>{if(pr[mr]===A)return;let ti=A.drag===t,Et=ti?Ct:ur,ii=ti?t.getPlaceholderElement():A.drag.getRootElement();A.offset+=Et;let ri=Math.round(A.offset*(1/A.drag.scale));u?(ii.style.transform=xt(`translate3d(${ri}px, 0, 0)`,A.initialTransform),Me(A.clientRect,0,Et)):(ii.style.transform=xt(`translate3d(0, ${ri}px, 0)`,A.initialTransform),Me(A.clientRect,Et,0))}),this._previousSwap.overlaps=Ut(E,e,i),this._previousSwap.drag=_.drag,this._previousSwap.delta=u?r.x:r.y,{previousIndex:g,currentIndex:s}}enter(t,e,i,r){let o=r==null||r<0?this._getItemIndexFromPointerPosition(t,e,i):r,s=this._activeDraggables,u=s.indexOf(t),g=t.getPlaceholderElement(),_=s[o];if(_===t&&(_=s[o+1]),!_&&(o==null||o===-1||o<s.length-1)&&this._shouldEnterAsFirstChild(e,i)&&(_=s[0]),u>-1&&s.splice(u,1),_&&!this._dragDropRegistry.isDragging(_)){let S=_.getRootElement();S.parentElement.insertBefore(g,S),s.splice(o,0,t)}else this._element.appendChild(g),s.push(t);g.style.transform="",this._cacheItemPositions()}withItems(t){this._activeDraggables=t.slice(),this._cacheItemPositions()}withSortPredicate(t){this._sortPredicate=t}reset(){this._activeDraggables?.forEach(t=>{let e=t.getRootElement();if(e){let i=this._itemPositions.find(r=>r.drag===t)?.initialTransform;e.style.transform=i||""}}),this._itemPositions=[],this._activeDraggables=[],this._previousSwap.drag=null,this._previousSwap.delta=0,this._previousSwap.overlaps=!1}getActiveItemsSnapshot(){return this._activeDraggables}getItemIndex(t){return(this.orientation==="horizontal"&&this.direction==="rtl"?this._itemPositions.slice().reverse():this._itemPositions).findIndex(i=>i.drag===t)}updateOnScroll(t,e){this._itemPositions.forEach(({clientRect:i})=>{Me(i,t,e)}),this._itemPositions.forEach(({drag:i})=>{this._dragDropRegistry.isDragging(i)&&i._sortFromLastPointerPosition()})}withElementContainer(t){this._element=t}_cacheItemPositions(){let t=this.orientation==="horizontal";this._itemPositions=this._activeDraggables.map(e=>{let i=e.getVisibleElement();return{drag:e,offset:0,initialTransform:i.style.transform||"",clientRect:Qt(i)}}).sort((e,i)=>t?e.clientRect.left-i.clientRect.left:e.clientRect.top-i.clientRect.top)}_getItemOffsetPx(t,e,i){let r=this.orientation==="horizontal",o=r?e.left-t.left:e.top-t.top;return i===-1&&(o+=r?e.width-t.width:e.height-t.height),o}_getSiblingOffsetPx(t,e,i){let r=this.orientation==="horizontal",o=e[t].clientRect,s=e[t+i*-1],u=o[r?"width":"height"]*i;if(s){let g=r?"left":"top",_=r?"right":"bottom";i===-1?u-=s.clientRect[g]-o[_]:u+=o[g]-s.clientRect[_]}return u}_shouldEnterAsFirstChild(t,e){if(!this._activeDraggables.length)return!1;let i=this._itemPositions,r=this.orientation==="horizontal";if(i[0].drag!==this._activeDraggables[0]){let s=i[i.length-1].clientRect;return r?t>=s.right:e>=s.bottom}else{let s=i[0].clientRect;return r?t<=s.left:e<=s.top}}_getItemIndexFromPointerPosition(t,e,i,r){let o=this.orientation==="horizontal",s=this._itemPositions.findIndex(({drag:u,clientRect:g})=>{if(u===t)return!1;if(r){let _=o?r.x:r.y;if(u===this._previousSwap.drag&&this._previousSwap.overlaps&&_===this._previousSwap.delta)return!1}return o?e>=Math.floor(g.left)&&e<Math.floor(g.right):i>=Math.floor(g.top)&&i<Math.floor(g.bottom)});return s===-1||!this._sortPredicate(s,t)?-1:s}},qt=class{_document;_dragDropRegistry;_element;_sortPredicate;_rootNode;_activeItems;_previousSwap={drag:null,deltaX:0,deltaY:0,overlaps:!1};_relatedNodes=[];constructor(t,e){this._document=t,this._dragDropRegistry=e}start(t){let e=this._element.childNodes;this._relatedNodes=[];for(let i=0;i<e.length;i++){let r=e[i];this._relatedNodes.push([r,r.nextSibling])}this.withItems(t)}sort(t,e,i,r){let o=this._getItemIndexFromPointerPosition(t,e,i),s=this._previousSwap;if(o===-1||this._activeItems[o]===t)return null;let u=this._activeItems[o];if(s.drag===u&&s.overlaps&&s.deltaX===r.x&&s.deltaY===r.y)return null;let g=this.getItemIndex(t),_=t.getPlaceholderElement(),S=u.getRootElement();o>g?S.after(_):S.before(_),bt(this._activeItems,g,o);let E=this._getRootNode().elementFromPoint(e,i);return s.deltaX=r.x,s.deltaY=r.y,s.drag=u,s.overlaps=S===E||S.contains(E),{previousIndex:g,currentIndex:o}}enter(t,e,i,r){let o=r==null||r<0?this._getItemIndexFromPointerPosition(t,e,i):r;o===-1&&(o=this._getClosestItemIndexToPointer(t,e,i));let s=this._activeItems[o],u=this._activeItems.indexOf(t);u>-1&&this._activeItems.splice(u,1),s&&!this._dragDropRegistry.isDragging(s)?(this._activeItems.splice(o,0,t),s.getRootElement().before(t.getPlaceholderElement())):(this._activeItems.push(t),this._element.appendChild(t.getPlaceholderElement()))}withItems(t){this._activeItems=t.slice()}withSortPredicate(t){this._sortPredicate=t}reset(){let t=this._element,e=this._previousSwap;for(let i=this._relatedNodes.length-1;i>-1;i--){let[r,o]=this._relatedNodes[i];r.parentNode===t&&r.nextSibling!==o&&(o===null?t.appendChild(r):o.parentNode===t&&t.insertBefore(r,o))}this._relatedNodes=[],this._activeItems=[],e.drag=null,e.deltaX=e.deltaY=0,e.overlaps=!1}getActiveItemsSnapshot(){return this._activeItems}getItemIndex(t){return this._activeItems.indexOf(t)}updateOnScroll(){this._activeItems.forEach(t=>{this._dragDropRegistry.isDragging(t)&&t._sortFromLastPointerPosition()})}withElementContainer(t){t!==this._element&&(this._element=t,this._rootNode=void 0)}_getItemIndexFromPointerPosition(t,e,i){let r=this._getRootNode().elementFromPoint(Math.floor(e),Math.floor(i)),o=r?this._activeItems.findIndex(s=>{let u=s.getRootElement();return r===u||u.contains(r)}):-1;return o===-1||!this._sortPredicate(o,t)?-1:o}_getRootNode(){return this._rootNode||(this._rootNode=gt(this._element)||this._document),this._rootNode}_getClosestItemIndexToPointer(t,e,i){if(this._activeItems.length===0)return-1;if(this._activeItems.length===1)return 0;let r=1/0,o=-1;for(let s=0;s<this._activeItems.length;s++){let u=this._activeItems[s];if(u!==t){let{x:g,y:_}=u.getRootElement().getBoundingClientRect(),S=Math.hypot(e-g,i-_);S<r&&(r=S,o=s)}}return o}},Yi=.05,er=.05,W=function(n){return n[n.NONE=0]="NONE",n[n.UP=1]="UP",n[n.DOWN=2]="DOWN",n}(W||{}),O=function(n){return n[n.NONE=0]="NONE",n[n.LEFT=1]="LEFT",n[n.RIGHT=2]="RIGHT",n}(O||{}),Kt=class{_dragDropRegistry;_ngZone;_viewportRuler;element;disabled=!1;sortingDisabled=!1;lockAxis;autoScrollDisabled=!1;autoScrollStep=2;enterPredicate=()=>!0;sortPredicate=()=>!0;beforeStarted=new I;entered=new I;exited=new I;dropped=new I;sorted=new I;receivingStarted=new I;receivingStopped=new I;data;_container;_isDragging=!1;_parentPositions;_sortStrategy;_domRect;_draggables=[];_siblings=[];_activeSiblings=new Set;_viewportScrollSubscription=se.EMPTY;_verticalScrollDirection=W.NONE;_horizontalScrollDirection=O.NONE;_scrollNode;_stopScrollTimers=new I;_cachedShadowRoot=null;_document;_scrollableElements=[];_initialScrollSnap;_direction="ltr";constructor(t,e,i,r,o){this._dragDropRegistry=e,this._ngZone=r,this._viewportRuler=o;let s=this.element=$(t);this._document=i,this.withOrientation("vertical").withElementContainer(s),e.registerDropContainer(this),this._parentPositions=new ft(i)}dispose(){this._stopScrolling(),this._stopScrollTimers.complete(),this._viewportScrollSubscription.unsubscribe(),this.beforeStarted.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this.sorted.complete(),this.receivingStarted.complete(),this.receivingStopped.complete(),this._activeSiblings.clear(),this._scrollNode=null,this._parentPositions.clear(),this._dragDropRegistry.removeDropContainer(this)}isDragging(){return this._isDragging}start(){this._draggingStarted(),this._notifyReceivingSiblings()}enter(t,e,i,r){this._draggingStarted(),r==null&&this.sortingDisabled&&(r=this._draggables.indexOf(t)),this._sortStrategy.enter(t,e,i,r),this._cacheParentPositions(),this._notifyReceivingSiblings(),this.entered.next({item:t,container:this,currentIndex:this.getItemIndex(t)})}exit(t){this._reset(),this.exited.next({item:t,container:this})}drop(t,e,i,r,o,s,u,g={}){this._reset(),this.dropped.next({item:t,currentIndex:e,previousIndex:i,container:this,previousContainer:r,isPointerOverContainer:o,distance:s,dropPoint:u,event:g})}withItems(t){let e=this._draggables;return this._draggables=t,t.forEach(i=>i._withDropContainer(this)),this.isDragging()&&(e.filter(r=>r.isDragging()).every(r=>t.indexOf(r)===-1)?this._reset():this._sortStrategy.withItems(this._draggables)),this}withDirection(t){return this._direction=t,this._sortStrategy instanceof yt&&(this._sortStrategy.direction=t),this}connectedTo(t){return this._siblings=t.slice(),this}withOrientation(t){if(t==="mixed")this._sortStrategy=new qt(this._document,this._dragDropRegistry);else{let e=new yt(this._dragDropRegistry);e.direction=this._direction,e.orientation=t,this._sortStrategy=e}return this._sortStrategy.withElementContainer(this._container),this._sortStrategy.withSortPredicate((e,i)=>this.sortPredicate(e,i,this)),this}withScrollableParents(t){let e=this._container;return this._scrollableElements=t.indexOf(e)===-1?[e,...t]:t.slice(),this}withElementContainer(t){if(t===this._container)return this;let e=$(this.element),i=this._scrollableElements.indexOf(this._container),r=this._scrollableElements.indexOf(t);return i>-1&&this._scrollableElements.splice(i,1),r>-1&&this._scrollableElements.splice(r,1),this._sortStrategy&&this._sortStrategy.withElementContainer(t),this._cachedShadowRoot=null,this._scrollableElements.unshift(t),this._container=t,this}getScrollableParents(){return this._scrollableElements}getItemIndex(t){return this._isDragging?this._sortStrategy.getItemIndex(t):this._draggables.indexOf(t)}isReceiving(){return this._activeSiblings.size>0}_sortItem(t,e,i,r){if(this.sortingDisabled||!this._domRect||!zi(this._domRect,Yi,e,i))return;let o=this._sortStrategy.sort(t,e,i,r);o&&this.sorted.next({previousIndex:o.previousIndex,currentIndex:o.currentIndex,container:this,item:t})}_startScrollingIfNecessary(t,e){if(this.autoScrollDisabled)return;let i,r=W.NONE,o=O.NONE;if(this._parentPositions.positions.forEach((s,u)=>{u===this._document||!s.clientRect||i||zi(s.clientRect,Yi,t,e)&&([r,o]=Gr(u,s.clientRect,this._direction,t,e),(r||o)&&(i=u))}),!r&&!o){let{width:s,height:u}=this._viewportRuler.getViewportSize(),g={width:s,height:u,top:0,right:s,bottom:u,left:0};r=tr(g,e),o=ir(g,t),i=window}i&&(r!==this._verticalScrollDirection||o!==this._horizontalScrollDirection||i!==this._scrollNode)&&(this._verticalScrollDirection=r,this._horizontalScrollDirection=o,this._scrollNode=i,(r||o)&&i?this._ngZone.runOutsideAngular(this._startScrollInterval):this._stopScrolling())}_stopScrolling(){this._stopScrollTimers.next()}_draggingStarted(){let t=this._container.style;this.beforeStarted.next(),this._isDragging=!0,this._initialScrollSnap=t.msScrollSnapType||t.scrollSnapType||"",t.scrollSnapType=t.msScrollSnapType="none",this._sortStrategy.start(this._draggables),this._cacheParentPositions(),this._viewportScrollSubscription.unsubscribe(),this._listenToScrollEvents()}_cacheParentPositions(){this._parentPositions.cache(this._scrollableElements),this._domRect=this._parentPositions.positions.get(this._container).clientRect}_reset(){this._isDragging=!1;let t=this._container.style;t.scrollSnapType=t.msScrollSnapType=this._initialScrollSnap,this._siblings.forEach(e=>e._stopReceiving(this)),this._sortStrategy.reset(),this._stopScrolling(),this._viewportScrollSubscription.unsubscribe(),this._parentPositions.clear()}_startScrollInterval=()=>{this._stopScrolling(),oi(0,It).pipe(he(this._stopScrollTimers)).subscribe(()=>{let t=this._scrollNode,e=this.autoScrollStep;this._verticalScrollDirection===W.UP?t.scrollBy(0,-e):this._verticalScrollDirection===W.DOWN&&t.scrollBy(0,e),this._horizontalScrollDirection===O.LEFT?t.scrollBy(-e,0):this._horizontalScrollDirection===O.RIGHT&&t.scrollBy(e,0)})};_isOverContainer(t,e){return this._domRect!=null&&Ut(this._domRect,t,e)}_getSiblingContainerFromPosition(t,e,i){return this._siblings.find(r=>r._canReceive(t,e,i))}_canReceive(t,e,i){if(!this._domRect||!Ut(this._domRect,e,i)||!this.enterPredicate(t,this))return!1;let r=this._getShadowRoot().elementFromPoint(e,i);return r?r===this._container||this._container.contains(r):!1}_startReceiving(t,e){let i=this._activeSiblings;!i.has(t)&&e.every(r=>this.enterPredicate(r,this)||this._draggables.indexOf(r)>-1)&&(i.add(t),this._cacheParentPositions(),this._listenToScrollEvents(),this.receivingStarted.next({initiator:t,receiver:this,items:e}))}_stopReceiving(t){this._activeSiblings.delete(t),this._viewportScrollSubscription.unsubscribe(),this.receivingStopped.next({initiator:t,receiver:this})}_listenToScrollEvents(){this._viewportScrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(t=>{if(this.isDragging()){let e=this._parentPositions.handleScroll(t);e&&this._sortStrategy.updateOnScroll(e.top,e.left)}else this.isReceiving()&&this._cacheParentPositions()})}_getShadowRoot(){if(!this._cachedShadowRoot){let t=gt(this._container);this._cachedShadowRoot=t||this._document}return this._cachedShadowRoot}_notifyReceivingSiblings(){let t=this._sortStrategy.getActiveItemsSnapshot().filter(e=>e.isDragging());this._siblings.forEach(e=>e._startReceiving(this,t))}};function tr(n,t){let{top:e,bottom:i,height:r}=n,o=r*er;return t>=e-o&&t<=e+o?W.UP:t>=i-o&&t<=i+o?W.DOWN:W.NONE}function ir(n,t){let{left:e,right:i,width:r}=n,o=r*er;return t>=e-o&&t<=e+o?O.LEFT:t>=i-o&&t<=i+o?O.RIGHT:O.NONE}function Gr(n,t,e,i,r){let o=tr(t,r),s=ir(t,i),u=W.NONE,g=O.NONE;if(o){let _=n.scrollTop;o===W.UP?_>0&&(u=W.UP):n.scrollHeight-_>n.clientHeight&&(u=W.DOWN)}if(s){let _=n.scrollLeft;e==="rtl"?s===O.RIGHT?_<0&&(g=O.RIGHT):n.scrollWidth+_>n.clientWidth&&(g=O.LEFT):s===O.LEFT?_>0&&(g=O.LEFT):n.scrollWidth-_>n.clientWidth&&(g=O.RIGHT)}return[u,g]}var Le={capture:!0},Ht={passive:!1,capture:!0},jr=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275cmp=V({type:n,selectors:[["ng-component"]],hostAttrs:["cdk-drag-resets-container",""],decls:0,vars:0,template:function(i,r){},styles:[`@layer cdk-resets{.cdk-drag-preview{background:none;border:none;padding:0;color:inherit;inset:auto}}.cdk-drag-placeholder *,.cdk-drag-preview *{pointer-events:none !important}
`],encapsulation:2,changeDetection:0})}return n})(),Xt=(()=>{class n{_ngZone=h(de);_document=h(ae);_styleLoader=h(Fi);_renderer=h(_e).createRenderer(null,null);_cleanupDocumentTouchmove;_dropInstances=new Set;_dragInstances=new Set;_activeDragInstances=C([]);_globalListeners;_draggingPredicate=e=>e.isDragging();_domNodesToDirectives=null;pointerMove=new I;pointerUp=new I;scroll=new I;constructor(){}registerDropContainer(e){this._dropInstances.has(e)||this._dropInstances.add(e)}registerDragItem(e){this._dragInstances.add(e),this._dragInstances.size===1&&this._ngZone.runOutsideAngular(()=>{this._cleanupDocumentTouchmove?.(),this._cleanupDocumentTouchmove=oe(this._renderer,this._document,"touchmove",this._persistentTouchmoveListener,Ht)})}removeDropContainer(e){this._dropInstances.delete(e)}removeDragItem(e){this._dragInstances.delete(e),this.stopDragging(e),this._dragInstances.size===0&&this._cleanupDocumentTouchmove?.()}startDragging(e,i){if(!(this._activeDragInstances().indexOf(e)>-1)&&(this._styleLoader.load(jr),this._activeDragInstances.update(r=>[...r,e]),this._activeDragInstances().length===1)){let r=i.type.startsWith("touch"),o=u=>this.pointerUp.next(u),s=[["scroll",u=>this.scroll.next(u),Le],["selectstart",this._preventDefaultWhileDragging,Ht]];r?s.push(["touchend",o,Le],["touchcancel",o,Le]):s.push(["mouseup",o,Le]),r||s.push(["mousemove",u=>this.pointerMove.next(u),Ht]),this._ngZone.runOutsideAngular(()=>{this._globalListeners=s.map(([u,g,_])=>oe(this._renderer,this._document,u,g,_))})}}stopDragging(e){this._activeDragInstances.update(i=>{let r=i.indexOf(e);return r>-1?(i.splice(r,1),[...i]):i}),this._activeDragInstances().length===0&&this._clearGlobalListeners()}isDragging(e){return this._activeDragInstances().indexOf(e)>-1}scrolled(e){let i=[this.scroll];return e&&e!==this._document&&i.push(new De(r=>this._ngZone.runOutsideAngular(()=>{let o=oe(this._renderer,e,"scroll",s=>{this._activeDragInstances().length&&r.next(s)},Le);return()=>{o()}}))),Ne(...i)}registerDirectiveNode(e,i){this._domNodesToDirectives??=new WeakMap,this._domNodesToDirectives.set(e,i)}removeDirectiveNode(e){this._domNodesToDirectives?.delete(e)}getDragDirectiveForNode(e){return this._domNodesToDirectives?.get(e)||null}ngOnDestroy(){this._dragInstances.forEach(e=>this.removeDragItem(e)),this._dropInstances.forEach(e=>this.removeDropContainer(e)),this._domNodesToDirectives=null,this._clearGlobalListeners(),this.pointerMove.complete(),this.pointerUp.complete()}_preventDefaultWhileDragging=e=>{this._activeDragInstances().length>0&&e.preventDefault()};_persistentTouchmoveListener=e=>{this._activeDragInstances().length>0&&(this._activeDragInstances().some(this._draggingPredicate)&&e.preventDefault(),this.pointerMove.next(e))};_clearGlobalListeners(){this._globalListeners?.forEach(e=>e()),this._globalListeners=void 0}static \u0275fac=function(i){return new(i||n)};static \u0275prov=R({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Hr={dragStartThreshold:5,pointerDirectionChangeThreshold:5},ei=(()=>{class n{_document=h(ae);_ngZone=h(de);_viewportRuler=h(Vi);_dragDropRegistry=h(Xt);_renderer=h(_e).createRenderer(null,null);constructor(){}createDrag(e,i=Hr){return new Zt(e,i,this._document,this._ngZone,this._viewportRuler,this._dragDropRegistry,this._renderer)}createDropList(e){return new Kt(e,this._dragDropRegistry,this._document,this._ngZone,this._viewportRuler)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=R({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Yt=new ee("CDK_DRAG_PARENT");var rr=new ee("CdkDragHandle"),nr=(()=>{class n{element=h(le);_parentDrag=h(Yt,{optional:!0,skipSelf:!0});_dragDropRegistry=h(Xt);_stateChanges=new I;get disabled(){return this._disabled}set disabled(e){this._disabled=e,this._stateChanges.next(this)}_disabled=!1;constructor(){this._parentDrag?._addHandle(this)}ngAfterViewInit(){if(!this._parentDrag){let e=this.element.nativeElement.parentElement;for(;e;){let i=this._dragDropRegistry.getDragDirectiveForNode(e);if(i){this._parentDrag=i,i._addHandle(this);break}e=e.parentElement}}}ngOnDestroy(){this._parentDrag?._removeHandle(this),this._stateChanges.complete()}static \u0275fac=function(i){return new(i||n)};static \u0275dir=Pe({type:n,selectors:[["","cdkDragHandle",""]],hostAttrs:[1,"cdk-drag-handle"],inputs:{disabled:[2,"cdkDragHandleDisabled","disabled",ge]},features:[pe([{provide:rr,useExisting:n}])]})}return n})(),or=new ee("CDK_DRAG_CONFIG"),sr=new ee("CdkDropList"),ar=(()=>{class n{element=h(le);dropContainer=h(sr,{optional:!0,skipSelf:!0});_ngZone=h(de);_viewContainerRef=h(Pt);_dir=h(zt,{optional:!0});_changeDetectorRef=h(xe);_selfHandle=h(rr,{optional:!0,self:!0});_parentDrag=h(Yt,{optional:!0,skipSelf:!0});_dragDropRegistry=h(Xt);_destroyed=new I;_handles=new Re([]);_previewTemplate;_placeholderTemplate;_dragRef;data;lockAxis;rootElementSelector;boundaryElement;dragStartDelay;freeDragPosition;get disabled(){return this._disabled||!!(this.dropContainer&&this.dropContainer.disabled)}set disabled(e){this._disabled=e,this._dragRef.disabled=this._disabled}_disabled;constrainPosition;previewClass;previewContainer;scale=1;started=new F;released=new F;ended=new F;entered=new F;exited=new F;dropped=new F;moved=new De(e=>{let i=this._dragRef.moved.pipe(ie(r=>({source:this,pointerPosition:r.pointerPosition,event:r.event,delta:r.delta,distance:r.distance}))).subscribe(e);return()=>{i.unsubscribe()}});_injector=h(Te);constructor(){let e=this.dropContainer,i=h(or,{optional:!0}),r=h(ei);this._dragRef=r.createDrag(this.element,{dragStartThreshold:i&&i.dragStartThreshold!=null?i.dragStartThreshold:5,pointerDirectionChangeThreshold:i&&i.pointerDirectionChangeThreshold!=null?i.pointerDirectionChangeThreshold:5,zIndex:i?.zIndex}),this._dragRef.data=this,this._dragDropRegistry.registerDirectiveNode(this.element.nativeElement,this),i&&this._assignDefaults(i),e&&(this._dragRef._withDropContainer(e._dropListRef),e.addItem(this),e._dropListRef.beforeStarted.pipe(he(this._destroyed)).subscribe(()=>{this._dragRef.scale=this.scale})),this._syncInputs(this._dragRef),this._handleEvents(this._dragRef)}getPlaceholderElement(){return this._dragRef.getPlaceholderElement()}getRootElement(){return this._dragRef.getRootElement()}reset(){this._dragRef.reset()}getFreeDragPosition(){return this._dragRef.getFreeDragPosition()}setFreeDragPosition(e){this._dragRef.setFreeDragPosition(e)}ngAfterViewInit(){Ft(()=>{this._updateRootElement(),this._setupHandlesListener(),this._dragRef.scale=this.scale,this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)},{injector:this._injector})}ngOnChanges(e){let i=e.rootElementSelector,r=e.freeDragPosition;i&&!i.firstChange&&this._updateRootElement(),this._dragRef.scale=this.scale,r&&!r.firstChange&&this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)}ngOnDestroy(){this.dropContainer&&this.dropContainer.removeItem(this),this._dragDropRegistry.removeDirectiveNode(this.element.nativeElement),this._ngZone.runOutsideAngular(()=>{this._handles.complete(),this._destroyed.next(),this._destroyed.complete(),this._dragRef.dispose()})}_addHandle(e){let i=this._handles.getValue();i.push(e),this._handles.next(i)}_removeHandle(e){let i=this._handles.getValue(),r=i.indexOf(e);r>-1&&(i.splice(r,1),this._handles.next(i))}_setPreviewTemplate(e){this._previewTemplate=e}_resetPreviewTemplate(e){e===this._previewTemplate&&(this._previewTemplate=null)}_setPlaceholderTemplate(e){this._placeholderTemplate=e}_resetPlaceholderTemplate(e){e===this._placeholderTemplate&&(this._placeholderTemplate=null)}_updateRootElement(){let e=this.element.nativeElement,i=e;this.rootElementSelector&&(i=e.closest!==void 0?e.closest(this.rootElementSelector):e.parentElement?.closest(this.rootElementSelector)),this._dragRef.withRootElement(i||e)}_getBoundaryElement(){let e=this.boundaryElement;return e?typeof e=="string"?this.element.nativeElement.closest(e):$(e):null}_syncInputs(e){e.beforeStarted.subscribe(()=>{if(!e.isDragging()){let i=this._dir,r=this.dragStartDelay,o=this._placeholderTemplate?{template:this._placeholderTemplate.templateRef,context:this._placeholderTemplate.data,viewContainer:this._viewContainerRef}:null,s=this._previewTemplate?{template:this._previewTemplate.templateRef,context:this._previewTemplate.data,matchSize:this._previewTemplate.matchSize,viewContainer:this._viewContainerRef}:null;e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.scale=this.scale,e.dragStartDelay=typeof r=="object"&&r?r:ht(r),e.constrainPosition=this.constrainPosition,e.previewClass=this.previewClass,e.withBoundaryElement(this._getBoundaryElement()).withPlaceholderTemplate(o).withPreviewTemplate(s).withPreviewContainer(this.previewContainer||"global"),i&&e.withDirection(i.value)}}),e.beforeStarted.pipe(J(1)).subscribe(()=>{if(this._parentDrag){e.withParent(this._parentDrag._dragRef);return}let i=this.element.nativeElement.parentElement;for(;i;){let r=this._dragDropRegistry.getDragDirectiveForNode(i);if(r){e.withParent(r._dragRef);break}i=i.parentElement}})}_handleEvents(e){e.started.subscribe(i=>{this.started.emit({source:this,event:i.event}),this._changeDetectorRef.markForCheck()}),e.released.subscribe(i=>{this.released.emit({source:this,event:i.event})}),e.ended.subscribe(i=>{this.ended.emit({source:this,distance:i.distance,dropPoint:i.dropPoint,event:i.event}),this._changeDetectorRef.markForCheck()}),e.entered.subscribe(i=>{this.entered.emit({container:i.container.data,item:this,currentIndex:i.currentIndex})}),e.exited.subscribe(i=>{this.exited.emit({container:i.container.data,item:this})}),e.dropped.subscribe(i=>{this.dropped.emit({previousIndex:i.previousIndex,currentIndex:i.currentIndex,previousContainer:i.previousContainer.data,container:i.container.data,isPointerOverContainer:i.isPointerOverContainer,item:this,distance:i.distance,dropPoint:i.dropPoint,event:i.event})})}_assignDefaults(e){let{lockAxis:i,dragStartDelay:r,constrainPosition:o,previewClass:s,boundaryElement:u,draggingDisabled:g,rootElementSelector:_,previewContainer:S}=e;this.disabled=g??!1,this.dragStartDelay=r||0,i&&(this.lockAxis=i),o&&(this.constrainPosition=o),s&&(this.previewClass=s),u&&(this.boundaryElement=u),_&&(this.rootElementSelector=_),S&&(this.previewContainer=S)}_setupHandlesListener(){this._handles.pipe(re(e=>{let i=e.map(r=>r.element);this._selfHandle&&this.rootElementSelector&&i.push(this.element),this._dragRef.withHandles(i)}),X(e=>Ne(...e.map(i=>i._stateChanges.pipe(We(i))))),he(this._destroyed)).subscribe(e=>{let i=this._dragRef,r=e.element.nativeElement;e.disabled?i.disableHandle(r):i.enableHandle(r)})}static \u0275fac=function(i){return new(i||n)};static \u0275dir=Pe({type:n,selectors:[["","cdkDrag",""]],hostAttrs:[1,"cdk-drag"],hostVars:4,hostBindings:function(i,r){i&2&&He("cdk-drag-disabled",r.disabled)("cdk-drag-dragging",r._dragRef.isDragging())},inputs:{data:[0,"cdkDragData","data"],lockAxis:[0,"cdkDragLockAxis","lockAxis"],rootElementSelector:[0,"cdkDragRootElement","rootElementSelector"],boundaryElement:[0,"cdkDragBoundary","boundaryElement"],dragStartDelay:[0,"cdkDragStartDelay","dragStartDelay"],freeDragPosition:[0,"cdkDragFreeDragPosition","freeDragPosition"],disabled:[2,"cdkDragDisabled","disabled",ge],constrainPosition:[0,"cdkDragConstrainPosition","constrainPosition"],previewClass:[0,"cdkDragPreviewClass","previewClass"],previewContainer:[0,"cdkDragPreviewContainer","previewContainer"],scale:[2,"cdkDragScale","scale",fi]},outputs:{started:"cdkDragStarted",released:"cdkDragReleased",ended:"cdkDragEnded",entered:"cdkDragEntered",exited:"cdkDragExited",dropped:"cdkDragDropped",moved:"cdkDragMoved"},exportAs:["cdkDrag"],features:[pe([{provide:Yt,useExisting:n}]),Tt]})}return n})(),Qi=new ee("CdkDropListGroup");var lr=(()=>{class n{element=h(le);_changeDetectorRef=h(xe);_scrollDispatcher=h(Oi);_dir=h(zt,{optional:!0});_group=h(Qi,{optional:!0,skipSelf:!0});_latestSortedRefs;_destroyed=new I;_scrollableParentsResolved;static _dropLists=[];_dropListRef;connectedTo=[];data;orientation;id=h(Mi).getId("cdk-drop-list-");lockAxis;get disabled(){return this._disabled||!!this._group&&this._group.disabled}set disabled(e){this._dropListRef.disabled=this._disabled=e}_disabled;sortingDisabled;enterPredicate=()=>!0;sortPredicate=()=>!0;autoScrollDisabled;autoScrollStep;elementContainerSelector;dropped=new F;entered=new F;exited=new F;sorted=new F;_unsortedItems=new Set;constructor(){let e=h(ei),i=h(or,{optional:!0});this._dropListRef=e.createDropList(this.element),this._dropListRef.data=this,i&&this._assignDefaults(i),this._dropListRef.enterPredicate=(r,o)=>this.enterPredicate(r.data,o.data),this._dropListRef.sortPredicate=(r,o,s)=>this.sortPredicate(r,o.data,s.data),this._setupInputSyncSubscription(this._dropListRef),this._handleEvents(this._dropListRef),n._dropLists.push(this),this._group&&this._group._items.add(this)}addItem(e){this._unsortedItems.add(e),this._dropListRef.isDragging()&&this._syncItemsWithRef(this.getSortedItems().map(i=>i._dragRef))}removeItem(e){if(this._unsortedItems.delete(e),this._latestSortedRefs){let i=this._latestSortedRefs.indexOf(e._dragRef);i>-1&&(this._latestSortedRefs.splice(i,1),this._syncItemsWithRef(this._latestSortedRefs))}}getSortedItems(){return Array.from(this._unsortedItems).sort((e,i)=>e._dragRef.getVisibleElement().compareDocumentPosition(i._dragRef.getVisibleElement())&Node.DOCUMENT_POSITION_FOLLOWING?-1:1)}ngOnDestroy(){let e=n._dropLists.indexOf(this);e>-1&&n._dropLists.splice(e,1),this._group&&this._group._items.delete(this),this._latestSortedRefs=void 0,this._unsortedItems.clear(),this._dropListRef.dispose(),this._destroyed.next(),this._destroyed.complete()}_setupInputSyncSubscription(e){this._dir&&this._dir.change.pipe(We(this._dir.value),he(this._destroyed)).subscribe(i=>e.withDirection(i)),e.beforeStarted.subscribe(()=>{let i=Ai(this.connectedTo).map(r=>{if(typeof r=="string"){let o=n._dropLists.find(s=>s.id===r);return o}return r});if(this._group&&this._group._items.forEach(r=>{i.indexOf(r)===-1&&i.push(r)}),!this._scrollableParentsResolved){let r=this._scrollDispatcher.getAncestorScrollContainers(this.element).map(o=>o.getElementRef().nativeElement);this._dropListRef.withScrollableParents(r),this._scrollableParentsResolved=!0}if(this.elementContainerSelector){let r=this.element.nativeElement.querySelector(this.elementContainerSelector);e.withElementContainer(r)}e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.sortingDisabled=this.sortingDisabled,e.autoScrollDisabled=this.autoScrollDisabled,e.autoScrollStep=ht(this.autoScrollStep,2),e.connectedTo(i.filter(r=>r&&r!==this).map(r=>r._dropListRef)).withOrientation(this.orientation)})}_handleEvents(e){e.beforeStarted.subscribe(()=>{this._syncItemsWithRef(this.getSortedItems().map(i=>i._dragRef)),this._changeDetectorRef.markForCheck()}),e.entered.subscribe(i=>{this.entered.emit({container:this,item:i.item.data,currentIndex:i.currentIndex})}),e.exited.subscribe(i=>{this.exited.emit({container:this,item:i.item.data}),this._changeDetectorRef.markForCheck()}),e.sorted.subscribe(i=>{this.sorted.emit({previousIndex:i.previousIndex,currentIndex:i.currentIndex,container:this,item:i.item.data})}),e.dropped.subscribe(i=>{this.dropped.emit({previousIndex:i.previousIndex,currentIndex:i.currentIndex,previousContainer:i.previousContainer.data,container:i.container.data,item:i.item.data,isPointerOverContainer:i.isPointerOverContainer,distance:i.distance,dropPoint:i.dropPoint,event:i.event}),this._changeDetectorRef.markForCheck()}),Ne(e.receivingStarted,e.receivingStopped).subscribe(()=>this._changeDetectorRef.markForCheck())}_assignDefaults(e){let{lockAxis:i,draggingDisabled:r,sortingDisabled:o,listAutoScrollDisabled:s,listOrientation:u}=e;this.disabled=r??!1,this.sortingDisabled=o??!1,this.autoScrollDisabled=s??!1,this.orientation=u||"vertical",i&&(this.lockAxis=i)}_syncItemsWithRef(e){this._latestSortedRefs=e,this._dropListRef.withItems(e)}static \u0275fac=function(i){return new(i||n)};static \u0275dir=Pe({type:n,selectors:[["","cdkDropList",""],["cdk-drop-list"]],hostAttrs:[1,"cdk-drop-list"],hostVars:7,hostBindings:function(i,r){i&2&&(pi("id",r.id),He("cdk-drop-list-disabled",r.disabled)("cdk-drop-list-dragging",r._dropListRef.isDragging())("cdk-drop-list-receiving",r._dropListRef.isReceiving()))},inputs:{connectedTo:[0,"cdkDropListConnectedTo","connectedTo"],data:[0,"cdkDropListData","data"],orientation:[0,"cdkDropListOrientation","orientation"],id:"id",lockAxis:[0,"cdkDropListLockAxis","lockAxis"],disabled:[2,"cdkDropListDisabled","disabled",ge],sortingDisabled:[2,"cdkDropListSortingDisabled","sortingDisabled",ge],enterPredicate:[0,"cdkDropListEnterPredicate","enterPredicate"],sortPredicate:[0,"cdkDropListSortPredicate","sortPredicate"],autoScrollDisabled:[2,"cdkDropListAutoScrollDisabled","autoScrollDisabled",ge],autoScrollStep:[0,"cdkDropListAutoScrollStep","autoScrollStep"],elementContainerSelector:[0,"cdkDropListElementContainer","elementContainerSelector"]},outputs:{dropped:"cdkDropListDropped",entered:"cdkDropListEntered",exited:"cdkDropListExited",sorted:"cdkDropListSorted"},exportAs:["cdkDropList"],features:[pe([{provide:Qi,useValue:void 0},{provide:sr,useExisting:n}])]})}return n})();var dr=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=Ge({type:n});static \u0275inj=Be({providers:[ei],imports:[Li]})}return n})();var St=class n{loadingCount=0;isLoading=new Re(!1);loadingMessage=new Re(null);activeTimeoutId=null;loading$=this.isLoading.asObservable();message$=this.loadingMessage.asObservable();constructor(){}show(t=null,e=6e3,i="Sembra che ci siano problemi di connessione..."){this.loadingCount++,this.loadingCount===1&&this.isLoading.next(!0),this.loadingMessage.next(t),this.activeTimeoutId&&(clearTimeout(this.activeTimeoutId),this.activeTimeoutId=null),typeof e=="number"&&e>0&&typeof i=="string"&&(this.activeTimeoutId=setTimeout(()=>{this.isLoading.value&&this.loadingMessage.next(t+" ("+i+")"),this.activeTimeoutId=null},e))}hide(){this.loadingCount>0&&this.loadingCount--,this.loadingCount===0&&(this.isLoading.next(!1),this.loadingMessage.next(null),this.activeTimeoutId&&(clearTimeout(this.activeTimeoutId),this.activeTimeoutId=null))}reset(){this.loadingCount=0,this.isLoading.next(!1),this.loadingMessage.next(null),this.activeTimeoutId&&(clearTimeout(this.activeTimeoutId),this.activeTimeoutId=null)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=R({token:n,factory:n.\u0275fac,providedIn:"root"})};var Zr=["setRepsInput"],qr=(n,t)=>({"border-red-500 dark:border-red-400":n,"border-gray-300 dark:border-gray-600":t}),Kr=(n,t,e,i,r,o,s,u)=>({"border-orange-500 dark:border-orange-400 bg-orange-100 dark:bg-orange-900/20":n,"ring-2 ring-orange-400 dark:ring-orange-300 shadow-lg":t,"dark:bg-orange-900/40":e,"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800":i,"rounded-b-none border-b-transparent dark:border-b-transparent":r,"rounded-t-none":o,"mb-2":s,"mt-4":u}),Yr=(n,t)=>({"border-b border-orange-300 dark:border-orange-600":n,"border-b border-gray-200 dark:border-gray-600":t});function Qr(n,t){if(n&1&&(l(0,"div",24),c(1),a()),n&2){let e=p();d(),b(" ",e.errorMessage(),`
`)}}function Jr(n,t){n&1&&(l(0,"span"),c(1,"Routine name is required."),a())}function Xr(n,t){if(n&1&&(l(0,"div",25),f(1,Jr,2,0,"span",26),a()),n&2){let e=p();d(),m("ngIf",e.f.name.errors==null?null:e.f.name.errors.required)}}function en(n,t){if(n&1&&(l(0,"option",27),c(1),a()),n&2){let e=t.$implicit;m("value",e.value),d(),D(e.label)}}function tn(n,t){if(n&1){let e=w();l(0,"div",28)(1,"h2",29),c(2,"Exercises"),a(),l(3,"button",30),y("click",function(){x(e);let r=p();return v(r.openExerciseSelectionModal())}),c(4," + Add Exercise "),a()()}if(n&2){let e=p();d(3),m("disabled",e.isViewMode)}}function rn(n,t){if(n&1){let e=w();l(0,"div",51)(1,"button",52),y("click",function(){x(e);let r=p(2);return v(r.groupSelectedAsSuperset())}),c(2),a()()}if(n&2){let e=p(2);d(),m("disabled",e.isViewMode)("disabled",!e.canGroupSelectedExercises()),d(),b(" Group Superset (",e.selectedExerciseIndicesForSuperset().length,") ")}}function nn(n,t){n&1&&(l(0,"div",53),T(),l(1,"svg",54),k(2,"path",55),a()())}function on(n,t){if(n&1){let e=w();l(0,"input",56),y("change",function(r){x(e);let o=p().index,s=p();return v(s.toggleExerciseSelectionForSuperset(o,r))}),a()}if(n&2){let e=p().index,i=p();m("id","superset-select-"+e)("checked",i.selectedExerciseIndicesForSuperset().includes(e))}}function sn(n,t){if(n&1&&(l(0,"span",57),c(1),a()),n&2){let e,i=p().$implicit;d(),L(" Superset (",(((e=i.get("supersetOrder"))==null?null:e.value)??0)+1," of ",(e=i.get("supersetSize"))==null?null:e.value,") ")}}function an(n,t){if(n&1){let e=w();l(0,"button",58),y("click",function(){x(e);let r=p().index,o=p();return v(o.removeExercise(r))}),T(),l(1,"svg",59),k(2,"path",60),a(),c(3," Remove Exercise "),a()}if(n&2){let e=p(2);m("disabled",e.isViewMode)}}function ln(n,t){if(n&1){let e=w();l(0,"button",61),y("click",function(){x(e);let r=p().index,o=p();return v(o.ungroupSuperset(r))}),T(),l(1,"svg",59),k(2,"path",62),a(),c(3," Ungroup "),a()}if(n&2){let e=p(2);m("disabled",e.isViewMode)}}function dn(n,t){if(n&1){let e=w();l(0,"div",75)(1,"button",76),y("click",function(){x(e);let r=p().index,o=p().$implicit,s=p();return v(s.removeSet(o,r))}),T(),l(2,"svg",77),k(3,"path",78),a()()()}if(n&2){let e=p(3);d(),m("disabled",e.isViewMode)}}function cn(n,t){if(n&1&&(l(0,"div",63)(1,"div",64)(2,"label",65),c(3,"Reps"),a(),k(4,"input",66,0),a(),l(6,"div",64)(7,"label",65),c(8),a(),k(9,"input",67),a(),l(10,"div",64)(11,"label",65),c(12,"Time (s)"),a(),k(13,"input",68),a(),l(14,"div",64)(15,"label",65),c(16,"Tempo"),a(),k(17,"input",69),a(),l(18,"div",70)(19,"label",65),c(20,"Rest (s)"),a(),k(21,"input",71),a(),f(22,dn,4,1,"div",72),l(23,"div",73)(24,"label",65),c(25,"Notes for this set (optional)"),a(),k(26,"input",74),a()()),n&2){let e=t.index,i=p().index,r=p();m("formGroupName",e),d(2),m("for","reps-"+i+"-"+e),d(2),m("id","reps-"+i+"-"+e),d(3),m("for","weight-"+i+"-"+e),d(),b("Weight (",r.unitsService.getUnitLabel(),")"),d(),m("id","weight-"+i+"-"+e),d(2),m("for","duration-"+i+"-"+e),d(2),m("id","duration-"+i+"-"+e),d(2),m("for","tempo-"+i+"-"+e),d(2),m("id","tempo-"+i+"-"+e),d(2),m("for","rest-"+i+"-"+e),d(2),m("id","rest-"+i+"-"+e),d(),m("ngIf",r.isEditMode),d(2),m("for","setNotes-"+i+"-"+e),d(2),m("id","setNotes-"+i+"-"+e)}}function un(n,t){if(n&1){let e=w();l(0,"div",79)(1,"button",80),y("click",function(){x(e);let r=p(),o=r.$implicit,s=r.index,u=p();return v(u.addSet(o,s))}),c(2),a()()}if(n&2){let e,i=p().$implicit,r=p();d(),m("disabled",r.isViewMode),d(),b(" + Add Set to ",((e=i.get("exerciseName"))==null?null:e.value)||"This Exercise"," ")}}function pn(n,t){if(n&1){let e=w();ce(0),l(1,"div",31),f(2,rn,3,3,"div",32),l(3,"div",33),f(4,nn,3,0,"div",34),l(5,"div",35)(6,"div",36),f(7,on,1,2,"input",37),l(8,"h3",38),f(9,sn,2,2,"span",39),c(10),a()(),l(11,"div",40)(12,"div",41)(13,"label",42),c(14,"Rounds:"),a(),l(15,"input",43),y("change",function(){let r,o=x(e),s=o.$implicit,u=o.index,g=p();return v(g.syncSupersetRounds((r=s.get("supersetId"))==null?null:r.value,(r=s.get("rounds"))==null?null:r.value,u))}),a()(),f(16,an,4,1,"button",44)(17,ln,4,1,"button",45),a()(),l(18,"div",46)(19,"div",4)(20,"h4",47),c(21,"Sets:"),a()(),l(22,"div",48),f(23,cn,27,15,"div",49),a(),f(24,un,3,2,"div",50),a()()(),ue()}if(n&2){let e,i,r,o,s,u,g=t.$implicit,_=t.index,S=t.last,E=p();d(2),m("ngIf",E.selectedExerciseIndicesForSuperset().length>=2&&_===E.firstSelectedExerciseIndexForSuperset),d(),m("cdkDragData",g)("formGroupName",_)("ngClass",_i(16,Kr,(e=g.get("supersetId"))==null?null:e.value,E.selectedExerciseIndicesForSuperset().includes(_),((e=g.get("supersetId"))==null?null:e.value)&&E.selectedExerciseIndicesForSuperset().includes(_),!((e=g.get("supersetId"))!=null&&e.value)&&!E.selectedExerciseIndicesForSuperset().includes(_),((e=g.get("supersetId"))==null?null:e.value)&&(((e=g.get("supersetOrder"))==null?null:e.value)??-1)<(((e=g.get("supersetSize"))==null?null:e.value)??0)-1,((e=g.get("supersetId"))==null?null:e.value)&&(((e=g.get("supersetOrder"))==null?null:e.value)??0)>0,(!((e=g.get("supersetId"))!=null&&e.value)||(((e=g.get("supersetOrder"))==null?null:e.value)??-1)===(((e=g.get("supersetSize"))==null?null:e.value)??0)-1)&&!S,E.selectedExerciseIndicesForSuperset().length>=2&&_===E.firstSelectedExerciseIndexForSuperset)),d(),m("ngIf",E.isEditMode),d(),m("ngClass",me(25,Yr,((i=g.get("supersetId"))==null?null:i.value)&&(((i=g.get("supersetOrder"))==null?null:i.value)??-1)<(((i=g.get("supersetSize"))==null?null:i.value)??0)-1,!((i=g.get("supersetId"))!=null&&i.value)||(((i=g.get("supersetOrder"))==null?null:i.value)??-1)===(((i=g.get("supersetSize"))==null?null:i.value)??0)-1)),d(2),m("ngIf",E.isEditMode),d(2),m("ngIf",(r=g.get("supersetId"))==null?null:r.value),d(),b(" ",((o=g.get("exerciseName"))==null?null:o.value)||"Select Exercise"," "),d(3),m("for","rounds-"+_),d(2),m("id","rounds-"+_)("readonly",((s=g.get("supersetId"))==null?null:s.value)&&(((s=g.get("supersetOrder"))==null?null:s.value)??0)>0),d(),m("ngIf",E.isEditMode),d(),m("ngIf",(u=g.get("supersetId"))==null?null:u.value),d(6),m("ngForOf",E.getSetsFormArray(g).controls),d(),m("ngIf",E.isEditMode)}}function mn(n,t){if(n&1){let e=w();l(0,"div",81)(1,"p",82),c(2,"No exercises added to this routine yet."),a(),l(3,"button",83),y("click",function(){x(e);let r=p();return v(r.openExerciseSelectionModal())}),c(4," + Add First Exercise "),a()()}}function gn(n,t){if(n&1){let e=w();l(0,"div",84)(1,"button",85),y("click",function(){x(e);let r=p();return v(r.openExerciseSelectionModal())}),T(),l(2,"svg",86),k(3,"path",87),a(),c(4," Add Another Exercise "),a()()}}function hn(n,t){if(n&1&&(l(0,"div",88)(1,"a",89),c(2," Cancel "),a(),l(3,"button",90),c(4),a()()),n&2){let e=p();d(3),m("disabled",e.routineForm.invalid&&e.routineForm.touched),d(),b(" ",e.isEditMode?"Save Changes":"Create Routine"," ")}}function _n(n,t){if(n&1){let e=w();l(0,"li",109),y("click",function(){let r=x(e).$implicit,o=p(2);return v(o.selectExercise(r))}),l(1,"div")(2,"span",110),c(3),a(),l(4,"span",111),c(5),P(6,"titlecase"),P(7,"titlecase"),a()(),T(),l(8,"svg",112),k(9,"path",113),a()()}if(n&2){let e=t.$implicit;d(3),D(e.name),d(2),L(" ",fe(6,3,e.category)," - ",fe(7,5,e.primaryMuscleGroup)," ")}}function fn(n,t){n&1&&(l(0,"li",114),c(1," No exercises match your search. "),a())}function xn(n,t){n&1&&(l(0,"li",114),c(1," Exercise library is empty or still loading. "),a())}function vn(n,t){if(n&1){let e=w();l(0,"div",91),y("click",function(){x(e);let r=p();return v(r.closeExerciseSelectionModal())}),l(1,"div",92),y("click",function(r){return x(e),v(r.stopPropagation())}),l(2,"div",93)(3,"div",94)(4,"div",95)(5,"div",96)(6,"h3",97),c(7," Select an Exercise "),a(),l(8,"button",98),y("click",function(){x(e);let r=p();return v(r.closeExerciseSelectionModal())}),T(),l(9,"svg",99),k(10,"path",100),a()()(),te(),l(11,"div",101)(12,"input",102),y("ngModelChange",function(r){x(e);let o=p();return v(o.modalSearchTerm.set(r))}),a()(),l(13,"div",103)(14,"ul",104),f(15,_n,10,7,"li",105)(16,fn,2,0,"li",106)(17,xn,2,0,"li",106),a()()()()(),l(18,"div",107)(19,"button",108),y("click",function(){x(e);let r=p();return v(r.closeExerciseSelectionModal())}),c(20," Cancel "),a()()()()}if(n&2){let e=p();d(12),m("ngModel",e.modalSearchTerm()),d(3),m("ngForOf",e.filteredAvailableExercises()),d(),m("ngIf",e.filteredAvailableExercises().length===0&&e.availableExercises.length>0),d(),m("ngIf",e.availableExercises.length===0)}}var Ie=class n{fb=h(ot);router=h(ne);route=h(Se);workoutService=h(we);exerciseService=h(ke);unitsService=h(lt);spinnerService=h(St);alertService=h(Ce);setRepsInputs;cdr=h(xe);routineForm;isEditMode=!1;isNewMode=!1;isViewMode=!1;currentRoutineId=null;routeSub;routineGoals=[{value:"strength",label:"Strength"},{value:"hypertrophy",label:"Hypertrophy"},{value:"endurance",label:"Endurance"},{value:"custom",label:"Custom"}];isExerciseModalOpen=C(!1);availableExercises=[];modalSearchTerm=C("");filteredAvailableExercises=Fe(()=>{let t=this.modalSearchTerm().toLowerCase();return t?this.availableExercises.filter(e=>e.name.toLowerCase().includes(t)||e.category.toLowerCase().includes(t)||e.primaryMuscleGroup.toLowerCase().includes(t)):this.availableExercises});selectedExerciseIndicesForSuperset=C([]);constructor(){this.routineForm=this.fb.group({name:["",M.required],description:[""],goal:["custom"],exercises:this.fb.array([])})}ngOnInit(){this.loadAvailableExercises(),this.routeSub=this.route.paramMap.pipe(X(t=>{this.currentRoutineId=t.get("routineId");let e=this.route.snapshot.url[0]?.path;return this.isNewMode=e==="new",this.isEditMode=e==="edit"&&!!this.currentRoutineId||!!this.isNewMode,this.isViewMode=e==="view",this.currentRoutineId?this.workoutService.getRoutineById(this.currentRoutineId):(this.exercisesFormArray.clear(),this.routineForm.reset({goal:"custom",exercises:[]}),Q(null))}),re(t=>{t?(this.patchFormWithRoutineData(t),(this.isViewMode||this.isEditMode)&&this.toggleFormState(this.isViewMode)):(this.isEditMode||this.isViewMode)&&!this.isNewMode&&(console.error(`Routine with ID ${this.currentRoutineId} not found.`),this.errorMessage.set(`Routine with ID ${this.currentRoutineId} not found.`),this.router.navigate(["/workout"]))})).subscribe()}toggleFormState(t){t?this.routineForm.disable({emitEvent:!1}):(this.routineForm.enable({emitEvent:!1}),this.exercisesFormArray.controls.forEach(e=>{this.updateRoundsControlability(e)}))}get exercisesFormArray(){return this.routineForm.get("exercises")}getSetsFormArray(t){return t.get("sets")}loadAvailableExercises(){this.exerciseService.getExercises().subscribe(t=>{this.availableExercises=t})}patchFormWithRoutineData(t){this.routineForm.patchValue({name:t.name,description:t.description,goal:t.goal}),this.exercisesFormArray.clear(),t.exercises.forEach(e=>{let i=this.createExerciseFormGroup(e);this.exercisesFormArray.push(i)}),this.isViewMode?this.toggleFormState(!0):this.toggleFormState(!1)}createExerciseFormGroup(t){let e=t?.exerciseId?this.availableExercises.find(r=>r.id===t.exerciseId):null,i=this.fb.group({id:[t?.id||this.workoutService.generateWorkoutExerciseId()],exerciseId:[t?.exerciseId||"",M.required],exerciseName:[t?.exerciseName||e?.name||"Unknown Exercise"],notes:[t?.notes||""],sets:this.fb.array(t?.sets.map(r=>this.createSetFormGroup(r))||[]),supersetId:[t?.supersetId||null],supersetOrder:[t?.supersetOrder??null],supersetSize:[t?.supersetSize??null],rounds:[t?.rounds??1,[M.min(1)]]});return i.get("supersetId")?.valueChanges.subscribe(()=>this.updateRoundsControlability(i)),i.get("supersetOrder")?.valueChanges.subscribe(()=>this.updateRoundsControlability(i)),this.updateRoundsControlability(i),i.get("exerciseId")?.valueChanges.subscribe(r=>{let o=this.availableExercises.find(s=>s.id===r);i.get("exerciseName")?.setValue(o?.name||"Unknown Exercise",{emitEvent:!1})}),i}createSetFormGroup(t){return this.fb.group({id:[t?.id||this.workoutService.generateExerciseSetId()],reps:[t?.reps??null,[M.min(0)]],weight:[t?.weight??null,[M.min(0)]],duration:[t?.duration??null,[M.min(0)]],tempo:[t?.tempo||""],restAfterSet:[t?.restAfterSet??60,[M.required,M.min(0)]],notes:[t?.notes||""]})}openExerciseSelectionModal(){this.modalSearchTerm.set(""),this.isExerciseModalOpen.set(!0)}closeExerciseSelectionModal(){this.isExerciseModalOpen.set(!1)}onModalSearchTermChange(t){let e=t.target;this.modalSearchTerm.set(e.value)}selectExercise(t){let e=this.createExerciseFormGroup({id:this.workoutService.generateWorkoutExerciseId(),exerciseId:t.id,exerciseName:t.name,sets:[{id:this.workoutService.generateExerciseSetId(),reps:8,weight:0,restAfterSet:60}],supersetId:null,supersetOrder:null,supersetSize:null,rounds:1});this.exercisesFormArray.push(e),this.closeExerciseSelectionModal()}ngAfterViewInit(){}addSet(t,e){let i=this.getSetsFormArray(t);i.push(this.createSetFormGroup()),this.cdr.detectChanges(),setTimeout(()=>{let r=0;for(let s=0;s<e;s++){let u=this.exercisesFormArray.at(s);r+=this.getSetsFormArray(u).length}r+=i.length-1;let o=this.setRepsInputs.toArray()[r];o&&o.nativeElement?(console.log("Focusing input:",o.nativeElement),o.nativeElement.focus(),o.nativeElement.select()):console.warn("Could not find reps input to focus at global index:",r,this.setRepsInputs.toArray())},0)}removeSet(t,e){this.getSetsFormArray(t).removeAt(e)}getFormErrors(t){let e={};return Object.keys(t.controls).forEach(i=>{let r=t.get(i).errors;if(r&&(e[i]=r),t.get(i)instanceof yi||t.get(i)instanceof Ii){let o=this.getFormErrors(t.get(i));Object.keys(o).length>0&&(e[i]=o)}}),e}get f(){return this.routineForm.controls}toggleExerciseSelectionForSuperset(t,e){let i=e.target;this.selectedExerciseIndicesForSuperset.update(r=>{let o;return i.checked?o=r.includes(t)?r:[...r,t]:o=r.filter(s=>s!==t),o.sort((s,u)=>s-u)})}canGroupSelectedExercises(){let t=this.selectedExerciseIndicesForSuperset();if(t.length<2)return!1;let e=this.exercisesFormArray.at(t[0]).get("supersetId")?.value;for(let i=1;i<t.length;i++){let r=t[i];t[i-1]+1;let o=this.exercisesFormArray.at(r).get("supersetId")?.value;if(e&&o&&e!==o||!e&&o)return!1}return!0}onExerciseDrop(t){if(t.previousContainer===t.container){let e=this.exercisesFormArray;bt(e.controls,t.previousIndex,t.currentIndex),e.updateValueAndValidity(),console.log(`Moved exercise from index ${t.previousIndex} to ${t.currentIndex}`),this.selectedExerciseIndicesForSuperset.set([]),this.handleSupersetIntegrityAfterDrag(t.previousIndex,t.currentIndex),this.recalculateSupersetOrders()}else console.log("Item dropped into a different container - not handled in this version.")}handleSupersetIntegrityAfterDrag(t,e){let i=new Set;if(i.add(t),i.add(e),t<e)for(let o=t;o<=e;o++)i.add(o);else for(let o=e;o<=t;o++)i.add(o);let r=new Set;i.forEach(o=>{if(o<this.exercisesFormArray.length){let u=this.exercisesFormArray.at(o).get("supersetId")?.value;u&&r.add(u)}}),r.forEach(o=>{console.log(`Drag operation potentially broke superset ${o}. Ungrouping it.`),this.exercisesFormArray.controls.forEach(s=>{let u=s;u.get("supersetId")?.value===o&&u.patchValue({supersetId:null,supersetOrder:null,supersetSize:null})})}),this.recalculateSupersetOrders()}recalculateSupersetOrders(){let t=new Map;this.exercisesFormArray.controls.forEach(e=>{let i=e,r=i.get("supersetId")?.value;r&&(t.has(r)||t.set(r,[]),t.get(r).push(i))}),t.forEach((e,i)=>{e.length<2?e.forEach(r=>r.patchValue({supersetId:null,supersetOrder:null,supersetSize:null})):e.forEach((r,o)=>{r.patchValue({supersetOrder:o,supersetSize:e.length},{emitEvent:!1})})}),this.exercisesFormArray.updateValueAndValidity()}groupSelectedAsSuperset(){let t=this.selectedExerciseIndicesForSuperset().sort((s,u)=>s-u);if(t.length<2){this.showErrorMessage("Select at least two exercises to form a superset.");return}for(let s=1;s<t.length;s++)if(t[s]!==t[s-1]+1){this.showErrorMessage("For this version, selected exercises must be contiguous to form a superset. Please reorder them first.");return}let e=At(),i=t.length,o=this.exercisesFormArray.at(t[0]).get("rounds")?.value??1;t.forEach((s,u)=>{let g=this.exercisesFormArray.at(s);g.patchValue({supersetId:e,supersetOrder:u,supersetSize:i,rounds:o}),this.updateRoundsControlability(g),g.get("sets").controls.forEach(S=>{u<i-1&&S.get("restAfterSet")?.setValue(0)})}),this.selectedExerciseIndicesForSuperset.set([])}ungroupSuperset(t){let e=this.exercisesFormArray.at(t),i=e.get("supersetId")?.value;if(!i)return;this.exercisesFormArray.controls.forEach(o=>{let s=o;s.get("supersetId")?.value===i&&s.patchValue({supersetId:null,supersetOrder:null,supersetSize:null})});let r=e.get("supersetId")?.value;r&&(this.exercisesFormArray.controls.forEach(o=>{let s=o;s.get("supersetId")?.value===r&&(s.patchValue({supersetId:null,supersetOrder:null,supersetSize:null}),this.updateRoundsControlability(s))}),this.selectedExerciseIndicesForSuperset.set([]))}removeExercise(t){let i=this.exercisesFormArray.at(t).get("supersetId")?.value;if(this.exercisesFormArray.removeAt(t),this.selectedExerciseIndicesForSuperset.set([]),i){let r=[];this.exercisesFormArray.controls.forEach(o=>{let s=o;s.get("supersetId")?.value===i&&r.push(s)}),r.length<2?r.forEach(o=>{o.patchValue({supersetId:null,supersetOrder:null,supersetSize:null})}):r.forEach((o,s)=>{o.patchValue({supersetOrder:s,supersetSize:r.length})})}this.recalculateSupersetOrders()}errorMessage=C(null);showErrorMessage(t,e=3e3){this.errorMessage.set(t),setTimeout(()=>this.errorMessage.set(null),e)}onSubmit(){if(this.isViewMode){console.log("In view mode, submission is disabled.");return}if(this.errorMessage.set(null),this.recalculateSupersetOrders(),!this.validateSupersetIntegrity()){this.showErrorMessage("Superset configuration is invalid. Please ensure supersets have at least two exercises and are contiguous.",1e4),console.error("Superset integrity validation failed during submission.");return}if(this.routineForm.invalid||!this.exercisesFormArray||this.exercisesFormArray.length===0){this.routineForm.markAllAsTouched(),this.showErrorMessage("Please fill in all required fields and correct any errors.",1e4),console.log("Form Errors:",this.getFormErrors(this.routineForm));return}let t=this.routineForm.value,e={id:this.isEditMode&&this.currentRoutineId?this.currentRoutineId:At(),name:t.name,description:t.description,goal:t.goal,exercises:t.exercises.map(i=>K(q({},i),{sets:i.sets.map(r=>K(q({},r),{weight:this.unitsService.convertToKg(r.weight,this.unitsService.currentUnit())??null,restAfterSet:r.restAfterSet??0}))}))};this.isNewMode?(this.workoutService.addRoutine(e),this.alertService.showAlert("Info","Routine added successfully!")):this.isEditMode?(this.workoutService.updateRoutine(e),this.alertService.showAlert("Info","Routine updated successfully!")):this.alertService.showAlert("Info","No operation done!"),this.router.navigate(["/workout"])}validateSupersetIntegrity(){let t=this.exercisesFormArray.value,e=new Map;for(let i of t)i.supersetId&&(e.has(i.supersetId)||e.set(i.supersetId,[]),e.get(i.supersetId).push(i));for(let[i,r]of e.entries()){if(r.length<2)return console.error(`Invalid superset ${i}: only ${r.length} exercise(s).`),!1;let o=r.sort((s,u)=>(s.supersetOrder??1/0)-(u.supersetOrder??1/0));for(let s=0;s<o.length;s++)if(o[s].supersetOrder!==s)return console.error(`Invalid superset order in ${i}. Exercise ${o[s].exerciseName} has order ${o[s].supersetOrder}, expected ${s}.`),!1}return!0}get firstSelectedExerciseIndexForSuperset(){let t=this.selectedExerciseIndicesForSuperset();return t.length>0?t[0]:null}updateRoundsControlability(t){let e=t.get("supersetId")?.value,i=t.get("supersetOrder")?.value,r=t.get("rounds");if(e&&i!==null&&i>0){r?.disable({emitEvent:!1});let o=this.exercisesFormArray.controls.find(s=>s.get("supersetId")?.value===e&&s.get("supersetOrder")?.value===0);o&&r?.setValue(o.get("rounds")?.value??1,{emitEvent:!1})}else r?.enable({emitEvent:!1})}syncSupersetRounds(t,e,i){!t||e===null||e===void 0||e<1||this.exercisesFormArray.at(i).get("supersetOrder")?.value!==0||this.exercisesFormArray.controls.forEach(o=>{let s=o;s.get("supersetId")?.value===t&&(s.get("rounds")?.value!==e&&s.get("rounds")?.setValue(e,{emitEvent:!1}),this.updateRoundsControlability(s))})}ngOnDestroy(){this.routeSub&&this.routeSub.unsubscribe()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-workout-builder"]],viewQuery:function(e,i){if(e&1&&Ot(Zr,5),e&2){let r;Vt(r=Lt())&&(i.setRepsInputs=r)}},features:[pe([be])],decls:31,vars:16,consts:[["setRepsInput",""],["class","my-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-md dark:bg-red-900/30 dark:border-red-600 dark:text-red-300",4,"ngIf"],[1,"container","mx-auto","p-4"],[1,"mb-6","pb-4","border-b","border-gray-200","dark:border-gray-700"],[1,"flex","justify-between","items-center"],[1,"text-3xl","font-bold","text-gray-800","dark:text-gray-200"],["routerLink","/workout",1,"text-sm","text-primary","dark:text-primary-light","hover:underline"],[1,"space-y-6","bg-white","dark:bg-gray-800","p-6","rounded-lg","shadow-md",3,"ngSubmit","formGroup"],["for","name",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300"],["type","text","id","name","formControlName","name",1,"mt-1","block","w-full","p-2","border","rounded-md","shadow-sm","focus:ring-primary","focus:border-primary",3,"ngClass"],["class","text-red-500 dark:text-red-400 text-xs mt-1",4,"ngIf"],["for","description",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300"],["id","description","formControlName","description","rows","3",1,"mt-1","block","w-full","p-2","border","border-gray-300","dark:border-gray-600","rounded-md","shadow-sm","focus:ring-primary","focus:border-primary"],["for","goal",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300"],["id","goal","formControlName","goal",1,"mt-1","block","w-full","p-2","border","border-gray-300","dark:border-gray-600","rounded-md","shadow-sm","focus:ring-primary","focus:border-primary"],[3,"value",4,"ngFor","ngForOf"],[1,"pt-4","border-t","border-gray-200","dark:border-gray-700"],["class","flex justify-between items-center mb-4",4,"ngIf"],["cdkDropList","","formArrayName","exercises",1,"exercise-list-container",3,"cdkDropListDropped","cdkDropListData"],[4,"ngFor","ngForOf"],["class","text-center py-6 text-gray-500 dark:text-gray-400 border border-dashed dark:border-gray-700 rounded-md",4,"ngIf"],["class","mt-6 text-center",4,"ngIf"],["class","pt-6 flex justify-end space-x-3",4,"ngIf"],["class","fixed inset-0 bg-gray-600 bg-opacity-75 transition-opacity overflow-y-auto h-full w-full z-50 flex items-center justify-center p-4",3,"click",4,"ngIf"],[1,"my-4","p-3","bg-red-100","border","border-red-400","text-red-700","rounded-md","dark:bg-red-900/30","dark:border-red-600","dark:text-red-300"],[1,"text-red-500","dark:text-red-400","text-xs","mt-1"],[4,"ngIf"],[3,"value"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-xl","font-semibold","text-gray-700","dark:text-gray-300"],["type","button",1,"bg-green-500","hover:enabled:bg-green-600","text-white","text-sm","font-medium","py-2","px-3","rounded-md","transition-all","duration-150","ease-in-out","disabled:opacity-50",3,"click","disabled"],[1,"relative","group","exercise-card-wrapper"],["class","absolute left-1/2 -translate-x-1/2 z-20","style","top: -1.25rem;",4,"ngIf"],["cdkDrag","",1,"p-4","border","rounded-lg","shadow","space-y-4","exercise-item","relative","transition-all","duration-150","ease-in-out",3,"cdkDragData","formGroupName","ngClass"],["cdkDragHandle","","class","absolute top-2 right-2 cursor-grab p-1 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300","title","Drag to reorder",4,"ngIf"],[1,"flex","items-start","justify-between","pb-2",3,"ngClass"],[1,"flex","items-center","pr-8"],["type","checkbox","class","h-5 w-5 text-orange-600 border-gray-300 rounded focus:ring-orange-500 mr-3 self-start mt-1",3,"id","checked","change",4,"ngIf"],[1,"text-lg","font-semibold","text-gray-800","dark:text-gray-100"],["class","text-xs text-orange-600 dark:text-orange-400 font-normal block",4,"ngIf"],[1,"flex","flex-col","items-end","space-y-1","ml-2","flex-shrink-0"],[1,"flex","items-center","space-x-1"],[1,"text-xs","font-medium","text-gray-600","dark:text-gray-400","whitespace-nowrap",3,"for"],["type","number","formControlName","rounds","min","1",1,"w-16","p-1","text-sm","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-200","disabled:opacity-50","disabled:bg-gray-200","dark:disabled:bg-gray-700",3,"change","id","readonly"],["type","button","class","flex mt-1 text-xs text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 font-medium py-1 px-2 rounded-md hover:enabled:bg-red-100 dark:enabled:hover:bg-red-900/50 disabled:opacity-50",3,"disabled","click",4,"ngIf"],["type","button","class","flex mt-1 text-xs text-violet-600 hover:text-violet-700 dark:text-violet-400 dark:hover:text-violet-300 font-medium py-1 px-2 rounded-md hover:bg-violet-100 dark:hover:bg-violet-900/50 disabled:opacity-50",3,"disabled","click",4,"ngIf"],[1,"space-y-3"],[1,"text-md","font-semibold","text-gray-700","dark:text-gray-300"],["formArrayName","sets",1,"space-y-2"],["class","grid grid-cols-12 gap-x-2 gap-y-1 items-center p-3 rounded-md bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600",3,"formGroupName",4,"ngFor","ngForOf"],["class","text-right",4,"ngIf"],[1,"absolute","left-1/2","-translate-x-1/2","z-20",2,"top","-1.25rem"],["type","button",1,"bg-orange-600","hover:bg-orange-700","text-white","text-xs","font-semibold","py-1.5","px-3","rounded-full","shadow-lg","whitespace-nowrap","transition-all","duration-150","ease-in-out","hover:scale-105","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["cdkDragHandle","","title","Drag to reorder",1,"absolute","top-2","right-2","cursor-grab","p-1","text-gray-400","hover:text-gray-600","dark:text-gray-500","dark:hover:text-gray-300"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"w-5","h-5"],["fill-rule","evenodd","d","M10 3a.75.75 0 0 1 .75.75v12.5a.75.75 0 0 1-1.5 0V3.75A.75.75 0 0 1 10 3ZM5.75 6.75a.75.75 0 0 0 0 1.5h8.5a.75.75 0 0 0 0-1.5h-8.5Zm0 5a.75.75 0 0 0 0 1.5h8.5a.75.75 0 0 0 0-1.5h-8.5Z","clip-rule","evenodd"],["type","checkbox",1,"h-5","w-5","text-orange-600","border-gray-300","rounded","focus:ring-orange-500","mr-3","self-start","mt-1",3,"change","id","checked"],[1,"text-xs","text-orange-600","dark:text-orange-400","font-normal","block"],["type","button",1,"flex","mt-1","text-xs","text-red-600","hover:text-red-700","dark:text-red-400","dark:hover:text-red-300","font-medium","py-1","px-2","rounded-md","hover:enabled:bg-red-100","dark:enabled:hover:bg-red-900/50","disabled:opacity-50",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-5","h-5","mr-1"],["stroke-linecap","round","stroke-linejoin","round","d","m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12.56 0c.342.052.682.107 1.022.166m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"],["type","button",1,"flex","mt-1","text-xs","text-violet-600","hover:text-violet-700","dark:text-violet-400","dark:hover:text-violet-300","font-medium","py-1","px-2","rounded-md","hover:bg-violet-100","dark:hover:bg-violet-900/50","disabled:opacity-50",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","d","M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75v4.5m0-4.5h-4.5m4.5 0L15 9m5.25 11.25v-4.5m0 4.5h-4.5m4.5 0L15 15"],[1,"grid","grid-cols-12","gap-x-2","gap-y-1","items-center","p-3","rounded-md","bg-gray-50","dark:bg-gray-700","border","border-gray-200","dark:border-gray-600",3,"formGroupName"],[1,"col-span-6","sm:col-span-2"],[1,"block","text-xs","font-medium","text-gray-600","dark:text-gray-400",3,"for"],["type","number","formControlName","reps","placeholder","Reps",1,"mt-0.5","w-full","p-1.5","text-sm","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-650",3,"id"],["type","number","formControlName","weight","placeholder","kg",1,"mt-0.5","w-full","p-1.5","text-sm","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-650",3,"id"],["type","number","formControlName","duration","placeholder","Secs",1,"mt-0.5","w-full","p-1.5","text-sm","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-650",3,"id"],["type","text","formControlName","tempo","placeholder","e.g. 2010",1,"mt-0.5","w-full","p-1.5","text-sm","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-650",3,"id"],[1,"col-span-10","sm:col-span-2"],["type","number","formControlName","restAfterSet","placeholder","Rest (s)",1,"mt-0.5","w-full","p-1.5","text-sm","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-650",3,"id"],["class","col-span-2 sm:col-span-1 flex items-end justify-end pb-0.5",4,"ngIf"],[1,"col-span-12","pt-1"],["type","text","formControlName","notes","placeholder","e.g. Drop set, pause reps",1,"mt-0.5","w-full","p-1.5","text-sm","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-650",3,"id"],[1,"col-span-2","sm:col-span-1","flex","items-end","justify-end","pb-0.5"],["type","button","title","Remove Set",1,"text-red-500","hover:text-red-600","dark:text-red-400","dark:hover:text-red-300","p-1.5","rounded-full","hover:enabled:bg-red-100","dark:hover:bg-red-900/50","disabled:opacity-50",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 16 16","fill","currentColor",1,"w-4","h-4"],["fill-rule","evenodd","d","M5 3.25A2.25 2.25 0 0 0 2.75 5.5v5A2.25 2.25 0 0 0 5 12.75h6a2.25 2.25 0 0 0 2.25-2.25v-5A2.25 2.25 0 0 0 11 3.25H5Zm.97 3.97a.75.75 0 0 1 1.06 0L8 8.28l.97-.97a.75.75 0 1 1 1.06 1.06L9.06 9.25l.97.97a.75.75 0 1 1-1.06 1.06L8 10.43l-.97.97a.75.75 0 0 1-1.06-1.06L6.94 9.25l-.97-.97a.75.75 0 0 1 0-1.06Z","clip-rule","evenodd"],[1,"text-right"],["type","button",1,"mt-1","text-sm","text-blue-600","hover:text-blue-700","dark:text-blue-400","dark:hover:text-blue-300","font-medium","py-1","px-2","rounded-md","hover:enabled:bg-blue-100","dark:hover:bg-blue-900/50","disabled:opacity-50",3,"click","disabled"],[1,"text-center","py-6","text-gray-500","dark:text-gray-400","border","border-dashed","dark:border-gray-700","rounded-md"],[1,"mb-2"],["type","button",1,"bg-green-500","hover:bg-green-600","text-white","text-sm","font-medium","py-2","px-3","rounded-md","transition-all","duration-150","ease-in-out",3,"click"],[1,"mt-6","text-center"],["type","button",1,"bg-green-500","hover:bg-green-600","text-white","font-semibold","py-2","px-6","rounded-md","shadow-md","hover:shadow-lg","transition-all","duration-300","focus:outline-none","focus:ring-2","focus:ring-green-400","focus:ring-opacity-75",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"w-5","h-5","mr-2","inline-block"],["d","M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z"],[1,"pt-6","flex","justify-end","space-x-3"],["routerLink","/workout",1,"px-4","py-2","border","border-gray-300","dark:border-gray-600","rounded-md","shadow-sm","text-sm","font-medium","text-gray-700","dark:text-gray-200","hover:bg-gray-50","dark:hover:bg-gray-700"],["type","submit",1,"px-4","py-2","border","border-transparent","rounded-md","shadow-sm","text-sm","font-medium","text-white","bg-primary","hover:bg-primary-dark","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-primary-dark","disabled:opacity-50","transition-all","duration-150","ease-in-out",3,"disabled"],[1,"fixed","inset-0","bg-gray-600","bg-opacity-75","transition-opacity","overflow-y-auto","h-full","w-full","z-50","flex","items-center","justify-center","p-4",3,"click"],[1,"relative","transform","overflow-hidden","rounded-lg","bg-white","dark:bg-gray-800","text-left","shadow-xl","transition-all","sm:my-8","sm:w-full","sm:max-w-lg",3,"click"],[1,"bg-white","dark:bg-gray-800","px-4","pt-5","pb-4","sm:p-6","sm:pb-4"],[1,"sm:flex","sm:items-start","w-full"],[1,"mt-3","text-center","sm:mt-0","sm:text-left","w-full"],[1,"flex","justify-between","items-center","pb-3"],["id","modal-title",1,"text-xl","font-semibold","leading-6","text-gray-900","dark:text-gray-100"],["type","button",1,"p-1","rounded-full","text-gray-400","hover:text-gray-600","dark:hover:text-gray-300","focus:outline-none",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","d","M6 18 18 6M6 6l12 12"],[1,"my-4"],["type","text","placeholder","Search exercises by name, category, muscle...",1,"w-full","p-2","border","border-gray-300","dark:border-gray-600","rounded-md","shadow-sm","focus:ring-primary","focus:border-primary","dark:bg-gray-700","dark:text-gray-200",3,"ngModelChange","ngModel"],[1,"mt-2","max-h-80","overflow-y-auto","pr-2"],[1,"space-y-1"],["class","p-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md cursor-pointer transition-all duration-150 ease-in-out flex justify-between items-center",3,"click",4,"ngFor","ngForOf"],["class","text-gray-500 dark:text-gray-400 text-center p-4",4,"ngIf"],[1,"bg-gray-50","dark:bg-gray-750","px-4","py-3","sm:flex","sm:flex-row-reverse","sm:px-6"],["type","button",1,"mt-3","inline-flex","w-full","justify-center","rounded-md","bg-white","dark:bg-gray-600","px-3","py-2","text-sm","font-semibold","text-gray-900","dark:text-gray-200","shadow-sm","ring-1","ring-inset","ring-gray-300","dark:ring-gray-500","hover:bg-gray-50","dark:hover:bg-gray-500","sm:mt-0","sm:w-auto",3,"click"],[1,"p-3","hover:bg-gray-100","dark:hover:bg-gray-700","rounded-md","cursor-pointer","transition-all","duration-150","ease-in-out","flex","justify-between","items-center",3,"click"],[1,"font-medium","text-gray-800","dark:text-gray-200"],[1,"block","text-xs","text-gray-500","dark:text-gray-400"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"w-5","h-5","text-primary","dark:text-primary-light"],["fill-rule","evenodd","d","M8.22 5.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06-1.06L11.94 10 8.22 6.28a.75.75 0 0 1 0-1.06Z","clip-rule","evenodd"],[1,"text-gray-500","dark:text-gray-400","text-center","p-4"]],template:function(e,i){e&1&&(f(0,Qr,2,1,"div",1),l(1,"div",2)(2,"header",3)(3,"div",4)(4,"h1",5),c(5),a(),l(6,"a",6),c(7," \u2190 Back to Routines "),a()()(),l(8,"form",7),y("ngSubmit",function(){return i.onSubmit()}),l(9,"div")(10,"label",8),c(11,"Routine Name"),a(),k(12,"input",9),f(13,Xr,2,1,"div",10),a(),l(14,"div")(15,"label",11),c(16,"Description (Optional)"),a(),k(17,"textarea",12),a(),l(18,"div")(19,"label",13),c(20,"Primary Goal"),a(),l(21,"select",14),f(22,en,2,2,"option",15),a()(),l(23,"div",16),f(24,tn,5,1,"div",17),l(25,"div",18),y("cdkDropListDropped",function(o){return i.onExerciseDrop(o)}),f(26,pn,25,28,"ng-container",19),a(),f(27,mn,5,0,"div",20)(28,gn,5,0,"div",21),a(),f(29,hn,5,2,"div",22),a(),f(30,vn,21,4,"div",23),a()),e&2&&(m("ngIf",i.errorMessage()),d(5),b(" ",i.isNewMode?"New routine":i.isViewMode?"View Routine":"Edit routine"," "),d(3),m("formGroup",i.routineForm),d(4),m("ngClass",me(13,qr,i.f.name.invalid&&i.f.name.touched,!(i.f.name.invalid&&i.f.name.touched))),d(),m("ngIf",i.f.name.invalid&&(i.f.name.dirty||i.f.name.touched)),d(9),m("ngForOf",i.routineGoals),d(2),m("ngIf",i.isEditMode&&i.exercisesFormArray.length>0),d(),m("cdkDropListData",i.exercisesFormArray.controls),d(),m("ngForOf",i.exercisesFormArray.controls),d(),m("ngIf",i.exercisesFormArray.length===0),d(),m("ngIf",i.isEditMode&&i.exercisesFormArray.length>0),d(),m("ngIf",i.isEditMode),d(),m("ngIf",i.isExerciseModalOpen()))},dependencies:[U,ve,j,H,Ke,at,tt,ki,Ci,Qe,it,wi,Je,Xe,Ei,rt,nt,bi,Si,Ye,st,et,dr,lr,ar,nr],styles:[".exercise-list-container[_ngcontent-%COMP%]{min-height:60px}.exercise-item[_ngcontent-%COMP%]{transition:box-shadow .2s ease-in-out}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:.4;background:#ccc;border:dotted 2px #999;min-height:100px;transition:transform .25s cubic-bezier(0,0,.2,1);display:block;margin-bottom:.5rem}.cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f;border-radius:.5rem;background-color:var(--card-background-color, white)}body.dark[_ngcontent-%COMP%]   .cdk-drag-preview[_ngcontent-%COMP%]{background-color:var(--dark-card-background-color, #1f2937)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .exercise-item[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"]})};var yn=(n,t,e)=>({"text-red-500 dark:text-red-400 animate-pulse":n,"text-green-500 dark:text-green-400":t,"text-gray-800 dark:text-gray-100":e}),bn=(n,t)=>({"bg-green-500 hover:bg-green-600":n,"bg-yellow-500 hover:bg-yellow-600":t}),cr=(n,t)=>({"border-red-500 dark:border-red-400":n,"border-gray-300 dark:border-gray-600":t});function Sn(n,t){if(n&1&&(l(0,"div",17),c(1),a()),n&2){let e=p(3);d(),L(" Round ",e.currentBlockRound()," of ",e.totalBlockRounds()," ")}}function wn(n,t){if(n&1&&k(0,"img",33),n&2){let e=p().ngIf;m("src",e.imageUrls[0],ci)("alt",e.name)}}function kn(n,t){n&1&&(l(0,"div",34),c(1," No Image"),a())}function Cn(n,t){if(n&1&&(l(0,"div",30),f(1,wn,1,2,"img",31)(2,kn,2,0,"div",32),a()),n&2){let e=t.ngIf;d(),m("ngIf",e.imageUrls&&e.imageUrls.length>0),d(),m("ngIf",!e.imageUrls||e.imageUrls.length===0)}}function En(n,t){n&1&&(l(0,"div",35),c(1," Loading..."),a())}function In(n,t){if(n&1&&(l(0,"span"),c(1),a()),n&2){let e=p(5);d(),b(" (Round ",e.currentBlockRound(),") ")}}function Dn(n,t){if(n&1&&(l(0,"div",36),c(1),f(2,In,2,1,"span",37),a()),n&2){let e=p().ngIf,i=p(3);d(),L(" SUPERSET ",(e.exerciseData.supersetOrder??0)+1," of ",e.exerciseData.supersetSize||"?"," "),d(),m("ngIf",i.totalBlockRounds()>1&&(!e.exerciseData.supersetId||e.exerciseData.supersetOrder===0))}}function Rn(n,t){if(n&1&&(l(0,"div",38),c(1),a()),n&2){let e=p(4);d(),L(" ROUND ",e.currentBlockRound()," of ",e.totalBlockRounds()," ")}}function Tn(n,t){n&1&&(l(0,"span",39),c(1,"(in current superset)"),a())}function Pn(n,t){if(n&1&&(l(0,"p",40),c(1),a()),n&2){let e,i=p(4);d(),b(" ",(e=i.currentBaseExercise())==null?null:e.description," ")}}function Fn(n,t){if(n&1&&(l(0,"em",53),c(1),a()),n&2){let e=p(2).$implicit;d(),b("(T: ",e.targetReps,")")}}function On(n,t){if(n&1&&(l(0,"span",50),c(1," Reps: "),l(2,"strong",51),c(3),a(),f(4,Fn,2,1,"em",52),a()),n&2){let e=p().$implicit;d(3),D(e.repsAchieved),d(),m("ngIf",e.targetReps!==void 0&&e.targetReps!==e.repsAchieved)}}function Vn(n,t){if(n&1&&(l(0,"em",53),c(1),a()),n&2){let e=p(2).$implicit;d(),b("(T: ",e.targetWeight," kg)")}}function Ln(n,t){if(n&1&&(l(0,"span",50),c(1," Weight: "),l(2,"strong",51),c(3),a(),f(4,Vn,2,1,"em",52),a()),n&2){let e=p().$implicit;d(3),b("",e.weightUsed," kg"),d(),m("ngIf",e.targetWeight!==void 0&&e.targetWeight!==null&&e.targetWeight!==e.weightUsed)}}function Mn(n,t){if(n&1&&(l(0,"em",53),c(1),a()),n&2){let e=p(2).$implicit;d(),b("(T: ",e.targetDuration,"s)")}}function An(n,t){if(n&1&&(l(0,"span"),c(1," Time: "),l(2,"strong",51),c(3),a(),f(4,Mn,2,1,"em",52),a()),n&2){let e=p().$implicit;d(3),b("",e.durationPerformed,"s"),d(),m("ngIf",e.targetDuration!==void 0&&e.targetDuration!==e.durationPerformed)}}function Nn(n,t){if(n&1&&(l(0,"p",54)(1,"em",39),c(2),a()()),n&2){let e=p().$implicit;d(2),b("Notes: ",e.notes)}}function Wn(n,t){if(n&1&&(l(0,"div",45)(1,"p",46),c(2),a(),l(3,"div",47),f(4,On,5,2,"span",48)(5,Ln,5,2,"span",48)(6,An,5,2,"span",37)(7,Nn,3,1,"p",49),a()()),n&2){let e=t.$implicit,i=t.index;d(2),b(" Set ",i+1,": "),d(2),m("ngIf",e.repsAchieved!==void 0),d(),m("ngIf",e.weightUsed!==void 0&&e.weightUsed!==null),d(),m("ngIf",e.durationPerformed!==void 0),d(),m("ngIf",e.notes)}}function Bn(n,t){if(n&1&&(l(0,"div",41)(1,"h4",42),c(2," Completed Sets for this Exercise: "),a(),l(3,"div",43),f(4,Wn,8,5,"div",44),a()()),n&2){let e=p(4);d(4),m("ngForOf",e.allPreviousLoggedSetsForCurrentExercise())}}function zn(n,t){n&1&&(l(0,"span",77),c(1,"(Previously Logged This Session)"),a())}function Gn(n,t){if(n&1&&(l(0,"li"),c(1),a()),n&2){let e=p().ngIf;d(),b("Reps: ",e.repsAchieved)}}function jn(n,t){if(n&1&&(l(0,"li"),c(1),P(2,"weightUnit"),a()),n&2){let e=p().ngIf,i=p().ngIf;d(),L("Weight: ",e.weightUsed," ",B(2,2,i.setData.weight,"1.0-2"))}}function Hn(n,t){if(n&1&&(l(0,"li"),c(1),a()),n&2){let e=p().ngIf;d(),b("Time: ",e.durationPerformed,"s")}}function Un(n,t){if(n&1&&(l(0,"div",78)(1,"p",79),c(2),P(3,"date"),a(),l(4,"ul",80),f(5,Gn,2,1,"li",37)(6,jn,3,5,"li",37)(7,Hn,2,1,"li",37),a()()),n&2){let e=t.ngIf,i=p(5);d(2),b("Last time (",B(3,4,i.lastPerformanceForCurrentExercise==null?null:i.lastPerformanceForCurrentExercise.lastPerformedDate,"dd/MM/yyyy HH:mm"),"):"),d(3),m("ngIf",e.repsAchieved!==void 0),d(),m("ngIf",e.weightUsed!==void 0&&e.weightUsed!==null),d(),m("ngIf",e.durationPerformed!==void 0)}}function $n(n,t){if(n&1&&(l(0,"div")(1,"span",85),c(2),a(),l(3,"strong",51),c(4),a(),l(5,"em",86),c(6),P(7,"date"),a()()),n&2){let e=t.$implicit,i=p(6);d(2),b("",e.pbType,": "),d(2),D(i.formatPbValue(e)),d(2),b(" (",B(7,3,e.timestamp,"shortDate"),")")}}function Zn(n,t){if(n&1&&(l(0,"div",81)(1,"p",82),c(2),a(),l(3,"div",83),f(4,$n,8,6,"div",84),a()()),n&2){let e,i=p(5);d(2),b("Personal Bests for ",((e=i.currentBaseExercise())==null?null:e.name)||"this exercise",":"),d(2),m("ngForOf",i.exercisePBs())}}function qn(n,t){if(n&1&&(l(0,"div",81)(1,"p",87),c(2),a()()),n&2){let e,i=p(5);d(2),b("No personal bests recorded yet for ",(e=i.currentBaseExercise())==null?null:e.name,".")}}function Kn(n,t){if(n&1){let e=w();l(0,"div",91),y("click",function(){x(e);let r=p(6);return v(r.startEditTarget("reps"))}),c(1),a()}if(n&2){let e=p(2).ngIf;d(),b(" ",e.setData.reps," ")}}function Yn(n,t){if(n&1){let e=w();l(0,"div",92)(1,"input",93),Ze("ngModelChange",function(r){x(e);let o=p(6);return $e(o.editingTargetValue,r)||(o.editingTargetValue=r),v(r)}),y("keyup.enter",function(){x(e);let r=p(6);return v(r.confirmEditTarget())})("keyup.escape",function(){x(e);let r=p(6);return v(r.cancelEditTarget())}),a(),l(2,"button",94),y("click",function(){x(e);let r=p(6);return v(r.confirmEditTarget())}),c(3,"\u2713"),a(),l(4,"button",95),y("click",function(){x(e);let r=p(6);return v(r.cancelEditTarget())}),c(5,"\u2715"),a()()}if(n&2){let e=p(6);d(),Ue("ngModel",e.editingTargetValue)}}function Qn(n,t){if(n&1&&(l(0,"div")(1,"span",88),c(2,"Target Reps"),a(),f(3,Kn,2,1,"div",89)(4,Yn,6,1,"div",90),a()),n&2){let e=p(5);d(3),m("ngIf",e.editingTarget!=="reps"),d(),m("ngIf",e.editingTarget==="reps")}}function Jn(n,t){if(n&1){let e=w();l(0,"div",91),y("click",function(){x(e);let r=p(6);return v(r.startEditTarget("weight"))}),c(1),l(2,"span",96),c(3,"kg"),a()()}if(n&2){let e=p(2).ngIf;d(),b(" ",e.setData.weight," ")}}function Xn(n,t){if(n&1){let e=w();l(0,"div",92)(1,"input",93),Ze("ngModelChange",function(r){x(e);let o=p(6);return $e(o.editingTargetValue,r)||(o.editingTargetValue=r),v(r)}),y("keyup.enter",function(){x(e);let r=p(6);return v(r.confirmEditTarget())})("keyup.escape",function(){x(e);let r=p(6);return v(r.cancelEditTarget())}),a(),l(2,"button",94),y("click",function(){x(e);let r=p(6);return v(r.confirmEditTarget())}),c(3,"\u2713"),a(),l(4,"button",95),y("click",function(){x(e);let r=p(6);return v(r.cancelEditTarget())}),c(5,"\u2715"),a()()}if(n&2){let e=p(6);d(),Ue("ngModel",e.editingTargetValue)}}function eo(n,t){if(n&1&&(l(0,"div")(1,"span",88),c(2,"Target Weight"),a(),f(3,Jn,4,1,"div",89)(4,Xn,6,1,"div",90),a()),n&2){let e=p(5);d(3),m("ngIf",e.editingTarget!=="weight"),d(),m("ngIf",e.editingTarget==="weight")}}function to(n,t){if(n&1){let e=w();l(0,"div",91),y("click",function(){x(e);let r=p(6);return v(r.startEditTarget("duration"))}),c(1),l(2,"span",96),c(3,"s"),a()()}if(n&2){let e=p(2).ngIf;d(),b(" ",e.setData.duration)}}function io(n,t){if(n&1){let e=w();l(0,"div",92)(1,"input",93),Ze("ngModelChange",function(r){x(e);let o=p(6);return $e(o.editingTargetValue,r)||(o.editingTargetValue=r),v(r)}),y("keyup.enter",function(){x(e);let r=p(6);return v(r.confirmEditTarget())})("keyup.escape",function(){x(e);let r=p(6);return v(r.cancelEditTarget())}),a(),l(2,"button",94),y("click",function(){x(e);let r=p(6);return v(r.confirmEditTarget())}),c(3,"\u2713"),a(),l(4,"button",95),y("click",function(){x(e);let r=p(6);return v(r.cancelEditTarget())}),c(5,"\u2715"),a()()}if(n&2){let e=p(6);d(),Ue("ngModel",e.editingTargetValue)}}function ro(n,t){if(n&1&&(l(0,"div")(1,"span",88),c(2,"Target Time"),a(),f(3,to,4,1,"div",89)(4,io,6,1,"div",90),a()),n&2){let e=p(5);d(3),m("ngIf",e.editingTarget!=="duration"),d(),m("ngIf",e.editingTarget==="duration")}}function no(n,t){if(n&1&&(l(0,"div")(1,"span",88),c(2,"Target Tempo"),a(),l(3,"span",97),c(4),a()()),n&2){let e=p().ngIf;d(4),D(e.setData.tempo)}}function oo(n,t){n&1&&(l(0,"span"),c(1,"Reps cannot be negative."),a())}function so(n,t){if(n&1&&(l(0,"div",101),f(1,oo,2,0,"span",37),a()),n&2){let e=p(6);d(),m("ngIf",e.csf.actualReps.errors==null?null:e.csf.actualReps.errors.min)}}function ao(n,t){if(n&1&&(l(0,"div",98)(1,"label",99),c(2,"Actual Reps"),a(),k(3,"input",100),f(4,so,2,1,"div",72),a()),n&2){let e=p(5);d(3),m("ngClass",me(2,cr,e.csf.actualReps.invalid&&e.csf.actualReps.touched,!(e.csf.actualReps.invalid&&e.csf.actualReps.touched))),d(),m("ngIf",e.csf.actualReps.invalid&&e.csf.actualReps.touched)}}function lo(n,t){n&1&&(l(0,"span"),c(1,"Weight cannot be negative."),a())}function co(n,t){if(n&1&&(l(0,"div",101),f(1,lo,2,0,"span",37),a()),n&2){let e=p(6);d(),m("ngIf",e.csf.actualWeight.errors==null?null:e.csf.actualWeight.errors.min)}}function uo(n,t){if(n&1&&(l(0,"div",98)(1,"label",102),c(2),P(3,"weightUnit"),a(),k(4,"input",103),f(5,co,2,1,"div",72),a()),n&2){let e=p().ngIf,i=p(4);d(2),b("Actual Weight (",B(3,3,e.setData.weight,"1.0-2"),")"),d(2),m("ngClass",me(6,cr,i.csf.actualWeight.invalid&&i.csf.actualWeight.touched,!(i.csf.actualWeight.invalid&&i.csf.actualWeight.touched))),d(),m("ngIf",i.csf.actualWeight.invalid&&i.csf.actualWeight.touched)}}function po(n,t){n&1&&(l(0,"span"),c(1,"Start Timer"),a())}function mo(n,t){n&1&&(l(0,"span"),c(1,"Pause Timer"),a())}function go(n,t){n&1&&(l(0,"span"),c(1,"Resume Timer"),a())}function ho(n,t){if(n&1){let e=w();l(0,"button",104),y("click",function(){x(e);let r=p(5);return v(r.resetTimedSet())}),c(1," Reset "),a()}}function _o(n,t){n&1&&(l(0,"span"),c(1,"Duration cannot be negative."),a())}function fo(n,t){if(n&1&&(l(0,"div",101),f(1,_o,2,0,"span",37),a()),n&2){let e=p(5);d(),m("ngIf",e.csf.actualDuration.errors==null?null:e.csf.actualDuration.errors.min)}}function xo(n,t){if(n&1){let e=w();l(0,"div",55)(1,"h3",56),c(2),f(3,zn,2,0,"span",57),a(),l(4,"div",58),f(5,Un,8,7,"div",59)(6,Zn,5,2,"div",60)(7,qn,3,1,"div",60)(8,Qn,5,2,"div",37)(9,eo,5,2,"div",37)(10,ro,5,2,"div",37)(11,no,5,1,"div",37),a(),l(12,"form",61)(13,"div",62),f(14,ao,5,5,"div",63)(15,uo,6,9,"div",63),l(16,"div",64)(17,"div",65)(18,"label",66),c(19,"Actual Time"),a(),l(20,"span",67),c(21),P(22,"number"),a()(),k(23,"input",68),l(24,"div",69)(25,"button",70),y("click",function(){x(e);let r=p(4);return v(r.toggleTimedSetTimer())}),f(26,po,2,0,"span",37)(27,mo,2,0,"span",37)(28,go,2,0,"span",37),a(),f(29,ho,2,0,"button",71),a(),f(30,fo,2,1,"div",72),a()(),l(31,"div",73)(32,"label",74),c(33,"Notes for this set (optional)"),a(),k(34,"textarea",75),a()(),l(35,"button",76),y("click",function(){x(e);let r=p(4);return v(r.completeSetAndProceed())}),c(36),a()()}if(n&2){let e=t.ngIf,i=p(4);d(2),L(" Set ",e.setIndex+1," of ",e.exerciseData.sets.length," "),d(),m("ngIf",e.isCompleted),d(2),m("ngIf",i.trackingService.findPreviousSetPerformance(i.lastPerformanceForCurrentExercise,e.setData,e.setIndex)),d(),m("ngIf",i.exercisePBs().length>0),d(),m("ngIf",i.currentBaseExercise()&&i.exercisePBs().length===0),d(),m("ngIf",e.setData.reps!==void 0),d(),m("ngIf",e.setData.weight!==void 0&&e.setData.weight!==null),d(),m("ngIf",e.setData.duration!==void 0),d(),m("ngIf",e.setData.tempo),d(),m("formGroup",i.currentSetForm),d(2),m("ngIf",e.setData.reps!==void 0),d(),m("ngIf",e.setData.weight!==void 0&&e.setData.weight!==null),d(5),m("ngClass",hi(26,yn,i.csf.actualDuration.value>e.setData.duration&&e.setData.duration>0&&i.timedSetTimerState()==="running",i.csf.actualDuration.value<=e.setData.duration&&e.setData.duration>0&&i.timedSetTimerState()==="running"&&i.csf.actualDuration.value>0,i.timedSetTimerState()!=="running"||i.csf.actualDuration.value===0)),d(),b(" ",B(22,23,i.csf.actualDuration.value||0,"1.0-0"),"s "),d(4),m("disabled",i.isResting())("ngClass",me(30,bn,i.timedSetTimerState()==="idle"||i.timedSetTimerState()==="paused",i.timedSetTimerState()==="running")),d(),m("ngIf",i.timedSetTimerState()==="idle"),d(),m("ngIf",i.timedSetTimerState()==="running"),d(),m("ngIf",i.timedSetTimerState()==="paused"),d(),m("ngIf",i.timedSetTimerState()!=="idle"),d(),m("ngIf",i.csf.actualDuration.invalid&&i.csf.actualDuration.touched),d(6),b(" ",i.checkIfLatestSetOfLatestExercise()?"Complete workout":"Complete Set & Rest"," ")}}function vo(n,t){if(n&1){let e=w();l(0,"div",105)(1,"p",106),c(2),a(),l(3,"p",107),c(4),a(),l(5,"p",108),c(6),a(),l(7,"button",109),y("click",function(){x(e);let r=p(4);return v(r.skipRest())}),c(8),a()()}if(n&2){let e,i,r=p().ngIf,o=p().ngIf,s=p(2);d(2),b(" ",((e=s.activeSetInfo())==null||e.setData==null?null:e.setData.restAfterSet)===0&&(!((e=s.activeSetInfo())==null||e.exerciseData==null)&&e.exerciseData.supersetId)?"SUPERSET TRANSITION":"RESTING"," "),d(2),D(s.restTimerDisplay()),d(2),b(" Next: ",s.getNextUpText(r,o)," "),d(2),b(" Skip ",((i=s.activeSetInfo())==null||i.setData==null?null:i.setData.restAfterSet)===0&&(!((i=s.activeSetInfo())==null||i.exerciseData==null)&&i.exerciseData.supersetId)?"Transition":"Rest"," ")}}function yo(n,t){if(n&1&&(ce(0),l(1,"div",18)(2,"div",19),f(3,Cn,3,2,"div",20)(4,En,2,0,"ng-template",null,3,G),l(6,"div"),f(7,Dn,3,3,"div",21)(8,Rn,2,2,"div",22),l(9,"h2",23),c(10),a(),l(11,"p",24),c(12),f(13,Tn,2,0,"span",25),a()()(),f(14,Pn,2,1,"p",26),a(),f(15,Bn,5,1,"div",27)(16,xo,37,33,"div",28)(17,vo,9,4,"div",29),ue()),n&2){let e,i=t.ngIf,r=z(5),o=p().ngIf,s=p(2);d(3),m("ngIf",s.currentBaseExercise())("ngIfElse",r),d(4),m("ngIf",i.exerciseData.supersetId),d(),m("ngIf",!i.exerciseData.supersetId&&s.totalBlockRounds()>1&&s.currentBlockRound()>0),d(2),b(" ",i.exerciseData.exerciseName||"Loading Exercise Name..."," "),d(2),L(" Exercise ",i.exerciseIndex+1," of ",o.exercises.length," "),d(),m("ngIf",i.exerciseData.supersetId),d(),m("ngIf",(e=s.currentBaseExercise())==null?null:e.description),d(),m("ngIf",s.allPreviousLoggedSetsForCurrentExercise().length>0),d(),m("ngIf",s.activeSetInfo()),d(),m("ngIf",s.isResting())}}function bo(n,t){if(n&1){let e=w();l(0,"div",110)(1,"h2",111),c(2,"Workout Complete or Error!"),a(),l(3,"p",112),c(4," (This state means all sets are done or there was an issue loading active set) "),a(),l(5,"button",113),y("click",function(){x(e);let r=p(3);return v(r.finishWorkout())}),c(6," Confirm & Finish Workout "),a()()}}function So(n,t){if(n&1){let e=w();ce(0),l(1,"header",7)(2,"div",8)(3,"h1",9),c(4),a(),l(5,"button",10),y("click",function(){x(e);let r=p(2);return v(r.quitWorkout())}),c(6," Quit Workout "),a()(),l(7,"div",11),c(8," Session Time: "),l(9,"span",12),c(10),a()(),f(11,Sn,2,2,"div",13),a(),l(12,"div",14),f(13,yo,18,12,"ng-container",6)(14,bo,7,0,"ng-template",null,2,G),a(),l(16,"footer",15)(17,"button",16),y("click",function(){x(e);let r=p(2);return v(r.finishWorkout())}),c(18," Finish Workout Early "),a()(),ue()}if(n&2){let e=t.ngIf,i=z(15),r=p(2);d(3),m("title",e.name),d(),b(" ",e.name," "),d(6),D(r.sessionTimerDisplay()),d(),m("ngIf",r.totalBlockRounds()>1),d(2),m("ngIf",r.activeSetInfo())("ngIfElse",i)}}function wo(n,t){n&1&&(l(0,"div",114)(1,"h2",115),c(2,"Routine Not Found"),a(),l(3,"p",112),c(4,"The selected routine could not be loaded."),a(),l(5,"a",116),c(6," \u2190 Back to Routines "),a()())}function ko(n,t){if(n&1&&(l(0,"div",5),f(1,So,19,6,"ng-container",6)(2,wo,7,0,"ng-template",null,1,G),a()),n&2){let e=z(3),i=p();d(),m("ngIf",i.routine())("ngIfElse",e)}}function Co(n,t){n&1&&(l(0,"div",114)(1,"p",117),c(2,"Loading workout player..."),a()())}var wt=class n{route=h(Se);router=h(ne);workoutService=h(we);exerciseService=h(ke);trackingService=h(dt);fb=h(ot);currentSetForm;routineId=null;routine=C(void 0);currentExerciseIndex=C(0);currentSetIndex=C(0);currentWorkoutLogExercises=C([]);workoutStartTime=0;routeSub;timerSub;restTimerSub;sessionTimerDisplay=C("00:00:00");restTimerDisplay=C(null);isResting=C(!1);currentBlockRound=C(1);totalBlockRounds=C(1);activeSetInfo=Fe(()=>{let t=this.routine(),e=this.currentExerciseIndex(),i=this.currentSetIndex();if(t&&t.exercises[e]&&t.exercises[e].sets[i]){let r=t.exercises[e],o=t.exercises[e].sets[i],u=this.currentWorkoutLogExercises().find(g=>g.exerciseId===r.exerciseId)?.sets.find(g=>g.plannedSetId===o.id);return{exerciseIndex:e,setIndex:i,exerciseData:r,setData:o,baseExerciseInfo:void 0,isCompleted:!!u,actualReps:u?.repsAchieved,actualWeight:u?.weightUsed,actualDuration:u?.durationPerformed,notes:u?.notes}}return null});currentBaseExercise=C(void 0);exercisePBs=C([]);timedSetTimerState=C("idle");timedSetElapsedSeconds=C(0);timedSetIntervalSub;allPreviousLoggedSetsForCurrentExercise=Fe(()=>{let t=this.activeSetInfo();if(!t||t.setIndex===0)return[];let e=this.currentWorkoutLogExercises().find(i=>i.exerciseId===t.exerciseData.exerciseId);if(e&&e.sets.length>0){let i=[];for(let r=0;r<t.setIndex;r++){let o=t.exerciseData.sets[r]?.id;if(o){let s=e.sets.find(u=>u.plannedSetId===o);s&&i.push(s)}}return i}return[]});lastPerformanceForCurrentExercise=null;editingTarget=null;editingTargetValue="";constructor(){this.initializeCurrentSetForm()}ngOnInit(){this.workoutStartTime=Date.now(),this.startSessionTimer(),this.routeSub=this.route.paramMap.pipe(X(t=>(this.routineId=t.get("routineId"),this.routineId?this.workoutService.getRoutineById(this.routineId).pipe(ie(e=>e?JSON.parse(JSON.stringify(e)):null)):Q(null))),re(t=>{if(t){if(this.routine.set(t),t.exercises.length>0){let e=t.exercises[0];if(!e.supersetId||e.supersetOrder===0)this.totalBlockRounds.set(e.rounds??1);else{let i=t.exercises.find(r=>r.supersetId===e.supersetId&&r.supersetOrder===0);this.totalBlockRounds.set(i?.rounds??1)}}else this.totalBlockRounds.set(1);this.currentBlockRound.set(1),this.prepareCurrentSet()}else this.routine.set(null),console.error("WorkoutPlayer: Routine not found or ID missing.")})).subscribe()}resetAndPatchCurrentSetForm(){this.currentSetForm.reset();let t=this.activeSetInfo();if(this.resetTimedSet(),t){let i=this.currentWorkoutLogExercises().find(r=>r.exerciseId===t.exerciseData.exerciseId)?.sets.find(r=>r.plannedSetId===t.setData.id);i?this.currentSetForm.patchValue({actualReps:i.repsAchieved,actualWeight:i.weightUsed,actualDuration:i.durationPerformed,setNotes:i.notes}):this.currentSetForm.patchValue({actualReps:t.setData.reps??null,actualWeight:t.setData.weight??null,actualDuration:t.setData.duration??null,setNotes:""}),t.setData.duration&&!t.setData.reps&&!t.setData.weight&&this.currentSetForm.get("actualDuration")?.setValue(t.setData.duration)}}startSessionTimer(){this.timerSub=Ae(0,1e3).pipe(ie(()=>Math.floor((Date.now()-this.workoutStartTime)/1e3))).subscribe(t=>{let e=Math.floor(t/3600),i=Math.floor(t%3600/60),r=t%60;this.sessionTimerDisplay.set(`${String(e).padStart(2,"0")}:${String(i).padStart(2,"0")}:${String(r).padStart(2,"0")}`)})}startRestTimer(t){this.restTimerSub&&this.restTimerSub.unsubscribe(),this.isResting.set(!0);let e=t;this.updateRestTimerDisplay(e);let i=this.activeSetInfo(),r=this.routine();this.restTimerSub=Ae(0,1e3).pipe(ai(()=>e>=0)).subscribe(()=>{this.updateRestTimerDisplay(e),e===0&&(this.isResting.set(!1),this.restTimerDisplay.set(null)),e--})}updateRestTimerDisplay(t){let e=Math.floor(t/60),i=t%60;this.restTimerDisplay.set(`${String(e).padStart(2,"0")}:${String(i).padStart(2,"0")}`)}skipRest(){this.restTimerSub&&this.restTimerSub.unsubscribe(),this.isResting.set(!1),this.restTimerDisplay.set(null)}addLoggedSetToCurrentLog(t,e){let i=this.currentWorkoutLogExercises(),r=i.find(o=>o.exerciseId===t.exerciseId);if(r){let o=r.sets.findIndex(s=>s.plannedSetId===e.plannedSetId);o>-1?r.sets[o]=e:r.sets.push(e),this.currentWorkoutLogExercises.set([...i])}else r={exerciseId:t.exerciseId,exerciseName:this.currentBaseExercise()?.name||t.exerciseName||"Unknown Exercise",sets:[e]},this.currentWorkoutLogExercises.set([...i,r])}finishWorkout(){this.timerSub&&this.timerSub.unsubscribe(),this.restTimerSub&&this.restTimerSub.unsubscribe();let t=this.routine(),e=Date.now(),i=Math.round((e-this.workoutStartTime)/(1e3*60)),r={routineId:this.routineId||void 0,routineName:t?.name||"Ad-hoc Workout",startTime:this.workoutStartTime,endTime:e,durationMinutes:i,exercises:this.currentWorkoutLogExercises(),date:new Date(this.workoutStartTime).toISOString().split("T")[0]},o=this.trackingService.addWorkoutLog(r);console.log("Workout Finished and Logged! Log ID:",o.id),this.routineId&&t&&this.workoutService.getRoutineById(this.routineId).pipe(J(1)).subscribe(s=>{if(s){let u=K(q({},s),{lastPerformed:new Date(this.workoutStartTime).toISOString()});this.workoutService.updateRoutine(u)}}),this.router.navigate(["/workout/summary",o.id])}quitWorkout(){confirm("Are you sure you want to quit this workout? Progress will not be saved.")&&(this.timerSub&&this.timerSub.unsubscribe(),this.restTimerSub&&this.restTimerSub.unsubscribe(),this.router.navigate(["/workout"]))}get csf(){return this.currentSetForm.controls}toggleTimedSetTimer(){let t=this.timedSetTimerState();t==="idle"||t==="paused"?this.startOrResumeTimedSet():t==="running"&&this.pauseTimedSet()}startOrResumeTimedSet(){this.timedSetTimerState.set("running"),this.timedSetIntervalSub&&this.timedSetIntervalSub.unsubscribe(),this.timedSetIntervalSub=Ae(0,1e3).subscribe(()=>{this.timedSetElapsedSeconds.update(t=>t+1),this.currentSetForm.get("actualDuration")?.setValue(this.timedSetElapsedSeconds())})}pauseTimedSet(){this.timedSetIntervalSub&&(this.timedSetIntervalSub.unsubscribe(),this.timedSetIntervalSub=void 0),this.timedSetTimerState.set("paused")}resetTimedSet(){this.timedSetIntervalSub&&(this.timedSetIntervalSub.unsubscribe(),this.timedSetIntervalSub=void 0),this.timedSetTimerState.set("idle"),this.timedSetElapsedSeconds.set(0)}stopAndLogTimedSet(){(this.timedSetTimerState()==="running"||this.timedSetTimerState()==="paused")&&this.pauseTimedSet()}checkIfLatestSetOfLatestExercise(){let t=this.routine(),e=this.activeSetInfo();if(!t||!e||!(e.exerciseIndex===t.exercises.length-1))return!1;let r=t.exercises[e.exerciseIndex];return e.setIndex===r.sets.length-1}fetchLastPerformanceAndPatchForm(){return Y(this,null,function*(){let t=this.activeSetInfo();if(!t){this.currentSetForm.reset(),this.resetTimedSet();return}if(!this.lastPerformanceForCurrentExercise||this.lastPerformanceForCurrentExercise.sets[0]?.exerciseId!==t.exerciseData.exerciseId)try{this.lastPerformanceForCurrentExercise=yield new Promise(e=>{this.trackingService.getLastPerformanceForExercise(t.exerciseData.exerciseId).pipe(J(1)).subscribe(i=>e(i))})}catch(e){console.error("Error fetching last performance:",e),this.lastPerformanceForCurrentExercise=null}this.patchCurrentSetFormWithData(t)})}patchCurrentSetFormWithData(t){this.currentSetForm.reset(),this.resetTimedSet();let i=this.currentWorkoutLogExercises().find(o=>o.exerciseId===t.exerciseData.exerciseId)?.sets.find(o=>o.plannedSetId===t.setData.id);if(i){this.currentSetForm.patchValue({actualReps:i.repsAchieved,actualWeight:i.weightUsed,actualDuration:i.durationPerformed,setNotes:i.notes});return}let r=this.trackingService.findPreviousSetPerformance(this.lastPerformanceForCurrentExercise,t.setData,t.setIndex);r?this.currentSetForm.patchValue({actualReps:r.repsAchieved??t.setData.reps??null,actualWeight:r.weightUsed??t.setData.weight??null,actualDuration:r.durationPerformed??t.setData.duration??null,setNotes:""}):this.currentSetForm.patchValue({actualReps:t.setData.reps??null,actualWeight:t.setData.weight??null,actualDuration:t.setData.duration??null,setNotes:""})}startEditTarget(t){let e=this.activeSetInfo();if(e)switch(this.editingTarget=t,t){case"reps":this.editingTargetValue=e.setData.reps??"";break;case"weight":this.editingTargetValue=e.setData.weight??"";break;case"duration":this.editingTargetValue=e.setData.duration??"";break}}cancelEditTarget(){this.editingTarget=null,this.editingTargetValue=""}formatPbValue(t){let e="";return t.weightUsed!==void 0&&t.weightUsed!==null?(e+=`${t.weightUsed}kg`,t.repsAchieved>1&&!t.pbType.includes("RM (Actual)")&&(e+=` x ${t.repsAchieved}`)):t.repsAchieved>0&&t.pbType.includes("Max Reps")?e=`${t.repsAchieved} reps`:t.durationPerformed&&t.durationPerformed>0&&t.pbType.includes("Max Duration")&&(e=`${t.durationPerformed}s`),e||"N/A"}ngOnDestroy(){this.routeSub&&this.routeSub.unsubscribe(),this.timerSub&&this.timerSub.unsubscribe(),this.restTimerSub&&this.restTimerSub.unsubscribe(),this.timedSetIntervalSub&&this.timedSetIntervalSub.unsubscribe()}initializeCurrentSetForm(){this.currentSetForm=this.fb.group({actualReps:[null,[M.min(0)]],actualWeight:[null,[M.min(0)]],actualDuration:[null,[M.min(0)]],setNotes:[""]})}prepareCurrentSet(){return Y(this,null,function*(){let t=this.routine(),e=this.currentExerciseIndex(),i=this.currentSetIndex();if(!t||!t.exercises[e]||!t.exercises[e].sets[i]){this.currentSetForm.reset(),this.resetTimedSet(),this.currentBaseExercise.set(null),this.exercisePBs.set([]),this.lastPerformanceForCurrentExercise=null,console.warn("prepareCurrentSet: Could not find active set data in session routine.");return}let r=t.exercises[e],o=r.sets[i];if(this.loadBaseExerciseAndPBs(r.exerciseId),!this.lastPerformanceForCurrentExercise||this.lastPerformanceForCurrentExercise.sets[0]?.exerciseId!==r.exerciseId)try{this.lastPerformanceForCurrentExercise=yield new Promise(_=>{this.trackingService.getLastPerformanceForExercise(r.exerciseId).pipe(J(1)).subscribe(S=>_(S))})}catch(_){console.error("Error fetching last performance:",_),this.lastPerformanceForCurrentExercise=null}let s=this.trackingService.findPreviousSetPerformance(this.lastPerformanceForCurrentExercise,o,i),u=this.workoutService.suggestNextSetParameters(s,o,t.goal);console.log(`Original/Current Session Target for Set ${i+1}:`,o),console.log("Last Historical Performance for this set:",s),console.log(`Progressive Overload Suggestion for Set ${i+1}:`,u);let g=JSON.parse(JSON.stringify(t));g.exercises[e].sets[i]=K(q({},u),{id:o.id,notes:u.notes??o.notes}),this.routine.set(g),this.patchActualsFormBasedOnSessionTargets()})}patchActualsFormBasedOnSessionTargets(){this.currentSetForm.reset(),this.resetTimedSet();let t=this.activeSetInfo();if(!t)return;let i=this.currentWorkoutLogExercises().find(r=>r.exerciseId===t.exerciseData.exerciseId)?.sets.find(r=>r.plannedSetId===t.setData.id);i?this.currentSetForm.patchValue({actualReps:i.repsAchieved,actualWeight:i.weightUsed,actualDuration:i.durationPerformed,setNotes:i.notes}):this.currentSetForm.patchValue({actualReps:t.setData.reps??null,actualWeight:t.setData.weight??null,actualDuration:t.setData.duration??null,setNotes:t.setData.notes||""})}loadBaseExerciseAndPBs(t){this.currentBaseExercise.set(void 0),this.exercisePBs.set([]),this.exerciseService.getExerciseById(t).subscribe(e=>{this.currentBaseExercise.set(e||null)}),this.trackingService.getAllPersonalBestsForExercise(t).pipe(J(1)).subscribe(e=>{this.exercisePBs.set(e)})}navigateToNextStepInWorkout(t,e){let i=t.exerciseIndex,r=t.setIndex,o=e.exercises[i],s=i,u=0,g=!1;if(r<o.sets.length-1)u=r+1,console.log(`Advancing to Set ${u+1} of ${o.exerciseName}`);else if(o.supersetId&&o.supersetOrder!==null&&o.supersetSize!==null&&o.supersetSize!==void 0&&o.supersetOrder<o.supersetSize-1)if(s++,s<e.exercises.length&&e.exercises[s].supersetId===o.supersetId)console.log(`Advancing to next Superset Exercise: ${e.exercises[s].exerciseName}`);else{console.error("Superset structure broken. Attempting to find next block.");let _=this.findNextExerciseBlockStartIndex(i,e);if(_!==-1)s=_,g=!0;else{this.finishWorkout();return}}else{let _=this.totalBlockRounds();if(this.currentBlockRound()<_)this.currentBlockRound.update(S=>S+1),console.log(`Starting Round ${this.currentBlockRound()} of ${_} for current block.`),o.supersetId&&o.supersetOrder!==null&&(s=i-o.supersetOrder);else{console.log("All rounds for current block complete. Finding next block.");let S=this.findNextExerciseBlockStartIndex(i,e);if(S!==-1)s=S,g=!0;else{this.finishWorkout();return}}}if(g){this.currentBlockRound.set(1);let _=e.exercises[s];!_.supersetId||_.supersetOrder===0?this.totalBlockRounds.set(_.rounds??1):(console.warn("Landed on non-block-starter exercise when expecting new block. Defaulting rounds to 1."),this.totalBlockRounds.set(1)),this.lastPerformanceForCurrentExercise=null}this.currentExerciseIndex.set(s),this.currentSetIndex.set(u),t.setData.restAfterSet>0&&!this.isResting()&&this.startRestTimer(t.setData.restAfterSet),this.prepareCurrentSet()}confirmEditTarget(){let t=this.activeSetInfo();if(!t||this.editingTarget===null)return;let e=parseFloat(this.editingTargetValue);if(isNaN(e)||e<0){alert(`Invalid value for ${this.editingTarget}. Please enter a non-negative number.`);return}let i=this.routine,r=i();if(!r)return;let o=JSON.parse(JSON.stringify(r)),u=o.exercises[t.exerciseIndex].sets[t.setIndex];switch(this.editingTarget){case"reps":u.reps=e;break;case"weight":u.weight=e;break;case"duration":u.duration=e;break}i.set(o),this.cancelEditTarget(),this.patchActualsFormBasedOnSessionTargets()}completeSetAndProceed(){let t=this.activeSetInfo(),e=this.routine();if(!t||!e){console.error("Cannot complete set: activeInfo or routine is not available.");return}if(t.setData.duration&&(this.timedSetTimerState()==="running"||this.timedSetTimerState()==="paused")&&this.stopAndLogTimedSet(),this.currentSetForm.invalid){this.currentSetForm.markAllAsTouched(),alert("Please correct the input values for the current set.");return}let i=this.currentSetForm.value,r={id:t.setData.id,plannedSetId:t.setData.id,exerciseId:t.exerciseData.exerciseId,repsAchieved:i.actualReps??t.setData.reps??0,weightUsed:i.actualWeight??t.setData.weight,durationPerformed:t.setData.duration?i.actualDuration??0:void 0,targetReps:t.setData.reps,targetWeight:t.setData.weight,targetDuration:t.setData.duration,targetTempo:t.setData.tempo,notes:i.setNotes||void 0,timestamp:new Date().toISOString()};this.addLoggedSetToCurrentLog(t.exerciseData,r),t.setData.restAfterSet>0&&!this.isResting()&&this.startRestTimer(t.setData.restAfterSet),this.resetTimedSet(),this.navigateToNextStepInWorkout(t,e)}findNextExerciseBlockIndex(t,e){for(let i=t+1;i<e.exercises.length;i++){let r=e.exercises[i];if(!r.supersetId||r.supersetOrder===0)return i}return-1}getNextUpText(t,e){if(!t||!e)return"Next Set/Exercise";let i=t.exerciseIndex,r=t.setIndex,o=e.exercises[i];if(r<o.sets.length-1)return`Set ${r+2} of ${o.exerciseName}`;if(o.supersetId&&o.supersetOrder!==null&&o.supersetSize&&o.supersetOrder<o.supersetSize-1){let g=i+1;if(g<e.exercises.length&&e.exercises[g].supersetId===o.supersetId)return`SUPERSET: ${e.exercises[g].exerciseName}`}let s=this.totalBlockRounds();if(this.currentBlockRound()<s){let g=i;return o.supersetId&&o.supersetOrder!==null&&(g=i-o.supersetOrder),`Round ${this.currentBlockRound()+1}: ${e.exercises[g].exerciseName}`}let u=this.findNextExerciseBlockStartIndex(i,e);return u!==-1?`Next Exercise: ${e.exercises[u].exerciseName}`:"Finish Workout!"}findNextExerciseBlockStartIndex(t,e){for(let i=t+1;i<e.exercises.length;i++){let r=e.exercises[i];if(!r.supersetId||r.supersetOrder===0)return i}return-1}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-workout-player"]],decls:3,vars:2,consts:[["loadingOrError",""],["routineNotFound",""],["workoutCompleteOrError",""],["loadingBaseEx",""],["class","container mx-auto p-4 min-h-screen flex flex-col",4,"ngIf","ngIfElse"],[1,"container","mx-auto","p-4","min-h-screen","flex","flex-col"],[4,"ngIf","ngIfElse"],[1,"mb-2"],[1,"flex","justify-between","items-center","mb-2"],[1,"text-3xl","font-bold","text-gray-800","dark:text-gray-200","truncate",3,"title"],[1,"text-sm","text-red-500","hover:text-red-700","dark:text-red-400","dark:hover:text-red-300","font-medium","py-1","px-2","rounded-md","border","border-red-500","dark:border-red-400","hover:bg-red-100","dark:hover:bg-red-900/30",3,"click"],[1,"text-lg","text-gray-600","dark:text-gray-400"],[1,"font-semibold"],["class","text-lg font-semibold text-blue-600 dark:text-blue-400",4,"ngIf"],[1,"flex-grow","bg-white","dark:bg-gray-800","p-2","rounded-lg","shadow-xl"],[1,"mt-auto","pt-6","text-center"],[1,"bg-gray-200","hover:bg-gray-300","dark:bg-gray-700","dark:hover:bg-gray-600","text-gray-700","dark:text-gray-200","font-semibold","py-2","px-6","rounded-md","text-sm",3,"click"],[1,"text-lg","font-semibold","text-blue-600","dark:text-blue-400"],[1,"mb-2","pb-2","border-b","border-gray-300","dark:border-gray-700"],[1,"flex","items-center","mb-1"],["class","mr-4",4,"ngIf","ngIfElse"],["class","text-xs font-semibold text-purple-600 dark:text-purple-400 mb-0.5",4,"ngIf"],["class","text-xs font-semibold text-blue-600 dark:text-blue-400 mb-0.5",4,"ngIf"],[1,"text-2xl","font-semibold","text-primary","dark:text-primary-light"],[1,"text-sm","text-gray-500","dark:text-gray-400"],["class","italic",4,"ngIf"],["class","text-sm text-gray-600 dark:text-gray-400 mb-2 line-clamp-2",4,"ngIf"],["class","mb-6 space-y-3",4,"ngIf"],["class","mb-6",4,"ngIf"],["class","mt-8 text-center p-4 bg-blue-50 dark:bg-blue-900/30 rounded-lg",4,"ngIf"],[1,"mr-4"],["class","w-24 h-24 object-contain rounded-md border dark:border-gray-600 bg-gray-100 dark:bg-gray-700",3,"src","alt",4,"ngIf"],["class","w-24 h-24 bg-gray-200 dark:bg-gray-700 flex items-center justify-center rounded-md text-xs text-gray-500",4,"ngIf"],[1,"w-24","h-24","object-contain","rounded-md","border","dark:border-gray-600","bg-gray-100","dark:bg-gray-700",3,"src","alt"],[1,"w-24","h-24","bg-gray-200","dark:bg-gray-700","flex","items-center","justify-center","rounded-md","text-xs","text-gray-500"],[1,"w-24","h-24","bg-gray-200","dark:bg-gray-700","flex","items-center","justify-center","rounded-md","text-xs","text-gray-500","animate-pulse","mr-2"],[1,"text-xs","font-semibold","text-purple-600","dark:text-purple-400","mb-0.5"],[4,"ngIf"],[1,"text-xs","font-semibold","text-blue-600","dark:text-blue-400","mb-0.5"],[1,"italic"],[1,"text-sm","text-gray-600","dark:text-gray-400","mb-2","line-clamp-2"],[1,"mb-6","space-y-3"],[1,"text-md","font-semibold","text-gray-700","dark:text-gray-300"],[1,"max-h-48","overflow-y-auto","space-y-2","pr-2","border","dark:border-gray-700","rounded-md","p-2","bg-gray-50","dark:bg-gray-750"],["class","p-2 border-b border-gray-200 dark:border-gray-600 last:border-b-0",4,"ngFor","ngForOf"],[1,"p-2","border-b","border-gray-200","dark:border-gray-600","last:border-b-0"],[1,"text-xs","font-medium","text-gray-600","dark:text-gray-200","mb-0.5"],[1,"text-xs","text-gray-500","dark:text-gray-400","space-y-px"],["class","mr-3",4,"ngIf"],["class","mt-1 text-gray-500 dark:text-gray-400",4,"ngIf"],[1,"mr-3"],[1,"text-gray-700","dark:text-gray-300"],["class","text-gray-400 dark:text-gray-500 ml-1",4,"ngIf"],[1,"text-gray-400","dark:text-gray-500","ml-1"],[1,"mt-1","text-gray-500","dark:text-gray-400"],[1,"mb-6"],[1,"text-xl","font-medium","mb-1","text-gray-700","dark:text-gray-300"],["class","ml-2 text-xs text-green-500 font-normal",4,"ngIf"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-3","mb-2","p-2","bg-gray-100","dark:bg-gray-700","rounded-md"],["class","col-span-full pt-2 text-xs",4,"ngIf"],["class","col-span-full mt-3 pt-3 border-t border-dashed border-gray-300 dark:border-gray-600 text-xs",4,"ngIf"],[1,"space-y-4","mb-6","p-4","border","border-gray-200","dark:border-gray-600","rounded-lg",3,"formGroup"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],["class","md:col-span-1",4,"ngIf"],[1,"md:col-span-3","space-y-2"],[1,"flex","items-center","justify-between"],["for","actualDuration",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300"],[1,"text-2xl","font-mono","font-semibold","text-gray-800","dark:text-gray-100",3,"ngClass"],["type","number","id","actualDuration","formControlName","actualDuration","hidden",""],[1,"flex","space-x-2","mt-1"],["type","button",1,"flex-1","text-white","font-medium","py-2","px-3","rounded-md","transition-colors","text-sm","disabled:opacity-50",3,"click","disabled","ngClass"],["type","button","class","bg-gray-300 hover:bg-gray-400 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 font-medium py-2 px-3 rounded-md transition-colors text-sm",3,"click",4,"ngIf"],["class","text-xs text-red-500 mt-1",4,"ngIf"],[1,"md:col-span-3"],["for","setNotes",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300"],["id","setNotes","formControlName","setNotes","rows","2",1,"mt-1","block","w-full","p-2","border","rounded-md","shadow-sm","focus:ring-primary","focus:border-primary","dark:bg-gray-650"],[1,"w-full","bg-green-500","hover:bg-green-600","text-white","font-bold","py-3","px-4","rounded-lg","shadow-md","text-lg","transition-colors","focus:outline-none","focus:ring-2","focus:ring-green-400","disabled:opacity-50",3,"click"],[1,"ml-2","text-xs","text-green-500","font-normal"],[1,"col-span-full","pt-2","text-xs"],[1,"font-medium","text-gray-500","dark:text-gray-400"],[1,"list-disc","list-inside","ml-2","text-gray-500","dark:text-gray-400"],[1,"col-span-full","mt-3","pt-3","border-t","border-dashed","border-gray-300","dark:border-gray-600","text-xs"],[1,"font-medium","text-gray-500","dark:text-gray-400","mb-1"],[1,"grid","grid-cols-2","sm:grid-cols-3","gap-x-4","gap-y-1"],[4,"ngFor","ngForOf"],[1,"text-gray-500","dark:text-gray-400"],[1,"text-gray-400","dark:text-gray-500","text-2xs","ml-1"],[1,"text-gray-500","dark:text-gray-400","italic"],[1,"block","text-xs","text-gray-500","dark:text-gray-400"],["class","text-2xl font-bold text-gray-800 dark:text-gray-100 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 p-1 rounded",3,"click",4,"ngIf"],["class","flex items-center space-x-1",4,"ngIf"],[1,"text-2xl","font-bold","text-gray-800","dark:text-gray-100","cursor-pointer","hover:bg-gray-200","dark:hover:bg-gray-600","p-1","rounded",3,"click"],[1,"flex","items-center","space-x-1"],["type","number","autofocus","",1,"w-20","p-1","text-xl","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-600",3,"ngModelChange","keyup.enter","keyup.escape","ngModel"],[1,"p-1","text-green-500","hover:text-green-700",3,"click"],[1,"p-1","text-red-500","hover:text-red-700",3,"click"],[1,"text-lg"],[1,"text-lg","font-semibold","text-gray-800","dark:text-gray-100","p-1"],[1,"md:col-span-1"],["for","actualReps",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300"],["type","number","id","actualReps","formControlName","actualReps",1,"mt-1","block","w-full","p-2","border","rounded-md","shadow-sm","focus:ring-primary","focus:border-primary","dark:bg-gray-650",3,"ngClass"],[1,"text-xs","text-red-500","mt-1"],["for","actualWeight",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300"],["type","number","id","actualWeight","formControlName","actualWeight",1,"mt-1","block","w-full","p-2","border","rounded-md","shadow-sm","focus:ring-primary","focus:border-primary","dark:bg-gray-650",3,"ngClass"],["type","button",1,"bg-gray-300","hover:bg-gray-400","dark:bg-gray-600","dark:hover:bg-gray-500","text-gray-800","dark:text-gray-200","font-medium","py-2","px-3","rounded-md","transition-colors","text-sm",3,"click"],[1,"mt-8","text-center","p-4","bg-blue-50","dark:bg-blue-900/30","rounded-lg"],[1,"text-sm","text-blue-700","dark:text-blue-300","mb-1"],[1,"text-5xl","font-bold","text-blue-600","dark:text-blue-200","tabular-nums"],[1,"text-xs","text-gray-500","dark:text-gray-400","mt-1"],[1,"mt-3","text-xs","text-blue-500","hover:text-blue-700","dark:text-blue-400","dark:hover:text-blue-300","underline",3,"click"],[1,"text-center","py-10"],[1,"text-2xl","font-semibold","text-gray-700","dark:text-gray-200"],[1,"text-gray-600","dark:text-gray-400"],[1,"mt-6","bg-primary","hover:bg-primary-dark","text-white","font-bold","py-3","px-6","rounded-lg","shadow-md","text-lg","transition-colors",3,"click"],[1,"text-center","py-20"],[1,"text-2xl","font-semibold","text-red-600","dark:text-red-400","mb-4"],["routerLink","/workout",1,"mt-6","inline-block","text-primary","dark:text-primary-light","hover:underline"],[1,"text-xl","text-gray-600","dark:text-gray-400"]],template:function(e,i){if(e&1&&f(0,ko,4,2,"div",4)(1,Co,3,0,"ng-template",null,0,G),e&2){let r=z(2);m("ngIf",i.routine()!==void 0)("ngIfElse",r)}},dependencies:[U,ve,j,H,be,ye,Ye,at,tt,Qe,it,Je,Xe,rt,nt,st,et,Di],encapsulation:2})};function Eo(n,t){if(n&1&&(l(0,"li",22)(1,"p",23),c(2),a(),l(3,"p",24),c(4),a()()),n&2){let e=t.$implicit;d(2),L("",e.exerciseName," - ",e.pbType),d(2),D(e.value)}}function Io(n,t){if(n&1&&(l(0,"div",18)(1,"h2",19),c(2," \u{1F389} New Personal Bests! \u{1F389} "),a(),l(3,"ul",20),f(4,Eo,5,3,"li",21),a()()),n&2){let e=p(2);d(4),m("ngForOf",e.sessionPBs())}}function Do(n,t){if(n&1&&(l(0,"div",25)(1,"h3",26),c(2,"Your Notes for this Session:"),a(),l(3,"p",27),c(4),a()()),n&2){let e=p().ngIf;d(4),D(e.notes)}}function Ro(n,t){if(n&1){let e=w();ce(0),l(1,"div",3)(2,"div",4),T(),l(3,"svg",5),k(4,"path",6),a(),te(),l(5,"h1",7),c(6,"Workout Complete!"),a(),l(7,"p",8),c(8,"Great job on finishing your session."),a()(),l(9,"div",9)(10,"div",10)(11,"span",11),c(12,"Routine:"),a(),l(13,"span",12),c(14),a()(),l(15,"div",10)(16,"span",11),c(17,"Date:"),a(),l(18,"span",12),c(19),P(20,"date"),a()(),l(21,"div",10)(22,"span",11),c(23,"Duration:"),a(),l(24,"span",12),c(25),a()(),l(26,"div",10)(27,"span",11),c(28,"Total Volume:"),a(),l(29,"span",12),c(30),P(31,"number"),a()()(),f(32,Io,5,1,"div",13)(33,Do,5,1,"div",14),l(34,"div",15)(35,"button",16),y("click",function(){x(e);let r=p();return v(r.viewFullLog())}),c(36," View Full Log Details "),a(),l(37,"button",17),y("click",function(){x(e);let r=p();return v(r.navigateToRoutines())}),c(38," Back to Routines "),a()()(),ue()}if(n&2){let e=t.ngIf,i=p();d(14),D(e.routineName||"Ad-hoc Workout"),d(5),D(B(20,7,e.startTime,"fullDate")),d(6),b("",e.durationMinutes," minutes"),d(5),L("",B(31,10,i.sessionTotalVolume(),"1.0-0")," ",i.unitsService.getUnitLabel(),"*kg"),d(2),m("ngIf",i.sessionPBs().length>0),d(),m("ngIf",e.notes)}}function To(n,t){n&1&&(l(0,"div",28)(1,"p",29),c(2,"Loading workout summary..."),a()())}var kt=class n{route=h(Se);router=h(ne);trackingService=h(dt);exerciseService=h(ke);statsService=h(Ri);unitsService=h(lt);workoutLog=C(void 0);displayExercisesSummary=C([]);sessionPBs=C([]);sessionTotalVolume=C(0);logId;ngOnInit(){(this.logId?Q(this.logId):this.route.paramMap.pipe(ie(e=>e.get("logId")))).pipe(X(e=>e?this.trackingService.getWorkoutLogById(e):Q(null)),re(e=>{e?(this.workoutLog.set(e),this.sessionTotalVolume.set(this.statsService.calculateWorkoutVolume(e)),this.prepareDisplayExercisesSummary(e.exercises),this.identifySessionPBs(e)):(this.workoutLog.set(null),this.displayExercisesSummary.set([]),this.sessionPBs.set([]))})).subscribe()}prepareDisplayExercisesSummary(t){if(!t||t.length===0){this.displayExercisesSummary.set([]);return}let e=t.map(i=>this.exerciseService.getExerciseById(i.exerciseId).pipe(ie(r=>{let o=0;return i.sets.forEach(s=>{o+=(s.repsAchieved||0)*(s.weightUsed||0)}),K(q({},i),{baseExercise:r||null,sessionVolume:o})})));ni(e).subscribe({next:i=>this.displayExercisesSummary.set(i),error:i=>{console.error("Error fetching exercise details for summary:",i),this.displayExercisesSummary.set(t.map(r=>K(q({},r),{baseExercise:null,sessionVolume:0})))}})}identifySessionPBs(t){let e=[];this.trackingService.personalBests$.pipe(J(1)).subscribe(i=>{t.exercises.forEach(o=>{let s=i[o.exerciseId];s&&o.sets.forEach(u=>{s.forEach(g=>{g.id===u.id&&g.timestamp===u.timestamp&&u.weightUsed===g.weightUsed&&u.repsAchieved===g.repsAchieved&&e.push({exerciseName:o.exerciseName,pbType:g.pbType,value:this.formatPbValueForSummary(g),isNewOrImproved:!0})})})});let r=Array.from(new Map(e.map(o=>[`${o.exerciseName}-${o.pbType}`,o])).values());this.sessionPBs.set(r)})}formatPbValueForSummary(t){let e="";return t.weightUsed!==void 0&&t.weightUsed!==null?(e+=`${t.weightUsed}kg`,t.repsAchieved>0&&(t.pbType.includes("Heaviest")||t.repsAchieved>1&&!t.pbType.includes("RM"))&&(e+=` x ${t.repsAchieved}`)):t.repsAchieved>0&&t.pbType.includes("Max Reps")?e=`${t.repsAchieved} reps`:t.durationPerformed&&t.durationPerformed>0&&t.pbType.includes("Max Duration")&&(e=`${t.durationPerformed}s`),e||"N/A"}viewFullLog(){this.workoutLog()&&this.router.navigate(["/history/log",this.workoutLog().id])}navigateToRoutines(){this.router.navigate(["/workout"])}startNewWorkout(){this.router.navigate(["/workout"])}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-workout-summary"]],inputs:{logId:"logId"},decls:4,vars:2,consts:[["loadingOrNotFoundSummary",""],[1,"container","mx-auto","p-4","py-8"],[4,"ngIf","ngIfElse"],[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-2xl","p-6","md:p-8","max-w-2xl","mx-auto"],[1,"text-center","mb-8"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","currentColor",1,"w-16","h-16","text-green-500","mx-auto","mb-3"],["fill-rule","evenodd","d","M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.06-1.06l-3.002 3.001-1.502-1.502a.75.75 0 0 0-1.06 1.06L9.97 12.72l3.59-3.591Z","clip-rule","evenodd"],[1,"text-4xl","font-bold","text-gray-800","dark:text-gray-100"],[1,"text-lg","text-gray-600","dark:text-gray-400","mt-1"],[1,"space-y-4","mb-8"],[1,"flex","justify-between","items-baseline","p-3","bg-gray-50","dark:bg-gray-700","rounded-md"],[1,"text-sm","font-medium","text-gray-600","dark:text-gray-300"],[1,"text-md","font-semibold","text-gray-800","dark:text-gray-100"],["class","mb-8",4,"ngIf"],["class","mb-8 p-3 bg-yellow-50 dark:bg-yellow-900/30 rounded-md",4,"ngIf"],[1,"mt-8","pt-6","border-t","border-gray-200","dark:border-gray-700","space-y-3","md:space-y-0","md:flex","md:justify-center","md:space-x-4"],[1,"w-full","md:w-auto","flex","items-center","justify-center","px-6","py-3","border","border-transparent","rounded-md","shadow-sm","text-base","font-medium","text-white","bg-primary","hover:bg-primary-dark","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-primary-dark",3,"click"],[1,"w-full","md:w-auto","flex","items-center","justify-center","px-6","py-3","border","border-gray-300","dark:border-gray-600","rounded-md","shadow-sm","text-base","font-medium","text-gray-700","dark:text-gray-200","bg-white","dark:bg-gray-700","hover:bg-gray-50","dark:hover:bg-gray-600","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-primary",3,"click"],[1,"mb-8"],[1,"text-xl","font-semibold","text-gray-700","dark:text-gray-300","mb-3","text-center","border-b","pb-2","dark:border-gray-700"],[1,"space-y-2","mt-3"],["class","p-2 bg-green-50 dark:bg-green-900/30 rounded-md text-center",4,"ngFor","ngForOf"],[1,"p-2","bg-green-50","dark:bg-green-900/30","rounded-md","text-center"],[1,"text-sm","font-medium","text-green-700","dark:text-green-300"],[1,"text-lg","font-bold","text-green-600","dark:text-green-200"],[1,"mb-8","p-3","bg-yellow-50","dark:bg-yellow-900/30","rounded-md"],[1,"text-sm","font-medium","text-yellow-800","dark:text-yellow-300","mb-1"],[1,"text-sm","text-yellow-700","dark:text-yellow-200","italic","whitespace-pre-line"],[1,"text-center","py-20"],[1,"text-xl","text-gray-600","dark:text-gray-400"]],template:function(e,i){if(e&1&&(l(0,"div",1),f(1,Ro,39,13,"ng-container",2)(2,To,3,0,"ng-template",null,0,G),a()),e&2){let r=z(3);d(),m("ngIf",i.workoutLog())("ngIfElse",r)}},dependencies:[U,j,H,be,ye],encapsulation:2})};var zl=[{path:"",component:mt,title:"My Routines"},{path:"new",component:Ie,title:"Create New Routine"},{path:"edit/:routineId",component:Ie,title:"Edit Routine"},{path:"view/:routineId",component:Ie,title:"View Routine"},{path:"play/:routineId",component:wt,title:"Workout Session"},{path:"summary/:logId",component:kt,title:"Workout Summary"}];export{zl as WORKOUT_TRACKER_ROUTES};
