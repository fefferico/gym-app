import{a as v,b as k}from"./chunk-N4ZKNZIX.js";import{b as X,e as Z,i as ee,j as S}from"./chunk-NM4UFURY.js";import{$c as te,D as P,Da as g,Ea as u,Fa as w,Fb as U,Ga as Y,Ka as W,La as h,M as G,Ma as d,Na as B,Oa as V,Q as D,Qb as J,U as M,V as C,W as N,Xa as z,Za as $,Zc as Q,_c as _,ca as A,fc as T,g as j,gc as I,ic as b,ja as E,jc as x,ka as y,kc as O,sa as H,ub as K,va as F,vb as R,wb as q,xa as L}from"./chunk-2TJAW5PQ.js";var oe=class l{transform(t){return t?.sets?.length?t.sets.some(e=>typeof e.weightUsed=="number"||typeof e.weight=="number"||typeof e.targetWeight=="number"):!1}static \u0275fac=function(e){return new(e||l)};static \u0275pipe=F({name:"isWeighted",type:l,pure:!0})};var se=["*",[["","modal-footer",""]]],le=["*","[modal-footer]"];function me(l,t){if(l&1&&(u(0,"h3",11),z(1),w()),l&2){let e=d(3);y(),$(" ",e.modalTitle()," ")}}function ce(l,t){if(l&1){let e=W();u(0,"div",6),L(1,me,2,1,"h3",7),u(2,"button",8),h("click",function(){M(e);let r=d(2);return C(r.closeModal())}),N(),u(3,"svg",9),Y(4,"path",10),w()()()}if(l&2){let e=d(2);y(),g("ngIf",e.modalTitle())}}function ue(l,t){if(l&1){let e=W();u(0,"div",1),h("click",function(){M(e);let r=d();return C(r.closeModal())}),u(1,"div",2),h("click",function(r){M(e);let a=d();return C(a.onDialogClick(r))}),L(2,ce,5,1,"div",3),u(3,"div",4),V(4),w(),u(5,"div",5),V(6,1),w()()()}if(l&2){let e=d();g("@modalAnimation",e.animationState),y(),g("@dialogAnimation",e.animationState),y(),g("ngIf",e.modalTitle()||!0)}}var re=class l{elementRef=D(A);isOpen=q(!1);modalTitle=R();closed=K();get animationState(){return this.isOpen()?"open":"closed"}closeModal(){this.isOpen.set(!1),this.closed.emit()}onDialogClick(t){t.stopPropagation()}onDocumentMouseDown(t){this.isOpen()&&this.elementRef.nativeElement.contains(t.target)&&t.target.classList.contains("modal-container")&&this.closeModal()}onEscapeKey(){this.isOpen()&&this.closeModal()}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=H({type:l,selectors:[["app-modal"]],hostBindings:function(e,o){e&1&&h("mousedown",function(a){return o.onDocumentMouseDown(a)},E)("keydown.escape",function(){return o.onEscapeKey()},E)},inputs:{isOpen:[1,"isOpen"],modalTitle:[1,"modalTitle"]},outputs:{isOpen:"isOpenChange",closed:"closed"},ngContentSelectors:le,decls:1,vars:1,consts:[["class","modal-container fixed inset-0 z-[1000] flex items-center justify-center bg-black bg-opacity-60",3,"click",4,"ngIf"],[1,"modal-container","fixed","inset-0","z-[1000]","flex","items-center","justify-center","bg-black","bg-opacity-60",3,"click"],[1,"modal-dialog","mx-2","bg-white","dark:bg-gray-800","rounded-md","shadow-xl","min-w-[300px]","w-full","max-w-lg","md:max-w-xl","lg:max-w-2xl","max-h-[90vh]","flex","flex-col","overflow-hidden",3,"click"],["class","modal-header flex items-center justify-between ml-1 p-1 md:p-1 border-gray-200 dark:border-gray-700",4,"ngIf"],[1,"modal-body","p-1","md:p-1","space-y-4","overflow-y-auto","flex-grow"],[1,"modal-footer","flex","items-center","p-4","md:p-5","border-t","border-gray-200","dark:border-gray-700","rounded-b"],[1,"modal-header","flex","items-center","justify-between","ml-1","p-1","md:p-1","border-gray-200","dark:border-gray-700"],["class","text-xl font-semibold text-gray-900 dark:text-white",4,"ngIf"],["type","button","aria-label","Close modal",1,"modal-close-button","text-gray-400","bg-transparent","hover:bg-gray-200","hover:text-gray-900","dark:hover:bg-gray-600","dark:hover:text-white","rounded-md","text-sm","w-8","h-8","ms-auto","inline-flex","justify-center","items-center",3,"click"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 14 14",1,"w-3","h-3"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"],[1,"text-xl","font-semibold","text-gray-900","dark:text-white"]],template:function(e,o){e&1&&(B(se),L(0,ue,7,3,"div",0)),e&2&&g("ngIf",o.isOpen())},dependencies:[J,U],styles:[".modal-footer[_ngcontent-%COMP%]:empty{display:none}"],data:{animation:[T("modalAnimation",[x("closed",b({opacity:0,visibility:"hidden"})),x("open",b({opacity:1,visibility:"visible"})),O("closed <=> open",[I("300ms ease-in-out")])]),T("dialogAnimation",[x("closed",b({opacity:0,transform:"scale(0.95) translateY(20px)",visibility:"hidden"})),x("open",b({opacity:1,transform:"scale(1) translateY(0)",visibility:"visible"})),O("closed <=> open",[I("300ms ease-in-out")])])]}})};function ae(l,t){return Q(l,t?.in).getFullYear()}var ie=class l{exerciseService=D(te);constructor(){}calculateSetVolume(t){return(t.repsAchieved||0)*(t.weightUsed||0)}calculateWorkoutVolume(t){let e=0;return t.exercises.forEach(o=>{o.sets.forEach(r=>{e+=this.calculateSetVolume(r)})}),e}calculateTotalVolumeForAllLogs(t){return t.reduce((e,o)=>e+this.calculateWorkoutVolume(o),0)}getWeeklySummaries(t){if(!t||t.length===0)return[];let e=new Map;return t.forEach(o=>{let r=new Date(o.startTime),a=ae(r),s=ee(r,{weekStartsOn:1}),n=`${a}-W${String(s).padStart(2,"0")}`,m=X(r,{weekStartsOn:1}),p=`Week ${s}, ${a}`,i=S(m,"dd/MM"),c=S(k(m,-6),"dd/MM");e.has(n)||e.set(n,{weekNumber:s,year:a,weekLabel:p,weekLabelStart:i,weekLabelEnd:c,workoutCount:0,totalVolume:0});let f=e.get(n);f.workoutCount++,f.totalVolume+=this.calculateWorkoutVolume(o)}),Array.from(e.values()).sort((o,r)=>o.year===r.year?o.weekNumber-r.weekNumber:o.year-r.year)}getWeeklyVolumeForChart(t){return this.getWeeklySummaries(t).map(o=>({date:new Date(o.year,0,o.weekNumber*7-6),weekLabel:o.weekLabel,totalVolume:o.totalVolume})).sort((o,r)=>o.date.getTime()-r.date.getTime())}getPerformanceByMuscleGroup(t){return j(this,null,function*(){if(!t||t.length===0)return[];let e=new Map,o=yield new Promise(a=>{this.exerciseService.getExercises().pipe(P(1)).subscribe(s=>a(s))}),r=new Map(o.map(a=>[a.id,a]));return t.forEach(a=>{let s=new Set;a.exercises.forEach(n=>{let m=r.get(n.exerciseId);if(m&&m.muscleGroups){let p=n.sets.reduce((i,c)=>i+this.calculateSetVolume(c),0);m.muscleGroups.forEach(i=>{let c=i.toLowerCase().trim();e.has(c)||e.set(c,{volume:0,workoutCountSet:new Set});let f=e.get(c);f.volume+=p,s.add(c)})}}),s.forEach(n=>{e.get(n)?.workoutCountSet.add(a.id)})}),Array.from(e.entries()).map(([a,s])=>({muscleGroup:a,volume:Math.round(s.volume),workoutCount:s.workoutCountSet.size})).sort((a,s)=>s.volume-a.volume)})}calculateCurrentWorkoutStreak(t){let e={length:0};if(!t||t.length===0)return e;let o=[...new Set(t.map(i=>S(_(i.date),"yyyy-MM-dd")))].map(i=>_(i)).sort((i,c)=>c.getTime()-i.getTime());if(o.length===0)return e;let r=0,a,s,n=new Date;if(n.setHours(0,0,0,0),o.some(i=>v(i,n)))r=1,a=new Date(n),s=new Date(n),n=k(n,1);else{let i=k(n,1);if(o.some(f=>v(f,i)))r=1,a=new Date(i),s=new Date(i),n=k(i,1);else return e}let p=!1;for(let i of o){if(!p){v(i,a)&&(p=!0);continue}if(v(i,n))r++,s=new Date(i),n=k(n,1);else break}return{length:r,startDate:s,endDate:a}}calculateLongestWorkoutStreak(t){let e={length:0};if(!t||t.length<1)return e;let o=[...new Set(t.map(n=>S(_(n.date),"yyyy-MM-dd")))].map(n=>_(n)).sort((n,m)=>n.getTime()-m.getTime());if(o.length===0)return e;let r={length:0},a=0,s;for(let n=0;n<o.length;n++){let m=o[n];n===0||Z(m,o[n-1])!==1?(a=1,s=m):a++,a>r.length&&(r={length:a,startDate:s,endDate:m})}return r}static \u0275fac=function(e){return new(e||l)};static \u0275prov=G({token:l,factory:l.\u0275fac,providedIn:"root"})};export{oe as a,re as b,ie as c};
