import{a as V}from"./chunk-4MQC6E3K.js";import{b as p,c as d}from"./chunk-6VKNUJLL.js";import{b as W,e as v,g as x,h as w}from"./chunk-2CPVNZX3.js";import{a as M}from"./chunk-BJHWSFGY.js";import{a as g}from"./chunk-N4SVDFLX.js";import{A as y,Cb as D,I as h,M as k,f as S,oa as b,yc as L}from"./chunk-BLDG3RHL.js";var E=class m{decimalPipe=k(D);unitsService=k(V);transform(e,o="1.0-2"){if(e==null)return null;let r=this.unitsService.convertFromKg(e,this.unitsService.currentUnit()),a=this.decimalPipe.transform(r,o),n=this.unitsService.getUnitLabel();return`${a} ${n}`}static \u0275fac=function(o){return new(o||m)};static \u0275pipe=b({name:"weightUnit",type:m,pure:!0})};function C(m,e){return L(m,e?.in).getFullYear()}var I=class m{exerciseService=k(M);constructor(){}calculateSetVolume(e){return(e.repsAchieved||0)*(e.weightUsed||0)}calculateWorkoutVolume(e){let o=0;return e.exercises.forEach(r=>{r.sets.forEach(a=>{o+=this.calculateSetVolume(a)})}),o}calculateTotalVolumeForAllLogs(e){return e.reduce((o,r)=>o+this.calculateWorkoutVolume(r),0)}getWeeklySummaries(e){if(!e||e.length===0)return[];let o=new Map;return e.forEach(r=>{let a=new Date(r.startTime),n=C(a),i=x(a,{weekStartsOn:1}),t=`${n}-W${String(i).padStart(2,"0")}`,s=W(a,{weekStartsOn:1}),l=`Week ${i}, ${n}`,u=w(s,"dd/MM"),c=w(d(s,-6),"dd/MM");o.has(t)||o.set(t,{weekNumber:i,year:n,weekLabel:l,weekLabelStart:u,weekLabelEnd:c,workoutCount:0,totalVolume:0});let f=o.get(t);f.workoutCount++,f.totalVolume+=this.calculateWorkoutVolume(r)}),Array.from(o.values()).sort((r,a)=>r.year===a.year?r.weekNumber-a.weekNumber:r.year-a.year)}getWeeklyVolumeForChart(e){return this.getWeeklySummaries(e).map(r=>({date:new Date(r.year,0,r.weekNumber*7-6),weekLabel:r.weekLabel,totalVolume:r.totalVolume})).sort((r,a)=>r.date.getTime()-a.date.getTime())}getPerformanceByMuscleGroup(e){return S(this,null,function*(){if(!e||e.length===0)return[];let o=new Map,r=yield new Promise(n=>{this.exerciseService.getExercises().pipe(y(1)).subscribe(i=>n(i))}),a=new Map(r.map(n=>[n.id,n]));return e.forEach(n=>{let i=new Set;n.exercises.forEach(t=>{let s=a.get(t.exerciseId);if(s&&s.muscleGroups){let l=t.sets.reduce((u,c)=>u+this.calculateSetVolume(c),0);s.muscleGroups.forEach(u=>{let c=u.toLowerCase().trim();o.has(c)||o.set(c,{volume:0,workoutCountSet:new Set});let f=o.get(c);f.volume+=l,i.add(c)})}}),i.forEach(t=>{o.get(t)?.workoutCountSet.add(n.id)})}),Array.from(o.entries()).map(([n,i])=>({muscleGroup:n,volume:Math.round(i.volume),workoutCount:i.workoutCountSet.size})).sort((n,i)=>i.volume-n.volume)})}calculateCurrentWorkoutStreak(e){let o={length:0};if(!e||e.length===0)return o;let r=[...new Set(e.map(u=>w(g(u.date),"yyyy-MM-dd")))].map(u=>g(u)).sort((u,c)=>c.getTime()-u.getTime());if(r.length===0)return o;let a=0,n,i,t=new Date;if(t.setHours(0,0,0,0),r.some(u=>p(u,t)))a=1,n=new Date(t),i=new Date(t),t=d(t,1);else{let u=d(t,1);if(r.some(f=>p(f,u)))a=1,n=new Date(u),i=new Date(u),t=d(u,1);else return o}let l=!1;for(let u of r){if(!l){p(u,n)&&(l=!0);continue}if(p(u,t))a++,i=new Date(u),t=d(t,1);else break}return{length:a,startDate:i,endDate:n}}calculateLongestWorkoutStreak(e){let o={length:0};if(!e||e.length<1)return o;let r=[...new Set(e.map(t=>w(g(t.date),"yyyy-MM-dd")))].map(t=>g(t)).sort((t,s)=>t.getTime()-s.getTime());if(r.length===0)return o;let a={length:0},n=0,i;for(let t=0;t<r.length;t++){let s=r[t];t===0||v(s,r[t-1])!==1?(n=1,i=s):n++,n>a.length&&(a={length:n,startDate:i,endDate:s})}return a}static \u0275fac=function(o){return new(o||m)};static \u0275prov=h({token:m,factory:m.\u0275fac,providedIn:"root"})};export{E as a,I as b};
