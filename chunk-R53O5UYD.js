import{a as ne}from"./chunk-J67B6IR2.js";import{b as S,c as y}from"./chunk-TZWIGK4J.js";import{b as Z,e as ee,g as te,h as _}from"./chunk-X2XI6BUQ.js";import{a as oe}from"./chunk-NQ6C7OZV.js";import{c as T,d as I,g as v,h as b,i as O,n as D}from"./chunk-I5UX6DPJ.js";import{$ as A,Aa as k,Ba as u,Ca as h,Cb as q,D as j,Da as Y,Gc as X,Ha as V,Ia as x,Ja as p,Ka as B,Kb as J,L as G,La as W,Lb as Q,P as d,R as M,S as C,T as N,Ua as U,Wa as $,g as P,ga as E,ha as w,pa as F,sa as H,sb as z,tb as K,ua as L,ub as R}from"./chunk-YKPMGRVE.js";var re=class l{decimalPipe=d(J);unitsService=d(ne);transform(t,e="1.0-2"){if(t==null)return null;let o=this.unitsService.convertFromKg(t,this.unitsService.currentUnit()),n=this.decimalPipe.transform(o,e),i=this.unitsService.getUnitLabel();return`${n} ${i}`}static \u0275fac=function(e){return new(e||l)};static \u0275pipe=H({name:"weightUnit",type:l,pure:!0})};var ce=["*",[["","modal-footer",""]]],me=["*","[modal-footer]"];function ue(l,t){if(l&1&&(u(0,"h3",11),U(1),h()),l&2){let e=p(3);w(),$(" ",e.modalTitle()," ")}}function de(l,t){if(l&1){let e=V();u(0,"div",6),L(1,ue,2,1,"h3",7),u(2,"button",8),x("click",function(){M(e);let n=p(2);return C(n.closeModal())}),N(),u(3,"svg",9),Y(4,"path",10),h()()()}if(l&2){let e=p(2);w(),k("ngIf",e.modalTitle())}}function pe(l,t){if(l&1){let e=V();u(0,"div",1),x("click",function(){M(e);let n=p();return C(n.closeModal())}),u(1,"div",2),x("click",function(n){M(e);let i=p();return C(i.onDialogClick(n))}),L(2,de,5,1,"div",3),u(3,"div",4),W(4),h(),u(5,"div",5),W(6,1),h()()()}if(l&2){let e=p();k("@modalAnimation",e.animationState),w(),k("@dialogAnimation",e.animationState),w(),k("ngIf",e.modalTitle()||!0)}}var ae=class l{elementRef=d(A);isOpen=R(!1);modalTitle=K();closed=z();get animationState(){return this.isOpen()?"open":"closed"}closeModal(){this.isOpen.set(!1),this.closed.emit()}onDialogClick(t){t.stopPropagation()}onDocumentMouseDown(t){this.isOpen()&&this.elementRef.nativeElement.contains(t.target)&&t.target.classList.contains("modal-container")&&this.closeModal()}onEscapeKey(){this.isOpen()&&this.closeModal()}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=F({type:l,selectors:[["app-modal"]],hostBindings:function(e,o){e&1&&x("mousedown",function(i){return o.onDocumentMouseDown(i)},E)("keydown.escape",function(){return o.onEscapeKey()},E)},inputs:{isOpen:[1,"isOpen"],modalTitle:[1,"modalTitle"]},outputs:{isOpen:"isOpenChange",closed:"closed"},ngContentSelectors:me,decls:1,vars:1,consts:[["class","modal-container fixed inset-0 z-[1000] flex items-center justify-center bg-black bg-opacity-60",3,"click",4,"ngIf"],[1,"modal-container","fixed","inset-0","z-[1000]","flex","items-center","justify-center","bg-black","bg-opacity-60",3,"click"],[1,"modal-dialog","mx-2","bg-white","dark:bg-gray-800","rounded-lg","shadow-xl","min-w-[300px]","w-full","max-w-lg","md:max-w-xl","lg:max-w-2xl","max-h-[90vh]","flex","flex-col","overflow-hidden",3,"click"],["class","modal-header flex items-center justify-between ml-1 p-1 md:p-1 border-gray-200 dark:border-gray-700",4,"ngIf"],[1,"modal-body","p-1","md:p-1","space-y-4","overflow-y-auto","flex-grow"],[1,"modal-footer","flex","items-center","p-4","md:p-5","border-t","border-gray-200","dark:border-gray-700","rounded-b"],[1,"modal-header","flex","items-center","justify-between","ml-1","p-1","md:p-1","border-gray-200","dark:border-gray-700"],["class","text-xl font-semibold text-gray-900 dark:text-white",4,"ngIf"],["type","button","aria-label","Close modal",1,"modal-close-button","text-gray-400","bg-transparent","hover:bg-gray-200","hover:text-gray-900","dark:hover:bg-gray-600","dark:hover:text-white","rounded-lg","text-sm","w-8","h-8","ms-auto","inline-flex","justify-center","items-center",3,"click"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 14 14",1,"w-3","h-3"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"],[1,"text-xl","font-semibold","text-gray-900","dark:text-white"]],template:function(e,o){e&1&&(B(ce),L(0,pe,7,3,"div",0)),e&2&&k("ngIf",o.isOpen())},dependencies:[Q,q],styles:[".modal-footer[_ngcontent-%COMP%]:empty{display:none}"],data:{animation:[T("modalAnimation",[b("closed",v({opacity:0,visibility:"hidden"})),b("open",v({opacity:1,visibility:"visible"})),O("closed <=> open",[I("300ms ease-in-out")])]),T("dialogAnimation",[b("closed",v({opacity:0,transform:"scale(0.95) translateY(20px)",visibility:"hidden"})),b("open",v({opacity:1,transform:"scale(1) translateY(0)",visibility:"visible"})),O("closed <=> open",[I("300ms ease-in-out")])])]}})};function se(l,t){return X(l,t?.in).getFullYear()}var le=class l{exerciseService=d(oe);constructor(){}calculateSetVolume(t){return(t.repsAchieved||0)*(t.weightUsed||0)}calculateWorkoutVolume(t){let e=0;return t.exercises.forEach(o=>{o.sets.forEach(n=>{e+=this.calculateSetVolume(n)})}),e}calculateTotalVolumeForAllLogs(t){return t.reduce((e,o)=>e+this.calculateWorkoutVolume(o),0)}getWeeklySummaries(t){if(!t||t.length===0)return[];let e=new Map;return t.forEach(o=>{let n=new Date(o.startTime),i=se(n),s=te(n,{weekStartsOn:1}),r=`${i}-W${String(s).padStart(2,"0")}`,c=Z(n,{weekStartsOn:1}),f=`Week ${s}, ${i}`,a=_(c,"dd/MM"),m=_(y(c,-6),"dd/MM");e.has(r)||e.set(r,{weekNumber:s,year:i,weekLabel:f,weekLabelStart:a,weekLabelEnd:m,workoutCount:0,totalVolume:0});let g=e.get(r);g.workoutCount++,g.totalVolume+=this.calculateWorkoutVolume(o)}),Array.from(e.values()).sort((o,n)=>o.year===n.year?o.weekNumber-n.weekNumber:o.year-n.year)}getWeeklyVolumeForChart(t){return this.getWeeklySummaries(t).map(o=>({date:new Date(o.year,0,o.weekNumber*7-6),weekLabel:o.weekLabel,totalVolume:o.totalVolume})).sort((o,n)=>o.date.getTime()-n.date.getTime())}getPerformanceByMuscleGroup(t){return P(this,null,function*(){if(!t||t.length===0)return[];let e=new Map,o=yield new Promise(i=>{this.exerciseService.getExercises().pipe(j(1)).subscribe(s=>i(s))}),n=new Map(o.map(i=>[i.id,i]));return t.forEach(i=>{let s=new Set;i.exercises.forEach(r=>{let c=n.get(r.exerciseId);if(c&&c.muscleGroups){let f=r.sets.reduce((a,m)=>a+this.calculateSetVolume(m),0);c.muscleGroups.forEach(a=>{let m=a.toLowerCase().trim();e.has(m)||e.set(m,{volume:0,workoutCountSet:new Set});let g=e.get(m);g.volume+=f,s.add(m)})}}),s.forEach(r=>{e.get(r)?.workoutCountSet.add(i.id)})}),Array.from(e.entries()).map(([i,s])=>({muscleGroup:i,volume:Math.round(s.volume),workoutCount:s.workoutCountSet.size})).sort((i,s)=>s.volume-i.volume)})}calculateCurrentWorkoutStreak(t){let e={length:0};if(!t||t.length===0)return e;let o=[...new Set(t.map(a=>_(D(a.date),"yyyy-MM-dd")))].map(a=>D(a)).sort((a,m)=>m.getTime()-a.getTime());if(o.length===0)return e;let n=0,i,s,r=new Date;if(r.setHours(0,0,0,0),o.some(a=>S(a,r)))n=1,i=new Date(r),s=new Date(r),r=y(r,1);else{let a=y(r,1);if(o.some(g=>S(g,a)))n=1,i=new Date(a),s=new Date(a),r=y(a,1);else return e}let f=!1;for(let a of o){if(!f){S(a,i)&&(f=!0);continue}if(S(a,r))n++,s=new Date(a),r=y(r,1);else break}return{length:n,startDate:s,endDate:i}}calculateLongestWorkoutStreak(t){let e={length:0};if(!t||t.length<1)return e;let o=[...new Set(t.map(r=>_(D(r.date),"yyyy-MM-dd")))].map(r=>D(r)).sort((r,c)=>r.getTime()-c.getTime());if(o.length===0)return e;let n={length:0},i=0,s;for(let r=0;r<o.length;r++){let c=o[r];r===0||ee(c,o[r-1])!==1?(i=1,s=c):i++,i>n.length&&(n={length:i,startDate:s,endDate:c})}return n}static \u0275fac=function(e){return new(e||l)};static \u0275prov=G({token:l,factory:l.\u0275fac,providedIn:"root"})};export{re as a,ae as b,le as c};
