import{Ec as f,K as g,O as u,d as q,hd as y,i as m,jd as E,m as S,md as b,nd as G}from"./chunk-4EC3NBNE.js";import{a as l,b as p,g as h}from"./chunk-GAL4ENT6.js";var T=class d{storageService=u(G);toastService=u(y);alertService=u(b);translate=u(E);PERSONAL_GYM_STORAGE_KEY="fitTrackPro_personalGym";equipmentSubject=new q(this._loadFromStorage());equipment$=this.equipmentSubject.asObservable();constructor(){}_loadFromStorage(){let t=this.storageService.getItem(this.PERSONAL_GYM_STORAGE_KEY);return t?this._sortEquipment(t):[]}_saveToStorage(t){let e=this._sortEquipment(t);this.storageService.setItem(this.PERSONAL_GYM_STORAGE_KEY,e),this.equipmentSubject.next(e)}_sortEquipment(t){return t.sort((e,i)=>e.category<i.category?-1:e.category>i.category?1:e.name.localeCompare(i.name))}getAllEquipment(){return this.equipment$}getEquipmentById(t){return this.equipment$.pipe(S(e=>e.find(i=>i.id===t)))}addEquipment(t){let e=p(l({},t),{id:f()}),s=[...this.equipmentSubject.getValue(),e];this._saveToStorage(s);let n=this.translate.instant("personalGymService.addSuccessTitle"),a=this.translate.instant("personalGymService.addSuccessMessage",{name:e.name});return this.toastService.success(a,3e3,n),e}updateEquipment(t){let e=this.equipmentSubject.getValue(),i=e.findIndex(s=>s.id===t.id);if(i>-1){let s=[...e];s[i]=t,this._saveToStorage(s);let n=this.translate.instant("personalGymService.updateSuccessTitle"),a=this.translate.instant("personalGymService.updateSuccessMessage",{name:t.name});this.toastService.success(a,3e3,n)}else{let s=this.translate.instant("personalGymService.updateFailedTitle"),n=this.translate.instant("personalGymService.updateFailedMessage",{name:t.name});this.toastService.error(n,0,s)}}deleteEquipment(t){return h(this,null,function*(){let e=this.equipmentSubject.getValue(),i=e.find(o=>o.id===t);if(!i){let o=this.translate.instant("personalGymService.deleteFailedTitle"),c=this.translate.instant("personalGymService.deleteFailedMessage");this.toastService.error(c,0,o);return}let s=this.translate.instant("personalGymService.deleteConfirmTitle"),n=this.translate.instant("personalGymService.deleteConfirmMessage",{name:i.name}),a=yield this.alertService.showConfirm(s,n);if(a&&a.data){let o=e.filter(v=>v.id!==t);this._saveToStorage(o);let c=this.translate.instant("personalGymService.deletedTitle"),r=this.translate.instant("personalGymService.deletedMessage",{name:i.name});this.toastService.info(r,3e3,c)}})}getDataForBackup(){return this.equipmentSubject.getValue()}mergeData(t){if(!Array.isArray(t)){console.error("PersonalGymService: Imported data for equipment is not an array.");let r=this.translate.instant("personalGymService.importErrorTitle"),v=this.translate.instant("personalGymService.importFailed");this.toastService.error(v,0,r);return}let e=this.equipmentSubject.getValue(),i=new Map(e.map(r=>[r.id,r])),s=0,n=0;t.forEach(r=>{if(!r.id||!r.name){console.warn("Skipping invalid equipment during import:",r);return}i.has(r.id)?s++:n++,i.set(r.id,r)});let a=Array.from(i.values());this._saveToStorage(a);let o=this.translate.instant("personalGymService.mergeSuccessTitle"),c=this.translate.instant("personalGymService.mergeSuccessMessage",{updatedCount:s,addedCount:n});this.toastService.success(c,6e3,o)}hideEquipment(t){let e=this.equipmentSubject.getValue(),i=e.findIndex(a=>a.id===t);if(i===-1)return this.toastService.error("Failed to hide equipment: not found.",0,"Error"),m(void 0);let s=[...e],n=p(l({},s[i]),{isHidden:!0});return s[i]=n,this._saveToStorage(s),this.toastService.info(`'${n.name}' is now hidden.`,3e3,"Hidden"),m(n)}unhideEquipment(t){let e=this.equipmentSubject.getValue(),i=e.findIndex(a=>a.id===t);if(i===-1)return this.toastService.error("Failed to un-hide equipment: not found.",0,"Error"),m(void 0);let s=[...e],n=p(l({},s[i]),{isHidden:!1});return s[i]=n,this._saveToStorage(s),this.toastService.success(`'${n.name}' is now visible.`,3e3,"Visible"),m(n)}getHiddenEquipments(){return this.equipmentSubject.asObservable().pipe(S(t=>t.filter(e=>e.isHidden)))}static \u0275fac=function(e){return new(e||d)};static \u0275prov=g({token:d,factory:d.\u0275fac,providedIn:"root"})};export{T as a};
