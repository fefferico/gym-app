import{a as M,b as E,c as j}from"./chunk-QSPGE45Z.js";import{a as Z}from"./chunk-W4MDPEPU.js";import{c as ee,f as p,h as te}from"./chunk-UUK5EMMS.js";import{h as y,s as k}from"./chunk-JQD335PY.js";import{Ab as Y,Bb as q,Ia as w,J as H,Ja as d,Jb as J,Ka as v,La as N,N as h,Pa as O,Qa as b,Ra as g,S as _,Sa as R,T as C,Ta as L,U as B,Ub as Q,aa as F,ab as $,cb as z,ed as X,ha as W,ia as x,oc as T,pc as I,qa as K,sc as S,tc as D,uc as A,va as V,z as P,zb as U}from"./chunk-PV6B3BBM.js";import{g as G}from"./chunk-GAL4ENT6.js";var le=["*",[["","modal-footer",""]]],ce=["*","[modal-footer]"];function me(s,o){if(s&1&&(d(0,"h3",11),$(1),v()),s&2){let e=g(3);x(),z(" ",e.modalTitle()," ")}}function de(s,o){if(s&1){let e=O();d(0,"div",6),V(1,me,2,1,"h3",7),d(2,"button",8),b("click",function(){_(e);let a=g(2);return C(a.closeModal())}),B(),d(3,"svg",9),N(4,"path",10),v()()()}if(s&2){let e=g(2);x(),w("ngIf",e.modalTitle())}}function ue(s,o){if(s&1){let e=O();d(0,"div",1),b("click",function(){_(e);let a=g();return C(a.closeModal())}),d(1,"div",2),b("click",function(a){_(e);let t=g();return C(t.onDialogClick(a))}),V(2,de,5,1,"div",3),d(3,"div",4),L(4),v(),d(5,"div",5),L(6,1),v()()()}if(s&2){let e=g();w("@modalAnimation",e.animationState),x(),w("@dialogAnimation",e.animationState),x(),w("ngIf",e.modalTitle()||!0)}}var oe=class s{elementRef=h(F);isOpen=q(!1);modalTitle=Y();closed=U();get animationState(){return this.isOpen()?"open":"closed"}closeModal(){this.isOpen.set(!1),this.closed.emit()}onDialogClick(o){o.stopPropagation()}onDocumentMouseDown(o){this.isOpen()&&this.elementRef.nativeElement.contains(o.target)&&o.target.classList.contains("modal-container")&&this.closeModal()}onEscapeKey(){this.isOpen()&&this.closeModal()}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=K({type:s,selectors:[["app-modal"]],hostBindings:function(e,r){e&1&&b("mousedown",function(t){return r.onDocumentMouseDown(t)},W)("keydown.escape",function(){return r.onEscapeKey()},W)},inputs:{isOpen:[1,"isOpen"],modalTitle:[1,"modalTitle"]},outputs:{isOpen:"isOpenChange",closed:"closed"},ngContentSelectors:ce,decls:1,vars:1,consts:[["class","modal-container fixed inset-0 z-[1000] flex items-center justify-center bg-black bg-opacity-60",3,"click",4,"ngIf"],[1,"modal-container","fixed","inset-0","z-[1000]","flex","items-center","justify-center","bg-black","bg-opacity-60",3,"click"],[1,"modal-dialog","mx-2","bg-white","dark:bg-gray-800","rounded-md","shadow-xl","min-w-[300px]","w-full","max-w-lg","md:max-w-xl","lg:max-w-2xl","max-h-[90vh]","flex","flex-col","overflow-hidden",3,"click"],["class","modal-header flex items-center justify-between ml-1 p-1 md:p-1 border-gray-200 dark:border-gray-700",4,"ngIf"],[1,"modal-body","p-1","md:p-1","space-y-4","overflow-y-auto","flex-grow","custom-scrollbar"],[1,"modal-footer","flex","items-center","p-4","md:p-5","border-t","border-gray-200","dark:border-gray-700","rounded-b"],[1,"modal-header","flex","items-center","justify-between","ml-1","p-1","md:p-1","border-gray-200","dark:border-gray-700"],["class","text-xl font-semibold text-gray-900 dark:text-white",4,"ngIf"],["type","button","aria-label","Close modal",1,"modal-close-button","text-gray-400","bg-transparent","hover:bg-gray-200","hover:text-gray-900","dark:hover:bg-gray-600","dark:hover:text-white","rounded-md","text-sm","w-8","h-8","ms-auto","inline-flex","justify-center","items-center",3,"click"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 14 14",1,"w-3","h-3"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"],[1,"text-xl","font-semibold","text-gray-900","dark:text-white"]],template:function(e,r){e&1&&(R(le),V(0,ue,7,3,"div",0)),e&2&&w("ngIf",r.isOpen())},dependencies:[Q,J],styles:[".modal-footer[_ngcontent-%COMP%]:empty{display:none}"],data:{animation:[T("modalAnimation",[D("closed",S({opacity:0,visibility:"hidden"})),D("open",S({opacity:1,visibility:"visible"})),A("closed <=> open",[I("300ms ease-in-out")])]),T("dialogAnimation",[D("closed",S({opacity:0,transform:"scale(0.95) translateY(20px)",visibility:"hidden"})),D("open",S({opacity:1,transform:"scale(1) translateY(0)",visibility:"visible"})),A("closed <=> open",[I("300ms ease-in-out")])])]}})};function ne(s){return o=>{let r=(s?Math[s]:Math.trunc)(o);return r===0?0:r}}function re(s,o,e){let r=ee(s,o,e)/7;return ne(e?.roundingMethod)(r)}var ae=class s{exerciseService=h(te);translate=h(X);constructor(){}calculateSetVolume(o){return(o.repsAchieved||0)*(o.weightUsed||0)}calculateWorkoutVolume(o){let e=0;return o.exercises.forEach(r=>{r.sets.forEach(a=>{e+=this.calculateSetVolume(a)})}),e}calculateTotalVolumeForAllLogs(o){return o.reduce((e,r)=>e+this.calculateWorkoutVolume(r),0)}getWeeklySummaries(o){if(!o||o.length===0)return[];let e={};o.forEach(a=>{let t=p(a.date),n=y(t,{weekStartsOn:1}),c=M(t,{weekStartsOn:1}),m=k(n,"yyyy-MM-dd");e[m]||(e[m]={logs:[],startDate:n,endDate:c}),e[m].logs.push(a)});let r=this.translate.instant("statsService.weekOf");return Object.entries(e).map(([a,t])=>{let n=this.calculateTotalVolumeForAllLogs(t.logs);return{weekLabel:`${r} ${k(t.startDate,"MMM d")}`,workoutCount:t.logs.length,totalVolume:n,weekStartDate:t.startDate,weekEndDate:t.endDate}}).sort((a,t)=>t.weekStartDate.getTime()-a.weekStartDate.getTime())}calculateTotalVolume(o){return o.exercises.reduce((e,r)=>{let a=r.sets.reduce((t,n)=>t+(n.weightUsed??0)*(n.repsAchieved??0),0);return e+a},0)}getWeeklyVolumeForChart(o){if(!o||o.length===0)return[];let e={},r=this.translate.instant("statsService.weekPrefix");return o.forEach(t=>{let n=p(t.date),c=y(n,{weekStartsOn:1}),m=k(c,"yyyy-MM-dd");e[m]||(e[m]={totalVolume:0,weekLabel:`${r}${k(c,"w")} '${k(c,"yy")}`}),e[m].totalVolume+=this.calculateTotalVolume(t)}),Object.keys(e).sort((t,n)=>new Date(t).getTime()-new Date(n).getTime()).map(t=>({date:p(t),weekLabel:e[t].weekLabel,totalVolume:e[t].totalVolume}))}getPerformanceByMuscleGroup(o){return G(this,null,function*(){if(!o||o.length===0)return[];let e=new Map,r=yield new Promise(t=>{this.exerciseService.getExercises().pipe(P(1)).subscribe(n=>t(n))}),a=new Map(r.map(t=>[t.id,t]));return o.forEach(t=>{let n=new Set;t.exercises.forEach(c=>{let m=a.get(c.exerciseId);if(m&&m.muscleGroups){let u=c.sets.reduce((i,l)=>i+this.calculateSetVolume(l),0);m.muscleGroups.forEach(i=>{let l=i.toLowerCase().trim();e.has(l)||e.set(l,{volume:0,workoutCountSet:new Set});let f=e.get(l);f.volume+=u,n.add(l)})}}),n.forEach(c=>{e.get(c)?.workoutCountSet.add(t.id)})}),Array.from(e.entries()).map(([t,n])=>({muscleGroup:t,volume:Math.round(n.volume),workoutCount:n.workoutCountSet.size})).sort((t,n)=>n.volume-t.volume)})}calculateCurrentWorkoutStreak(o,e){let r=[...o.map(l=>p(l.date)),...e.map(l=>p(l.date))];if(r.length===0)return{length:0};r.sort((l,f)=>f.getTime()-l.getTime());let a=new Date,t=y(a,{weekStartsOn:1}),n=0,c,m=r[0],u=j(a,7);if(!E(m,a,{weekStartsOn:1})&&!E(m,u,{weekStartsOn:1}))return{length:0};for(let l=0;l<260&&r.some(ie=>E(ie,t,{weekStartsOn:1}));l++)c||(c=M(t,{weekStartsOn:1})),n++,t=j(t,7);if(n===0)return{length:0};let i=y(Z(t,7),{weekStartsOn:1});return{length:n,startDate:i,endDate:c}}calculateLongestWorkoutStreak(o,e){let r=[...o.map(i=>p(i.date)),...e.map(i=>p(i.date))];if(r.length<2)return this.calculateCurrentWorkoutStreak(o,e);let a=Array.from(new Set(r.map(i=>k(y(i,{weekStartsOn:1}),"yyyy-MM-dd")))).map(i=>new Date(i)).sort((i,l)=>i.getTime()-l.getTime());if(a.length===0)return{length:0};let t=0,n=0,c,m,u;for(let i=0;i<a.length;i++)if(i===0)n=1,u=a[i];else{let l=a[i-1],f=a[i];re(f,l)===1?n++:(n>t&&(t=n,c=u,m=M(l,{weekStartsOn:1})),n=1,u=f)}return n>t&&(t=n,c=u,m=M(a[a.length-1],{weekStartsOn:1})),{length:t,startDate:c,endDate:m}}static \u0275fac=function(e){return new(e||s)};static \u0275prov=H({token:s,factory:s.\u0275fac,providedIn:"root"})};export{oe as a,ae as b};
