import{a as ze,b as Ft}from"./chunk-24PO23A4.js";import{a as _e}from"./chunk-YNS5D6F5.js";import{a as fe}from"./chunk-WLWWSFEN.js";import{a as Tt,b as Pt,c as Wt,d as Rt,e as Vt}from"./chunk-5MRSSACL.js";import"./chunk-CPAHXTYO.js";import{c as ft,d as _t,f as it,g as rt,h as ht}from"./chunk-YAHOZYMW.js";import{h as q}from"./chunk-AN7IIKCF.js";import{b as re}from"./chunk-C7OZXO4L.js";import{a as ge,b as je}from"./chunk-JFE3I7DT.js";import{$ as lt,$a as ct,$b as St,Ba as b,Bb as K,C as se,Ca as f,Cb as Y,Da as d,E as ne,Ha as Se,Ia as ye,Ja as be,K as I,Ka as Q,Kb as gt,Lb as me,M as x,Ma as ke,N as g,Nb as ie,O as C,Oa as u,Ob as Re,P as R,Pa as V,Qa as k,Ra as U,Sb as oe,T as E,Ta as we,Tb as Ve,U as at,Ua as Ie,Ub as M,Va as Ee,Vb as Fe,Wb as De,Xa as Ce,Xb as vt,Y as ae,Yb as Me,Za as ut,Zb as Oe,_a as ue,_b as Ae,a as B,aa as dt,ab as mt,ac as Ne,b as L,ba as l,bc as yt,cb as pt,cc as bt,d as P,db as F,dc as Be,eb as j,ec as kt,fb as $,fc as wt,gc as It,hb as z,hc as Et,ic as Ct,ja as G,jb as D,jc as Le,k as Z,kc as Ue,lc as $e,m as X,mb as Te,mc as pe,n as ve,nc as Ge,oa as h,oc as xe,p as nt,pa as et,qb as Pe,r as Xe,rb as ee,s as ot,sb as H,ta as tt,u as st,ua as c,va as s,wa as a,wb as xt,xa as y,xb as We,y as N,ya as le,yb as ce,za as de,zb as te}from"./chunk-MAKRABO3.js";function Dt(n,t){if(n&1&&(s(0,"p",25),u(1),a()),n&2){let e=d().$implicit;c("title",e.description),l(),V(e.description)}}function Mt(n,t){if(n&1&&(s(0,"div",26)(1,"span",21),u(2,"Last:"),a(),u(3),F(4,"date"),a()),n&2){let e=d().$implicit;l(3),k(" ",$(4,1,e.lastPerformed,"dd/MM/yy")," ")}}function Ot(n,t){n&1&&(s(0,"div",27),u(1," Not performed "),a())}function At(n,t){if(n&1){let e=b();s(0,"div",28)(1,"button",29),f("click",function(r){x(e);let o=d().$implicit,m=d(3);return g(m.startWorkout(o.id,r))}),C(),s(2,"svg",30),y(3,"path",31),a()(),R(),s(4,"button",32),f("click",function(r){x(e);let o=d().$implicit,m=d(3);return g(m.viewRoutineDetails(o.id,r))}),C(),s(5,"svg",30),y(6,"path",33)(7,"path",34),a()(),R(),s(8,"button",35),f("click",function(r){x(e);let o=d().$implicit,m=d(3);return g(m.editRoutine(o.id,r))}),C(),s(9,"svg",30),y(10,"path",36),a()(),R(),s(11,"button",37),f("click",function(r){x(e);let o=d().$implicit,m=d(3);return g(m.deleteRoutine(o.id,r))}),C(),s(12,"svg",30),y(13,"path",38),a()()()}n&2&&c("@slideInOutActions",void 0)}function Nt(n,t){if(n&1){let e=b();s(0,"div",12),f("click",function(){let r=x(e).$implicit,o=d(3);return g(o.viewRoutineDetails(r.id))}),s(1,"div",13)(2,"div",14)(3,"h2",15),u(4),a(),s(5,"button",16),f("click",function(r){let o=x(e).$implicit,m=d(3);return g(m.toggleActions(o.id,r))}),C(),s(6,"svg",17),y(7,"path",18),a()()(),h(8,Dt,2,2,"p",19),R(),s(9,"div",20)(10,"span")(11,"span",21),u(12,"Goal:"),a(),u(13),F(14,"titlecase"),a(),s(15,"span")(16,"span",21),u(17,"Ex:"),a(),u(18),a()(),h(19,Mt,5,4,"div",22)(20,Ot,2,0,"div",23),a(),h(21,At,14,1,"div",24),a()}if(n&2){let e=t.$implicit,i=d(3);l(3),c("title",e.name),l(),V(e.name),l(4),c("ngIf",e.description),l(5),k(" ",j(14,8,e.goal)??"N/A"," "),l(5),k(" ",e.exercises.length," "),l(),c("ngIf",e.lastPerformed),l(),c("ngIf",!e.lastPerformed),l(),c("ngIf",i.areActionsVisible(e.id))}}function Bt(n,t){if(n&1&&(s(0,"div",10),h(1,Nt,22,10,"div",11),a()),n&2){let e=d().ngIf;l(),c("ngForOf",e)}}function Lt(n,t){if(n&1){let e=b();s(0,"div",39),C(),s(1,"svg",40),y(2,"path",41),a(),R(),s(3,"h3",42),u(4,"No Routines Yet!"),a(),s(5,"p",43),u(6,"Get started by creating your first workout routine."),a(),s(7,"button",44),f("click",function(){x(e);let r=d(2);return g(r.navigateToCreateRoutine())}),u(8," Create Your First Routine "),a()()}}function Ut(n,t){if(n&1&&(s(0,"div"),h(1,Bt,2,1,"div",9)(2,Lt,9,0,"ng-template",null,1,z),a()),n&2){let e=t.ngIf,i=Q(3);l(),c("ngIf",e.length>0)("ngIfElse",i)}}function $t(n,t){n&1&&(s(0,"div",45)(1,"p",46),u(2,"Loading routines..."),a()())}var He=class n{workoutService=I(xe);trackingService=I(re);router=I(ie);alertService=I(pe);spinnerService=I(je);toastService=I(ge);storageService=I(Ge);platformId=I(ae);routines$;visibleActionsRutineId=E(null);PAUSED_WORKOUT_KEY="fitTrackPro_pausedWorkoutState";ngOnInit(){Y(this.platformId)&&window.scrollTo(0,0),this.routines$=this.workoutService.routines$}navigateToCreateRoutine(){this.router.navigate(["/workout/new"])}editRoutine(t,e){e.stopPropagation(),this.router.navigate(["/workout/edit",t]),this.visibleActionsRutineId.set(null)}deleteRoutine(t,e){return P(this,null,function*(){e.stopPropagation(),this.visibleActionsRutineId.set(null);let i=yield X(this.workoutService.getRoutineById(t).pipe(N(1)));if(!i){this.toastService.error("Routine not found for deletion.",0,"Error");return}let r=(yield X(this.trackingService.getWorkoutLogsByRoutineId(t).pipe(N(1))))||[],o=`Are you sure you want to delete the routine "${i.name}"?`;r.length>0&&(o+=` This will also delete ${r.length} associated workout log(s). This action cannot be undone.`);let m=yield this.alertService.showConfirm("Delete Routine",o,"Delete");if(m&&m.data)try{this.spinnerService.show(),r.length>0&&(yield this.trackingService.clearWorkoutLogsByRoutineId(t)),this.workoutService.deleteRoutine(t),this.toastService.success(`Routine "${i.name}" deleted successfully.`,4e3,"Routine Deleted")}catch(p){console.error("Error during deletion:",p),this.toastService.error("Failed to delete routine or its logs. Please try again.",0,"Deletion Failed")}finally{this.spinnerService.hide()}})}startWorkout(t,e){return P(this,null,function*(){if(e.stopPropagation(),this.visibleActionsRutineId.set(null),!Y(this.platformId)){this.router.navigate(["/workout/play",t]);return}let i=this.storageService.getItem(this.PAUSED_WORKOUT_KEY);if(i){let r=i.sessionRoutine?.name||"a previous session",o=i.workoutDate?` from ${q(new Date(i.workoutDate),"MMM d, HH:mm")}`:"",m=[{text:"Cancel",role:"cancel",data:"cancel"},{text:"Discard Paused & Start New",role:"confirm",data:"discard_start_new",cssClass:"bg-red-500 hover:bg-red-600 text-white"},{text:`Resume: ${r.substring(0,15)}${r.length>15?"...":""}`,role:"confirm",data:"resume_paused",cssClass:"bg-green-500 hover:bg-green-600 text-white"}],p=yield this.alertService.showConfirmationDialog("Workout in Progress",`You have a paused workout ("${r}"${o}). What would you like to do?`,m);if(p&&p.data==="resume_paused"){let S=i.routineId||"ad-hoc";i.routineId?this.router.navigate(["/workout/play",i.routineId],{queryParams:{resume:"true"}}):this.router.navigate(["/workout/play"],{queryParams:{resume:"true"}})}else p&&p.data==="discard_start_new"?(this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),this.toastService.info("Previous paused workout discarded.",3e3),this.router.navigate(["/workout/play",t])):this.toastService.info("Starting new workout cancelled.",2e3)}else this.router.navigate(["/workout/play",t])})}viewRoutineDetails(t,e){e?.stopPropagation(),this.router.navigate(["/workout/view",t]),this.visibleActionsRutineId.set(null)}toggleActions(t,e){e.stopPropagation(),this.visibleActionsRutineId.update(i=>i===t?null:t)}areActionsVisible(t){return this.visibleActionsRutineId()===t}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=G({type:n,selectors:[["app-routine-list"]],decls:12,vars:4,consts:[["loadingRoutines",""],["noRoutines",""],[1,"acontainer","mx-auto","p-1"],[1,"flex","justify-between","items-center","mb-6","pb-3","border-b","border-gray-200","dark:border-gray-700"],[1,"text-2xl","font-bold","text-gray-800","dark:text-gray-200"],[1,"bg-primary","hover:bg-primary-dark","text-white","font-semibold","py-2","px-3","rounded-md","shadow-sm","hover:shadow-md","transition-all","duration-200","focus:outline-none","focus:ring-2","focus:ring-primary-light","focus:ring-opacity-75","text-sm",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"w-4","h-4","mr-1.5","inline-block"],["d","M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z"],[4,"ngIf","ngIfElse"],["class","grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",4,"ngIf","ngIfElse"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4"],["class","bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-200 cursor-pointer overflow-hidden relative group",3,"click",4,"ngFor","ngForOf"],[1,"bg-white","dark:bg-gray-800","rounded-lg","shadow-md","hover:shadow-lg","transition-shadow","duration-200","cursor-pointer","overflow-hidden","relative","group",3,"click"],[1,"p-3"],[1,"flex","justify-between","items-start","mb-1.5"],[1,"text-lg","font-semibold","text-primary","dark:text-primary-light","truncate","pr-8",3,"title"],[1,"absolute","top-2","right-2","p-1.5","text-gray-500","dark:text-gray-400","hover:bg-gray-200","dark:hover:bg-gray-700","rounded-full","focus:outline-none","z-10",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","d","M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"],["class","text-gray-600 dark:text-gray-400 text-xs mb-2 line-clamp-2",3,"title",4,"ngIf"],[1,"flex","justify-between","text-xs","text-gray-500","dark:text-gray-300","mb-2","space-x-2"],[1,"font-medium"],["class","text-xs text-gray-500 dark:text-gray-300",4,"ngIf"],["class","text-xs text-gray-500 dark:text-gray-300 italic",4,"ngIf"],["class",`absolute inset-x-0 bottom-0 p-2 bg-gray-100 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-700
                           flex flex-wrap gap-1.5 justify-center z-20 rounded-b-lg`,4,"ngIf"],[1,"text-gray-600","dark:text-gray-400","text-xs","mb-2","line-clamp-2",3,"title"],[1,"text-xs","text-gray-500","dark:text-gray-300"],[1,"text-xs","text-gray-500","dark:text-gray-300","italic"],[1,"absolute","inset-x-0","bottom-0","p-2","bg-gray-100","dark:bg-gray-700","border-t","border-gray-200","dark:border-gray-700","flex","flex-wrap","gap-1.5","justify-center","z-20","rounded-b-lg"],["title","Start Workout",1,"flex-1","text-xs","min-w-[70px]","flex","items-center","justify-center","p-1.5","bg-green-500","text-white","rounded-md","hover:bg-green-600","transition-colors",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","2","stroke","currentColor",1,"size-4"],["stroke-linecap","round","stroke-linejoin","round","d","M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"],["title","View Details",1,"flex-1","text-xs","min-w-[70px]","flex","items-center","justify-center","p-1.5","bg-cyan-500","text-white","rounded-md","hover:bg-cyan-600","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"],["stroke-linecap","round","stroke-linejoin","round","d","M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"],["title","Edit Routine",1,"flex-1","text-xs","min-w-[70px]","flex","items-center","justify-center","p-1.5","bg-yellow-500","text-white","rounded-md","hover:bg-yellow-600","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"],["title","Delete Routine",1,"flex-1","text-xs","min-w-[70px]","flex","items-center","justify-center","p-1.5","bg-red-500","text-white","rounded-md","hover:bg-red-600","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"],[1,"text-center","py-12","px-6","bg-white","dark:bg-gray-800","rounded-lg","shadow-md"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-16","h-16","mx-auto","text-gray-400","dark:text-gray-200","mb-4"],["stroke-linecap","round","stroke-linejoin","round","d","M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 0 1 0 3.75H5.625a1.875 1.875 0 0 1 0-3.75Z"],[1,"text-xl","font-semibold","text-gray-700","dark:text-gray-300","mb-2"],[1,"text-gray-500","dark:text-gray-400","mb-6"],[1,"bg-primary","hover:bg-primary-dark","text-white","font-semibold","py-2","px-6","rounded-md","shadow-md","hover:shadow-lg","transition-all","duration-300","focus:outline-none","focus:ring-2","focus:ring-primary-light","focus:ring-opacity-75",3,"click"],[1,"text-center","py-10"],[1,"text-xl","text-gray-600","dark:text-gray-400"]],template:function(e,i){if(e&1){let r=b();s(0,"div",2)(1,"header",3)(2,"h1",4),u(3,"My Workout & Routines"),a(),s(4,"button",5),f("click",function(){return x(r),g(i.navigateToCreateRoutine())}),C(),s(5,"svg",6),y(6,"path",7),a(),u(7," New Routine "),a()(),h(8,Ut,4,2,"div",8),F(9,"async"),h(10,$t,3,0,"ng-template",null,0,z),a()}if(e&2){let r=Q(11);l(8),c("ngIf",j(9,2,i.routines$))("ngIfElse",r)}},dependencies:[K,ee,H,xt,We,ce],encapsulation:2,data:{animation:[ft("slideInOutActions",[rt("void",it({height:"0px",opacity:0,overflow:"hidden",paddingTop:"0",paddingBottom:"0",marginTop:"0",marginBottom:"0"})),rt("*",it({height:"*",opacity:1,overflow:"hidden",paddingTop:"0.5rem",paddingBottom:"0.5rem"})),ht("void <=> *",_t("200ms ease-in-out"))])]}})};var jt=["setRepsInput"],zt=["expandedSetElement"],Ht=(n,t)=>({"border-red-500 dark:border-red-400":n,"border-gray-300 dark:border-gray-600":t}),Kt=(n,t,e,i,r,o,m)=>({"border-orange-500 dark:border-orange-400 bg-orange-50 dark:bg-orange-900/30":n,"ring-2 ring-orange-400 dark:ring-orange-300 shadow-md":t,"dark:bg-orange-900/40":e,"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800":i,"rounded-b-none border-b-transparent dark:border-b-transparent":r,"rounded-t-none":o,"mt-4":m}),Yt=(n,t)=>({"border-b border-orange-300 dark:border-orange-600":n,"border-b border-gray-200 dark:border-gray-600":t}),qt=(n,t,e)=>({"bg-blue-100 dark:bg-blue-700":n,"bg-gray-50 dark:bg-gray-700":t,"cursor-default":e}),Jt=(n,t)=>({"bg-blue-100 dark:bg-blue-700":n,"bg-gray-100 dark:bg-gray-700":t});function Qt(n,t){if(n&1&&(s(0,"div",31),u(1),a()),n&2){let e=d();l(),k(" ",e.errorMessage(),`
`)}}function Zt(n,t){if(n&1){let e=b();s(0,"button",39),f("click",function(){x(e);let r=d(2);return g(r.enableEditMode())}),C(),s(1,"svg",34),y(2,"path",40),a(),u(3," Edit "),a()}}function Xt(n,t){if(n&1){let e=b();s(0,"div",32)(1,"button",33),f("click",function(){x(e);let r=d();return g(r.startCurrentWorkout())}),C(),s(2,"svg",34),y(3,"path",35),a(),u(4," Start "),a(),h(5,Zt,4,0,"button",36),R(),s(6,"button",37),f("click",function(){x(e);let r=d();return g(r.deleteCurrentRoutine())}),C(),s(7,"svg",34),y(8,"path",38),a(),u(9," Delete "),a()()}if(n&2){let e=d();l(5),c("ngIf",e.isViewMode)}}function ei(n,t){n&1&&(s(0,"span"),u(1,"Routine name is required."),a())}function ti(n,t){if(n&1&&(s(0,"div",41),h(1,ei,2,0,"span",42),a()),n&2){let e=d();l(),c("ngIf",e.f.name.errors==null?null:e.f.name.errors.required)}}function ii(n,t){if(n&1&&(s(0,"option",43),u(1),a()),n&2){let e=t.$implicit;c("value",e.value),l(),V(e.label)}}function ri(n,t){if(n&1){let e=b();s(0,"button",44),f("click",function(){x(e);let r=d();return g(r.openExerciseSelectionModal())}),u(1," + Add Exercise "),a()}if(n&2){let e=d();c("disabled",e.isViewMode)}}function ni(n,t){if(n&1){let e=b();s(0,"div",69)(1,"button",70),f("click",function(){x(e);let r=d(3);return g(r.groupSelectedAsSuperset())}),u(2),a()()}if(n&2){let e=d(3);l(),c("disabled",!e.canGroupSelectedExercises()||e.isViewMode),l(),k(" Group Superset (",e.selectedExerciseIndicesForSuperset().length,") ")}}function oi(n,t){n&1&&(s(0,"div",71),C(),s(1,"svg",72),y(2,"path",73),a()())}function si(n,t){if(n&1){let e=b();s(0,"input",74),f("change",function(r){x(e);let o=d().index,m=d(2);return g(m.toggleExerciseSelectionForSuperset(o,r))}),a()}if(n&2){let e=d().index,i=d(2);c("id","superset-select-"+e)("checked",i.selectedExerciseIndicesForSuperset().includes(e))("disabled",i.isViewMode)}}function ai(n,t){if(n&1&&(s(0,"span",75),u(1),a()),n&2){let e,i=d().$implicit;l(),U(" Superset (",(((e=i.get("supersetOrder"))==null?null:e.value)??0)+1," of ",(e=i.get("supersetSize"))==null?null:e.value,") ")}}function li(n,t){if(n&1){let e=b();s(0,"button",76),f("click",function(){x(e);let r=d().index,o=d(2);return g(o.removeExercise(r))}),C(),s(1,"svg",77),y(2,"path",78),a(),u(3," Remove "),a()}if(n&2){let e=d(3);c("disabled",e.isViewMode)}}function di(n,t){if(n&1){let e=b();s(0,"button",79),f("click",function(){x(e);let r=d().index,o=d(2);return g(o.ungroupSuperset(r))}),C(),s(1,"svg",77),y(2,"path",80),a(),u(3," Ungroup "),a()}if(n&2){let e=d(3);c("disabled",e.isViewMode)}}function ui(n,t){if(n&1){let e=b();s(0,"button",81),f("click",function(){x(e);let r=d(),o=r.$implicit,m=r.index,p=d(2);return g(p.addSet(o,m))}),u(1," + Add Set "),a()}if(n&2){let e=d(3);c("disabled",e.isViewMode)}}function ci(n,t){if(n&1&&(s(0,"div",82)(1,"div",83),u(2,"#"),a(),s(3,"div",84),u(4,"Reps"),a(),s(5,"div",84),u(6),a(),s(7,"div",84),u(8,"Time"),a(),s(9,"div",84),u(10,"Rest"),a(),s(11,"div",84),u(12,"Tempo"),a(),y(13,"div",85),a()),n&2){let e=d(3);l(6),k("Weight (",e.unitsService.getUnitLabel(),") ")}}function mi(n,t){if(n&1){let e=b();s(0,"div",95)(1,"button",96),f("click",function(r){x(e);let o=d(2).index,m=d(),p=m.$implicit,S=m.index;return d(2).removeSet(p,S,o),g(r.stopPropagation())}),C(),s(2,"svg",97),y(3,"path",98),a()()()}if(n&2){let e=d(5);l(),c("disabled",e.isViewMode)}}function pi(n,t){n&1&&(s(0,"div",99),C(),s(1,"svg",100),y(2,"line",101)(3,"line",102),a()())}function xi(n,t){if(n&1){let e=b();s(0,"div",89),f("click",function(r){x(e);let o=d().index,m=d().index,p=d(2);return g(p.toggleSetExpansion(m,o,r))}),s(1,"div",90),u(2),a(),s(3,"div",91),u(4),a(),s(5,"div",91),u(6),F(7,"weightUnit"),a(),s(8,"div",91),u(9),a(),s(10,"div",91),u(11),a(),s(12,"div",92),u(13),a(),h(14,mi,4,1,"div",93)(15,pi,4,0,"div",94),a()}if(n&2){let e,i,r,o,m,p,S,_=d(),v=_.$implicit,w=_.index,T=d(3);c("ngClass",ct(13,qt,(e=v.get("isWarmup"))==null?null:e.value,!((e=v.get("isWarmup"))!=null&&e.value)&&!T.isViewMode,T.isViewMode)),l(2),k(" ",w+1),l(2),k(" ",((i=v.get("reps"))==null?null:i.value)||"-"),l(2),k(" ",(r=v.get("weight"))!=null&&r.value?$(7,10,(r=v.get("weight"))==null?null:r.value,"1.0-2"):"-"),l(3),k(" ",(o=v.get("duration"))!=null&&o.value?((o=v.get("duration"))==null?null:o.value)+"s":"-"),l(2),k(" ",(m=v.get("restAfterSet"))==null?null:m.value,"s"),l(),c("title",(p=v.get("tempo"))==null?null:p.value),l(),V(((S=v.get("tempo"))==null?null:S.value)||"-"),l(),c("ngIf",T.isEditMode&&!T.isViewMode),l(),c("ngIf",T.isViewMode)}}function gi(n,t){if(n&1){let e=b();s(0,"div",103,0)(2,"div",104)(3,"div")(4,"label",105),u(5,"Reps"),a(),y(6,"input",106,1),a(),s(8,"div")(9,"label",105),u(10),a(),y(11,"input",107),a(),s(12,"div")(13,"label",105),u(14,"Time (s)"),a(),y(15,"input",108),a(),s(16,"div")(17,"label",105),u(18,"Tempo"),a(),y(19,"input",109),a(),s(20,"div",110)(21,"label",105),u(22,"Rest (s)"),a(),y(23,"input",111),a(),s(24,"div",112)(25,"label",105),u(26,"Set Notes (Opt.)"),a(),y(27,"input",113),a()(),s(28,"div",114)(29,"button",115),f("click",function(){x(e);let r=d(4);return g(r.collapseExpandedSet())}),u(30),a()()()}if(n&2){let e,i=d(),r=i.$implicit,o=i.index,m=d().index,p=d(2);c("ngClass",ue(15,Jt,(e=r.get("isWarmup"))==null?null:e.value,!((e=r.get("isWarmup"))!=null&&e.value))),l(4),c("for","reps-exp-"+m+"-"+o),l(2),c("id","reps-exp-"+m+"-"+o),l(3),c("for","weight-exp-"+m+"-"+o),l(),k("Weight (",p.unitsService.getUnitLabel(),")"),l(),c("id","weight-exp-"+m+"-"+o),l(2),c("for","duration-exp-"+m+"-"+o),l(2),c("id","duration-exp-"+m+"-"+o),l(2),c("for","tempo-exp-"+m+"-"+o),l(2),c("id","tempo-exp-"+m+"-"+o),l(2),c("for","rest-exp-"+m+"-"+o),l(2),c("id","rest-exp-"+m+"-"+o),l(2),c("for","setNotes-exp-"+m+"-"+o),l(2),c("id","setNotes-exp-"+m+"-"+o),l(3),k(" ",p.isViewMode?"Collapse":p.isEditMode?"Done":"Close"," ")}}function fi(n,t){if(n&1&&(s(0,"div",86),h(1,xi,16,17,"div",87)(2,gi,31,18,"div",88),a()),n&2){let e=t.index,i=d().index,r=d(2);c("formGroupName",e),l(),c("ngIf",!r.isSetExpanded(i,e)),l(),c("ngIf",r.isSetExpanded(i,e))}}function _i(n,t){if(n&1){let e=b();le(0),s(1,"div",47),h(2,ni,3,2,"div",48),s(3,"div",49),h(4,oi,3,0,"div",50),s(5,"div",51)(6,"div",52),h(7,si,1,3,"input",53),s(8,"h3",54),h(9,ai,2,2,"span",55),u(10),a()(),s(11,"div",56)(12,"div",57)(13,"label",58),u(14,"Rounds:"),a(),s(15,"input",59),f("change",function(){let r,o=x(e),m=o.$implicit,p=o.index,S=d(2);return g(S.syncSupersetRounds((r=m.get("supersetId"))==null?null:r.value,(r=m.get("rounds"))==null?null:r.value,p))}),a()(),h(16,li,4,1,"button",60)(17,di,4,1,"button",61),a()(),s(18,"div",62)(19,"div",63)(20,"h4",64),u(21,"Sets:"),a(),h(22,ui,2,1,"button",65),a(),s(23,"div",66),h(24,ci,14,1,"div",67)(25,fi,3,3,"div",68),a()()()(),de()}if(n&2){let e,i,r,o,m,p,S,_=t.$implicit,v=t.index,w=d(2);l(2),c("ngIf",w.isEditMode&&w.selectedExerciseIndicesForSuperset().length>=2&&v===w.firstSelectedExerciseIndexForSuperset),l(),c("cdkDragDisabled",w.isViewMode||!w.isEditMode)("cdkDragData",_)("formGroupName",v)("ngClass",pt(18,Kt,(e=_.get("supersetId"))==null?null:e.value,w.selectedExerciseIndicesForSuperset().includes(v),((e=_.get("supersetId"))==null?null:e.value)&&w.selectedExerciseIndicesForSuperset().includes(v),!((e=_.get("supersetId"))!=null&&e.value)&&!w.selectedExerciseIndicesForSuperset().includes(v),((e=_.get("supersetId"))==null?null:e.value)&&(((e=_.get("supersetOrder"))==null?null:e.value)??-1)<(((e=_.get("supersetSize"))==null?null:e.value)??0)-1,((e=_.get("supersetId"))==null?null:e.value)&&(((e=_.get("supersetOrder"))==null?null:e.value)??0)>0,w.isEditMode&&w.selectedExerciseIndicesForSuperset().length>=2&&v===w.firstSelectedExerciseIndexForSuperset)),l(),c("ngIf",w.isEditMode),l(),c("ngClass",ue(26,Yt,((i=_.get("supersetId"))==null?null:i.value)&&(((i=_.get("supersetOrder"))==null?null:i.value)??-1)<(((i=_.get("supersetSize"))==null?null:i.value)??0)-1,!((i=_.get("supersetId"))!=null&&i.value)||(((i=_.get("supersetOrder"))==null?null:i.value)??-1)===(((i=_.get("supersetSize"))==null?null:i.value)??0)-1)),l(2),c("ngIf",w.isEditMode),l(2),c("ngIf",(r=_.get("supersetId"))==null?null:r.value),l(),k(" ",((o=_.get("exerciseName"))==null?null:o.value)||"Select Exercise"," "),l(3),c("for","rounds-"+v),l(2),c("id","rounds-"+v)("readonly",((m=_.get("supersetId"))==null?null:m.value)&&(((m=_.get("supersetOrder"))==null?null:m.value)??0)>0||w.isViewMode),l(),c("ngIf",w.isEditMode),l(),c("ngIf",w.isEditMode&&((p=_.get("supersetId"))==null?null:p.value)),l(5),c("ngIf",w.isEditMode),l(2),c("ngIf",w.getSetsFormArray(_).controls.length>0&&((S=w.expandedSetPath())==null?null:S.exerciseIndex)!==v),l(),c("ngForOf",w.getSetsFormArray(_).controls)}}function hi(n,t){if(n&1){let e=b();s(0,"div",45),f("cdkDropListDropped",function(r){x(e);let o=d();return g(o.onExerciseDrop(r))}),h(1,_i,26,29,"ng-container",46),a()}if(n&2){let e=d();c("cdkDropListData",e.exercisesFormArray.controls),l(),c("ngForOf",e.exercisesFormArray.controls)}}function vi(n,t){if(n&1){let e=b();s(0,"div",116)(1,"p",117),u(2,"No exercises added to this routine yet."),a(),s(3,"button",118),f("click",function(){x(e);let r=d();return g(r.openExerciseSelectionModal())}),u(4," + Add First Exercise "),a()()}if(n&2){let e=d();l(3),c("disabled",e.isViewMode)}}function Si(n,t){if(n&1){let e=b();s(0,"div",119)(1,"button",120),f("click",function(){x(e);let r=d();return g(r.openExerciseSelectionModal())}),C(),s(2,"svg",121),y(3,"path",122),a(),u(4," Add Another Exercise "),a()()}if(n&2){let e=d();l(),c("disabled",e.isViewMode)}}function yi(n,t){if(n&1&&(s(0,"div",123)(1,"a",124),u(2," Cancel "),a(),s(3,"button",125),u(4),a()()),n&2){let e=d();l(3),c("disabled",e.routineForm.invalid&&(e.routineForm.touched||e.routineForm.dirty)),l(),k(" ",e.isNewMode?"Create Routine":"Save Changes"," ")}}function bi(n,t){if(n&1){let e=b();s(0,"li",143),f("click",function(){let r=x(e).$implicit,o=d(2);return g(o.selectExercise(r))}),s(1,"div")(2,"span",144),u(3),a(),s(4,"span",145),u(5),F(6,"titlecase"),F(7,"titlecase"),a()(),C(),s(8,"svg",146),y(9,"path",147),a()()}if(n&2){let e=t.$implicit;l(3),V(e.name),l(2),U("",j(6,3,e.category)," - ",j(7,5,e.primaryMuscleGroup))}}function ki(n,t){n&1&&(s(0,"li",148),u(1,"No exercises match your search."),a())}function wi(n,t){n&1&&(s(0,"li",148),u(1,"Exercise library is empty or still loading."),a())}function Ii(n,t){if(n&1){let e=b();s(0,"div",126),f("click",function(){x(e);let r=d();return g(r.closeExerciseSelectionModal())}),s(1,"div",127),f("click",function(r){return x(e),g(r.stopPropagation())}),s(2,"div",128)(3,"div",129)(4,"div",130)(5,"div",131)(6,"h3",132),u(7,"Select an Exercise"),a(),s(8,"button",133),f("click",function(){x(e);let r=d();return g(r.closeExerciseSelectionModal())}),C(),s(9,"svg",134),y(10,"path",135),a()()(),R(),s(11,"div",136)(12,"input",137),f("ngModelChange",function(r){x(e);let o=d();return g(o.modalSearchTerm.set(r))}),a()(),s(13,"div",138)(14,"ul",62),h(15,bi,10,7,"li",139)(16,ki,2,0,"li",140)(17,wi,2,0,"li",140),a()()()()(),s(18,"div",141)(19,"button",142),f("click",function(){x(e);let r=d();return g(r.closeExerciseSelectionModal())}),u(20,"Cancel"),a()()()()}if(n&2){let e=d();l(12),c("ngModel",e.modalSearchTerm()),l(3),c("ngForOf",e.filteredAvailableExercises()),l(),c("ngIf",e.filteredAvailableExercises().length===0&&e.availableExercises.length>0),l(),c("ngIf",e.availableExercises.length===0)}}var he=class n{fb=I(Le);router=I(ie);route=I(me);workoutService=I(xe);exerciseService=I(fe);unitsService=I(_e);spinnerService=I(je);alertService=I(pe);toastService=I(ge);trackingService=I(re);PAUSED_WORKOUT_KEY="fitTrackPro_pausedWorkoutState";PAUSED_STATE_VERSION="1.1";setRepsInputs;expandedSetElements;cdr=I(Te);routineForm;isEditMode=!1;isNewMode=!1;isViewMode=!1;currentRoutineId=null;routeSub;expandedSetPath=E(null);routineGoals=[{value:"hypertrophy",label:"Hypertrophy"},{value:"strength",label:"Strength"},{value:"muscular endurance",label:"Muscular endurance"},{value:"cardiovascular endurance",label:"Cardiovascular endurance"},{value:"fat loss / body composition",label:"Fat loss / body composition"},{value:"mobility & flexibility",label:"Mobility & flexibility"},{value:"power / explosiveness",label:"Power / explosiveness"},{value:"speed & agility",label:"Speed & agility"},{value:"balance & coordination",label:"Balance & coordination"},{value:"skill acquisition",label:"Skill acquisition"},{value:"rehabilitation / injury prevention",label:"Rehabilitation / injury prevention"},{value:"mental health / stress relief",label:"Mental health"},{value:"general health & longevity",label:"General health & longevity"},{value:"sport-specific performance",label:"Sport-specific performance"},{value:"maintenance",label:"Maintenance"},{value:"custom",label:"Custom"}];isExerciseModalOpen=E(!1);availableExercises=[];modalSearchTerm=E("");filteredAvailableExercises=D(()=>{let t=this.modalSearchTerm().toLowerCase();return t?this.availableExercises.filter(e=>e.name.toLowerCase().includes(t)||e.category.toLowerCase().includes(t)||e.primaryMuscleGroup.toLowerCase().includes(t)):this.availableExercises});selectedExerciseIndicesForSuperset=E([]);constructor(){this.routineForm=this.fb.group({name:["",M.required],description:[""],goal:["custom"],exercises:this.fb.array([])})}platformId=I(ae);ngOnInit(){Y(this.platformId)&&window.scrollTo(0,0),this.loadAvailableExercises(),this.routeSub=this.route.paramMap.pipe(se(t=>{this.currentRoutineId=t.get("routineId");let e=this.route.snapshot.url[0]?.path;return this.isNewMode=e==="new",this.isViewMode=e==="view"&&!!this.currentRoutineId,this.isEditMode=e==="edit"&&!!this.currentRoutineId||this.isNewMode,this.expandedSetPath.set(null),this.currentRoutineId&&(this.isEditMode||this.isViewMode)&&!this.isNewMode?this.workoutService.getRoutineById(this.currentRoutineId):(this.exercisesFormArray.clear(),this.routineForm.reset({goal:"custom",exercises:[]}),this.isNewMode&&this.toggleFormState(!1),Z(null))}),ne(t=>{t?(this.patchFormWithRoutineData(t),this.isViewMode?this.toggleFormState(!0):this.isEditMode&&!this.isNewMode&&this.toggleFormState(!1)):(this.isEditMode||this.isViewMode)&&!this.isNewMode&&this.currentRoutineId&&(this.toastService.error(`Routine with ID ${this.currentRoutineId} not found.`,0,"Error"),this.router.navigate(["/workout"]))})).subscribe()}toggleFormState(t){t?this.routineForm.disable({emitEvent:!1}):(this.routineForm.enable({emitEvent:!1}),this.exercisesFormArray.controls.forEach(e=>{this.updateRoundsControlability(e)}))}get exercisesFormArray(){return this.routineForm.get("exercises")}getSetsFormArray(t){return t.get("sets")}loadAvailableExercises(){this.exerciseService.getExercises().subscribe(t=>{this.availableExercises=t})}patchFormWithRoutineData(t){this.routineForm.patchValue({name:t.name,description:t.description,goal:t.goal}),this.exercisesFormArray.clear(),t.exercises.forEach(e=>{let i=this.createExerciseFormGroup(e);this.exercisesFormArray.push(i)}),this.isViewMode?this.toggleFormState(!0):this.toggleFormState(!1),this.expandedSetPath.set(null)}createExerciseFormGroup(t){let e=t?.exerciseId?this.availableExercises.find(r=>r.id===t.exerciseId):null,i=this.fb.group({id:[t?.id||this.workoutService.generateWorkoutExerciseId()],exerciseId:[t?.exerciseId||"",M.required],exerciseName:[t?.exerciseName||e?.name||"Select Exercise"],notes:[t?.notes||""],sets:this.fb.array(t?.sets.map(r=>this.createSetFormGroup(r))||[]),supersetId:[t?.supersetId||null],supersetOrder:[t?.supersetOrder??null],supersetSize:[t?.supersetSize??null],rounds:[t?.rounds??1,[M.min(1)]]});return i.get("supersetId")?.valueChanges.subscribe(()=>this.updateRoundsControlability(i)),i.get("supersetOrder")?.valueChanges.subscribe(()=>this.updateRoundsControlability(i)),this.updateRoundsControlability(i),i.get("exerciseId")?.valueChanges.subscribe(r=>{let o=this.availableExercises.find(m=>m.id===r);i.get("exerciseName")?.setValue(o?.name||"Unknown Exercise",{emitEvent:!1})}),i}createSetFormGroup(t){return this.fb.group({id:[t?.id||this.workoutService.generateExerciseSetId()],reps:[t?.reps??null,[M.min(0)]],weight:[this.unitsService.convertFromKg(t?.weight,this.unitsService.currentUnit())??null,[M.min(0)]],duration:[t?.duration??null,[M.min(0)]],tempo:[t?.tempo||""],restAfterSet:[t?.restAfterSet??60,[M.required,M.min(0)]],notes:[t?.notes||""],isWarmup:[t?.isWarmup||!1]})}openExerciseSelectionModal(){this.isViewMode||(this.modalSearchTerm.set(""),this.isExerciseModalOpen.set(!0))}closeExerciseSelectionModal(){this.isExerciseModalOpen.set(!1)}onModalSearchTermChange(t){let e=t.target;this.modalSearchTerm.set(e.value)}selectExercise(t){let e=this.createExerciseFormGroup({id:this.workoutService.generateWorkoutExerciseId(),exerciseId:t.id,exerciseName:t.name,sets:[{id:this.workoutService.generateExerciseSetId(),reps:8,weight:0,restAfterSet:60,duration:0,tempo:"-",notes:""}],supersetId:null,supersetOrder:null,supersetSize:null,rounds:1});this.exercisesFormArray.push(e),this.closeExerciseSelectionModal(),this.toggleSetExpansion(this.exercisesFormArray.length-1,0)}ngAfterViewInit(){this.expandedSetElements.changes.subscribe(t=>{t.first&&this.expandedSetPath()&&setTimeout(()=>{t.first.nativeElement.scrollIntoView({behavior:"smooth",block:"center"})},0)})}addSet(t,e){if(this.isViewMode)return;let i=this.getSetsFormArray(t);i.push(this.createSetFormGroup()),this.cdr.detectChanges();let r=i.length-1;this.toggleSetExpansion(e,r)}removeSet(t,e,i){if(this.isViewMode)return;this.getSetsFormArray(t).removeAt(i);let o=this.expandedSetPath();o&&o.exerciseIndex===e&&o.setIndex===i?this.expandedSetPath.set(null):o&&o.exerciseIndex===e&&o.setIndex>i&&this.expandedSetPath.set({exerciseIndex:e,setIndex:o.setIndex-1})}toggleSetExpansion(t,e,i){if(i?.stopPropagation(),!(this.isViewMode&&!(this.expandedSetPath()?.exerciseIndex===t&&this.expandedSetPath()?.setIndex===e))){if(this.isViewMode){this.expandedSetPath.set(null);return}}let r=this.expandedSetPath();r?.exerciseIndex===t&&r?.setIndex===e?this.expandedSetPath.set(null):(this.expandedSetPath.set({exerciseIndex:t,setIndex:e}),this.cdr.detectChanges(),setTimeout(()=>{let o=this.expandedSetElements.find((m,p)=>!0);if(o){let m=o.nativeElement.querySelector('input[formControlName="reps"], input[formControlName="weight"], input[formControlName="duration"]');m instanceof HTMLInputElement&&(m.focus(),m.select())}},50))}isSetExpanded(t,e){let i=this.expandedSetPath();return i?.exerciseIndex===t&&i?.setIndex===e}collapseExpandedSet(){this.expandedSetPath.set(null)}getFormErrors(t){let e={};return Object.keys(t.controls).forEach(i=>{let r=t.get(i).errors;if(r&&(e[i]=r),t.get(i)instanceof vt||t.get(i)instanceof Ct){let o=this.getFormErrors(t.get(i));Object.keys(o).length>0&&(e[i]=o)}}),e}get f(){return this.routineForm.controls}toggleExerciseSelectionForSuperset(t,e){if(this.isViewMode)return;let i=e.target;this.selectedExerciseIndicesForSuperset.update(r=>{let o;return i.checked?o=r.includes(t)?r:[...r,t]:o=r.filter(m=>m!==t),o.sort((m,p)=>m-p)})}canGroupSelectedExercises(){let t=this.selectedExerciseIndicesForSuperset();if(t.length<2)return!1;let e=this.exercisesFormArray.at(t[0]).get("supersetId")?.value;for(let i=1;i<t.length;i++){let r=t[i],o=this.exercisesFormArray.at(r).get("supersetId")?.value;if(e&&o&&e!==o||!e&&o)return!1}return!0}onExerciseDrop(t){if(!this.isViewMode&&t.previousContainer===t.container){let e=this.exercisesFormArray;Tt(e.controls,t.previousIndex,t.currentIndex),e.updateValueAndValidity(),this.selectedExerciseIndicesForSuperset.set([]),this.handleSupersetIntegrityAfterDrag(t.previousIndex,t.currentIndex),this.recalculateSupersetOrders(),this.expandedSetPath.set(null)}}handleSupersetIntegrityAfterDrag(t,e){let i=new Set;if(i.add(t),i.add(e),t<e)for(let o=t;o<=e;o++)i.add(o);else for(let o=e;o<=t;o++)i.add(o);let r=new Set;i.forEach(o=>{if(o<this.exercisesFormArray.length){let p=this.exercisesFormArray.at(o).get("supersetId")?.value;p&&r.add(p)}}),r.forEach(o=>{this.exercisesFormArray.controls.forEach(m=>{let p=m;p.get("supersetId")?.value===o&&p.patchValue({supersetId:null,supersetOrder:null,supersetSize:null})})}),this.recalculateSupersetOrders()}recalculateSupersetOrders(){let t=new Map;this.exercisesFormArray.controls.forEach(e=>{let i=e,r=i.get("supersetId")?.value;r?(t.has(r)||t.set(r,[]),t.get(r).push(i)):(i.patchValue({supersetOrder:null,supersetSize:null},{emitEvent:!1}),this.updateRoundsControlability(i))}),t.forEach((e,i)=>{e.length<2?e.forEach(r=>{r.patchValue({supersetId:null,supersetOrder:null,supersetSize:null}),this.updateRoundsControlability(r)}):(e.sort((r,o)=>this.exercisesFormArray.controls.indexOf(r)-this.exercisesFormArray.controls.indexOf(o)),e.forEach((r,o)=>{r.patchValue({supersetOrder:o,supersetSize:e.length},{emitEvent:!1}),this.updateRoundsControlability(r)}))}),this.exercisesFormArray.updateValueAndValidity({emitEvent:!1})}groupSelectedAsSuperset(){if(this.isViewMode)return;let t=this.selectedExerciseIndicesForSuperset().sort((m,p)=>m-p);if(t.length<2){this.toastService.warning("Select at least two exercises.",3e3,"Superset Error");return}for(let m=1;m<t.length;m++)if(t[m]!==t[m-1]+1){this.toastService.warning("Selected exercises must be next to each other to form a superset.",5e3,"Superset Error");return}let e=oe(),i=t.length,o=this.exercisesFormArray.at(t[0]).get("rounds")?.value??1;t.forEach((m,p)=>{let S=this.exercisesFormArray.at(m);S.patchValue({supersetId:e,supersetOrder:p,supersetSize:i,rounds:o}),this.updateRoundsControlability(S),S.get("sets").controls.forEach(v=>{p<i-1&&v.get("restAfterSet")?.setValue(0)})}),this.selectedExerciseIndicesForSuperset.set([]),this.toastService.success("Superset created!",3e3,"Success")}ungroupSuperset(t){if(this.isViewMode)return;let i=this.exercisesFormArray.at(t).get("supersetId")?.value;i&&(this.exercisesFormArray.controls.forEach(r=>{let o=r;o.get("supersetId")?.value===i&&(o.patchValue({supersetId:null,supersetOrder:null,supersetSize:null}),this.updateRoundsControlability(o))}),this.selectedExerciseIndicesForSuperset.set([]),this.toastService.info("Superset ungrouped.",3e3,"Ungrouped"))}removeExercise(t){if(this.isViewMode)return;let i=this.exercisesFormArray.at(t).get("supersetId")?.value;this.exercisesFormArray.removeAt(t),this.selectedExerciseIndicesForSuperset.set([]),i&&this.recalculateSupersetOrders(),this.toastService.info("Exercise removed.",2e3),this.expandedSetPath.set(null)}errorMessage=E(null);onSubmit(){if(this.isViewMode){this.toastService.info("Currently in view mode. No changes to save.",3e3,"View Mode");return}if(this.recalculateSupersetOrders(),!this.validateSupersetIntegrity()){this.toastService.error("Superset configuration is invalid. Ensure supersets have at least two contiguous exercises.",0,"Validation Error");return}let t=this.exercisesFormArray.value;for(let r=0;r<t.length;r++){let o=t[r],m=this.availableExercises.find(v=>v.id===o.exerciseId),p=o.exerciseName||m?.name||`Exercise ${r+1}`;if(!o.sets||o.sets.length===0){this.toastService.error(`The exercise "${p}" must have at least one set.`,0,"Validation Error");return}let _=this.exercisesFormArray.at(r).get("rounds")?.value;if(_!=null&&_<1){this.toastService.error(`The exercise "${p}" must have at least 1 round.`,0,"Validation Error");return}for(let v=0;v<o.sets.length;v++){let w=o.sets[v],T=`Set ${v+1} of "${p}"`,A=w.reps??0,O=w.weight??0,W=w.duration??0,J=W>0;if(!J&&m&&["cardio","stretching","plank","isometric"].includes(m.category.toLowerCase())&&(J=!0),J){if(W<=0){this.toastService.error(`${T} is timed but has no duration.`,0,"Validation Error");return}}else{if(A<=0&&O<=0){this.toastService.error(`${T} must have reps or weight.`,0,"Validation Error");return}if(A<=0&&O>0){this.toastService.error(`${T} with weight must also have reps.`,0,"Validation Error");return}}}}if(this.routineForm.invalid||!this.exercisesFormArray||this.exercisesFormArray.length===0){this.routineForm.markAllAsTouched(),this.toastService.error("Please fill required fields (Name, at least one exercise with sets).",0,"Validation Error"),console.log("Form Errors:",this.getFormErrors(this.routineForm));return}let e=this.routineForm.getRawValue(),i={id:(this.isEditMode||this.isNewMode)&&this.currentRoutineId?this.currentRoutineId:oe(),name:e.name,description:e.description,goal:e.goal,exercises:e.exercises.map(r=>L(B({},r),{sets:r.sets.map(o=>L(B({},o),{weight:this.unitsService.convertToKg(o.weight,this.unitsService.currentUnit())??null,restAfterSet:o.restAfterSet??0}))}))};this.isNewMode&&!this.currentRoutineId&&(i.id=oe());try{if(this.spinnerService.show(),this.isNewMode)this.workoutService.addRoutine(i),this.toastService.success("Routine created successfully!",4e3,"Success");else if(this.isEditMode&&this.currentRoutineId)this.workoutService.updateRoutine(i),this.toastService.success("Routine updated successfully!",4e3,"Success");else{this.toastService.warning("No save operation performed. Mode is unclear or ID missing.",0,"Save Warning"),this.spinnerService.hide();return}this.router.navigate(["/workout"])}catch(r){console.error("Error saving routine:",r),this.toastService.error(`Failed to save routine: ${r.message||"Unknown error"}`,0,"Save Error")}finally{this.spinnerService.hide()}}validateSupersetIntegrity(){let t=this.exercisesFormArray.value,e=new Map;for(let i of t)i.supersetId&&(e.has(i.supersetId)||e.set(i.supersetId,[]),e.get(i.supersetId).push(i));for(let[i,r]of e.entries()){if(r.length<2)return!1;let o=r.sort((m,p)=>(m.supersetOrder??1/0)-(p.supersetOrder??1/0));for(let m=0;m<o.length;m++)if(o[m].supersetOrder!==m)return!1}return!0}get firstSelectedExerciseIndexForSuperset(){let t=this.selectedExerciseIndicesForSuperset();return t.length>0?t[0]:null}updateRoundsControlability(t){let e=t.get("supersetId")?.value,i=t.get("supersetOrder")?.value,r=t.get("rounds");if(this.isViewMode){r?.disable({emitEvent:!1});return}if(e&&i!==null&&i>0){r?.disable({emitEvent:!1});let o=this.exercisesFormArray.controls.find(m=>m.get("supersetId")?.value===e&&m.get("supersetOrder")?.value===0);o&&r?.setValue(o.get("rounds")?.value??1,{emitEvent:!1})}else r?.enable({emitEvent:!1})}syncSupersetRounds(t,e,i){this.isViewMode||!t||e===null||e===void 0||e<1||this.exercisesFormArray.at(i).get("supersetOrder")?.value!==0||this.exercisesFormArray.controls.forEach(o=>{let m=o;m.get("supersetId")?.value===t&&m.get("rounds")?.value!==e&&m.get("rounds")?.setValue(e,{emitEvent:!1})})}startCurrentWorkout(){this.currentRoutineId?this.router.navigate(["/workout/play",this.currentRoutineId]):this.toastService.error("Cannot start workout: Routine ID is missing.",0,"Error")}enableEditMode(){this.isViewMode&&this.currentRoutineId&&(this.isViewMode=!1,this.isEditMode=!0,this.toggleFormState(!1),this.router.navigate(["/workout/edit",this.currentRoutineId],{replaceUrl:!0}),this.toastService.info("Edit mode enabled.",3e3,"Mode Changed"))}deleteCurrentRoutine(){return P(this,null,function*(){if(!this.currentRoutineId){this.toastService.error("Cannot delete: Routine ID is missing.",0,"Error");return}let t=yield X(this.workoutService.getRoutineById(this.currentRoutineId).pipe(N(1)));if(!t){this.toastService.error("Routine not found for deletion.",0,"Error");return}let e=(yield X(this.trackingService.getWorkoutLogsByRoutineId(this.currentRoutineId).pipe(N(1))))||[],i=`Are you sure you want to delete the routine "${t.name}"?`;e.length>0&&(i+=` This will also delete ${e.length} associated workout log(s). This action cannot be undone.`);let r=yield this.alertService.showConfirm("Delete Routine",i,"Delete");if(r&&r.data)try{this.spinnerService.show(),e.length>0&&(yield this.trackingService.clearWorkoutLogsByRoutineId(this.currentRoutineId),this.toastService.info(`${e.length} workout log(s) deleted.`,3e3,"Logs Cleared")),yield this.workoutService.deleteRoutine(this.currentRoutineId),this.toastService.success(`Routine "${t.name}" deleted.`,4e3,"Routine Deleted"),this.router.navigate(["/workout"])}catch(o){console.error("Error during deletion:",o),this.toastService.error("Failed to delete routine or logs. Please try again.",0,"Deletion Failed")}finally{this.spinnerService.hide()}})}ngOnDestroy(){this.routeSub&&this.routeSub.unsubscribe()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=G({type:n,selectors:[["app-workout-builder"]],viewQuery:function(e,i){if(e&1&&(Se(jt,5),Se(zt,5)),e&2){let r;ye(r=be())&&(i.setRepsInputs=r),ye(r=be())&&(i.expandedSetElements=r)}},features:[Ce([te])],decls:37,vars:16,consts:[["expandedSetElement",""],["setRepsInput",""],["class","my-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-md dark:bg-red-900/30 dark:border-red-600 dark:text-red-300",4,"ngIf"],[1,"container","mx-auto","p-1"],[1,"mb-6","pb-4","border-b","border-gray-200","dark:border-gray-700"],[1,"flex","justify-between","items-center"],["routerLink","/workout",1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-ml-1"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"text-xl","sm:text-2xl","md:text-3xl","font-bold","text-gray-800","dark:text-gray-200","text-center","flex-grow","truncate","px-2"],[1,"w-10","h-10"],["class","mt-4 flex flex-wrap gap-2 justify-center sm:justify-start",4,"ngIf"],[1,"space-y-6","mb-6",3,"ngSubmit","formGroup"],[1,"space-y-4","p-4","bg-white","dark:bg-gray-800","rounded-lg","shadow-sm"],["for","name",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300"],["type","text","id","name","formControlName","name",1,"mt-1","block","w-full","p-2","border","rounded-md","shadow-sm","focus:ring-primary","focus:border-primary","dark:bg-gray-700","dark:border-gray-600",3,"ngClass"],["class","text-red-500 dark:text-red-400 text-xs mt-1",4,"ngIf"],["for","description",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300"],["id","description","formControlName","description","rows","3",1,"mt-1","block","w-full","p-2","border","border-gray-300","dark:border-gray-600","rounded-md","shadow-sm","focus:ring-primary","focus:border-primary","dark:bg-gray-700"],["for","goal",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300"],["id","goal","formControlName","goal",1,"mt-1","block","w-full","p-2","border","border-gray-300","dark:border-gray-600","rounded-md","shadow-sm","focus:ring-primary","focus:border-primary","dark:bg-gray-700"],[3,"value",4,"ngFor","ngForOf"],[1,"pt-4"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-xl","font-semibold","text-gray-700","dark:text-gray-300"],["type","button","class","bg-green-500 hover:enabled:bg-green-600 text-white text-sm font-medium py-2 px-3 rounded-md transition-all duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed",3,"disabled","click",4,"ngIf"],["cdkDropList","","formArrayName","exercises","class","exercise-list-container space-y-4",3,"cdkDropListData","cdkDropListDropped",4,"ngIf"],["class","text-center py-6 text-gray-500 dark:text-gray-400 border border-dashed dark:border-gray-700 rounded-md mt-4",4,"ngIf"],["class","mt-6 text-center",4,"ngIf"],["class","pt-6 flex justify-end space-x-3",4,"ngIf"],["class","fixed inset-0 bg-gray-600 bg-opacity-75 transition-opacity overflow-y-auto h-full w-full z-[70] flex items-center justify-center p-4",3,"click",4,"ngIf"],[1,"my-4","p-3","bg-red-100","border","border-red-400","text-red-700","rounded-md","dark:bg-red-900/30","dark:border-red-600","dark:text-red-300"],[1,"mt-4","flex","flex-wrap","gap-2","justify-center","sm:justify-start"],["type","button",1,"bg-green-500","hover:bg-green-600","text-white","font-semibold","py-2","px-3","rounded-md","shadow-sm","text-xs","sm:text-sm","flex","items-center",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-4","sm:size-5","mr-1"],["stroke-linecap","round","stroke-linejoin","round","d","M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"],["type","button","class","bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-2 px-3 rounded-md shadow-sm text-xs sm:text-sm flex items-center",3,"click",4,"ngIf"],["type","button",1,"bg-red-500","hover:bg-red-600","text-white","font-semibold","py-2","px-3","rounded-md","shadow-sm","text-xs","sm:text-sm","flex","items-center",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"],["type","button",1,"bg-yellow-500","hover:bg-yellow-600","text-white","font-semibold","py-2","px-3","rounded-md","shadow-sm","text-xs","sm:text-sm","flex","items-center",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"],[1,"text-red-500","dark:text-red-400","text-xs","mt-1"],[4,"ngIf"],[3,"value"],["type","button",1,"bg-green-500","hover:enabled:bg-green-600","text-white","text-sm","font-medium","py-2","px-3","rounded-md","transition-all","duration-150","ease-in-out","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["cdkDropList","","formArrayName","exercises",1,"exercise-list-container","space-y-4",3,"cdkDropListDropped","cdkDropListData"],[4,"ngFor","ngForOf"],[1,"relative","group","exercise-card-wrapper"],["class","absolute left-1/2 -translate-x-1/2 z-20","style","top: -1.25rem;",4,"ngIf"],["cdkDrag","",1,"p-2","border","rounded-lg","shadow-sm","space-y-2","exercise-item","relative","transition-all","duration-150","ease-in-out",3,"cdkDragDisabled","cdkDragData","formGroupName","ngClass"],["cdkDragHandle","","class","absolute top-2 right-2 cursor-grab p-1 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300","title","Drag to reorder",4,"ngIf"],[1,"flex","flex-col","sm:flex-row","justify-between","items-start","sm:items-center","pb-2","pt-6",3,"ngClass"],[1,"flex","items-center","pr-8","mb-2","sm:mb-0"],["type","checkbox","class","h-5 w-5 text-orange-600 border-gray-300 rounded focus:ring-orange-500 mr-3 self-start mt-1 disabled:opacity-50",3,"id","checked","disabled","change",4,"ngIf"],[1,"text-lg","font-semibold","text-gray-800","dark:text-gray-100"],["class","text-xs text-orange-600 dark:text-orange-400 font-normal block",4,"ngIf"],[1,"flex","flex-col","items-start","sm:items-end","space-y-1","flex-shrink-0","w-full","sm:w-auto"],[1,"flex","items-center","space-x-1"],[1,"text-xs","font-medium","text-gray-600","dark:text-gray-400","whitespace-nowrap",3,"for"],["type","number","formControlName","rounds","min","1",1,"w-16","p-1","text-sm","border-gray-300","dark:border-gray-600","border-2","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-700","disabled:opacity-50","disabled:bg-gray-300","dark:disabled:bg-gray-500",3,"change","id","readonly"],["type","button","class","flex items-center text-xs text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 font-medium py-1 px-2 rounded-md hover:enabled:bg-red-100 dark:enabled:hover:bg-red-900/50 disabled:opacity-50",3,"disabled","click",4,"ngIf"],["type","button","class","flex items-center text-xs text-violet-600 hover:text-violet-700 dark:text-violet-400 dark:hover:text-violet-300 font-medium py-1 px-2 rounded-md hover:bg-violet-100 dark:hover:bg-violet-900/50 disabled:opacity-50",3,"disabled","click",4,"ngIf"],[1,"space-y-1"],[1,"flex","justify-between","items-center","mb-1"],[1,"text-sm","font-semibold","text-gray-700","dark:text-gray-300"],["type","button","class","text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 font-medium py-0.5 px-1.5 rounded-md hover:enabled:bg-blue-100 dark:hover:bg-blue-900/50 disabled:opacity-50",3,"disabled","click",4,"ngIf"],["formArrayName","sets",1,"space-y-1.5"],["class","flex justify-between grid grid-cols-12 gap-x-2 py-1 px-2 text-xs font-medium text-gray-500 dark:text-gray-400 border-b dark:border-gray-600",4,"ngIf"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"absolute","left-1/2","-translate-x-1/2","z-20",2,"top","-1.25rem"],["type","button",1,"bg-orange-600","hover:bg-orange-700","text-white","text-xs","font-semibold","py-1.5","px-3","rounded-full","shadow-lg","whitespace-nowrap","transition-all","duration-150","ease-in-out","hover:scale-105","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["cdkDragHandle","","title","Drag to reorder",1,"absolute","top-2","right-2","cursor-grab","p-1","text-gray-400","hover:text-gray-600","dark:text-gray-500","dark:hover:text-gray-300"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"w-5","h-5"],["fill-rule","evenodd","d","M10 3a.75.75 0 0 1 .75.75v12.5a.75.75 0 0 1-1.5 0V3.75A.75.75 0 0 1 10 3ZM5.75 6.75a.75.75 0 0 0 0 1.5h8.5a.75.75 0 0 0 0-1.5h-8.5Zm0 5a.75.75 0 0 0 0 1.5h8.5a.75.75 0 0 0 0-1.5h-8.5Z","clip-rule","evenodd"],["type","checkbox",1,"h-5","w-5","text-orange-600","border-gray-300","rounded","focus:ring-orange-500","mr-3","self-start","mt-1","disabled:opacity-50",3,"change","id","checked","disabled"],[1,"text-xs","text-orange-600","dark:text-orange-400","font-normal","block"],["type","button",1,"flex","items-center","text-xs","text-red-600","hover:text-red-700","dark:text-red-400","dark:hover:text-red-300","font-medium","py-1","px-2","rounded-md","hover:enabled:bg-red-100","dark:enabled:hover:bg-red-900/50","disabled:opacity-50",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-4","h-4","mr-1"],["stroke-linecap","round","stroke-linejoin","round","d","m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12.56 0c.342.052.682.107 1.022.166m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"],["type","button",1,"flex","items-center","text-xs","text-violet-600","hover:text-violet-700","dark:text-violet-400","dark:hover:text-violet-300","font-medium","py-1","px-2","rounded-md","hover:bg-violet-100","dark:hover:bg-violet-900/50","disabled:opacity-50",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","d","M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75v4.5m0-4.5h-4.5m4.5 0L15 9m5.25 11.25v-4.5m0 4.5h-4.5m4.5 0L15 15"],["type","button",1,"text-xs","text-blue-600","hover:text-blue-700","dark:text-blue-400","dark:hover:text-blue-300","font-medium","py-0.5","px-1.5","rounded-md","hover:enabled:bg-blue-100","dark:hover:bg-blue-900/50","disabled:opacity-50",3,"click","disabled"],[1,"flex","justify-between","grid","grid-cols-12","gap-x-2","py-1","px-2","text-xs","font-medium","text-gray-500","dark:text-gray-400","border-b","dark:border-gray-600"],[1,"col-span-1","text-center"],[1,"col-span-2","text-center"],[1,"col-span-2"],[3,"formGroupName"],["class","grid grid-cols-12 gap-x-2 items-center py-1.5 px-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer border dark:border-gray-700",3,"ngClass","click",4,"ngIf"],["class","mt-1 p-3 rounded-md border border-gray-300 dark:border-gray-500 shadow-inner space-y-2",3,"ngClass",4,"ngIf"],[1,"grid","grid-cols-12","gap-x-2","items-center","py-1.5","px-2","rounded-md","hover:bg-gray-100","dark:hover:bg-gray-700","cursor-pointer","border","dark:border-gray-700",3,"click","ngClass"],[1,"col-span-1","text-xs","text-gray-600","dark:text-gray-400","text-center","font-medium"],[1,"col-span-2","text-xs","text-gray-700","dark:text-gray-200","text-center"],[1,"col-span-2","text-xs","text-gray-700","dark:text-gray-200","text-center","truncate",3,"title"],["class","col-span-1 flex items-center justify-end",4,"ngIf"],["class","col-span-1",4,"ngIf"],[1,"col-span-1","flex","items-center","justify-end"],["type","button","title","Remove Set",1,"text-red-500","hover:text-red-600","dark:text-red-400","dark:hover:text-red-300","p-1","rounded-full","hover:bg-red-100","dark:hover:bg-red-900/30","disabled:opacity-50",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 16 16","fill","currentColor",1,"w-3.5","h-3.5"],["fill-rule","evenodd","d","M5 3.25A2.25 2.25 0 0 0 2.75 5.5v5A2.25 2.25 0 0 0 5 12.75h6a2.25 2.25 0 0 0 2.25-2.25v-5A2.25 2.25 0 0 0 11 3.25H5Zm.97 3.97a.75.75 0 0 1 1.06 0L8 8.28l.97-.97a.75.75 0 1 1 1.06 1.06L9.06 9.25l.97.97a.75.75 0 1 1-1.06 1.06L8 10.43l-.97.97a.75.75 0 0 1-1.06-1.06L6.94 9.25l-.97-.97a.75.75 0 0 1 0-1.06Z","clip-rule","evenodd"],[1,"col-span-1"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["x1","12","y1","5","x2","12","y2","19"],["x1","5","y1","12","x2","19","y2","12"],[1,"mt-1","p-3","rounded-md","border","border-gray-300","dark:border-gray-500","shadow-inner","space-y-2",3,"ngClass"],[1,"grid","grid-cols-2","sm:grid-cols-3","md:grid-cols-4","gap-x-3","gap-y-2","items-center"],[1,"block","text-xs","font-medium","text-gray-600","dark:text-gray-400",3,"for"],["type","number","formControlName","reps","placeholder","Reps",1,"mt-0.5","w-full","p-1.5","text-sm","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-600",3,"id"],["type","number","formControlName","weight","placeholder","Weight",1,"mt-0.5","w-full","p-1.5","text-sm","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-600",3,"id"],["type","number","formControlName","duration","placeholder","Secs",1,"mt-0.5","w-full","p-1.5","text-sm","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-600",3,"id"],["type","text","formControlName","tempo","placeholder","e.g. 2010",1,"mt-0.5","w-full","p-1.5","text-sm","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-600",3,"id"],[1,"col-span-2","sm:col-span-1","md:col-span-2"],["type","number","formControlName","restAfterSet","placeholder","Rest",1,"mt-0.5","w-full","p-1.5","text-sm","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-600",3,"id"],[1,"col-span-full"],["type","text","formControlName","notes","placeholder","e.g. Drop set",1,"mt-0.5","w-full","p-1.5","text-sm","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-600",3,"id"],[1,"mt-2","text-right"],["type","button",1,"text-xs","text-blue-600","hover:text-blue-700","dark:text-blue-400","dark:hover:text-blue-300","font-medium","py-1","px-2","rounded-md","hover:bg-blue-100","dark:hover:bg-blue-900/30",3,"click"],[1,"text-center","py-6","text-gray-500","dark:text-gray-400","border","border-dashed","dark:border-gray-700","rounded-md","mt-4"],[1,"mb-2"],["type","button",1,"bg-green-500","hover:bg-green-600","text-white","text-sm","font-medium","py-2","px-3","rounded-md","transition-all","duration-150","ease-in-out","disabled:opacity-50",3,"click","disabled"],[1,"mt-6","text-center"],["type","button",1,"bg-green-500","hover:bg-green-600","text-white","font-semibold","py-2","px-6","rounded-md","shadow-md","hover:shadow-lg","transition-all","duration-300","focus:outline-none","focus:ring-2","focus:ring-green-400","focus:ring-opacity-75","disabled:opacity-50",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"w-5","h-5","mr-2","inline-block"],["d","M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z"],[1,"pt-6","flex","justify-end","space-x-3"],["routerLink","/workout",1,"px-4","py-2","border","border-gray-300","dark:border-gray-600","rounded-md","shadow-sm","text-sm","font-medium","text-gray-700","dark:text-gray-200","hover:bg-gray-50","dark:hover:bg-gray-700"],["type","submit",1,"px-4","py-2","border","border-transparent","rounded-md","shadow-sm","text-sm","font-medium","text-white","bg-primary","hover:bg-primary-dark","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-primary-dark","disabled:opacity-50","transition-all","duration-150","ease-in-out",3,"disabled"],[1,"fixed","inset-0","bg-gray-600","bg-opacity-75","transition-opacity","overflow-y-auto","h-full","w-full","z-[70]","flex","items-center","justify-center","p-4",3,"click"],[1,"relative","transform","overflow-hidden","rounded-lg","bg-white","dark:bg-gray-800","text-left","shadow-xl","transition-all","sm:my-8","sm:w-full","sm:max-w-lg",3,"click"],[1,"bg-white","dark:bg-gray-800","px-4","pt-5","pb-4","sm:p-6","sm:pb-4"],[1,"sm:flex","sm:items-start","w-full"],[1,"mt-3","text-center","sm:mt-0","sm:text-left","w-full"],[1,"flex","justify-between","items-center","pb-3"],["id","modal-title",1,"text-xl","font-semibold","leading-6","text-gray-900","dark:text-gray-100"],["type","button",1,"p-1","rounded-full","text-gray-400","hover:text-gray-600","dark:hover:text-gray-300","focus:outline-none",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","d","M6 18L18 6M6 6l12 12"],[1,"my-4"],["type","text","placeholder","Search exercises...",1,"w-full","p-2","border","border-gray-300","dark:border-gray-600","rounded-md","shadow-sm","focus:ring-primary","focus:border-primary","dark:bg-gray-700","dark:text-gray-200",3,"ngModelChange","ngModel"],[1,"mt-2","max-h-80","overflow-y-auto","pr-2"],["class","p-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md cursor-pointer transition-all duration-150 ease-in-out flex justify-between items-center",3,"click",4,"ngFor","ngForOf"],["class","text-gray-500 dark:text-gray-400 text-center p-4",4,"ngIf"],[1,"bg-gray-50","dark:bg-gray-700","px-4","py-3","sm:flex","sm:flex-row-reverse","sm:px-6"],["type","button",1,"mt-3","inline-flex","w-full","justify-center","rounded-md","bg-white","dark:bg-gray-600","px-3","py-2","text-sm","font-semibold","text-gray-900","dark:text-gray-200","shadow-sm","ring-1","ring-inset","ring-gray-300","dark:ring-gray-500","hover:bg-gray-50","dark:hover:bg-gray-500","sm:mt-0","sm:w-auto",3,"click"],[1,"p-3","hover:bg-gray-100","dark:hover:bg-gray-700","rounded-md","cursor-pointer","transition-all","duration-150","ease-in-out","flex","justify-between","items-center",3,"click"],[1,"font-medium","text-gray-800","dark:text-gray-200"],[1,"block","text-xs","text-gray-500","dark:text-gray-400"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"w-5","h-5","text-primary","dark:text-primary-light"],["fill-rule","evenodd","d","M8.22 5.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06-1.06L11.94 10 8.22 6.28a.75.75 0 0 1 0-1.06Z","clip-rule","evenodd"],[1,"text-gray-500","dark:text-gray-400","text-center","p-4"]],template:function(e,i){if(e&1&&(h(0,Qt,2,1,"div",2),s(1,"div",3)(2,"header",4)(3,"div",5)(4,"button",6),C(),s(5,"svg",7),y(6,"path",8),a()(),R(),s(7,"h1",9),u(8),a(),y(9,"div",10),a(),h(10,Xt,10,1,"div",11),a(),s(11,"form",12),f("ngSubmit",function(){return i.onSubmit()}),s(12,"section",13)(13,"div")(14,"label",14),u(15,"Routine Name"),a(),y(16,"input",15),h(17,ti,2,1,"div",16),a(),s(18,"div")(19,"label",17),u(20,"Description (Optional)"),a(),y(21,"textarea",18),a(),s(22,"div")(23,"label",19),u(24,"Primary Goal"),a(),s(25,"select",20),h(26,ii,2,2,"option",21),a()()(),s(27,"section",22)(28,"div",23)(29,"h2",24),u(30,"Exercises"),a(),h(31,ri,2,1,"button",25),a(),h(32,hi,2,2,"div",26)(33,vi,5,1,"div",27)(34,Si,5,1,"div",28),a(),h(35,yi,5,2,"div",29),a(),h(36,Ii,21,4,"div",30),a()),e&2){let r;c("ngIf",i.errorMessage()),l(8),k(" ",i.isNewMode?"New Routine":i.isViewMode?((r=i.routineForm.get("name"))==null?null:r.value)||"View Routine":"Edit: "+(((r=i.routineForm.get("name"))==null?null:r.value)||"Routine")," "),l(2),c("ngIf",!i.isNewMode&&i.currentRoutineId),l(),c("formGroup",i.routineForm),l(5),c("ngClass",ue(13,Ht,i.f.name.invalid&&i.f.name.touched,!(i.f.name.invalid&&i.f.name.touched))),l(),c("ngIf",i.f.name.invalid&&(i.f.name.dirty||i.f.name.touched)),l(9),c("ngForOf",i.routineGoals),l(5),c("ngIf",i.isEditMode&&i.exercisesFormArray.length>0),l(),c("ngIf",i.exercisesFormArray.length>0),l(),c("ngIf",i.isEditMode&&i.exercisesFormArray.length===0),l(),c("ngIf",i.isEditMode&&i.exercisesFormArray.length>0),l(),c("ngIf",i.isEditMode||i.isNewMode),l(),c("ngIf",i.isExerciseModalOpen())}},dependencies:[K,Pe,ee,H,We,$e,Oe,wt,It,Ve,Ae,kt,Fe,De,Et,Ne,Be,yt,bt,Re,Ue,Me,Vt,Rt,Wt,Pt,ze],styles:[".exercise-list-container[_ngcontent-%COMP%]{min-height:60px}.exercise-item[_ngcontent-%COMP%]{transition:box-shadow .2s ease-in-out}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:.4;background:#ccc;border:dotted 2px #999;min-height:100px;transition:transform .25s cubic-bezier(0,0,.2,1);display:block;margin-bottom:.5rem}.cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f;border-radius:.5rem;background-color:var(--card-background-color, white)}body.dark[_ngcontent-%COMP%]   .cdk-drag-preview[_ngcontent-%COMP%]{background-color:var(--dark-card-background-color, #1f2937)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .exercise-item[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"]})};var Ei=["progressCircleSvg"];function Ci(n,t){if(n&1&&(s(0,"div",12),u(1),a()),n&2){let e=d(2);l(),k(" Prepare for: ",e.nextUpText," ")}}function Ti(n,t){if(n&1){let e=b();s(0,"div",2)(1,"div",3),C(),s(2,"svg",4,0),y(4,"circle",5)(5,"circle",6),a(),R(),s(6,"div",7)(7,"div",8),u(8),a(),s(9,"div",9),u(10),a()()(),s(11,"button",10),f("click",function(){x(e);let r=d();return g(r.skipTimer())}),u(12," Skip "),a(),h(13,Ci,2,1,"div",11),a()}if(n&2){let e=d();ke("opacity-100",e.isVisible)("opacity-0",!e.isVisible),l(4),tt("r",e.getCircleRadius()),l(),tt("r",e.getCircleRadius())("stroke-dasharray",e.getCircleCircumference())("stroke-dashoffset",e.strokeDashoffset()),l(3),k(" ",e.displayTime()," "),l(2),k(" ",e.mainText," "),l(3),c("ngIf",e.nextUpText)}}var Je=class n{isVisible=!1;durationSeconds=60;mainText="RESTING";nextUpText=null;timerFinished=new et;timerSkipped=new et;progressCircleSvg;timerIntervalId;circleRadius=90;circumference=2*Math.PI*this.circleRadius;remainingTime=E(0);initialDuration=E(0);strokeDashoffset=D(()=>{if(this.initialDuration()<=0)return this.circumference;let t=this.remainingTime()/this.initialDuration();return this.circumference*(1-t)});displayTime=D(()=>{let t=this.remainingTime(),e=Math.floor(t/60),i=t%60;return`${e.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`});ngOnChanges(t){t.isVisible&&(this.isVisible?this.startTimer():this.stopTimer()),t.durationSeconds&&this.isVisible&&this.startTimer()}ngAfterViewInit(){}startTimer(){if(this.stopTimer(),this.initialDuration.set(this.durationSeconds),this.remainingTime.set(this.durationSeconds),this.durationSeconds<=0){this.timerFinished.emit();return}this.timerIntervalId=setInterval(()=>{this.remainingTime.update(t=>{let e=t-1;return e<=0?(this.stopTimer(),this.timerFinished.emit(),0):e})},1e3)}stopTimer(){this.timerIntervalId&&(clearInterval(this.timerIntervalId),this.timerIntervalId=null)}skipTimer(){this.stopTimer(),this.timerSkipped.emit()}ngOnDestroy(){this.stopTimer()}getCircleCircumference(){return this.circumference}getCircleRadius(){return this.circleRadius}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=G({type:n,selectors:[["app-full-screen-rest-timer"]],viewQuery:function(e,i){if(e&1&&Se(Ei,5),e&2){let r;ye(r=be())&&(i.progressCircleSvg=r.first)}},inputs:{isVisible:"isVisible",durationSeconds:"durationSeconds",mainText:"mainText",nextUpText:"nextUpText"},outputs:{timerFinished:"timerFinished",timerSkipped:"timerSkipped"},features:[at],decls:1,vars:1,consts:[["progressCircleSvg",""],["class","fixed inset-0 z-50 flex flex-col items-center justify-center bg-black/70 backdrop-blur-sm transition-opacity duration-300 ease-in-out",3,"opacity-100","opacity-0",4,"ngIf"],[1,"fixed","inset-0","z-50","flex","flex-col","items-center","justify-center","bg-black/70","backdrop-blur-sm","transition-opacity","duration-300","ease-in-out"],[1,"relative","flex","flex-col","items-center","justify-center","text-white"],["viewBox","0 0 200 200",1,"w-64","h-64","md:w-80","md:h-80","transform","-rotate-90"],["cx","100","cy","100","fill","transparent","stroke","rgba(255, 255, 255, 0.2)","stroke-width","12"],["cx","100","cy","100","fill","transparent","stroke","currentColor","stroke-width","14","stroke-linecap","round",1,"text-blue-500","dark:text-blue-400"],[1,"absolute","inset-0","flex","flex-col","items-center","justify-center","text-center"],[1,"text-6xl","md:text-7xl","font-bold","tabular-nums"],[1,"mt-2","text-xl","md:text-2xl","font-medium","uppercase","tracking-wider"],[1,"mt-12","py-3","px-8","bg-white/20","hover:bg-white/30","text-white","font-semibold","rounded-lg","shadow-md","transition-colors","duration-150","text-lg",3,"click"],["class","mt-5 text-sm md:text-base text-gray-300",4,"ngIf"],[1,"mt-5","text-sm","md:text-base","text-gray-300"]],template:function(e,i){e&1&&h(0,Ti,14,11,"div",1),e&2&&c("ngIf",i.isVisible)},dependencies:[K,H],encapsulation:2,changeDetection:0})};var Pi=n=>({"filter dark:invert":n}),Wi=(n,t,e,i)=>({"text-red-500":n,"animate-pulse":t,"text-green-500 dark:text-green-400":e,"text-gray-800 dark:text-gray-100":i}),Ri=(n,t)=>({"bg-green-500 hover:bg-green-600":n,"bg-yellow-500 hover:bg-yellow-600 text-black":t});function Vi(n,t){if(n&1){let e=b();s(0,"div",11)(1,"h2",12),u(2,"Session Paused"),a(),s(3,"p",13),u(4),a(),s(5,"button",14),f("click",function(){x(e);let r=d(2);return g(r.resumeSession())}),u(6," Resume Workout "),a(),s(7,"button",15),f("click",function(){x(e);let r=d(2);return g(r.quitWorkout())}),u(8," Quit Workout (No Save) "),a()()}if(n&2){let e=d(2);l(4),k("Elapsed Time: ",e.sessionTimerDisplay())}}function Fi(n,t){if(n&1&&y(0,"img",44),n&2){let e=d().ngIf,i=d(4);c("src",i.getIconPath(e.iconName),lt)("alt",e.name+" icon")("ngClass",ut(3,Pi,e.iconName!=="default-exercise"&&e.iconName!==""&&e.iconName!==null))}}function Di(n,t){if(n&1&&(s(0,"div",42),h(1,Fi,1,5,"img",43),a()),n&2){let e=t.ngIf;l(),c("ngIf",e.iconName)}}function Mi(n,t){n&1&&y(0,"div",45)}function Oi(n,t){if(n&1&&(s(0,"span"),u(1),a()),n&2){let e=d(5);l(),k("/",e.getTotalWarmupSetsForCurrentExercise())}}function Ai(n,t){if(n&1&&(s(0,"span",46),u(1),h(2,Oi,2,1,"span",36),a()),n&2){let e=d(4);l(),k(" Warm-up Set ",e.getCurrentWarmupSetNumber()," "),l(),c("ngIf",e.getTotalWarmupSetsForCurrentExercise()>0)}}function Ni(n,t){if(n&1&&(s(0,"span"),u(1),a()),n&2){let e=d(4);l(),U(" Set ",e.getCurrentWorkingSetNumber(),"/",e.getWorkingSetCountForCurrentExercise()," ")}}function Bi(n,t){if(n&1&&(s(0,"span",47),u(1),a()),n&2){let e=d(4);l(),U(" (Round ",e.currentBlockRound(),"/",e.totalBlockRounds(),") ")}}function Li(n,t){if(n&1&&(s(0,"span",48),u(1),a()),n&2){let e=d().ngIf;l(),U(" (Superset ",(e.exerciseData.supersetOrder??0)+1,"/",e.exerciseData.supersetSize??"?",") ")}}function Ui(n,t){if(n&1){let e=b();s(0,"div")(1,"label",49),u(2,"Weight"),a(),s(3,"div",50)(4,"button",51),f("click",function(){x(e);let r=d(4);return g(r.decrementWeight(.5))}),C(),s(5,"svg",52),y(6,"path",53),a()(),R(),y(7,"input",54),s(8,"span",55),u(9),a(),s(10,"button",51),f("click",function(){x(e);let r=d(4);return g(r.incrementWeight(.5))}),C(),s(11,"svg",52),y(12,"path",56),a()()()()}if(n&2){let e=d(4);l(4),c("disabled",e.getDisabled()),l(5),V(e.weightUnitDisplaySymbol),l(),c("disabled",e.getDisabled())}}function $i(n,t){if(n&1){let e=b();s(0,"div")(1,"label",49),u(2,"Reps"),a(),s(3,"div",50)(4,"button",51),f("click",function(){x(e);let r=d(4);return g(r.decrementReps(1))}),C(),s(5,"svg",52),y(6,"path",53),a()(),R(),y(7,"input",57),s(8,"button",51),f("click",function(){x(e);let r=d(4);return g(r.incrementReps(1))}),C(),s(9,"svg",52),y(10,"path",56),a()()()()}if(n&2){let e=d(4);l(4),c("disabled",e.getDisabled()),l(4),c("disabled",e.getDisabled())}}function Gi(n,t){if(n&1&&(s(0,"span"),u(1),a()),n&2){let e=d(2).ngIf;l(),k("(Target: ",e.setData.duration,"s)")}}function ji(n,t){n&1&&(s(0,"span"),u(1,"Start Timer"),a())}function zi(n,t){n&1&&(s(0,"span"),u(1,"Pause Timer"),a())}function Hi(n,t){n&1&&(s(0,"span"),u(1,"Resume Timer"),a())}function Ki(n,t){if(n&1){let e=b();s(0,"button",64),f("click",function(){x(e);let r=d(5);return g(r.resetTimedSet())}),u(1," Reset "),a()}if(n&2){let e=d(5);c("disabled",e.getDisabled())}}function Yi(n,t){if(n&1){let e=b();s(0,"div")(1,"label",58),u(2," Time (seconds) "),h(3,Gi,2,1,"span",36),a(),s(4,"div",59),u(5),a(),y(6,"input",60),s(7,"div",61)(8,"button",62),f("click",function(){x(e);let r=d(4);return g(r.toggleTimedSetTimer())}),h(9,ji,2,0,"span",36)(10,zi,2,0,"span",36)(11,Hi,2,0,"span",36),a(),h(12,Ki,2,1,"button",63),a()()}if(n&2){let e,i=d().ngIf,r=d(3);l(3),c("ngIf",i.setData.duration>0),l(),c("ngClass",mt(9,Wi,r.isTimedSetOvertime(),r.isTimedSetOvertime()&&r.timedSetTimerState()==="running",!r.isTimedSetOvertime()&&r.timedSetTimerState()==="running"&&(((e=r.activeSetInfo())==null||e.setData==null?null:e.setData.duration)??0)>0&&r.timedSetElapsedSeconds()>0,r.timedSetTimerState()==="idle"||r.timedSetTimerState()==="paused"||!((((e=r.activeSetInfo())==null||e.setData==null?null:e.setData.duration)??0)>0&&r.timedSetElapsedSeconds()>0&&!r.isTimedSetOvertime()))),l(),k(" ",r.timedSetDisplay()," "),l(3),c("disabled",r.getDisabled())("ngClass",ue(14,Ri,r.timedSetTimerState()==="idle"||r.timedSetTimerState()==="paused",r.timedSetTimerState()==="running")),l(),c("ngIf",r.timedSetTimerState()==="idle"),l(),c("ngIf",r.timedSetTimerState()==="running"),l(),c("ngIf",r.timedSetTimerState()==="paused"),l(),c("ngIf",r.timedSetTimerState()!=="idle")}}function qi(n,t){if(n&1){let e=b();s(0,"div",70)(1,"input",71),f("ngModelChange",function(r){x(e);let o=d(5);return g(o.updateRpe(r))}),a(),s(2,"div",72)(3,"span"),u(4,"Easy"),a(),s(5,"span",73),u(6),a(),s(7,"span"),u(8,"Max Effort"),a()()()}if(n&2){let e=d(5);l(),c("ngModel",e.rpeValue()),l(5),V(e.rpeValue()||"-")}}function Ji(n,t){if(n&1){let e=b();s(0,"div",65)(1,"button",66),f("click",function(){x(e);let r=d(4);return g(r.toggleRpeInput())}),u(2," Tap to track RPE (optional) "),C(),s(3,"svg",67),y(4,"path",68),a()(),h(5,qi,9,2,"div",69),a()}if(n&2){let e=d(4);l(5),c("ngIf",e.showRpeSlider())}}function Qi(n,t){if(n&1){let e=b();s(0,"div",29)(1,"div",30),h(2,Di,2,1,"div",31)(3,Mi,1,0,"ng-template",null,3,z),s(5,"h2",32),u(6),a()(),s(7,"div",33)(8,"p",34),h(9,Ai,3,2,"span",35)(10,Ni,2,2,"span",36)(11,Bi,2,2,"span",37)(12,Li,2,2,"span",38),a()(),s(13,"form",39),h(14,Ui,13,3,"div",36)(15,$i,11,2,"div",36)(16,Yi,13,17,"div",36)(17,Ji,6,1,"div",40),a(),s(18,"button",41),f("click",function(){x(e);let r=d(3);return g(r.completeSetAndProceed())}),u(19),a()()}if(n&2){let e=t.ngIf,i=d(3);l(2),c("ngIf",i.currentBaseExercise()),l(3),c("title",e.exerciseData.exerciseName),l(),k(" ",e.exerciseData.exerciseName||"Loading Exercise..."," "),l(3),c("ngIf",e.isWarmup),l(),c("ngIf",!e.isWarmup),l(),c("ngIf",i.totalBlockRounds()>1&&i.currentBlockRound()>0),l(),c("ngIf",e.exerciseData.supersetId),l(),c("formGroup",i.currentSetForm),l(),c("ngIf",i.csf.actualWeight),l(),c("ngIf",i.csf.actualReps&&e.setData.reps!==void 0),l(),c("ngIf",e.setData.duration!==void 0),l(),c("ngIf",!1),l(),c("disabled",i.sessionState()==="paused"),l(),k(" ",i.nextActionButtonLabel()," ")}}function Zi(n,t){n&1&&(s(0,"p",79),u(1," All sets are done. Well done! "),a())}function Xi(n,t){if(n&1){let e=b();s(0,"button",80),f("click",function(){x(e);let r=d(4);return g(r.finishWorkout())}),u(1," Confirm & Finish Workout "),a()}}function er(n,t){n&1&&(s(0,"button",81),C(),s(1,"svg",18),y(2,"path",19),a()())}function tr(n,t){if(n&1&&(s(0,"div",74)(1,"h2",75),u(2),a(),h(3,Zi,2,0,"p",76)(4,Xi,2,0,"button",77)(5,er,3,0,"button",78),a()),n&2){let e=d(3);l(2),k(" ",e.sessionState()==="error"?"Error Loading Workout":"Workout Complete!"," "),l(),c("ngIf",e.sessionState()!=="error"),l(),c("ngIf",e.sessionState()!=="error"),l(),c("ngIf",e.sessionState()==="error")}}function ir(n,t){if(n&1){let e=b();s(0,"footer",82)(1,"div",83),u(2,"UP NEXT"),a(),s(3,"div",84),u(4),a(),s(5,"div",85),u(6),F(7,"number"),s(8,"button",86),f("click",function(){x(e);let r=d(3);return g(r.skipRest())}),u(9,"(Skip)"),a()()()}if(n&2){let e=d(3);l(3),c("title",e.restTimerNextUpText()),l(),k(" ",e.restTimerNextUpText()||"Next Exercise"," "),l(2),k(" Rest: ",e.restTimerDisplay()||$(7,3,e.restDuration(),"1.0-0")+"s"," ")}}function rr(n,t){if(n&1){let e=b();le(0),s(1,"header",16)(2,"button",17),f("click",function(){x(e);let r=d(2);return g(r.goBack())}),C(),s(3,"svg",18),y(4,"path",19),a()(),R(),s(5,"div",20)(6,"h1",21),u(7),a(),s(8,"div",22),u(9),a()(),s(10,"button",23),f("click",function(){x(e);let r=d(2);return g(r.toggleWorkoutMenu())}),C(),s(11,"svg",24),y(12,"path",25),a()()(),R(),s(13,"main",26),h(14,Qi,20,14,"div",27)(15,tr,6,4,"ng-template",null,2,z),a(),h(17,ir,10,6,"footer",28),de()}if(n&2){let e=t.ngIf,i=Q(16),r=d(2);l(6),c("title",e.name),l(),k(" ",e.name||"Workout"," "),l(2),V(r.sessionTimerDisplay()),l(),c("disabled",r.sessionState()==="loading"||r.sessionState()==="error"||r.sessionState()==="paused"),l(3),ke("pb-20",r.isRestTimerVisible())("pb-4",!r.isRestTimerVisible()),l(),c("ngIf",r.activeSetInfo())("ngIfElse",i),l(3),c("ngIf",r.isRestTimerVisible())}}function nr(n,t){if(n&1){let e=b();s(0,"div",87)(1,"button",88),f("click",function(){x(e);let r=d(2);return g(r.goBack())}),C(),s(2,"svg",18),y(3,"path",19),a()(),R(),s(4,"div",20)(5,"h1",89),u(6,"Error"),a()(),y(7,"div",90),a(),s(8,"div",91)(9,"h2",92),u(10,"Routine Not Found"),a(),s(11,"p",93),u(12,"The selected routine could not be loaded."),a(),s(13,"button",94),C(),s(14,"svg",18),y(15,"path",19),a()()()}}function or(n,t){if(n&1&&(s(0,"div",8),h(1,Vi,9,1,"div",9)(2,rr,18,11,"ng-container",10)(3,nr,16,0,"ng-template",null,1,z),a()),n&2){let e=Q(4),i=d();l(),c("ngIf",i.sessionState()==="paused"),l(),c("ngIf",i.routine())("ngIfElse",e)}}function sr(n,t){if(n&1){let e=b();s(0,"div",95)(1,"h2",96),u(2,"Workout Menu"),a(),s(3,"button",97),f("click",function(){x(e);let r=d();return g(r.pauseSession())}),u(4," Pause Workout "),a(),s(5,"button",98),f("click",function(){x(e);let r=d();return g(r.openPerformanceInsightsFromMenu())}),u(6," View Performance Insights "),a(),s(7,"button",99),f("click",function(){x(e);let r=d();return g(r.addWarmupSet())}),u(8," + Add Warm-up Set "),a(),s(9,"button",100),f("click",function(){x(e);let r=d();return g(r.skipCurrentSet())}),u(10," Skip Current Set "),a(),s(11,"button",101),f("click",function(){x(e);let r=d();return g(r.skipCurrentExercise())}),u(12," Skip Current Exercise "),a(),s(13,"button",102),f("click",function(){x(e);let r=d();return g(r.finishWorkoutEarly())}),u(14," Finish Workout Early "),a(),s(15,"button",103),f("click",function(){x(e);let r=d();return g(r.quitWorkout())}),u(16," Quit Workout "),a(),s(17,"button",104),f("click",function(){x(e);let r=d();return g(r.closeWorkoutMenu())}),u(18," Close Menu "),a()()}if(n&2){let e=d();l(3),c("disabled",e.sessionState()!=="playing"),l(2),c("disabled",e.sessionState()==="paused"),l(2),c("disabled",!e.canAddWarmupSet()||e.sessionState()==="paused"),l(2),c("disabled",!e.activeSetInfo()||e.sessionState()==="paused"),l(2),c("disabled",!e.activeSetInfo()||e.sessionState()==="paused"),l(2),c("disabled",e.sessionState()==="paused")}}function ar(n,t){n&1&&(s(0,"span",46),u(1,"(Warm-up) "),a())}function lr(n,t){if(n&1&&(s(0,"span",128),u(1,"Reps: "),s(2,"strong",129),u(3),a()()),n&2){let e=d().$implicit;l(3),V(e.repsAchieved)}}function dr(n,t){if(n&1&&(s(0,"span",128),u(1,"Weight: "),s(2,"strong",129),u(3),F(4,"weightUnit"),a()()),n&2){let e=d().$implicit;l(3),V(j(4,1,e.weightUsed))}}function ur(n,t){if(n&1&&(s(0,"span"),u(1,"Time: "),s(2,"strong",129),u(3),a()()),n&2){let e=d().$implicit;l(3),k("",e.durationPerformed,"s")}}function cr(n,t){if(n&1&&(s(0,"p",130),u(1),a()),n&2){let e=d().$implicit;l(),k("Notes: ",e.notes)}}function mr(n,t){if(n&1&&(s(0,"div",124)(1,"p",125),h(2,ar,2,0,"span",35),u(3),a(),h(4,lr,4,1,"span",126)(5,dr,5,3,"span",126)(6,ur,4,1,"span",36)(7,cr,2,1,"p",127),a()),n&2){let e=t.$implicit,i=t.index;l(2),c("ngIf",e.isWarmup),l(),k(" Set ",i+1,": "),l(),c("ngIf",e.repsAchieved!==void 0),l(),c("ngIf",e.weightUsed!==void 0&&e.weightUsed!==null),l(),c("ngIf",e.durationPerformed!==void 0),l(),c("ngIf",e.notes)}}function pr(n,t){if(n&1&&(s(0,"div",122),h(1,mr,8,6,"div",123),a()),n&2){let e=d(3);l(),c("ngForOf",e.allPreviousLoggedSetsForCurrentExercise())}}function xr(n,t){if(n&1&&(s(0,"li"),u(1),a()),n&2){let e=d().ngIf;l(),k("Reps: ",e.repsAchieved)}}function gr(n,t){if(n&1&&(s(0,"li"),u(1),F(2,"weightUnit"),a()),n&2){let e=d().ngIf;l(),k("Weight: ",j(2,1,e.weightUsed))}}function fr(n,t){if(n&1&&(s(0,"li"),u(1),a()),n&2){let e=d().ngIf;l(),k("Time: ",e.durationPerformed,"s")}}function _r(n,t){if(n&1&&(s(0,"div",131)(1,"p",132),u(2),F(3,"date"),a(),s(4,"ul",133),h(5,xr,2,1,"li",36)(6,gr,3,3,"li",36)(7,fr,2,1,"li",36),a()()),n&2){let e=t.ngIf,i=d(3);l(2),k("Last time (",$(3,4,i.lastPerformanceForCurrentExercise==null?null:i.lastPerformanceForCurrentExercise.lastPerformedDate,"dd/MM/yyyy HH:mm"),"):"),l(3),c("ngIf",e.repsAchieved!==void 0),l(),c("ngIf",e.weightUsed!==void 0&&e.weightUsed!==null),l(),c("ngIf",e.durationPerformed!==void 0)}}function hr(n,t){n&1&&(s(0,"div",131)(1,"p",134),u(2,"No previous performance recorded for this exercise yet."),a()())}function vr(n,t){if(n&1&&(s(0,"div")(1,"span",139),u(2),a(),s(3,"strong",129),u(4),a(),s(5,"em",140),u(6),F(7,"date"),a()()),n&2){let e=t.$implicit,i=d(4);l(2),k("",e.pbType,": "),l(2),V(i.formatPbValue(e)),l(2),k(" (",$(7,3,e.timestamp,"shortDate"),")")}}function Sr(n,t){if(n&1&&(s(0,"div",135)(1,"p",136),u(2),a(),s(3,"div",137),h(4,vr,8,6,"div",138),a()()),n&2){let e,i=d(3);l(2),k("Personal Bests for ",((e=i.currentBaseExercise())==null?null:e.name)||"this exercise",":"),l(2),c("ngForOf",i.exercisePBs())}}function yr(n,t){if(n&1&&(s(0,"div",135)(1,"p",134),u(2),a()()),n&2){let e,i=d(3);l(2),k("No personal bests recorded yet for ",(e=i.currentBaseExercise())==null?null:e.name,".")}}function br(n,t){if(n&1){let e=b();s(0,"div",145),f("click",function(){x(e);let r=d(4);return g(r.startEditTarget("reps"))}),u(1),a()}if(n&2){let e=d(2).ngIf;l(),k(" ",e.setData.reps," ")}}function kr(n,t){if(n&1){let e=b();s(0,"div",146)(1,"input",147),Ee("ngModelChange",function(r){x(e);let o=d(4);return Ie(o.editingTargetValue,r)||(o.editingTargetValue=r),g(r)}),f("keyup.enter",function(){x(e);let r=d(4);return g(r.confirmEditTarget())})("keyup.escape",function(){x(e);let r=d(4);return g(r.cancelEditTarget())}),a(),s(2,"button",148),f("click",function(){x(e);let r=d(4);return g(r.confirmEditTarget())}),u(3,"\u2713"),a(),s(4,"button",149),f("click",function(){x(e);let r=d(4);return g(r.cancelEditTarget())}),u(5,"\u2715"),a()()}if(n&2){let e=d(4);l(),we("ngModel",e.editingTargetValue)}}function wr(n,t){if(n&1&&(s(0,"div",141)(1,"span",142),u(2,"Target Reps"),a(),h(3,br,2,1,"div",143)(4,kr,6,1,"div",144),a()),n&2){let e=d(3);l(3),c("ngIf",e.editingTarget!=="reps"),l(),c("ngIf",e.editingTarget==="reps")}}function Ir(n,t){if(n&1){let e=b();s(0,"div",145),f("click",function(){x(e);let r=d(4);return g(r.startEditTarget("weight"))}),u(1),F(2,"weightUnit"),a()}if(n&2){let e=d(2).ngIf;l(),k(" ",j(2,1,e.setData.weight)," ")}}function Er(n,t){if(n&1){let e=b();s(0,"div",146)(1,"input",147),Ee("ngModelChange",function(r){x(e);let o=d(4);return Ie(o.editingTargetValue,r)||(o.editingTargetValue=r),g(r)}),f("keyup.enter",function(){x(e);let r=d(4);return g(r.confirmEditTarget())})("keyup.escape",function(){x(e);let r=d(4);return g(r.cancelEditTarget())}),a(),s(2,"button",148),f("click",function(){x(e);let r=d(4);return g(r.confirmEditTarget())}),u(3,"\u2713"),a(),s(4,"button",149),f("click",function(){x(e);let r=d(4);return g(r.cancelEditTarget())}),u(5,"\u2715"),a()()}if(n&2){let e=d(4);l(),we("ngModel",e.editingTargetValue)}}function Cr(n,t){if(n&1&&(s(0,"div",141)(1,"span",142),u(2,"Target Weight"),a(),h(3,Ir,3,3,"div",143)(4,Er,6,1,"div",144),a()),n&2){let e=d(3);l(3),c("ngIf",e.editingTarget!=="weight"),l(),c("ngIf",e.editingTarget==="weight")}}function Tr(n,t){if(n&1){let e=b();s(0,"div",145),f("click",function(){x(e);let r=d(4);return g(r.startEditTarget("duration"))}),u(1),s(2,"span",150),u(3,"s"),a()()}if(n&2){let e=d(2).ngIf;l(),k(" ",e.setData.duration)}}function Pr(n,t){if(n&1){let e=b();s(0,"div",146)(1,"input",147),Ee("ngModelChange",function(r){x(e);let o=d(4);return Ie(o.editingTargetValue,r)||(o.editingTargetValue=r),g(r)}),f("keyup.enter",function(){x(e);let r=d(4);return g(r.confirmEditTarget())})("keyup.escape",function(){x(e);let r=d(4);return g(r.cancelEditTarget())}),a(),s(2,"button",148),f("click",function(){x(e);let r=d(4);return g(r.confirmEditTarget())}),u(3,"\u2713"),a(),s(4,"button",149),f("click",function(){x(e);let r=d(4);return g(r.cancelEditTarget())}),u(5,"\u2715"),a()()}if(n&2){let e=d(4);l(),we("ngModel",e.editingTargetValue)}}function Wr(n,t){if(n&1&&(s(0,"div",141)(1,"span",142),u(2,"Target Time"),a(),h(3,Tr,4,1,"div",143)(4,Pr,6,1,"div",144),a()),n&2){let e=d(3);l(3),c("ngIf",e.editingTarget!=="duration"),l(),c("ngIf",e.editingTarget==="duration")}}function Rr(n,t){if(n&1&&(s(0,"div",141)(1,"span",142),u(2,"Target Tempo"),a(),s(3,"span",151),u(4),a()()),n&2){let e=d().ngIf;l(4),V(e.setData.tempo)}}function Vr(n,t){if(n&1){let e=b();s(0,"div",114)(1,"div",115)(2,"button",116),f("click",function(){x(e);let r=d(2);return g(r.toggleCompletedSetsInfo())}),u(3),a()(),h(4,pr,2,1,"div",117),s(5,"div",118),h(6,_r,8,7,"div",119)(7,hr,3,0,"div",119)(8,Sr,5,2,"div",120)(9,yr,3,1,"div",120)(10,wr,5,2,"div",121)(11,Cr,5,2,"div",121)(12,Wr,5,2,"div",121)(13,Rr,5,1,"div",121),a()()}if(n&2){let e=t.ngIf,i=d(2);l(3),U(" ",i.showCompletedSetsInfo()?"Hide":"Show"," Completed Sets (",i.allPreviousLoggedSetsForCurrentExercise().length,") "),l(),c("ngIf",i.allPreviousLoggedSetsForCurrentExercise().length>0&&i.showCompletedSetsInfo()),l(2),c("ngIf",i.trackingService.findPreviousSetPerformance(i.lastPerformanceForCurrentExercise,e.setData,e.setIndex)),l(),c("ngIf",!i.lastPerformanceForCurrentExercise&&i.activeSetInfo()),l(),c("ngIf",i.exercisePBs().length>0),l(),c("ngIf",i.currentBaseExercise()&&i.exercisePBs().length===0),l(),c("ngIf",e.setData.reps!==void 0),l(),c("ngIf",e.setData.weight!==void 0&&e.setData.weight!==null),l(),c("ngIf",e.setData.duration!==void 0),l(),c("ngIf",e.setData.tempo)}}function Fr(n,t){if(n&1){let e=b();s(0,"div",105)(1,"div",106)(2,"header",107)(3,"h3",108),u(4,"Performance Insights & Targets"),a(),s(5,"button",109),f("click",function(){x(e);let r=d();return g(r.closePerformanceInsights())}),C(),s(6,"svg",24),y(7,"path",110),a()()(),h(8,Vr,14,11,"div",111),R(),s(9,"footer",112)(10,"button",113),f("click",function(){x(e);let r=d();return g(r.closePerformanceInsights())}),u(11," Done "),a()()()()}if(n&2){let e=d();l(8),c("ngIf",e.activeSetInfo())}}function Dr(n,t){n&1&&(s(0,"div",152)(1,"p",153),u(2,"Loading workout player..."),a()())}var Qe=class n{route=I(me);router=I(ie);workoutService=I(xe);exerciseService=I(fe);trackingService=I(re);alertService=I(pe);toastService=I(ge);fb=I(Le);storageService=I(Ge);cdr=I(Te);unitService=I(_e);PAUSED_WORKOUT_KEY="fitTrackPro_pausedWorkoutState";PAUSED_STATE_VERSION="1.1";nextActionButtonLabel=E("SET DONE");isRestTimerVisible=E(!1);restDuration=E(0);restTimerMainText=E("RESTING");restTimerNextUpText=E(null);currentSetForm;routineId=null;routine=E(void 0);originalRoutineSnapshot=[];currentExerciseIndex=E(0);currentSetIndex=E(0);currentWorkoutLogExercises=E([]);workoutStartTime=0;routeSub;timerSub;sessionTimerDisplay=E("00:00:00");restTimerDisplay=E(null);currentBlockRound=E(1);totalBlockRounds=E(1);wasRestTimerVisibleOnPause=!1;restTimerRemainingSecondsOnPause=0;restTimerInitialDurationOnPause=0;restTimerMainTextOnPause="RESTING";restTimerNextUpTextOnPause=null;rpeValue=E(null);rpeOptions=Array.from({length:10},(t,e)=>e+1);showRpeSlider=E(!1);timedSetTimerState=E("idle");timedSetElapsedSeconds=E(0);timedSetIntervalSub;timedSetDisplay=D(()=>{let t=this.timedSetTimerState(),e=this.timedSetElapsedSeconds(),r=this.activeSetInfo()?.setData?.duration;return t==="idle"?(r!==void 0&&r>0?r:this.csf?.actualDuration?.value??0).toString():r!==void 0&&r>0?(r-e).toString():e.toString()});isTimedSetOvertime=D(()=>{if(this.timedSetTimerState()==="idle")return!1;let e=this.timedSetElapsedSeconds(),i=this.activeSetInfo()?.setData?.duration;return i!==void 0&&i>0&&e>i});unloadNotification(t){this.sessionState()==="playing"&&this.routine()&&this.currentWorkoutLogExercises().length>0&&this.captureAndSaveStateForUnload()}autoSaveSub;AUTO_SAVE_INTERVAL_MS=15e3;get weightUnitDisplaySymbol(){return this.unitService.getUnitLabel()}getWorkingSetCountForCurrentExercise=D(()=>{let t=this.routine(),e=this.currentExerciseIndex();return t&&t.exercises[e]?t.exercises[e].sets.filter(i=>!i.isWarmup).length:0});getCurrentWorkingSetNumber=D(()=>{let t=this.activeSetInfo(),e=this.routine();if(!t||!e||t.isWarmup)return 0;let i=e.exercises[t.exerciseIndex],r=0;for(let o=0;o<=t.setIndex;o++)if(i.sets[o].isWarmup||r++,o===t.setIndex)return r;return 0});getCurrentWarmupSetNumber=D(()=>{let t=this.activeSetInfo(),e=this.routine();if(!t||!e||!t.isWarmup)return 0;let i=e.exercises[t.exerciseIndex],r=0;for(let o=0;o<=t.setIndex;o++)if(i.sets[o].isWarmup&&r++,o===t.setIndex)return r;return 0});activeSetInfo=D(()=>{let t=this.routine(),e=this.currentExerciseIndex(),i=this.currentSetIndex();if(t&&t.exercises[e]&&t.exercises[e].sets[i]){let r=t.exercises[e],o=t.exercises[e].sets[i],p=this.currentWorkoutLogExercises().find(S=>S.exerciseId===r.exerciseId)?.sets.find(S=>S.plannedSetId===o.id);return{exerciseIndex:e,setIndex:i,exerciseData:r,setData:o,isWarmup:!!o.isWarmup,baseExerciseInfo:void 0,isCompleted:!!p,actualReps:p?.repsAchieved,actualWeight:p?.weightUsed,actualDuration:p?.durationPerformed,notes:p?.notes}}return null});currentBaseExercise=E(void 0);exercisePBs=E([]);allPreviousLoggedSetsForCurrentExercise=D(()=>{let t=this.activeSetInfo();if(!t||t.setIndex===0)return[];let e=this.currentWorkoutLogExercises().find(i=>i.exerciseId===t.exerciseData.exerciseId);if(e&&e.sets.length>0){let i=[];for(let r=0;r<t.setIndex;r++){let o=t.exerciseData.sets[r]?.id;if(o){let m=e.sets.find(p=>p.plannedSetId===o);m&&i.push(m)}}return i}return[]});lastPerformanceForCurrentExercise=null;editingTarget=null;editingTargetValue="";sessionState=E("loading");sessionTimerElapsedSecondsBeforePause=0;wasTimedSetRunningOnPause=!1;isWorkoutMenuVisible=E(!1);isPerformanceInsightsVisible=E(!1);showCompletedSetsInfo=E(!1);routerEventsSub;isSessionConcluded=!1;constructor(){this.initializeCurrentSetForm()}platformId=I(ae);resetAndPatchCurrentSetForm(){this.currentSetForm.reset({rpe:null}),this.rpeValue.set(null),this.showRpeSlider.set(!1);let t=this.activeSetInfo();if(this.resetTimedSet(),t){let i=this.currentWorkoutLogExercises().find(o=>o.exerciseId===t.exerciseData.exerciseId)?.sets.find(o=>o.plannedSetId===t.setData.id),r=t.setData.duration??null;i&&i.durationPerformed!==void 0&&(r=i.durationPerformed),this.currentSetForm.patchValue({actualReps:i?.repsAchieved??t.setData.reps??null,actualWeight:i?.weightUsed??t.setData.weight??null,actualDuration:r,setNotes:i?.notes??"",rpe:null})}}startSessionTimer(){this.sessionState()!=="paused"&&(this.timerSub&&this.timerSub.unsubscribe(),this.timerSub=Xe(0,1e3).subscribe(()=>{if(this.sessionState()==="playing"){let t=Math.floor((Date.now()-this.workoutStartTime)/1e3),e=this.sessionTimerElapsedSecondsBeforePause+t,i=Math.floor(e/3600),r=Math.floor(e%3600/60),o=e%60;this.sessionTimerDisplay.set(`${String(i).padStart(2,"0")}:${String(r).padStart(2,"0")}:${String(o).padStart(2,"0")}`)}}))}updateRestTimerDisplay(t){let e=Math.floor(t/60),i=t%60;this.restTimerDisplay.set(`${String(e).padStart(2,"0")}:${String(i).padStart(2,"0")}`)}addLoggedSetToCurrentLog(t,e){let i=this.currentWorkoutLogExercises(),r=i.find(o=>o.exerciseId===t.exerciseId);if(r){let o=r.sets.findIndex(m=>m.plannedSetId===e.plannedSetId);o>-1?r.sets[o]=e:r.sets.push(e),this.currentWorkoutLogExercises.set([...i])}else r={exerciseId:t.exerciseId,exerciseName:this.currentBaseExercise()?.name||t.exerciseName||"Unknown Exercise",sets:[e]},this.currentWorkoutLogExercises.set([...i,r])}finishWorkout(){return P(this,null,function*(){yield this.finishWorkoutAndReportStatus()})}comparePerformedToOriginal(t,e){let i=[],r=!1;t.length!==e.length&&(i.push(`Number of exercises changed (was ${e.length}, now ${t.length}).`),r=!0);let o=Math.min(t.length,e.length);for(let m=0;m<o;m++){let p=t[m],S=e[m];if(p.exerciseId!==S.exerciseId&&(i.push(`Exercise at position ${m+1} changed (was ${S.exerciseName||S.exerciseId}, now ${p.exerciseName||p.exerciseId}).`),r=!0),p.sets.length!==S.sets.length)i.push(`Set count for "${p.exerciseName||p.exerciseId}" changed (was ${S.sets.length}, now ${p.sets.length}).`),r=!0;else for(let _=0;_<p.sets.length;_++){let v=p.sets[_],w=S.sets[_],T=!!S.sets[_]?.isWarmup,A=!!v.isWarmup;if(T!==A){i.push(`Warm-up status for set ${_+1} of "${p.exerciseName||p.exerciseId}" changed.`),r=!0;break}}r&&i.some(_=>_.includes(p.exerciseName||p.exerciseId))}if(t.length>e.length)for(let m=e.length;m<t.length;m++)i.push(`Added exercise: ${t[m].exerciseName||t[m].exerciseId}.`),r=!0;return e.length>t.length&&!r&&(i.push("One or more exercises were removed from the original routine."),r=!0),{majorDifference:r,details:i}}convertLoggedToWorkoutExercises(t){let e=this.routine();return t.map(i=>{let r=e?.exercises.find(o=>o.exerciseId===i.exerciseId);return{id:oe(),exerciseId:i.exerciseId,exerciseName:i.exerciseName,supersetId:r?.supersetId||null,supersetOrder:r?.supersetOrder??null,supersetSize:r?.supersetSize??null,rounds:r?.rounds??1,notes:i.sets.map(o=>o.notes).filter(o=>!!o).join("; ")||"",sets:i.sets.map(o=>{let m=r?.sets.find(S=>S.id===o.plannedSetId);return{id:oe(),reps:o.repsAchieved,weight:o.weightUsed,duration:o.durationPerformed,tempo:o.targetTempo||m?.tempo,restAfterSet:o.targetRestAfterSet||m?.restAfterSet||60,notes:o.notes,isWarmup:o.isWarmup}})}})}get csf(){return this.currentSetForm.controls}toggleTimedSetTimer(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Please resume to use the timer.",3e3,"Paused");return}let t=this.timedSetTimerState();t==="idle"||t==="paused"?this.startOrResumeTimedSet():t==="running"&&this.pauseTimedSet()}startOrResumeTimedSet(){if(this.timedSetTimerState()==="idle"){this.timedSetElapsedSeconds.set(0);let t=this.activeSetInfo()?.setData?.duration;t!==void 0&&t>0&&this.currentSetForm.get("actualDuration")?.setValue(t,{emitEvent:!1})}this.timedSetTimerState.set("running"),this.timedSetIntervalSub&&this.timedSetIntervalSub.unsubscribe(),this.timedSetIntervalSub=Xe(0,1e3).subscribe(()=>{this.timedSetTimerState()==="running"?(this.timedSetElapsedSeconds.update(t=>t+1),this.currentSetForm.get("actualDuration")?.setValue(this.timedSetElapsedSeconds(),{emitEvent:!1})):this.timedSetIntervalSub&&this.timedSetIntervalSub.unsubscribe()})}pauseTimedSet(){this.timedSetIntervalSub&&(this.timedSetIntervalSub.unsubscribe(),this.timedSetIntervalSub=void 0),this.timedSetTimerState.set("paused")}resetTimedSet(){this.timedSetIntervalSub&&(this.timedSetIntervalSub.unsubscribe(),this.timedSetIntervalSub=void 0),this.timedSetTimerState.set("idle"),this.timedSetElapsedSeconds.set(0);let t=this.activeSetInfo()?.setData?.duration;this.currentSetForm.get("actualDuration")?.setValue(t??0,{emitEvent:!1})}stopAndLogTimedSet(){(this.timedSetTimerState()==="running"||this.timedSetTimerState()==="paused")&&this.pauseTimedSet()}checkIfLatestSetOfExercise(){let t=this.activeSetInfo(),e=this.routine();if(!t||!e)return!1;let i=e.exercises[t.exerciseIndex];if(t.setIndex===i.sets.length-1)return!0;for(let r=t.setIndex+1;r<i.sets.length;r++)if(!i.sets[r].isWarmup)return!1;return!0}checkIfLatestSetOfWorkout(){let t=this.activeSetInfo(),e=this.routine();if(!t||!e)return!1;if(t.exerciseIndex===e.exercises.length-1)return this.checkIfLatestSetOfExercise();for(let i=t.exerciseIndex+1;i<e.exercises.length;i++)if(e.exercises[i].sets.some(o=>!o.isWarmup))return!1;return this.checkIfLatestSetOfExercise()}fetchLastPerformanceAndPatchForm(){return P(this,null,function*(){yield this.prepareCurrentSet()})}patchCurrentSetFormWithData(t){this.patchActualsFormBasedOnSessionTargets()}startEditTarget(t){let e=this.activeSetInfo();if(e)switch(this.editingTarget=t,t){case"reps":this.editingTargetValue=e.setData.reps??"";break;case"weight":this.editingTargetValue=e.setData.weight??"";break;case"duration":this.editingTargetValue=e.setData.duration??"";break}}cancelEditTarget(){this.editingTarget=null,this.editingTargetValue=""}formatPbValue(t){let e="";return t.weightUsed!==void 0&&t.weightUsed!==null?(e+=`${t.weightUsed}${this.unitService.getUnitSuffix()}`,t.repsAchieved>1&&!t.pbType.includes("RM (Actual)")&&(e+=` x ${t.repsAchieved}`)):t.repsAchieved>0&&t.pbType.includes("Max Reps")?e=`${t.repsAchieved} reps`:t.durationPerformed&&t.durationPerformed>0&&t.pbType.includes("Max Duration")&&(e=`${t.durationPerformed}s`),e||"N/A"}initializeCurrentSetForm(){this.currentSetForm=this.fb.group({actualReps:[null,[M.min(0)]],actualWeight:[null,[M.min(0)]],actualDuration:[null,[M.min(0)]],setNotes:[""],rpe:[null,[M.min(1),M.max(10)]]})}prepareCurrentSet(){return P(this,null,function*(){if(this.sessionState()==="paused"){console.log("PrepareCurrentSet: Session is paused, deferring preparation.");return}let t=this.routine(),e=this.currentExerciseIndex(),i=this.currentSetIndex();if(!t||!t.exercises[e]||!t.exercises[e].sets[i]){this.currentSetForm.reset({rpe:null}),this.rpeValue.set(null),this.showRpeSlider.set(!1),this.resetTimedSet(),this.currentBaseExercise.set(null),this.exercisePBs.set([]),this.lastPerformanceForCurrentExercise=null,console.warn("prepareCurrentSet: Could not find active set data in session routine.");return}let r=t.exercises[e],o=r.sets[i];if(this.loadBaseExerciseAndPBs(r.exerciseId),!this.lastPerformanceForCurrentExercise||this.lastPerformanceForCurrentExercise.sets[0]?.exerciseId!==r.exerciseId)try{this.lastPerformanceForCurrentExercise=yield new Promise(_=>{this.trackingService.getLastPerformanceForExercise(r.exerciseId).pipe(N(1)).subscribe(v=>_(v))})}catch(_){console.error("Error fetching last performance:",_),this.lastPerformanceForCurrentExercise=null}let m=this.trackingService.findPreviousSetPerformance(this.lastPerformanceForCurrentExercise,o,i),p;if(o.isWarmup)p=L(B({},o),{reps:o.reps??8,weight:o.weight??null,restAfterSet:o.restAfterSet??30});else{let _=this.workoutService.suggestNextSetParameters(m,o,t.goal);p=L(B({},_),{id:o.id,notes:_.notes??o.notes,isWarmup:!1})}let S=JSON.parse(JSON.stringify(t));S.exercises[e].sets[i]=p,this.routine.set(S),this.patchActualsFormBasedOnSessionTargets()})}patchActualsFormBasedOnSessionTargets(){if(this.sessionState()==="paused"){console.log("patchActualsFormBasedOnSessionTargets: Session is paused, deferring preparation.");return}this.currentSetForm.reset({rpe:null}),this.rpeValue.set(null),this.showRpeSlider.set(!1),this.resetTimedSet();let t=this.activeSetInfo();if(!t)return;let i=this.currentWorkoutLogExercises().find(o=>o.exerciseId===t.exerciseData.exerciseId)?.sets.find(o=>o.plannedSetId===t.setData.id),r=t.setData.duration??null;i&&i.durationPerformed!==void 0&&(r=i.durationPerformed),i?(this.currentSetForm.patchValue({actualReps:i.repsAchieved,actualWeight:i.weightUsed,actualDuration:r,setNotes:i.notes,rpe:i.rpe}),i.rpe&&this.rpeValue.set(i.rpe)):this.currentSetForm.patchValue({actualReps:t.setData.reps??(t.isWarmup?8:null),actualWeight:t.setData.weight??(t.isWarmup,null),actualDuration:r,setNotes:t.setData.notes||(t.isWarmup?"Warm-up":""),rpe:null})}loadBaseExerciseAndPBs(t){this.currentBaseExercise.set(void 0),this.exercisePBs.set([]),this.exerciseService.getExerciseById(t).subscribe(e=>{this.currentBaseExercise.set(e?L(B({},e),{iconName:this.exerciseService.determineExerciseIcon(e,e?.name)}):null)}),this.trackingService.getAllPersonalBestsForExercise(t).pipe(N(1)).subscribe(e=>this.exercisePBs.set(e))}navigateToNextStepInWorkout(t,e){let i=t.exerciseIndex,r=t.setIndex,o=e.exercises[i],m=i,p=0,S=!1;if(r<o.sets.length-1)p=r+1;else if(o.supersetId&&o.supersetOrder!==null&&o.supersetSize!==null&&o.supersetSize!==void 0&&o.supersetOrder<o.supersetSize-1){if(m++,!(m<e.exercises.length&&e.exercises[m].supersetId===o.supersetId)){let _=this.findNextExerciseBlockStartIndex(i,e);if(_!==-1)m=_,S=!0;else{this.finishWorkout();return}}}else{let _=this.totalBlockRounds();if(this.currentBlockRound()<_)this.currentBlockRound.update(v=>v+1),o.supersetId&&o.supersetOrder!==null&&(m=i-o.supersetOrder);else{let v=this.findNextExerciseBlockStartIndex(i,e);if(v!==-1)m=v,S=!0;else{this.finishWorkout();return}}}if(S){this.currentBlockRound.set(1);let _=e.exercises[m];if(!_.supersetId||_.supersetOrder===0)this.totalBlockRounds.set(_.rounds??1);else{let v=e.exercises.find(w=>w.supersetId===_.supersetId&&w.supersetOrder===0);this.totalBlockRounds.set(v?.rounds??1)}this.lastPerformanceForCurrentExercise=null}this.currentExerciseIndex.set(m),this.currentSetIndex.set(p),t.setData.restAfterSet>0&&this.startRestPeriod(t.setData.restAfterSet),this.prepareCurrentSet()}confirmEditTarget(){let t=this.activeSetInfo();if(!t||this.editingTarget===null)return;let e=parseFloat(this.editingTargetValue);if(isNaN(e)||e<0){this.toastService.error(`Invalid value for ${this.editingTarget}. Must be non-negative.`,3e3,"Input Error");return}let i=this.routine,r=i();if(!r)return;let o=JSON.parse(JSON.stringify(r)),p=o.exercises[t.exerciseIndex].sets[t.setIndex];switch(this.editingTarget){case"reps":p.reps=e;break;case"weight":p.weight=e;break;case"duration":p.duration=e;break}i.set(o),this.toastService.success(`Target ${this.editingTarget} updated to ${e}.`,3e3,"Target Updated"),this.cancelEditTarget(),this.patchActualsFormBasedOnSessionTargets()}completeSetAndProceed(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Please resume to continue.",3e3,"Paused");return}let t=this.activeSetInfo(),e=this.routine();if(!t||!e){console.error("Cannot complete set: activeInfo or routine is not available."),this.toastService.error("Cannot complete set: data missing.",0,"Error");return}if(t.setData.duration&&t.setData.duration>0&&(this.timedSetTimerState()==="running"||this.timedSetTimerState()==="paused")&&this.stopAndLogTimedSet(),this.currentSetForm.invalid){this.currentSetForm.markAllAsTouched();let m="";for(let p of Object.keys(this.currentSetForm.controls))if(this.currentSetForm.controls[p].invalid){m=p;break}this.toastService.error(`Please correct input: ${m?m+" is invalid.":"form invalid."}`,0,"Validation Error");return}let i=this.currentSetForm.value,r=i.actualDuration;t.setData.duration&&t.setData.duration>0&&this.timedSetElapsedSeconds()>0?r=this.timedSetElapsedSeconds():i.actualDuration===null&&t.setData.duration&&(r=t.setData.duration);let o={id:t.setData.id,plannedSetId:t.setData.id,exerciseId:t.exerciseData.exerciseId,isWarmup:!!t.setData.isWarmup,repsAchieved:i.actualReps??(t.setData.isWarmup?0:t.setData.reps??0),weightUsed:i.actualWeight??(t.setData.isWarmup?null:t.setData.weight),durationPerformed:r,rpe:i.rpe??void 0,targetReps:t.setData.reps,targetWeight:t.setData.weight,targetDuration:t.setData.duration,targetTempo:t.setData.tempo,notes:i.setNotes||void 0,timestamp:new Date().toISOString()};this.addLoggedSetToCurrentLog(t.exerciseData,o),this.sessionState()==="playing"&&this.captureAndSaveStateForUnload(),this.rpeValue.set(null),this.showRpeSlider.set(!1),this.navigateToNextStepInWorkout(t,e)}findNextExerciseBlockStartIndex(t,e){for(let i=t+1;i<e.exercises.length;i++){let r=e.exercises[i];if(!r.supersetId||r.supersetOrder===0)return i}return-1}getNextUpText(t,e){if(!t||!e)return"Next Set/Exercise";let i=t.exerciseIndex,r=t.setData,o=e.exercises[i],m=o.sets,p=m.findIndex(v=>v.id===r.id);if(r.isWarmup&&p<m.length-1)if(m[p+1].isWarmup){let w=0;for(let T=0;T<=p+1;T++)m[T].isWarmup&&w++;return`Warm-up Set ${w} of ${o.exerciseName}`}else{let w=0;for(let T=0;T<=p+1;T++)m[T].isWarmup||w++;return`Set ${w} of ${o.exerciseName}`}if(p<m.length-1){let v=m[p+1],w=v.isWarmup?"Warm-up":"Set",T=0;for(let A=0;A<=p+1;A++)!!m[A].isWarmup==!!v.isWarmup&&T++;return`${w} ${T} of ${o.exerciseName}`}if(o.supersetId&&o.supersetOrder!==null&&o.supersetSize&&o.supersetOrder<o.supersetSize-1){let v=i+1;if(v<e.exercises.length&&e.exercises[v].supersetId===o.supersetId)return`SUPERSET: ${e.exercises[v].sets[0].isWarmup?"Warm-up Set 1":"Set 1"} of ${e.exercises[v].exerciseName}`}let S=this.totalBlockRounds();if(this.currentBlockRound()<S){let v=i;o.supersetId&&o.supersetOrder!==null&&(v=i-o.supersetOrder);let w=e.exercises[v],A=w.sets[0].isWarmup?"Warm-up Set 1":"Set 1";return`Round ${this.currentBlockRound()+1}: ${A} of ${w.exerciseName}`}let _=this.findNextExerciseBlockStartIndex(i,e);if(_!==-1){let v=e.exercises[_];return`${v.sets[0].isWarmup?"Warm-up Set 1":"Set 1"} of ${v.exerciseName}`}return"Finish Workout!"}getDisabled(){return this.timedSetTimerState()==="running"||this.sessionState()==="paused"}startRestPeriod(t,e=!1){if(this.sessionState()==="paused"&&!e){this.wasRestTimerVisibleOnPause=!0,this.restTimerRemainingSecondsOnPause=t,this.restTimerInitialDurationOnPause=t,this.restTimerMainTextOnPause=this.activeSetInfo()?.setData?.restAfterSet===0&&this.activeSetInfo()?.exerciseData?.supersetId?"SUPERSET TRANSITION":"RESTING";let i=this.activeSetInfo();this.routine()&&i&&(this.restTimerNextUpTextOnPause=this.activeSetInfo()?.exerciseData.exerciseName||"Next Exercise");return}if(t>0){let i=this.routine();this.restDuration.set(t),e?(this.restTimerMainText.set(this.restTimerMainTextOnPause),this.restTimerNextUpText.set(this.restTimerNextUpTextOnPause)):(this.restTimerMainText.set(this.activeSetInfo()?.setData?.restAfterSet===0&&this.activeSetInfo()?.exerciseData?.supersetId?"SUPERSET TRANSITION":"RESTING"),this.restTimerNextUpText.set(this.activeSetInfo()?.exerciseData.exerciseName||"Next Exercise")),this.isRestTimerVisible.set(!0),this.updateRestTimerDisplay(t)}else this.isRestTimerVisible.set(!1)}handleRestTimerFinished(){this.isRestTimerVisible.set(!1)}handleRestTimerSkipped(){this.isRestTimerVisible.set(!1),this.toastService.info("Rest skipped.",2e3)}skipRest(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Resume to skip rest.",3e3,"Paused");return}this.isRestTimerVisible()&&this.handleRestTimerSkipped()}pauseSession(){return P(this,null,function*(){this.sessionState()==="playing"&&(this.isPerformanceInsightsVisible.set(!1),this.closeWorkoutMenu(),this.sessionTimerElapsedSecondsBeforePause+=Math.floor((Date.now()-this.workoutStartTime)/1e3),this.timerSub&&this.timerSub.unsubscribe(),this.wasTimedSetRunningOnPause=this.timedSetTimerState()==="running",this.timedSetTimerState()==="running"&&this.pauseTimedSet(),this.wasRestTimerVisibleOnPause=this.isRestTimerVisible(),this.wasRestTimerVisibleOnPause&&(this.restTimerRemainingSecondsOnPause=this.restDuration(),this.restTimerInitialDurationOnPause=this.restDuration(),this.restTimerMainTextOnPause=this.restTimerMainText(),this.restTimerNextUpTextOnPause=this.restTimerNextUpText(),this.isRestTimerVisible.set(!1)),this.stopAutoSave(),this.sessionState.set("paused"),this.savePausedSessionState(),this.toastService.info("Workout Paused",3e3))})}loadStateFromPausedSession(t){return P(this,null,function*(){this.routineId=t.routineId,this.routine.set(t.sessionRoutine),this.originalRoutineSnapshot=t.originalRoutineSnapshot?JSON.parse(JSON.stringify(t.originalRoutineSnapshot)):[],this.currentExerciseIndex.set(t.currentExerciseIndex),this.currentSetIndex.set(t.currentSetIndex),this.currentWorkoutLogExercises.set(t.currentWorkoutLogExercises),this.workoutStartTime=Date.now(),this.sessionTimerElapsedSecondsBeforePause=t.sessionTimerElapsedSecondsBeforePause,this.currentBlockRound.set(t.currentBlockRound),this.totalBlockRounds.set(t.totalBlockRounds),this.timedSetTimerState.set(t.timedSetTimerState),this.timedSetElapsedSeconds.set(t.timedSetElapsedSeconds),this.wasTimedSetRunningOnPause=t.timedSetTimerState==="running"||t.timedSetTimerState==="paused",this.lastPerformanceForCurrentExercise=t.lastPerformanceForCurrentExercise,this.wasRestTimerVisibleOnPause=t.isRestTimerVisibleOnPause,this.restTimerRemainingSecondsOnPause=t.restTimerRemainingSecondsOnPause,this.restTimerInitialDurationOnPause=t.restTimerInitialDurationOnPause,this.restTimerMainTextOnPause=t.restTimerMainTextOnPause,this.restTimerNextUpTextOnPause=t.restTimerNextUpTextOnPause,yield this.prepareCurrentSet(),this.sessionState.set("playing"),this.startSessionTimer(),this.startAutoSave(),(t.timedSetTimerState==="running"||t.timedSetTimerState==="paused")&&(this.startOrResumeTimedSet(),t.timedSetTimerState==="paused"&&this.pauseTimedSet()),this.wasRestTimerVisibleOnPause&&this.restTimerRemainingSecondsOnPause>0&&this.startRestPeriod(this.restTimerRemainingSecondsOnPause,!0),this.cdr.detectChanges(),this.toastService.success("Workout session resumed.",3e3,"Resumed")})}savePausedSessionState(){let t=this.routine();if(!t){console.warn("Cannot save paused state: routine data is not available.");return}let e=this.sessionTimerElapsedSecondsBeforePause;this.sessionState()==="playing"&&this.workoutStartTime>0&&(e+=Math.floor((Date.now()-this.workoutStartTime)/1e3));let i,r=this.activeSetInfo();this.currentWorkoutLogExercises().length>0&&this.currentWorkoutLogExercises()[0].sets.length>0?i=q(new Date(this.workoutStartTime-this.sessionTimerElapsedSecondsBeforePause*1e3),"yyyy-MM-dd"):i=q(new Date,"yyyy-MM-dd");let o={version:this.PAUSED_STATE_VERSION,routineId:this.routineId,sessionRoutine:JSON.parse(JSON.stringify(t)),originalRoutineSnapshot:JSON.parse(JSON.stringify(this.originalRoutineSnapshot)),currentExerciseIndex:this.currentExerciseIndex(),currentSetIndex:this.currentSetIndex(),currentWorkoutLogExercises:JSON.parse(JSON.stringify(this.currentWorkoutLogExercises())),workoutStartTimeOriginal:this.workoutStartTime,sessionTimerElapsedSecondsBeforePause:e,currentBlockRound:this.currentBlockRound(),totalBlockRounds:this.totalBlockRounds(),timedSetTimerState:this.timedSetTimerState(),timedSetElapsedSeconds:this.timedSetElapsedSeconds(),isResting:this.isRestTimerVisible(),isRestTimerVisibleOnPause:this.wasRestTimerVisibleOnPause,restTimerRemainingSecondsOnPause:this.restTimerRemainingSecondsOnPause,restTimerInitialDurationOnPause:this.restTimerInitialDurationOnPause,restTimerMainTextOnPause:this.restTimerMainTextOnPause,restTimerNextUpTextOnPause:this.restTimerNextUpTextOnPause,lastPerformanceForCurrentExercise:this.lastPerformanceForCurrentExercise?JSON.parse(JSON.stringify(this.lastPerformanceForCurrentExercise)):null,workoutDate:i};this.storageService.setItem(this.PAUSED_WORKOUT_KEY,o),console.log("Paused session state saved.",o)}captureAndSaveStateForUnload(){let t=this.sessionTimerElapsedSecondsBeforePause;this.sessionState()==="playing"&&this.workoutStartTime>0&&(t+=Math.floor((Date.now()-this.workoutStartTime)/1e3));let e=this.sessionTimerElapsedSecondsBeforePause;this.sessionTimerElapsedSecondsBeforePause=t,this.savePausedSessionState(),this.sessionTimerElapsedSecondsBeforePause=e,console.log("Session state attempt saved via beforeunload.")}addWarmupSet(){return P(this,null,function*(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Resume to add warm-up.",3e3,"Paused");return}let t=this.routine(),e=this.activeSetInfo();if(!t||!e){this.toastService.error("Cannot add warm-up: data unavailable.",0,"Error");return}let r=t.exercises[e.exerciseIndex].sets.findIndex(S=>!S.isWarmup);if(e.setIndex>0&&e.setIndex>r&&r!==-1){let S=yield this.alertService.showConfirm("Add Warm-up Set","You are past the first working set. Adding a warm-up set now will insert it before the current set. Continue?");if(!S||!S.data)return}let o={id:`warmup-${Date.now()}-${Math.random().toString(36).substring(2,7)}`,isWarmup:!0,reps:8,weight:0,duration:void 0,restAfterSet:30,notes:"Warm-up set"},m=JSON.parse(JSON.stringify(t));m.exercises[e.exerciseIndex].sets.splice(e.setIndex,0,o),this.routine.set(m),this.toastService.success("Warm-up set added. Fill details & complete.",4e3,"Warm-up Added"),yield this.prepareCurrentSet(),this.closeWorkoutMenu(),this.closePerformanceInsights()})}getSets(){let t=this.activeSetInfo(),e=t?.exerciseData.sets||[];return t?.setData.isWarmup?e.filter(i=>!i.isWarmup):e}getWarmUpSets(){let t=this.activeSetInfo(),e=t?.exerciseData.sets||[];return t?.setData.isWarmup?e.filter(i=>i.isWarmup):[]}getTotalWarmupSetsForCurrentExercise=D(()=>{let t=this.routine(),e=this.currentExerciseIndex();return t&&t.exercises[e]?t.exercises[e].sets.filter(i=>i.isWarmup).length:0});canAddWarmupSet=D(()=>{let t=this.activeSetInfo(),e=this.routine();if(!t||!e||this.sessionState()==="paused")return!1;let i=e.exercises[t.exerciseIndex].sets;for(let r=0;r<=t.setIndex;r++)if(!i[r].isWarmup&&this.getTotalWarmupSetsForCurrentExercise()>0)return!1;return!0});getIconPath(t){return this.exerciseService.getIconPath(t)}toggleWorkoutMenu(){this.sessionState()==="paused"&&!this.isWorkoutMenuVisible()||this.sessionState()==="paused"&&this.isWorkoutMenuVisible()||(this.isWorkoutMenuVisible.update(t=>!t),this.isWorkoutMenuVisible()&&this.isPerformanceInsightsVisible.set(!1))}closeWorkoutMenu(){this.isWorkoutMenuVisible.set(!1)}skipCurrentSet(){return P(this,null,function*(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Resume to skip set.",3e3,"Paused");return}let t=this.activeSetInfo(),e=this.routine();if(!t||!e){this.toastService.error("Cannot skip set: No active set information.",0,"Error");return}let i=yield this.alertService.showConfirm("Skip Current Set",`Skip current ${t.isWarmup?"warm-up":"set "+this.getCurrentWorkingSetNumber()} of "${t.exerciseData.exerciseName}"? It won't be logged.`);!i||!i.data||(this.toastService.info(`Skipped set of ${t.exerciseData.exerciseName}.`,2e3),this.resetTimedSet(),this.navigateToNextStepInWorkout(t,e),this.closeWorkoutMenu(),this.closePerformanceInsights())})}skipCurrentExercise(){return P(this,null,function*(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Resume to skip exercise.",3e3,"Paused");return}let t=this.activeSetInfo(),e=this.routine();if(!t||!e){this.toastService.error("Cannot skip exercise: No active exercise information.",0,"Error");return}let i=yield this.alertService.showConfirm("Skip Current Exercise",`Skip all remaining sets of "${t.exerciseData.exerciseName}" for this round?`);if(!i||!i.data)return;this.toastService.info(`Skipped exercise ${t.exerciseData.exerciseName}.`,3e3);let r=t.exerciseIndex,o=this.findNextExerciseBlockStartIndex(r,e);if(o!==-1){this.currentExerciseIndex.set(o),this.currentSetIndex.set(0),this.currentBlockRound.set(1);let m=e.exercises[o];if(!m.supersetId||m.supersetOrder===0)this.totalBlockRounds.set(m.rounds??1);else{let p=e.exercises.find(S=>S.supersetId===m.supersetId&&S.supersetOrder===0);this.totalBlockRounds.set(p?.rounds??1)}this.lastPerformanceForCurrentExercise=null,this.prepareCurrentSet()}else this.finishWorkout();this.closeWorkoutMenu(),this.closePerformanceInsights()})}finishWorkoutEarly(){return P(this,null,function*(){if(this.sessionState()==="paused"){this.toastService.warning("Please resume before finishing early.",3e3,"Paused");return}let t=yield this.alertService.showConfirm("Finish Workout Early","Finish workout now? Current progress will be saved.");t&&t.data&&(this.closeWorkoutMenu(),this.closePerformanceInsights(),(yield this.finishWorkoutAndReportStatus())||(this.toastService.info("Workout finished early. Paused session cleared.",4e3),this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),this.router.url.includes("/play")&&this.router.navigate(["/workout"])))})}finishWorkoutAndReportStatus(){return P(this,null,function*(){if(this.stopAutoSave(),this.sessionState()==="paused")return this.toastService.warning("Please resume workout before finishing.",3e3,"Session Paused"),!1;if(this.sessionState()==="loading")return this.toastService.info("Workout is still loading.",3e3,"Loading"),!1;if(this.currentWorkoutLogExercises().length===0)return this.toastService.info("No sets logged. Workout not saved.",3e3,"Empty Workout"),this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),this.router.url.includes("/play")&&this.router.navigate(["/workout"]),!1;this.timerSub&&this.timerSub.unsubscribe();let t=this.routine(),e=this.currentWorkoutLogExercises(),i=!0,r=!1,o=!1,m=t?.name?`${t.name} - ${q(new Date,"MMM d")}`:`Ad-hoc Workout - ${q(new Date,"MMM d, HH:mm")}`;if(this.routineId&&this.originalRoutineSnapshot&&this.originalRoutineSnapshot.length>0&&t){if(this.comparePerformedToOriginal(e,this.originalRoutineSnapshot).majorDifference){let W=yield this.alertService.showConfirmationDialog("Workout Modified",`This workout differed from the original "${t.name}". How would you like to proceed?`,[{text:"Save as New Routine",role:"confirm",data:"new",cssClass:"bg-green-500 hover:bg-green-600 text-white"},{text:"Update Original Routine",role:"confirm",data:"update_original",cssClass:"bg-orange-500 hover:bg-orange-600 text-white"},{text:"Log (Keep Original Structure)",role:"confirm",data:"log_only",cssClass:"bg-blue-500 hover:bg-blue-600 text-white"},{text:"Cancel Finish (Keep Active)",role:"cancel",data:"cancel_finish",cssClass:"bg-gray-300 hover:bg-gray-400"}]);if(W&&W.data==="new"){r=!0;let J=yield this.alertService.showPromptDialog("New Routine Name","Enter a name for this new routine:",[{name:"newRoutineName",type:"text",placeholder:"E.g., My Custom Workout",value:m}],"Save New Routine");J&&String(J.newRoutineName).trim()?m=String(J.newRoutineName).trim():!J&&W.data==="new"?this.toastService.warning("New routine name not provided. Saving with default name.",3e3):J||(i=!1)}else W&&W.data==="update_original"?(o=!0,this.toastService.info(`Original routine "${t.name}" will be updated with this session's structure.`,3e3,"Updating Original")):W&&W.data==="log_only"||(i=!1)}}else if(!this.routineId&&e.length>0){r=!0;let O=yield this.alertService.showPromptDialog("Save Ad-hoc Workout","Enter a name for this new routine:",[{name:"newRoutineName",type:"text",placeholder:m,value:m}],"Save New Routine");O&&String(O.newRoutineName).trim()?m=String(O.newRoutineName).trim():O||(i=!1)}if(!i)return this.toastService.info("Finish workout cancelled. Session remains active/paused.",3e3,"Cancelled"),this.sessionState()==="playing"&&this.startAutoSave(),!1;let p=Date.now(),S=this.workoutStartTime-this.sessionTimerElapsedSecondsBeforePause*1e3,_=Math.round((p-S)/(1e3*60)),v=this.routineId||void 0,w=t?.name||"Ad-hoc Workout";if(r){let O={name:m,description:t?.description||"Workout performed on "+q(new Date,"MMM d, yyyy"),goal:t?.goal||"custom",exercises:this.convertLoggedToWorkoutExercises(e)},W=this.workoutService.addRoutine(O);v=W.id,w=W.name,this.toastService.success(`New routine "${W.name}" created.`,4e3)}let T={routineId:v,routineName:w,date:q(new Date(S),"yyyy-MM-dd"),startTime:S,endTime:p,durationMinutes:_,exercises:this.currentWorkoutLogExercises(),notes:t?.notes},A=this.trackingService.addWorkoutLog(T);if(this.toastService.success("Congrats! Workout completed!",5e3,"Workout Finished"),v){let O=yield X(this.workoutService.getRoutineById(v).pipe(N(1)));if(O){let W=L(B({},O),{lastPerformed:new Date(S).toISOString()});o&&!r&&this.routineId===v&&(W.exercises=this.convertLoggedToWorkoutExercises(e),t&&(W.name=t.name,W.description=t.description,W.goal=t.goal),this.toastService.info(`Routine "${W.name}" structure updated.`,3e3)),this.workoutService.updateRoutine(W)}}return this.isSessionConcluded=!0,this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),this.router.navigate(["/workout/summary",A.id]),!0})}quitWorkout(){return P(this,null,function*(){let t=yield this.alertService.showConfirm("Quit Workout","Quit workout? Unsaved progress (if not paused) will be lost.");t&&t.data&&(this.stopAutoSave(),this.timerSub&&this.timerSub.unsubscribe(),this.timedSetIntervalSub&&this.timedSetIntervalSub.unsubscribe(),this.isRestTimerVisible.set(!1),this.isSessionConcluded=!0,this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),this.closeWorkoutMenu(),this.closePerformanceInsights(),this.router.navigate(["/workout"]),this.toastService.info("Workout quit. No progress saved for this session.",4e3))})}toggleCompletedSetsInfo(){this.showCompletedSetsInfo.update(t=>!t)}openPerformanceInsights(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Resume to view insights.",3e3,"Paused");return}this.isPerformanceInsightsVisible.set(!0),this.isWorkoutMenuVisible.set(!1)}closePerformanceInsights(){this.isPerformanceInsightsVisible.set(!1),this.editingTarget&&this.cancelEditTarget()}openPerformanceInsightsFromMenu(){this.closeWorkoutMenu(),this.openPerformanceInsights()}goBack(){this.currentWorkoutLogExercises().length>0&&this.sessionState()==="playing"?this.alertService.showConfirm("Exit Workout?","You have an active workout. Are you sure you want to exit? Your progress might be lost unless you pause first.").then(t=>{t&&t.data&&this.router.navigate(["/workout"])}):this.router.navigate(["/workout"])}incrementWeight(t=.5){let e=t,i=this.csf.actualWeight.value??0;this.currentSetForm.patchValue({actualWeight:parseFloat((i+e).toFixed(2))})}decrementWeight(t=.5){let e=t,i=this.csf.actualWeight.value??0;this.currentSetForm.patchValue({actualWeight:Math.max(0,parseFloat((i-e).toFixed(2)))})}incrementReps(t=1){let e=t,i=this.csf.actualReps.value??0;this.currentSetForm.patchValue({actualReps:i+e})}decrementReps(t=1){let e=t,i=this.csf.actualReps.value??0;this.currentSetForm.patchValue({actualReps:Math.max(0,i-e)})}toggleRpeInput(){this.showRpeSlider.update(t=>!t)}updateRpe(t){let e=typeof t=="string"?parseInt(t,10):t;e!==null&&!isNaN(e)&&e>=1&&e<=10?(this.rpeValue.set(e),this.currentSetForm.patchValue({rpe:e})):e===null&&(this.rpeValue.set(null),this.currentSetForm.patchValue({rpe:null}))}startAutoSave(){Y(this.platformId)&&(this.autoSaveSub&&this.autoSaveSub.unsubscribe(),this.autoSaveSub=ot(this.AUTO_SAVE_INTERVAL_MS).subscribe(()=>{this.sessionState()==="playing"&&this.routine()&&(console.log("Auto-saving workout state..."),this.savePausedSessionState())}))}stopAutoSave(){this.autoSaveSub&&(this.autoSaveSub.unsubscribe(),this.autoSaveSub=void 0)}isInitialLoadComplete=!1;ngOnInit(){return P(this,null,function*(){Y(this.platformId)&&window.scrollTo(0,0),console.log("WorkoutPlayer ngOnInit - Start"),(yield this.checkForPausedSession(!1))?(console.log("WorkoutPlayer ngOnInit - Resumed paused session."),this.isInitialLoadComplete=!0):(console.log("WorkoutPlayer ngOnInit - No paused session resumed, proceeding to load from route."),this.loadNewWorkoutFromRoute()),Y(this.platformId)&&(this.routerEventsSub=this.router.events.pipe(st(e=>e instanceof gt),ne(e=>P(this,null,function*(){console.log("WorkoutPlayer RouterEvent - NavigationEnd:",e.urlAfterRedirects);let i=this.route.snapshot,r=e.urlAfterRedirects.startsWith("/workout/play/"),o=i.paramMap.get("routineId");r&&(this.routineId===o&&this.isInitialLoadComplete&&this.sessionState()!=="playing"?(console.log("WorkoutPlayer RouterEvent - Re-entered same workout, checking for pause state."),!(yield this.checkForPausedSession(!0))&&this.sessionState()!=="playing"&&(console.log("WorkoutPlayer RouterEvent - No pause state resumed on re-entry, reloading route.",o),this.loadNewWorkoutFromRoute())):this.routineId!==o&&console.log("WorkoutPlayer RouterEvent - Navigated to new routineId, ensuring loadNewWorkoutFromRoute runs."))}))).subscribe())})}loadNewWorkoutFromRoute(){return P(this,null,function*(){console.log("loadNewWorkoutFromRoute - Called."),this.isInitialLoadComplete=!1,this.sessionState.set("loading"),this.stopAutoSave(),this.timerSub&&this.timerSub.unsubscribe(),this.timedSetIntervalSub&&this.timedSetIntervalSub.unsubscribe(),this.isRestTimerVisible.set(!1),this.workoutStartTime=Date.now(),this.sessionTimerElapsedSecondsBeforePause=0,this.originalRoutineSnapshot=[],this.currentWorkoutLogExercises.set([]),this.currentExerciseIndex.set(0),this.currentSetIndex.set(0),this.currentBlockRound.set(1),this.totalBlockRounds.set(1),this.routine.set(void 0),this.routeSub&&this.routeSub.unsubscribe(),this.routeSub=this.route.paramMap.pipe(se(t=>{let e=t.get("routineId");if(console.log("loadNewWorkoutFromRoute - paramMap emitted, newRoutineId:",e),!e)return this.toastService.error("No routine specified to play.",0,"Error"),this.router.navigate(["/workout"]),Z(null);if(this.routineId===e&&this.routine())if(this.sessionState()!=="playing")console.log("loadNewWorkoutFromRoute - Same routineId, re-preparing set for state:",this.sessionState());else return console.log("loadNewWorkoutFromRoute - Same routineId, already playing. No action."),Z(this.routine());return this.routineId=e,this.workoutService.getRoutineById(this.routineId).pipe(ve(i=>i?(this.originalRoutineSnapshot=JSON.parse(JSON.stringify(i.exercises)),JSON.parse(JSON.stringify(i))):null))}),ne(t=>P(this,null,function*(){if(this.sessionState()==="paused"){console.log("loadNewWorkoutFromRoute - tap: Session is paused, skipping setup."),this.isInitialLoadComplete=!0;return}if(t){if(console.log("loadNewWorkoutFromRoute - tap: Processing routine - ",t.name),this.routine.set(t),t.exercises.length>0){let e=t.exercises[0];if(!e.supersetId||e.supersetOrder===0)this.totalBlockRounds.set(e.rounds??1);else{let i=t.exercises.find(r=>r.supersetId===e.supersetId&&r.supersetOrder===0);this.totalBlockRounds.set(i?.rounds??1)}}else this.totalBlockRounds.set(1);this.currentExerciseIndex.set(0),this.currentSetIndex.set(0),this.currentBlockRound.set(1),this.currentWorkoutLogExercises.set([]),yield this.prepareCurrentSet(),this.sessionState.set("playing"),this.startSessionTimer(),this.startAutoSave()}else this.routineId&&(console.error("loadNewWorkoutFromRoute - tap: Failed to load routine for ID:",this.routineId),this.routine.set(null),this.sessionState.set("error"),this.toastService.error("Failed to load workout routine.",0,"Load Error"),this.router.navigate(["/workout"]),this.stopAutoSave());this.isInitialLoadComplete=!0}))).subscribe()})}checkForPausedSession(t=!1){return P(this,null,function*(){let e=this.storageService.getItem(this.PAUSED_WORKOUT_KEY),i=this.route.snapshot.paramMap.get("routineId"),r=this.route.snapshot.queryParamMap.get("resume")==="true";if(console.log("WorkoutPlayer.checkForPausedSession - Entry. isReEntry:",t,"resumeQueryParam:",r,"Paused State Exists:",!!e,"Paused Version Match:",e?.version===this.PAUSED_STATE_VERSION,"Paused Routine ID:",e?.routineId,"Route Routine ID:",i,"Paused Workout Date:",e?.workoutDate),e&&e.version===this.PAUSED_STATE_VERSION){if(i&&e.routineId===null)return console.log("WorkoutPlayer.checkForPausedSession - Current route is for a specific routine, but paused session was ad-hoc. Discarding paused session."),this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),!1;if(!i&&e.routineId!==null)return console.log("WorkoutPlayer.checkForPausedSession - Current route is ad-hoc, but paused session was for a specific routine. Discarding paused session."),this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),!1;if(i&&e.routineId&&i!==e.routineId)return console.log("WorkoutPlayer.checkForPausedSession - Paused session routine ID does not match current route routine ID. Discarding paused session."),this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),!1;let o=!1;if(r)console.log("WorkoutPlayer.checkForPausedSession - `resume=true` query param found. Attempting direct resume."),o=!0,this.router.navigate([],{relativeTo:this.route,queryParams:{resume:null},queryParamsHandling:"merge",replaceUrl:!0});else if(t)console.log("WorkoutPlayer.checkForPausedSession - Re-entry detected for matching routine. Attempting direct resume."),o=!0;else{let m=e.sessionRoutine?.name||"a previous session",p=e.workoutDate?` from ${q(new Date(e.workoutDate),"MMM d, yyyy HH:mm")}`:"",S=[{text:"Discard",role:"cancel",data:!1,cssClass:"bg-gray-300 hover:bg-gray-500"},{text:"Resume",role:"confirm",data:!0,cssClass:"bg-green-500 hover:bg-green-600 text-white"}],_=yield this.alertService.showConfirmationDialog("Resume Workout?",`You have a paused workout session for "${m}"${p}. Resume?`,S);o=!!(_&&_.data===!0)}return o?(console.log("WorkoutPlayer.checkForPausedSession - Proceeding to load paused state."),this.stopAllActivity(),this.routeSub&&this.routeSub.unsubscribe(),yield this.loadStateFromPausedSession(e),this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),this.isInitialLoadComplete=!0,!0):(console.log("WorkoutPlayer.checkForPausedSession - Paused session not loaded (discarded by user or not auto-resumed)."),this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),this.toastService.info("Paused session discarded.",3e3),!1)}return console.log("WorkoutPlayer.checkForPausedSession - No valid paused session found in storage."),!1})}stopAllActivity(){console.log("stopAllActivity - Stopping timers and auto-save."),this.stopAutoSave(),this.timerSub&&this.timerSub.unsubscribe(),this.timedSetIntervalSub&&this.timedSetIntervalSub.unsubscribe(),this.isRestTimerVisible.set(!1)}resumeSession(){return P(this,null,function*(){this.sessionState()==="paused"?(console.log("resumeSession button clicked - transitioning from Paused to Playing"),this.workoutStartTime=Date.now(),this.sessionState.set("playing"),this.startSessionTimer(),this.startAutoSave(),this.wasTimedSetRunningOnPause&&this.timedSetTimerState()==="paused"&&this.startOrResumeTimedSet(),this.wasTimedSetRunningOnPause=!1,this.wasRestTimerVisibleOnPause&&this.restTimerRemainingSecondsOnPause>0&&this.startRestPeriod(this.restTimerRemainingSecondsOnPause,!0),this.wasRestTimerVisibleOnPause=!1,this.closeWorkoutMenu(),this.closePerformanceInsights(),this.toastService.info("Workout session resumed.",3e3)):(console.log("resumeSession called but not in Paused state. Current state:",this.sessionState()),!(yield this.checkForPausedSession(!0))&&this.sessionState()!=="playing"&&this.routineId&&this.loadNewWorkoutFromRoute())})}ngOnDestroy(){this.routeSub&&this.routeSub.unsubscribe(),this.timerSub&&this.timerSub.unsubscribe(),this.timedSetIntervalSub&&this.timedSetIntervalSub.unsubscribe(),this.routerEventsSub&&this.routerEventsSub.unsubscribe(),this.stopAutoSave(),this.isRestTimerVisible.set(!1),Y(this.platformId)&&!this.isSessionConcluded&&(this.sessionState()==="playing"||this.sessionState()==="paused")&&this.routine()&&this.currentWorkoutLogExercises().length>0&&(console.log("WorkoutPlayer ngOnDestroy - Saving state (session not formally concluded)... State:",this.sessionState()),this.savePausedSessionState())}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=G({type:n,selectors:[["app-workout-player"]],hostBindings:function(e,i){e&1&&f("beforeunload",function(o){return i.unloadNotification(o)},dt)},features:[Ce([te])],decls:6,vars:8,consts:[["loadingOrError",""],["routineNotFound",""],["workoutCompleteOrError",""],["loadingBaseExIcon",""],["class","workout-player-container bg-gray-50 dark:bg-gray-950 min-h-screen flex flex-col",4,"ngIf","ngIfElse"],[3,"timerFinished","timerSkipped","isVisible","durationSeconds","mainText","nextUpText"],["class","fixed inset-0 z-50 bg-black/70 backdrop-blur-md flex flex-col items-center justify-center p-4 space-y-3 sm:space-y-4",4,"ngIf"],["style","z-index: 100","class","fixed inset-0 bg-gray-800/80 dark:bg-black/80 backdrop-blur-sm flex items-center justify-center p-4",4,"ngIf"],[1,"workout-player-container","bg-gray-50","dark:bg-gray-950","min-h-screen","flex","flex-col"],["class","fixed inset-0 z-[60] bg-black/70 backdrop-blur-sm flex flex-col items-center justify-center space-y-6 p-4",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"fixed","inset-0","z-[60]","bg-black/70","backdrop-blur-sm","flex","flex-col","items-center","justify-center","space-y-6","p-4"],[1,"text-4xl","font-bold","text-white"],[1,"text-lg","text-gray-200"],[1,"bg-green-500","hover:bg-green-600","text-white","font-bold","py-3","px-8","rounded-lg","text-xl","shadow-lg","w-full","max-w-xs",3,"click"],[1,"text-sm","text-red-300","hover:text-red-100","font-medium","py-2","px-4","rounded-md","border","border-red-300","hover:bg-red-700/30","w-full","max-w-xs","mt-2",3,"click"],[1,"fixed","top-0","left-0","right-0","z-30","bg-gray-50","dark:bg-gray-950","border-b","border-gray-200","dark:border-gray-800","p-2","flex","items-center","justify-between","h-14"],[1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-ml-1",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"text-center"],[1,"text-sm","font-semibold","text-gray-700","dark:text-gray-300","uppercase","tracking-wider","truncate","max-w-[calc(100vw-120px)]",3,"title"],[1,"text-xs","text-gray-500","dark:text-gray-400"],[1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-mr-1","disabled:opacity-50",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-6","w-6"],["stroke-linecap","round","stroke-linejoin","round","d","M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"],[1,"flex-grow","overflow-y-auto","pt-10"],["class","p-4 max-w-md mx-auto",4,"ngIf","ngIfElse"],["class","fixed bottom-0 left-0 right-0 z-30 bg-gray-50 dark:bg-gray-950 border-t border-gray-200 dark:border-gray-800 p-3 text-center h-auto min-h-[70px] flex flex-col justify-center",4,"ngIf"],[1,"p-4","max-w-md","mx-auto"],[1,"flex","text-center","justify-center","items-center","mb-1"],["class","mr-2 h-8 w-8 flex-shrink-0",4,"ngIf"],[1,"text-2xl","font-bold","text-gray-800","dark:text-gray-100","truncate",3,"title"],[1,"text-center","mb-4"],[1,"text-sm","text-gray-500","dark:text-gray-400"],["class","text-blue-500 dark:text-blue-400",4,"ngIf"],[4,"ngIf"],["class","ml-2",4,"ngIf"],["class","ml-2 text-purple-500 dark:text-purple-400 italic",4,"ngIf"],[1,"space-y-6","mb-8",3,"formGroup"],["class","pt-4",4,"ngIf"],[1,"w-full","bg-red-500","hover:bg-red-600","text-white","font-bold","py-4","px-4","rounded-2xl","shadow-md","text-lg","transition-colors","focus:outline-none","focus:ring-2","focus:ring-red-400","disabled:opacity-50",3,"click","disabled"],[1,"mr-2","h-8","w-8","flex-shrink-0"],["class","w-full h-full object-contain",3,"src","alt","ngClass",4,"ngIf"],[1,"w-full","h-full","object-contain",3,"src","alt","ngClass"],[1,"w-8","h-8","bg-gray-200","dark:bg-gray-700","rounded-md","animate-pulse","mr-2","flex-shrink-0"],[1,"text-blue-500","dark:text-blue-400"],[1,"ml-2"],[1,"ml-2","text-purple-500","dark:text-purple-400","italic"],[1,"block","text-xs","font-medium","text-gray-500","dark:text-gray-400","uppercase","tracking-wider","text-center","mb-2"],[1,"flex","items-center","justify-center","space-x-3"],["type","button",1,"p-3","bg-gray-200","dark:bg-gray-700","rounded-lg","text-gray-700","dark:text-gray-200","hover:bg-gray-300","dark:hover:bg-gray-600","disabled:opacity-50",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M20 12H4"],["type","number","formControlName","actualWeight","readonly","","placeholder","0",1,"w-28","text-center","text-3xl","font-bold","bg-transparent","border-none","p-0","focus:ring-0","text-gray-800","dark:text-gray-100"],[1,"text-lg","text-gray-700","dark:text-gray-200","-ml-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],["type","number","formControlName","actualReps","readonly","","placeholder","0",1,"w-28","text-center","text-3xl","font-bold","bg-transparent","border-none","p-0","focus:ring-0","text-gray-800","dark:text-gray-100"],["for","timedSetDisplay",1,"block","text-xs","font-medium","text-gray-500","dark:text-gray-400","uppercase","tracking-wider","text-center","mb-2"],["id","timedSetDisplay",1,"mt-1","block","w-full","p-3","border-none","text-3xl","font-bold","text-center","bg-transparent","focus:ring-0",3,"ngClass"],["type","number","formControlName","actualDuration",1,"hidden"],[1,"flex","space-x-2","mt-2","justify-center"],["type","button",1,"flex-grow","max-w-[150px]","text-white","font-medium","py-2","px-3","rounded-md","transition-colors","text-sm","disabled:opacity-50",3,"click","disabled","ngClass"],["type","button","class","flex-grow max-w-[150px] bg-gray-300 hover:bg-gray-400 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 font-medium py-2 px-3 rounded-md transition-colors text-sm disabled:opacity-50",3,"disabled","click",4,"ngIf"],["type","button",1,"flex-grow","max-w-[150px]","bg-gray-300","hover:bg-gray-400","dark:bg-gray-600","dark:hover:bg-gray-500","text-gray-800","dark:text-gray-200","font-medium","py-2","px-3","rounded-md","transition-colors","text-sm","disabled:opacity-50",3,"click","disabled"],[1,"pt-4"],["type","button",1,"w-full","text-center","text-sm","text-gray-500","dark:text-gray-400","hover:text-primary","dark:hover:text-primary-light","mb-2",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"inline","h-4","w-4","ml-1","text-gray-400","dark:text-gray-500"],["stroke-linecap","round","stroke-linejoin","round","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],["class","mt-2 px-2",4,"ngIf"],[1,"mt-2","px-2"],["type","range","min","1","max","10","step","1","formControlName","rpe",1,"w-full","h-2","bg-gray-300","dark:bg-gray-700","rounded-lg","appearance-none","cursor-pointer","[&::-webkit-slider-thumb]:bg-red-500","[&::-moz-range-thumb]:bg-red-500",3,"ngModelChange","ngModel"],[1,"flex","justify-between","text-xs","text-gray-500","dark:text-gray-400","px-1","mt-1"],[1,"font-semibold","text-red-500"],[1,"text-center","py-10","pt-16"],[1,"text-2xl","font-semibold","text-gray-700","dark:text-gray-200"],["class","text-gray-600 dark:text-gray-400 mt-2",4,"ngIf"],["class","mt-6 bg-primary hover:bg-primary-dark text-white font-bold py-3 px-6 rounded-lg shadow-md text-lg transition-colors",3,"click",4,"ngIf"],["routerLink","/profile","class","text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-primary-light p-2 -ml-1",4,"ngIf"],[1,"text-gray-600","dark:text-gray-400","mt-2"],[1,"mt-6","bg-primary","hover:bg-primary-dark","text-white","font-bold","py-3","px-6","rounded-lg","shadow-md","text-lg","transition-colors",3,"click"],["routerLink","/profile",1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-ml-1"],[1,"fixed","bottom-0","left-0","right-0","z-30","bg-gray-50","dark:bg-gray-950","border-t","border-gray-200","dark:border-gray-800","p-3","text-center","h-auto","min-h-[70px]","flex","flex-col","justify-center"],[1,"text-xs","font-semibold","text-gray-500","dark:text-gray-400","uppercase","tracking-wider"],[1,"text-lg","font-medium","text-gray-800","dark:text-gray-100","truncate","px-4",3,"title"],[1,"text-sm","text-gray-600","dark:text-gray-300"],[1,"ml-2","text-xs","text-primary","dark:text-primary-light","hover:underline",3,"click"],[1,"fixed","top-0","left-0","right-0","z-30","bg-gray-50","dark:bg-gray-950","border-b","border-gray-200","dark:border-gray-800","p-4","flex","items-center","justify-between","h-16"],[1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-ml-2",3,"click"],[1,"text-sm","font-semibold","text-gray-700","dark:text-gray-300","uppercase","tracking-wider"],[1,"w-6"],[1,"text-center","py-20","pt-24"],[1,"text-2xl","font-semibold","text-red-600","dark:text-red-400","mb-4"],[1,"text-gray-600","dark:text-gray-400"],["routerLink","/workout",1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-ml-1"],[1,"fixed","inset-0","z-50","bg-black/70","backdrop-blur-md","flex","flex-col","items-center","justify-center","p-4","space-y-3","sm:space-y-4"],[1,"text-2xl","sm:text-3xl","font-bold","text-white","mb-2","sm:mb-4"],[1,"w-full","max-w-xs","sm:max-w-sm","bg-yellow-500","hover:bg-yellow-600","text-white","font-bold","py-3","px-6","rounded-lg","text-lg","sm:text-xl","shadow-lg","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","max-w-xs","sm:max-w-sm","bg-cyan-500","hover:bg-cyan-600","text-white","font-semibold","py-2.5","sm:py-3","px-6","rounded-lg","text-md","sm:text-lg","shadow-md","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","max-w-xs","sm:max-w-sm","bg-sky-500","hover:bg-sky-600","text-white","font-semibold","py-2.5","sm:py-3","px-6","rounded-lg","text-md","sm:text-lg","shadow-md","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","max-w-xs","sm:max-w-sm","bg-blue-500","hover:bg-blue-600","text-white","font-semibold","py-2.5","sm:py-3","px-6","rounded-lg","text-md","sm:text-lg","shadow-md","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","max-w-xs","sm:max-w-sm","bg-indigo-500","hover:bg-indigo-600","text-white","font-semibold","py-2.5","sm:py-3","px-6","rounded-lg","text-md","sm:text-lg","shadow-md","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","max-w-xs","sm:max-w-sm","bg-teal-500","hover:bg-teal-600","text-white","font-semibold","py-2.5","sm:py-3","px-6","rounded-lg","text-md","sm:text-lg","shadow-md","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","max-w-xs","sm:max-w-sm","text-red-300","hover:text-red-100","font-medium","py-2.5","sm:py-3","px-6","rounded-lg","border","border-red-400","hover:bg-red-700/50","text-md","sm:text-lg",3,"click"],[1,"mt-4","sm:mt-6","text-gray-300","hover:text-white","font-medium","py-2","px-4","rounded-md","text-sm",3,"click"],[1,"fixed","inset-0","bg-gray-800/80","dark:bg-black/80","backdrop-blur-sm","flex","items-center","justify-center","p-4",2,"z-index","100"],[1,"bg-white","dark:bg-gray-800","rounded-lg","shadow-2xl","w-full","max-w-lg","max-h-[90vh]","flex","flex-col"],[1,"p-4","border-b","border-gray-200","dark:border-gray-700","flex","justify-between","items-center"],[1,"text-xl","font-semibold","text-gray-800","dark:text-gray-100"],[1,"p-1","rounded-full","text-gray-500","hover:text-gray-700","dark:text-gray-400","dark:hover:text-gray-200","hover:bg-gray-200","dark:hover:bg-gray-700","focus:outline-none",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M6 18L18 6M6 6l12 12"],["class","p-4 pt-1 overflow-y-auto",4,"ngIf"],[1,"p-4","border-t","border-gray-200","dark:border-gray-700","text-right"],[1,"bg-primary","hover:bg-primary-dark","text-white","font-semibold","py-2","px-6","rounded-md","text-sm",3,"click"],[1,"p-4","pt-1","overflow-y-auto"],[1,"mb-3"],[1,"text-xs","text-primary","dark:text-primary-light","hover:underline",3,"click"],["class","mb-4 mt-1 space-y-2 max-h-32 overflow-y-auto p-2 border dark:border-gray-700 rounded-md bg-gray-50 dark:bg-gray-700",4,"ngIf"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-2"],["class","col-span-full pt-2 text-xs",4,"ngIf"],["class","col-span-full mt-2 pt-2 border-t border-dashed border-gray-300 dark:border-gray-600 text-xs",4,"ngIf"],["class","col-span-2 md:col-span-2 mt-2 pt-2 border-t border-dashed border-gray-300 dark:border-gray-600",4,"ngIf"],[1,"mb-4","mt-1","space-y-2","max-h-32","overflow-y-auto","p-2","border","dark:border-gray-700","rounded-md","bg-gray-50","dark:bg-gray-700"],["class","p-1.5 border-b border-gray-200 dark:border-gray-600 last:border-b-0 text-xs",4,"ngFor","ngForOf"],[1,"p-1.5","border-b","border-gray-200","dark:border-gray-600","last:border-b-0","text-xs"],[1,"font-medium","text-gray-600","dark:text-gray-200","mb-0.5"],["class","mr-3",4,"ngIf"],["class","mt-1 text-gray-500 dark:text-gray-400 italic",4,"ngIf"],[1,"mr-3"],[1,"text-gray-700","dark:text-gray-300"],[1,"mt-1","text-gray-500","dark:text-gray-400","italic"],[1,"col-span-full","pt-2","text-xs"],[1,"font-medium","text-gray-500","dark:text-gray-400"],[1,"list-disc","list-inside","ml-2","text-gray-500","dark:text-gray-400"],[1,"text-gray-500","dark:text-gray-400","italic"],[1,"col-span-full","mt-2","pt-2","border-t","border-dashed","border-gray-300","dark:border-gray-600","text-xs"],[1,"font-medium","text-gray-500","dark:text-gray-400","mb-1"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-x-4","gap-y-1"],[4,"ngFor","ngForOf"],[1,"text-gray-500","dark:text-gray-400"],[1,"text-gray-400","dark:text-gray-500","text-2xs","ml-1"],[1,"col-span-2","md:col-span-2","mt-2","pt-2","border-t","border-dashed","border-gray-300","dark:border-gray-600"],[1,"block","text-sm","text-gray-500","dark:text-gray-400","mb-1"],["class","text-2xl font-bold text-gray-800 dark:text-gray-100 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 p-1 rounded",3,"click",4,"ngIf"],["class","flex items-center space-x-1",4,"ngIf"],[1,"text-2xl","font-bold","text-gray-800","dark:text-gray-100","cursor-pointer","hover:bg-gray-200","dark:hover:bg-gray-600","p-1","rounded",3,"click"],[1,"flex","items-center","space-x-1"],["type","number","autofocus","",1,"w-20","p-1","text-xl","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-600",3,"ngModelChange","keyup.enter","keyup.escape","ngModel"],[1,"p-1","text-green-500","hover:text-green-700",3,"click"],[1,"p-1","text-red-500","hover:text-red-700",3,"click"],[1,"text-lg"],[1,"text-lg","font-semibold","text-gray-800","dark:text-gray-100","p-1"],[1,"text-center","py-20"],[1,"text-xl","text-gray-600","dark:text-gray-400"]],template:function(e,i){if(e&1){let r=b();h(0,or,5,3,"div",4),s(1,"app-full-screen-rest-timer",5),f("timerFinished",function(){return x(r),g(i.handleRestTimerFinished())})("timerSkipped",function(){return x(r),g(i.handleRestTimerSkipped())}),a(),h(2,sr,19,6,"div",6)(3,Fr,12,1,"div",7)(4,Dr,3,0,"ng-template",null,0,z)}if(e&2){let r=Q(5);c("ngIf",i.routine()!==void 0)("ngIfElse",r),l(),c("isVisible",i.isRestTimerVisible())("durationSeconds",i.restDuration())("mainText",i.restTimerMainText())("nextUpText",i.restTimerNextUpText()),l(),c("ngIf",i.isWorkoutMenuVisible()),l(),c("ngIf",i.isPerformanceInsightsVisible())}},dependencies:[K,Pe,ee,H,te,ce,Re,$e,Oe,Ve,Ae,St,Fe,De,Ne,Be,Ue,Me,ze,Je],encapsulation:2})};function Mr(n,t){if(n&1&&(s(0,"div",10)(1,"span",11),u(2,"Total Volume:"),a(),s(3,"span",12),u(4),F(5,"number"),a()()),n&2){let e=d(2);l(4),U("",$(5,2,e.sessionTotalVolume(),"1.0-0")," ",e.unitsService.getUnitLabel())}}function Or(n,t){if(n&1&&(s(0,"li",25)(1,"p",26),u(2),a(),s(3,"p",27),u(4),a()()),n&2){let e=t.$implicit;l(2),U("",e.exerciseName," - ",e.pbType," "),l(2),V(e.value)}}function Ar(n,t){if(n&1&&(s(0,"div",21)(1,"h2",22),u(2," \u{1F389} New Personal Bests! \u{1F389} "),a(),s(3,"ul",23),h(4,Or,5,3,"li",24),a()()),n&2){let e=d(2);l(4),c("ngForOf",e.sessionPBs())}}function Nr(n,t){if(n&1&&(s(0,"div",28)(1,"h3",29),u(2,"Your Notes for this Session:"),a(),s(3,"p",30),u(4),a()()),n&2){let e=d().ngIf;l(4),V(e.notes)}}function Br(n,t){if(n&1){let e=b();le(0),s(1,"div",3)(2,"div",4),C(),s(3,"svg",5),y(4,"path",6),a(),R(),s(5,"h1",7),u(6,"Workout Complete!"),a(),s(7,"p",8),u(8,"Great job on finishing your session."),a()(),s(9,"div",9)(10,"div",10)(11,"span",11),u(12,"Routine:"),a(),s(13,"span",12),u(14),a()(),s(15,"div",10)(16,"span",11),u(17,"Date:"),a(),s(18,"span",12),u(19),F(20,"date"),a()(),s(21,"div",10)(22,"span",11),u(23,"Duration:"),a(),s(24,"span",12),u(25),a()(),h(26,Mr,6,5,"div",13),a(),h(27,Ar,5,1,"div",14)(28,Nr,5,1,"div",15),s(29,"div",16)(30,"button",17),f("click",function(){x(e);let r=d();return g(r.viewFullLog())}),u(31," View Full Log Details "),a(),s(32,"button",18),f("click",function(){x(e);let r=d();return g(r.navigateToRoutines())}),C(),s(33,"svg",19),y(34,"path",20),a()()()(),de()}if(n&2){let e=t.ngIf,i=d();l(14),V(e.routineName||"Ad-hoc Workout"),l(5),V($(20,6,e.startTime,"fullDate")),l(6),k("",e.durationMinutes," minutes"),l(),c("ngIf",i.sessionTotalVolume()>0),l(),c("ngIf",i.sessionPBs().length>0),l(),c("ngIf",e.notes)}}function Lr(n,t){n&1&&(s(0,"div",31)(1,"p",32),u(2,"Loading workout summary..."),a()())}var Ze=class n{route=I(me);router=I(ie);trackingService=I(re);exerciseService=I(fe);statsService=I(Ft);unitsService=I(_e);workoutLog=E(void 0);displayExercisesSummary=E([]);sessionPBs=E([]);sessionTotalVolume=E(0);logId;ngOnInit(){(this.logId?Z(this.logId):this.route.paramMap.pipe(ve(e=>e.get("logId")))).pipe(se(e=>e?this.trackingService.getWorkoutLogById(e):Z(null)),ne(e=>{e?(this.workoutLog.set(e),this.sessionTotalVolume.set(this.statsService.calculateWorkoutVolume(e)),this.prepareDisplayExercisesSummary(e.exercises),this.identifySessionPBs(e)):(this.workoutLog.set(null),this.displayExercisesSummary.set([]),this.sessionPBs.set([]))})).subscribe()}prepareDisplayExercisesSummary(t){if(!t||t.length===0){this.displayExercisesSummary.set([]);return}let e=t.map(i=>this.exerciseService.getExerciseById(i.exerciseId).pipe(ve(r=>{let o=0;return i.sets.forEach(m=>{o+=(m.repsAchieved||0)*(m.weightUsed||0)}),L(B({},i),{baseExercise:r||null,sessionVolume:o})})));nt(e).subscribe({next:i=>this.displayExercisesSummary.set(i),error:i=>{console.error("Error fetching exercise details for summary:",i),this.displayExercisesSummary.set(t.map(r=>L(B({},r),{baseExercise:null,sessionVolume:0})))}})}identifySessionPBs(t){let e=[];this.trackingService.personalBests$.pipe(N(1)).subscribe(i=>{t.exercises.forEach(o=>{let m=i[o.exerciseId];m&&o.sets.forEach(p=>{m.forEach(S=>{S.id===p.id&&S.timestamp===p.timestamp&&p.weightUsed===S.weightUsed&&p.repsAchieved===S.repsAchieved&&e.push({exerciseName:o.exerciseName,pbType:S.pbType,value:this.formatPbValueForSummary(S),isNewOrImproved:!0})})})});let r=Array.from(new Map(e.map(o=>[`${o.exerciseName}-${o.pbType}`,o])).values());this.sessionPBs.set(r)})}formatPbValueForSummary(t){let e="";return t.weightUsed!==void 0&&t.weightUsed!==null&&t.weightUsed!==0?(e+=`${t.weightUsed}kg`,t.repsAchieved>0&&(t.pbType.includes("Heaviest")||t.repsAchieved>1&&!t.pbType.includes("RM"))&&(e+=` x ${t.repsAchieved}`)):t.repsAchieved>0&&t.pbType.includes("Max Reps")?e=`${t.repsAchieved} reps`:t.durationPerformed&&t.durationPerformed>0&&t.pbType.includes("Max Duration")&&(e=`${t.durationPerformed}s`),e||"N/A"}viewFullLog(){this.workoutLog()&&this.router.navigate(["/history/log",this.workoutLog().id])}navigateToRoutines(){this.router.navigate(["/workout"])}startNewWorkout(){this.router.navigate(["/workout"])}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=G({type:n,selectors:[["app-workout-summary"]],inputs:{logId:"logId"},decls:4,vars:2,consts:[["loadingOrNotFoundSummary",""],[1,"acontainer","mx-auto","p-1","py-8"],[4,"ngIf","ngIfElse"],[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-2xl","p-6","md:p-8","max-w-2xl","mx-auto"],[1,"text-center","mb-8"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","currentColor",1,"w-16","h-16","text-green-500","mx-auto","mb-3"],["fill-rule","evenodd","d","M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.06-1.06l-3.002 3.001-1.502-1.502a.75.75 0 0 0-1.06 1.06L9.97 12.72l3.59-3.591Z","clip-rule","evenodd"],[1,"text-4xl","font-bold","text-gray-800","dark:text-gray-100"],[1,"text-lg","text-gray-600","dark:text-gray-400","mt-1"],[1,"space-y-4","mb-8"],[1,"flex","justify-between","items-baseline","p-3","bg-gray-50","dark:bg-gray-700","rounded-md"],[1,"text-sm","font-medium","text-gray-600","dark:text-gray-300"],[1,"text-md","font-semibold","text-gray-800","dark:text-gray-100"],["class","flex justify-between items-baseline p-3 bg-gray-50 dark:bg-gray-700 rounded-md",4,"ngIf"],["class","mb-8",4,"ngIf"],["class","mb-8 p-3 bg-yellow-50 dark:bg-yellow-900/30 rounded-md",4,"ngIf"],[1,"mt-8","pt-6","border-t","border-gray-200","dark:border-gray-700","space-y-3","md:space-y-0","md:flex","md:justify-center","md:space-x-4"],[1,"w-full","md:w-auto","flex","items-center","justify-center","px-6","py-3","border","border-transparent","rounded-md","shadow-sm","text-base","font-medium","text-white","bg-primary","hover:bg-primary-dark","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-primary-dark",3,"click"],[1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-ml-1",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"mb-8"],[1,"text-xl","font-semibold","text-gray-700","dark:text-gray-300","mb-3","text-center","border-b","pb-2","dark:border-gray-700"],[1,"space-y-2","mt-3"],["class","p-2 bg-green-50 dark:bg-green-900/30 rounded-md text-center",4,"ngFor","ngForOf"],[1,"p-2","bg-green-50","dark:bg-green-900/30","rounded-md","text-center"],[1,"text-sm","font-medium","text-green-700","dark:text-green-300"],[1,"text-lg","font-bold","text-green-600","dark:text-green-200"],[1,"mb-8","p-3","bg-yellow-50","dark:bg-yellow-900/30","rounded-md"],[1,"text-sm","font-medium","text-yellow-800","dark:text-yellow-300","mb-1"],[1,"text-sm","text-yellow-700","dark:text-yellow-200","italic","whitespace-pre-line"],[1,"text-center","py-20"],[1,"text-xl","text-gray-600","dark:text-gray-400"]],template:function(e,i){if(e&1&&(s(0,"div",1),h(1,Br,35,9,"ng-container",2)(2,Lr,3,0,"ng-template",null,0,z),a()),e&2){let r=Q(3);l(),c("ngIf",i.workoutLog())("ngIfElse",r)}},dependencies:[K,ee,H,te,ce],encapsulation:2})};var qo=[{path:"",component:He,title:"My Routines"},{path:"new",component:he,title:"Create New Routine"},{path:"edit/:routineId",component:he,title:"Edit Routine"},{path:"view/:routineId",component:he,title:"View Routine"},{path:"play/:routineId",component:Qe,title:"Workout Session"},{path:"summary/:logId",component:Ze,title:"Workout Summary"}];export{qo as WORKOUT_TRACKER_ROUTES};
