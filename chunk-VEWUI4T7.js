import{a as L,b as V,c as w,d as M,f as C,g as S,h as I}from"./chunk-DATMQG43.js";import{a as E}from"./chunk-G4A4JIJA.js";import{a as d}from"./chunk-VLGODEEX.js";import{G as b,K as f,d as D,ma as W,mc as x,nc as g,ub as v,y as h}from"./chunk-XFXOP52A.js";function p(s,e,r){let[t,n]=V(r?.in,s,e);return+w(t)==+w(n)}var T=class s{decimalPipe=f(v);unitsService=f(I);transform(e,r="1.0-2"){if(e==null)return null;let t=this.unitsService.convertFromKg(e,this.unitsService.currentUnit()),n=this.decimalPipe.transform(t,r),a=this.unitsService.getUnitLabel();return`${n} ${a}`}static \u0275fac=function(r){return new(r||s)};static \u0275pipe=W({name:"weightUnit",type:s,pure:!0})};function P(s,e,r){let t=g(s,r?.in);return isNaN(e)?x(r?.in||s,NaN):(e&&t.setDate(t.getDate()+e),t)}function N(s,e){return g(s,e?.in).getFullYear()}function k(s,e,r){return P(s,-e,r)}var O=class s{exerciseService=f(E);constructor(){}calculateSetVolume(e){return(e.repsAchieved||0)*(e.weightUsed||0)}calculateWorkoutVolume(e){let r=0;return e.exercises.forEach(t=>{t.sets.forEach(n=>{r+=this.calculateSetVolume(n)})}),r}calculateTotalVolumeForAllLogs(e){return e.reduce((r,t)=>r+this.calculateWorkoutVolume(t),0)}getWeeklySummaries(e){if(!e||e.length===0)return[];let r=new Map;return e.forEach(t=>{let n=new Date(t.startTime),a=N(n),i=C(n,{weekStartsOn:1}),o=`${a}-W${String(i).padStart(2,"0")}`,m=L(n,{weekStartsOn:1}),l=`Week ${i}, ${a}`;r.has(o)||r.set(o,{weekNumber:i,year:a,weekLabel:l,workoutCount:0,totalVolume:0});let u=r.get(o);u.workoutCount++,u.totalVolume+=this.calculateWorkoutVolume(t)}),Array.from(r.values()).sort((t,n)=>t.year===n.year?t.weekNumber-n.weekNumber:t.year-n.year)}getWeeklyVolumeForChart(e){return this.getWeeklySummaries(e).map(t=>({date:new Date(t.year,0,t.weekNumber*7-6),weekLabel:t.weekLabel,totalVolume:t.totalVolume})).sort((t,n)=>t.date.getTime()-n.date.getTime())}getPerformanceByMuscleGroup(e){return D(this,null,function*(){if(!e||e.length===0)return[];let r=new Map,t=yield new Promise(a=>{this.exerciseService.getExercises().pipe(h(1)).subscribe(i=>a(i))}),n=new Map(t.map(a=>[a.id,a]));return e.forEach(a=>{let i=new Set;a.exercises.forEach(o=>{let m=n.get(o.exerciseId);if(m&&m.muscleGroups){let l=o.sets.reduce((u,c)=>u+this.calculateSetVolume(c),0);m.muscleGroups.forEach(u=>{let c=u.toLowerCase().trim();r.has(c)||r.set(c,{volume:0,workoutCountSet:new Set});let y=r.get(c);y.volume+=l,i.add(c)})}}),i.forEach(o=>{r.get(o)?.workoutCountSet.add(a.id)})}),Array.from(r.entries()).map(([a,i])=>({muscleGroup:a,volume:Math.round(i.volume),workoutCount:i.workoutCountSet.size})).sort((a,i)=>i.volume-a.volume)})}calculateCurrentWorkoutStreak(e){let r={length:0};if(!e||e.length===0)return r;let t=[...new Set(e.map(u=>S(d(u.date),"yyyy-MM-dd")))].map(u=>d(u)).sort((u,c)=>c.getTime()-u.getTime());if(t.length===0)return r;let n=0,a,i,o=new Date;if(o.setHours(0,0,0,0),t.some(u=>p(u,o)))n=1,a=new Date(o),i=new Date(o),o=k(o,1);else{let u=k(o,1);if(t.some(y=>p(y,u)))n=1,a=new Date(u),i=new Date(u),o=k(u,1);else return r}let l=!1;for(let u of t){if(!l){p(u,a)&&(l=!0);continue}if(p(u,o))n++,i=new Date(u),o=k(o,1);else break}return{length:n,startDate:i,endDate:a}}calculateLongestWorkoutStreak(e){let r={length:0};if(!e||e.length<1)return r;let t=[...new Set(e.map(o=>S(d(o.date),"yyyy-MM-dd")))].map(o=>d(o)).sort((o,m)=>o.getTime()-m.getTime());if(t.length===0)return r;let n={length:0},a=0,i;for(let o=0;o<t.length;o++){let m=t[o];o===0||M(m,t[o-1])!==1?(a=1,i=m):a++,a>n.length&&(n={length:a,startDate:i,endDate:m})}return n}static \u0275fac=function(r){return new(r||s)};static \u0275prov=b({token:s,factory:s.\u0275fac,providedIn:"root"})};export{p as a,T as b,O as c};
