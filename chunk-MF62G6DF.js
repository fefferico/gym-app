import{a as S,b as j}from"./chunk-P5IKSRXU.js";import{a as X}from"./chunk-KFZFF2VT.js";import{c as ee,f,h as te}from"./chunk-FVUPAVAO.js";import{h as u,j as Z,n as w}from"./chunk-BIRQKV6U.js";import{$a as R,Ab as q,Ha as y,Ia as d,Ib as J,J as P,Ja as h,Ka as N,N as _,Oa as L,Pa as v,Qa as k,Ra as z,S as M,Sa as O,T as C,Tb as Q,U as B,aa as F,bb as Y,ha as E,ia as x,mc as T,nc as I,qa as K,qc as D,rc as b,sc as A,va as W,yb as $,z as H,zb as U}from"./chunk-Q6MEL7MM.js";import{g as G}from"./chunk-GAL4ENT6.js";var le=["*",[["","modal-footer",""]]],ce=["*","[modal-footer]"];function me(i,o){if(i&1&&(d(0,"h3",11),R(1),h()),i&2){let e=k(3);x(),Y(" ",e.modalTitle()," ")}}function de(i,o){if(i&1){let e=L();d(0,"div",6),W(1,me,2,1,"h3",7),d(2,"button",8),v("click",function(){M(e);let t=k(2);return C(t.closeModal())}),B(),d(3,"svg",9),N(4,"path",10),h()()()}if(i&2){let e=k(2);x(),y("ngIf",e.modalTitle())}}function ue(i,o){if(i&1){let e=L();d(0,"div",1),v("click",function(){M(e);let t=k();return C(t.closeModal())}),d(1,"div",2),v("click",function(t){M(e);let n=k();return C(n.onDialogClick(t))}),W(2,de,5,1,"div",3),d(3,"div",4),O(4),h(),d(5,"div",5),O(6,1),h()()()}if(i&2){let e=k();y("@modalAnimation",e.animationState),x(),y("@dialogAnimation",e.animationState),x(),y("ngIf",e.modalTitle()||!0)}}var oe=class i{elementRef=_(F);isOpen=q(!1);modalTitle=U();closed=$();get animationState(){return this.isOpen()?"open":"closed"}closeModal(){this.isOpen.set(!1),this.closed.emit()}onDialogClick(o){o.stopPropagation()}onDocumentMouseDown(o){this.isOpen()&&this.elementRef.nativeElement.contains(o.target)&&o.target.classList.contains("modal-container")&&this.closeModal()}onEscapeKey(){this.isOpen()&&this.closeModal()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=K({type:i,selectors:[["app-modal"]],hostBindings:function(e,r){e&1&&v("mousedown",function(n){return r.onDocumentMouseDown(n)},E)("keydown.escape",function(){return r.onEscapeKey()},E)},inputs:{isOpen:[1,"isOpen"],modalTitle:[1,"modalTitle"]},outputs:{isOpen:"isOpenChange",closed:"closed"},ngContentSelectors:ce,decls:1,vars:1,consts:[["class","modal-container fixed inset-0 z-[1000] flex items-center justify-center bg-black bg-opacity-60",3,"click",4,"ngIf"],[1,"modal-container","fixed","inset-0","z-[1000]","flex","items-center","justify-center","bg-black","bg-opacity-60",3,"click"],[1,"modal-dialog","mx-2","bg-white","dark:bg-gray-800","rounded-md","shadow-xl","min-w-[300px]","w-full","max-w-lg","md:max-w-xl","lg:max-w-2xl","max-h-[90vh]","flex","flex-col","overflow-hidden",3,"click"],["class","modal-header flex items-center justify-between ml-1 p-1 md:p-1 border-gray-200 dark:border-gray-700",4,"ngIf"],[1,"modal-body","p-1","md:p-1","space-y-4","overflow-y-auto","flex-grow","custom-scrollbar"],[1,"modal-footer","flex","items-center","p-4","md:p-5","border-t","border-gray-200","dark:border-gray-700","rounded-b"],[1,"modal-header","flex","items-center","justify-between","ml-1","p-1","md:p-1","border-gray-200","dark:border-gray-700"],["class","text-xl font-semibold text-gray-900 dark:text-white",4,"ngIf"],["type","button","aria-label","Close modal",1,"modal-close-button","text-gray-400","bg-transparent","hover:bg-gray-200","hover:text-gray-900","dark:hover:bg-gray-600","dark:hover:text-white","rounded-md","text-sm","w-8","h-8","ms-auto","inline-flex","justify-center","items-center",3,"click"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 14 14",1,"w-3","h-3"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"],[1,"text-xl","font-semibold","text-gray-900","dark:text-white"]],template:function(e,r){e&1&&(z(le),W(0,ue,7,3,"div",0)),e&2&&y("ngIf",r.isOpen())},dependencies:[Q,J],styles:[".modal-footer[_ngcontent-%COMP%]:empty{display:none}"],data:{animation:[T("modalAnimation",[b("closed",D({opacity:0,visibility:"hidden"})),b("open",D({opacity:1,visibility:"visible"})),A("closed <=> open",[I("300ms ease-in-out")])]),T("dialogAnimation",[b("closed",D({opacity:0,transform:"scale(0.95) translateY(20px)",visibility:"hidden"})),b("open",D({opacity:1,transform:"scale(1) translateY(0)",visibility:"visible"})),A("closed <=> open",[I("300ms ease-in-out")])])]}})};function ne(i){return o=>{let r=(i?Math[i]:Math.trunc)(o);return r===0?0:r}}function re(i,o,e){let r=ee(i,o,e)/7;return ne(e?.roundingMethod)(r)}function V(i,o,e){let[r,t]=Z(e?.in,i,o);return+u(r,e)==+u(t,e)}var ae=class i{exerciseService=_(te);constructor(){}calculateSetVolume(o){return(o.repsAchieved||0)*(o.weightUsed||0)}calculateWorkoutVolume(o){let e=0;return o.exercises.forEach(r=>{r.sets.forEach(t=>{e+=this.calculateSetVolume(t)})}),e}calculateTotalVolumeForAllLogs(o){return o.reduce((e,r)=>e+this.calculateWorkoutVolume(r),0)}getWeeklySummaries(o){if(!o||o.length===0)return[];let e={};return o.forEach(r=>{let t=f(r.date),n=u(t,{weekStartsOn:1}),a=S(t,{weekStartsOn:1}),l=w(n,"yyyy-MM-dd");e[l]||(e[l]={logs:[],startDate:n,endDate:a}),e[l].logs.push(r)}),Object.entries(e).map(([r,t])=>{let n=this.calculateTotalVolumeForAllLogs(t.logs);return{weekLabel:`Week of ${w(t.startDate,"MMM d")}`,workoutCount:t.logs.length,totalVolume:n,weekStartDate:t.startDate,weekEndDate:t.endDate}}).sort((r,t)=>t.weekStartDate.getTime()-r.weekStartDate.getTime())}calculateTotalVolume(o){return o.exercises.reduce((e,r)=>{let t=r.sets.reduce((n,a)=>n+(a.weightUsed??0)*(a.repsAchieved??0),0);return e+t},0)}getWeeklyVolumeForChart(o){if(!o||o.length===0)return[];let e={};return o.forEach(t=>{let n=f(t.date),a=u(n,{weekStartsOn:1}),l=w(a,"yyyy-MM-dd");e[l]||(e[l]={totalVolume:0,weekLabel:`W${w(a,"w")} '${w(a,"yy")}`}),e[l].totalVolume+=this.calculateTotalVolume(t)}),Object.keys(e).sort((t,n)=>new Date(t).getTime()-new Date(n).getTime()).map(t=>({date:f(t),weekLabel:e[t].weekLabel,totalVolume:e[t].totalVolume}))}getPerformanceByMuscleGroup(o){return G(this,null,function*(){if(!o||o.length===0)return[];let e=new Map,r=yield new Promise(n=>{this.exerciseService.getExercises().pipe(H(1)).subscribe(a=>n(a))}),t=new Map(r.map(n=>[n.id,n]));return o.forEach(n=>{let a=new Set;n.exercises.forEach(l=>{let m=t.get(l.exerciseId);if(m&&m.muscleGroups){let p=l.sets.reduce((s,c)=>s+this.calculateSetVolume(c),0);m.muscleGroups.forEach(s=>{let c=s.toLowerCase().trim();e.has(c)||e.set(c,{volume:0,workoutCountSet:new Set});let g=e.get(c);g.volume+=p,a.add(c)})}}),a.forEach(l=>{e.get(l)?.workoutCountSet.add(n.id)})}),Array.from(e.entries()).map(([n,a])=>({muscleGroup:n,volume:Math.round(a.volume),workoutCount:a.workoutCountSet.size})).sort((n,a)=>a.volume-n.volume)})}calculateCurrentWorkoutStreak(o,e){let r=[...o.map(c=>f(c.date)),...e.map(c=>f(c.date))];if(r.length===0)return{length:0};r.sort((c,g)=>g.getTime()-c.getTime());let t=new Date,n=u(t,{weekStartsOn:1}),a=0,l,m=r[0],p=j(t,7);if(!V(m,t,{weekStartsOn:1})&&!V(m,p,{weekStartsOn:1}))return{length:0};for(let c=0;c<260&&r.some(ie=>V(ie,n,{weekStartsOn:1}));c++)l||(l=S(n,{weekStartsOn:1})),a++,n=j(n,7);if(a===0)return{length:0};let s=u(X(n,7),{weekStartsOn:1});return{length:a,startDate:s,endDate:l}}calculateLongestWorkoutStreak(o,e){let r=[...o.map(s=>f(s.date)),...e.map(s=>f(s.date))];if(r.length<2)return this.calculateCurrentWorkoutStreak(o,e);let t=Array.from(new Set(r.map(s=>w(u(s,{weekStartsOn:1}),"yyyy-MM-dd")))).map(s=>new Date(s)).sort((s,c)=>s.getTime()-c.getTime());if(t.length===0)return{length:0};let n=0,a=0,l,m,p;for(let s=0;s<t.length;s++)if(s===0)a=1,p=t[s];else{let c=t[s-1],g=t[s];re(g,c)===1?a++:(a>n&&(n=a,l=p,m=S(c,{weekStartsOn:1})),a=1,p=g)}return a>n&&(n=a,l=p,m=S(t[t.length-1],{weekStartsOn:1})),{length:n,startDate:l,endDate:m}}static \u0275fac=function(e){return new(e||i)};static \u0275prov=P({token:i,factory:i.\u0275fac,providedIn:"root"})};export{oe as a,ae as b};
