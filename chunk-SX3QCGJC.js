import{b as ft,c as Ai}from"./chunk-VFL7S7AQ.js";import{c as Ci,d as Ii,f as At,g as Bt,h as Ti}from"./chunk-YAHOZYMW.js";import{a as _t,b as Fe}from"./chunk-HCMVDYAP.js";import{h as Ne}from"./chunk-JKNR3MW4.js";import{a as Me}from"./chunk-RRQXOQS5.js";import{$a as vi,$b as Oi,Aa as Ie,C as Ye,Ca as k,D as ne,Da as S,E as ke,Ea as u,F as de,Fb as Ve,H as U,Hb as he,I as Qe,Ia as Te,Ib as nt,J as se,Ja as Pe,Ka as De,L as f,La as oe,M as pi,Mb as ge,N as x,Na as ce,Nb as st,O as v,Ob as B,P as I,Pa as p,Pb as ot,Q as V,Qa as W,Qb as at,R as ze,Ra as E,Rb as Pi,S as Se,Sa as K,Sb as lt,Ta as Xe,Tb as dt,U as C,Ua as et,Ub as ct,V as Ge,Va as tt,Vb as Di,Wb as ut,X as ye,Xa as ae,Xb as Ri,Y as mi,Yb as Vi,Z as hi,Za as xi,Zb as pt,_a as Re,_b as Wi,a as H,aa as gi,ab as Si,ac as Fi,b as Z,ba as _i,bb as yi,bc as Mi,ca as d,cb as M,cc as Ni,d as O,db as Y,dc as mt,e as xe,ea as Ee,eb as q,ec as ht,f as Be,fb as Q,fc as gt,g as P,gc as We,h as li,ha as Mt,hb as A,hc as Li,i as Wt,ic as Oe,jb as Lt,k as re,ka as j,kb as ue,la as Je,lb as we,m as le,ma as Ue,mb as bi,n as ve,nb as wi,ob as it,oc as _e,p as di,pa as y,pb as pe,qa as L,qb as J,r as Ot,ra as be,s as ci,sa as Nt,sb as ki,t as qe,ta as fi,tb as rt,u as ui,ua as je,ub as X,v as Ft,va as m,vb as me,wa as a,wb as ee,xa as l,xb as Ei,y as G,ya as w,za as Ce}from"./chunk-K2W4LZAE.js";function Sr(n,t){if(n&1&&(a(0,"p",25),p(1),l()),n&2){let e=u().$implicit;m("title",e.description),d(),W(e.description)}}function yr(n,t){if(n&1&&(a(0,"div",26)(1,"span",21),p(2,"Last:"),l(),p(3),M(4,"date"),l()),n&2){let e=u().$implicit;d(3),E(" ",q(4,1,e.lastPerformed,"dd/MM/yy")," ")}}function br(n,t){n&1&&(a(0,"div",27),p(1," Not performed "),l())}function wr(n,t){if(n&1){let e=k();a(0,"div",28)(1,"button",29),S("click",function(r){x(e);let s=u().$implicit,o=u(3);return v(o.startWorkout(s.id,r))}),I(),a(2,"svg",30),w(3,"path",31),l()(),V(),a(4,"button",32),S("click",function(r){x(e);let s=u().$implicit,o=u(3);return v(o.viewRoutineDetails(s.id,r))}),I(),a(5,"svg",30),w(6,"path",33)(7,"path",34),l()(),V(),a(8,"button",35),S("click",function(r){x(e);let s=u().$implicit,o=u(3);return v(o.editRoutine(s.id,r))}),I(),a(9,"svg",30),w(10,"path",36),l()(),V(),a(11,"button",37),S("click",function(r){x(e);let s=u().$implicit,o=u(3);return v(o.deleteRoutine(s.id,r))}),I(),a(12,"svg",30),w(13,"path",38),l()()()}n&2&&m("@slideInOutActions",void 0)}function kr(n,t){if(n&1){let e=k();a(0,"div",12),S("click",function(){let r=x(e).$implicit,s=u(3);return v(s.viewRoutineDetails(r.id))}),a(1,"div",13)(2,"div",14)(3,"h2",15),p(4),l(),a(5,"button",16),S("click",function(r){let s=x(e).$implicit,o=u(3);return v(o.toggleActions(s.id,r))}),I(),a(6,"svg",17),w(7,"path",18),l()()(),y(8,Sr,2,2,"p",19),V(),a(9,"div",20)(10,"span")(11,"span",21),p(12,"Goal:"),l(),p(13),M(14,"titlecase"),l(),a(15,"span")(16,"span",21),p(17,"Ex:"),l(),p(18),l()(),y(19,yr,5,4,"div",22)(20,br,2,0,"div",23),l(),y(21,wr,14,1,"div",24),l()}if(n&2){let e=t.$implicit,i=u(3);d(3),m("title",e.name),d(),W(e.name),d(4),m("ngIf",e.description),d(5),E(" ",Y(14,8,e.goal)??"N/A"," "),d(5),E(" ",e.exercises.length," "),d(),m("ngIf",e.lastPerformed),d(),m("ngIf",!e.lastPerformed),d(),m("ngIf",i.areActionsVisible(e.id))}}function Er(n,t){if(n&1&&(a(0,"div",10),y(1,kr,22,10,"div",11),l()),n&2){let e=u().ngIf;d(),m("ngForOf",e)}}function Cr(n,t){if(n&1){let e=k();a(0,"div",39),I(),a(1,"svg",40),w(2,"path",41),l(),V(),a(3,"h3",42),p(4,"No Routines Yet!"),l(),a(5,"p",43),p(6,"Get started by creating your first workout routine."),l(),a(7,"button",44),S("click",function(){x(e);let r=u(2);return v(r.navigateToCreateRoutine())}),p(8," Create Your First Routine "),l()()}}function Ir(n,t){if(n&1&&(a(0,"div"),y(1,Er,2,1,"div",9)(2,Cr,9,0,"ng-template",null,1,Q),l()),n&2){let e=t.ngIf,i=oe(3);d(),m("ngIf",e.length>0)("ngIfElse",i)}}function Tr(n,t){n&1&&(a(0,"div",45)(1,"p",46),p(2,"Loading routines..."),l()())}var xt=class n{workoutService=f(Oe);trackingService=f(_e);router=f(he);alertService=f(We);spinnerService=f(_t);toastService=f(Fe);routines$;visibleActionsRutineId=C(null);ngOnInit(){window.scrollTo(0,0),this.routines$=this.workoutService.routines$}navigateToCreateRoutine(){this.router.navigate(["/workout/new"])}editRoutine(t,e){e.stopPropagation(),this.router.navigate(["/workout/edit",t]),this.visibleActionsRutineId.set(null)}deleteRoutine(t,e){return O(this,null,function*(){e.stopPropagation(),this.visibleActionsRutineId.set(null);let i=yield le(this.workoutService.getRoutineById(t).pipe(G(1)));if(!i){this.toastService.error("Routine not found for deletion.",0,"Error");return}let r=(yield le(this.trackingService.getWorkoutLogsByRoutineId(t).pipe(G(1))))||[],s=`Are you sure you want to delete the routine "${i.name}"?`;r.length>0&&(s+=` This will also delete ${r.length} associated workout log(s). This action cannot be undone.`);let o=yield this.alertService.showConfirm("Delete Routine",s,"Delete");if(o&&o.data)try{this.spinnerService.show(),r.length>0&&(yield this.trackingService.clearWorkoutLogsByRoutineId(t),this.toastService.info(`${r.length} workout log(s) deleted.`,3e3,"Logs Cleared")),yield this.workoutService.deleteRoutine(t),this.toastService.success(`Routine "${i.name}" deleted successfully.`,4e3,"Routine Deleted")}catch(c){console.error("Error during deletion:",c),this.toastService.error("Failed to delete routine or its logs. Please try again.",0,"Deletion Failed")}finally{this.spinnerService.hide()}})}startWorkout(t,e){e.stopPropagation(),this.router.navigate(["/workout/play",t]),this.visibleActionsRutineId.set(null)}viewRoutineDetails(t,e){e?.stopPropagation(),this.router.navigate(["/workout/view",t]),this.visibleActionsRutineId.set(null)}toggleActions(t,e){e.stopPropagation(),this.visibleActionsRutineId()===t?this.visibleActionsRutineId.set(null):this.visibleActionsRutineId.set(t)}areActionsVisible(t){return this.visibleActionsRutineId()===t}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=j({type:n,selectors:[["app-routine-list"]],decls:12,vars:4,consts:[["loadingRoutines",""],["noRoutines",""],[1,"container","mx-auto","p-4"],[1,"flex","justify-between","items-center","mb-6","pb-3","border-b","border-gray-200","dark:border-gray-700"],[1,"text-2xl","font-bold","text-gray-800","dark:text-gray-200"],[1,"bg-primary","hover:bg-primary-dark","text-white","font-semibold","py-2","px-3","rounded-md","shadow-sm","hover:shadow-md","transition-all","duration-200","focus:outline-none","focus:ring-2","focus:ring-primary-light","focus:ring-opacity-75","text-sm",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"w-4","h-4","mr-1.5","inline-block"],["d","M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z"],[4,"ngIf","ngIfElse"],["class","grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",4,"ngIf","ngIfElse"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4"],["class","bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-200 cursor-pointer overflow-hidden relative group",3,"click",4,"ngFor","ngForOf"],[1,"bg-white","dark:bg-gray-800","rounded-lg","shadow-md","hover:shadow-lg","transition-shadow","duration-200","cursor-pointer","overflow-hidden","relative","group",3,"click"],[1,"p-3"],[1,"flex","justify-between","items-start","mb-1.5"],[1,"text-lg","font-semibold","text-primary","dark:text-primary-light","truncate","pr-8",3,"title"],[1,"absolute","top-2","right-2","p-1.5","text-gray-500","dark:text-gray-400","hover:bg-gray-200","dark:hover:bg-gray-700","rounded-full","focus:outline-none","z-10",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","d","M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"],["class","text-gray-600 dark:text-gray-400 text-xs mb-2 line-clamp-2",3,"title",4,"ngIf"],[1,"flex","justify-between","text-xs","text-gray-500","dark:text-gray-300","mb-2","space-x-2"],[1,"font-medium"],["class","text-xs text-gray-500 dark:text-gray-300",4,"ngIf"],["class","text-xs text-gray-500 dark:text-gray-300 italic",4,"ngIf"],["class",`absolute inset-x-0 bottom-0 p-2 bg-gray-100 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-700
                           flex flex-wrap gap-1.5 justify-center z-20 rounded-b-lg`,4,"ngIf"],[1,"text-gray-600","dark:text-gray-400","text-xs","mb-2","line-clamp-2",3,"title"],[1,"text-xs","text-gray-500","dark:text-gray-300"],[1,"text-xs","text-gray-500","dark:text-gray-300","italic"],[1,"absolute","inset-x-0","bottom-0","p-2","bg-gray-100","dark:bg-gray-700","border-t","border-gray-200","dark:border-gray-700","flex","flex-wrap","gap-1.5","justify-center","z-20","rounded-b-lg"],["title","Start Workout",1,"flex-1","text-xs","min-w-[70px]","flex","items-center","justify-center","p-1.5","bg-green-500","text-white","rounded-md","hover:bg-green-600","transition-colors",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","2","stroke","currentColor",1,"size-4"],["stroke-linecap","round","stroke-linejoin","round","d","M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"],["title","View Details",1,"flex-1","text-xs","min-w-[70px]","flex","items-center","justify-center","p-1.5","bg-cyan-500","text-white","rounded-md","hover:bg-cyan-600","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"],["stroke-linecap","round","stroke-linejoin","round","d","M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"],["title","Edit Routine",1,"flex-1","text-xs","min-w-[70px]","flex","items-center","justify-center","p-1.5","bg-yellow-500","text-white","rounded-md","hover:bg-yellow-600","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"],["title","Delete Routine",1,"flex-1","text-xs","min-w-[70px]","flex","items-center","justify-center","p-1.5","bg-red-500","text-white","rounded-md","hover:bg-red-600","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"],[1,"text-center","py-12","px-6","bg-white","dark:bg-gray-800","rounded-lg","shadow-md"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-16","h-16","mx-auto","text-gray-400","dark:text-gray-200","mb-4"],["stroke-linecap","round","stroke-linejoin","round","d","M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 0 1 0 3.75H5.625a1.875 1.875 0 0 1 0-3.75Z"],[1,"text-xl","font-semibold","text-gray-700","dark:text-gray-300","mb-2"],[1,"text-gray-500","dark:text-gray-400","mb-6"],[1,"bg-primary","hover:bg-primary-dark","text-white","font-semibold","py-2","px-6","rounded-md","shadow-md","hover:shadow-lg","transition-all","duration-300","focus:outline-none","focus:ring-2","focus:ring-primary-light","focus:ring-opacity-75",3,"click"],[1,"text-center","py-10"],[1,"text-xl","text-gray-600","dark:text-gray-400"]],template:function(e,i){if(e&1){let r=k();a(0,"div",2)(1,"header",3)(2,"h1",4),p(3,"My Routines"),l(),a(4,"button",5),S("click",function(){return x(r),v(i.navigateToCreateRoutine())}),I(),a(5,"svg",6),w(6,"path",7),l(),p(7," New Routine "),l()(),y(8,Ir,4,2,"div",8),M(9,"async"),y(10,Tr,3,0,"ng-template",null,0,Q),l()}if(e&2){let r=oe(11);d(8),m("ngIf",Y(9,2,i.routines$))("ngIfElse",r)}},dependencies:[ee,pe,J,ki,rt,X],encapsulation:2,data:{animation:[Ci("slideInOutActions",[Bt("void",At({height:"0px",opacity:0,overflow:"hidden",paddingTop:"0",paddingBottom:"0",marginTop:"0",marginBottom:"0"})),Bt("*",At({height:"*",opacity:1,overflow:"hidden",paddingTop:"0.5rem",paddingBottom:"0.5rem"})),Ti("void <=> *",Ii("200ms ease-in-out"))])]}})};var zt;function Pr(){if(zt==null){let n=typeof document<"u"?document.head:null;zt=!!(n&&(n.createShadowRoot||n.attachShadow))}return zt}function yt(n){if(Pr()){let t=n.getRootNode?n.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}function $e(n){return n.composedPath?n.composedPath()[0]:n.target}function Bi(n){return n.buttons===0||n.detail===0}function zi(n){let t=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0];return!!t&&t.identifier===-1&&(t.radiusX==null||t.radiusX===1)&&(t.radiusY==null||t.radiusY===1)}function bt(n,t=0){return Dr(n)?Number(n):arguments.length===2?t:0}function Dr(n){return!isNaN(parseFloat(n))&&!isNaN(Number(n))}function ie(n){return n instanceof ye?n.nativeElement:n}function fe(n,t,e,i,r){let s=parseInt(Lt.major),o=parseInt(Lt.minor);return s>19||s===19&&o>0||s===0&&o===0?n.listen(t,e,i,r):(t.addEventListener(e,i,r),()=>{t.removeEventListener(e,i,r)})}var wt=new WeakMap,Gi=(()=>{class n{_appRef;_injector=f(ze);_environmentInjector=f(pi);load(e){let i=this._appRef=this._appRef||this._injector.get(fi),r=wt.get(i);r||(r={loaders:new Set,refs:[]},wt.set(i,r),i.onDestroy(()=>{wt.get(i)?.refs.forEach(s=>s.destroy()),wt.delete(i)})),r.loaders.has(e)||(r.loaders.add(e),r.refs.push(wi(e,{environmentInjector:this._environmentInjector})))}static \u0275fac=function(i){return new(i||n)};static \u0275prov=U({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Gt;try{Gt=typeof Intl<"u"&&Intl.v8BreakIterator}catch{Gt=!1}var Ut=(()=>{class n{_platformId=f(hi);isBrowser=this._platformId?Ei(this._platformId):typeof document=="object"&&!!document;EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent);TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent);BLINK=this.isBrowser&&!!(window.chrome||Gt)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT;WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT;IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window);FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent);ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT;SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT;constructor(){}static \u0275fac=function(i){return new(i||n)};static \u0275prov=U({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Rr=new se("cdk-dir-doc",{providedIn:"root",factory:Vr});function Vr(){return f(Se)}var Wr=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function Or(n){let t=n?.toLowerCase()||"";return t==="auto"&&typeof navigator<"u"&&navigator?.language?Wr.test(navigator.language)?"rtl":"ltr":t==="rtl"?"rtl":"ltr"}var jt=(()=>{class n{value="ltr";change=new L;constructor(){let e=f(Rr,{optional:!0});if(e){let i=e.body?e.body.dir:null,r=e.documentElement?e.documentElement.dir:null;this.value=Or(i||r||"ltr")}}ngOnDestroy(){this.change.complete()}static \u0275fac=function(i){return new(i||n)};static \u0275prov=U({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Mr=20,Ui=(()=>{class n{_ngZone=f(be);_platform=f(Ut);_renderer=f(Ee).createRenderer(null,null);_cleanupGlobalListener;constructor(){}_scrolled=new P;_scrolledCount=0;scrollContainers=new Map;register(e){this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe(()=>this._scrolled.next(e)))}deregister(e){let i=this.scrollContainers.get(e);i&&(i.unsubscribe(),this.scrollContainers.delete(e))}scrolled(e=Mr){return this._platform.isBrowser?new Be(i=>{this._cleanupGlobalListener||(this._cleanupGlobalListener=this._ngZone.runOutsideAngular(()=>this._renderer.listen("document","scroll",()=>this._scrolled.next())));let r=e>0?this._scrolled.pipe(Ft(e)).subscribe(i):this._scrolled.subscribe(i);return this._scrolledCount++,()=>{r.unsubscribe(),this._scrolledCount--,this._scrolledCount||(this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0)}}):re()}ngOnDestroy(){this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0,this.scrollContainers.forEach((e,i)=>this.deregister(i)),this._scrolled.complete()}ancestorScrolled(e,i){let r=this.getAncestorScrollContainers(e);return this.scrolled(i).pipe(ui(s=>!s||r.indexOf(s)>-1))}getAncestorScrollContainers(e){let i=[];return this.scrollContainers.forEach((r,s)=>{this._scrollableContainsElement(s,e)&&i.push(s)}),i}_scrollableContainsElement(e,i){let r=ie(i),s=e.getElementRef().nativeElement;do if(r==s)return!0;while(r=r.parentElement);return!1}static \u0275fac=function(i){return new(i||n)};static \u0275prov=U({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Nr=20,ji=(()=>{class n{_platform=f(Ut);_listeners;_viewportSize;_change=new P;_document=f(Se,{optional:!0});constructor(){let e=f(be),i=f(Ee).createRenderer(null,null);e.runOutsideAngular(()=>{if(this._platform.isBrowser){let r=s=>this._change.next(s);this._listeners=[i.listen("window","resize",r),i.listen("window","orientationchange",r)]}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){this._listeners?.forEach(e=>e()),this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();let e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}getViewportRect(){let e=this.getViewportScrollPosition(),{width:i,height:r}=this.getViewportSize();return{top:e.top,left:e.left,bottom:e.top+r,right:e.left+i,height:r,width:i}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};let e=this._document,i=this._getWindow(),r=e.documentElement,s=r.getBoundingClientRect(),o=-s.top||e.body.scrollTop||i.scrollY||r.scrollTop||0,c=-s.left||e.body.scrollLeft||i.scrollX||r.scrollLeft||0;return{top:o,left:c}}change(e=Nr){return e>0?this._change.pipe(Ft(e)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){let e=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:e.innerWidth,height:e.innerHeight}:{width:0,height:0}}static \u0275fac=function(i){return new(i||n)};static \u0275prov=U({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var $i=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=Je({type:n});static \u0275inj=Qe({})}return n})();var $t={},Hi=(()=>{class n{_appId=f(mi);getId(e){return this._appId!=="ng"&&(e+=this._appId),$t.hasOwnProperty(e)||($t[e]=0),`${e}${$t[e]++}`}static \u0275fac=function(i){return new(i||n)};static \u0275prov=U({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Zi(n){return Array.isArray(n)?n:[n]}function lr(n){let t=n.cloneNode(!0),e=t.querySelectorAll("[id]"),i=n.nodeName.toLowerCase();t.removeAttribute("id");for(let r=0;r<e.length;r++)e[r].removeAttribute("id");return i==="canvas"?Yi(n,t):(i==="input"||i==="select"||i==="textarea")&&qi(n,t),Ki("canvas",n,t,Yi),Ki("input, textarea, select",n,t,qi),t}function Ki(n,t,e,i){let r=t.querySelectorAll(n);if(r.length){let s=e.querySelectorAll(n);for(let o=0;o<r.length;o++)i(r[o],s[o])}}var Lr=0;function qi(n,t){t.type!=="file"&&(t.value=n.value),t.type==="radio"&&t.name&&(t.name=`mat-clone-${t.name}-${Lr++}`)}function Yi(n,t){let e=t.getContext("2d");if(e)try{e.drawImage(n,0,0)}catch{}}function ei(n){let t=n.getBoundingClientRect();return{top:t.top,right:t.right,bottom:t.bottom,left:t.left,width:t.width,height:t.height,x:t.x,y:t.y}}function Kt(n,t,e){let{top:i,bottom:r,left:s,right:o}=n;return e>=i&&e<=r&&t>=s&&t<=o}function Ke(n,t,e){n.top+=t,n.bottom=n.top+n.height,n.left+=e,n.right=n.left+n.width}function Qi(n,t,e,i){let{top:r,right:s,bottom:o,left:c,width:h,height:g}=n,_=h*t,b=g*t;return i>r-b&&i<o+b&&e>c-_&&e<s+_}var kt=class{_document;positions=new Map;constructor(t){this._document=t}clear(){this.positions.clear()}cache(t){this.clear(),this.positions.set(this._document,{scrollPosition:this.getViewportScrollPosition()}),t.forEach(e=>{this.positions.set(e,{scrollPosition:{top:e.scrollTop,left:e.scrollLeft},clientRect:ei(e)})})}handleScroll(t){let e=$e(t),i=this.positions.get(e);if(!i)return null;let r=i.scrollPosition,s,o;if(e===this._document){let g=this.getViewportScrollPosition();s=g.top,o=g.left}else s=e.scrollTop,o=e.scrollLeft;let c=r.top-s,h=r.left-o;return this.positions.forEach((g,_)=>{g.clientRect&&e!==_&&e.contains(_)&&Ke(g.clientRect,c,h)}),r.top=s,r.left=o,{top:c,left:h}}getViewportScrollPosition(){return{top:window.scrollY,left:window.scrollX}}};function dr(n,t){let e=n.rootNodes;if(e.length===1&&e[0].nodeType===t.ELEMENT_NODE)return e[0];let i=t.createElement("div");return e.forEach(r=>i.appendChild(r)),i}function ti(n,t,e){for(let i in t)if(t.hasOwnProperty(i)){let r=t[i];r?n.setProperty(i,r,e?.has(i)?"important":""):n.removeProperty(i)}return n}function Le(n,t){let e=t?"":"none";ti(n.style,{"touch-action":t?"":"none","-webkit-user-drag":t?"":"none","-webkit-tap-highlight-color":t?"":"transparent","user-select":e,"-ms-user-select":e,"-webkit-user-select":e,"-moz-user-select":e})}function Ji(n,t,e){ti(n.style,{position:t?"":"fixed",top:t?"":"0",opacity:t?"":"0",left:t?"":"-999em"},e)}function Et(n,t){return t&&t!="none"?n+" "+t:n}function Xi(n,t){n.style.width=`${t.width}px`,n.style.height=`${t.height}px`,n.style.transform=Ct(t.left,t.top)}function Ct(n,t){return`translate3d(${Math.round(n)}px, ${Math.round(t)}px, 0)`}function er(n){let t=n.toLowerCase().indexOf("ms")>-1?1:1e3;return parseFloat(n)*t}function Ar(n){let t=getComputedStyle(n),e=Ht(t,"transition-property"),i=e.find(c=>c==="transform"||c==="all");if(!i)return 0;let r=e.indexOf(i),s=Ht(t,"transition-duration"),o=Ht(t,"transition-delay");return er(s[r])+er(o[r])}function Ht(n,t){return n.getPropertyValue(t).split(",").map(i=>i.trim())}var Br=new Set(["position"]),qt=class{_document;_rootElement;_direction;_initialDomRect;_previewTemplate;_previewClass;_pickupPositionOnPage;_initialTransform;_zIndex;_renderer;_previewEmbeddedView;_preview;get element(){return this._preview}constructor(t,e,i,r,s,o,c,h,g,_){this._document=t,this._rootElement=e,this._direction=i,this._initialDomRect=r,this._previewTemplate=s,this._previewClass=o,this._pickupPositionOnPage=c,this._initialTransform=h,this._zIndex=g,this._renderer=_}attach(t){this._preview=this._createPreview(),t.appendChild(this._preview),tr(this._preview)&&this._preview.showPopover()}destroy(){this._preview.remove(),this._previewEmbeddedView?.destroy(),this._preview=this._previewEmbeddedView=null}setTransform(t){this._preview.style.transform=t}getBoundingClientRect(){return this._preview.getBoundingClientRect()}addClass(t){this._preview.classList.add(t)}getTransitionDuration(){return Ar(this._preview)}addEventListener(t,e){return this._renderer.listen(this._preview,t,e)}_createPreview(){let t=this._previewTemplate,e=this._previewClass,i=t?t.template:null,r;if(i&&t){let s=t.matchSize?this._initialDomRect:null,o=t.viewContainer.createEmbeddedView(i,t.context);o.detectChanges(),r=dr(o,this._document),this._previewEmbeddedView=o,t.matchSize?Xi(r,s):r.style.transform=Ct(this._pickupPositionOnPage.x,this._pickupPositionOnPage.y)}else r=lr(this._rootElement),Xi(r,this._initialDomRect),this._initialTransform&&(r.style.transform=this._initialTransform);return ti(r.style,{"pointer-events":"none",margin:tr(r)?"0 auto 0 0":"0",position:"fixed",top:"0",left:"0","z-index":this._zIndex+""},Br),Le(r,!1),r.classList.add("cdk-drag-preview"),r.setAttribute("popover","manual"),r.setAttribute("dir",this._direction),e&&(Array.isArray(e)?e.forEach(s=>r.classList.add(s)):r.classList.add(e)),r}};function tr(n){return"showPopover"in n}var zr={passive:!0},ir={passive:!1},Gr={passive:!1,capture:!0},Ur=800,rr=new Set(["position"]),Yt=class{_config;_document;_ngZone;_viewportRuler;_dragDropRegistry;_renderer;_rootElementCleanups;_cleanupShadowRootSelectStart;_preview;_previewContainer;_placeholderRef;_placeholder;_pickupPositionInElement;_pickupPositionOnPage;_anchor;_passiveTransform={x:0,y:0};_activeTransform={x:0,y:0};_initialTransform;_hasStartedDragging=C(!1);_hasMoved;_initialContainer;_initialIndex;_parentPositions;_moveEvents=new P;_pointerDirectionDelta;_pointerPositionAtLastDirectionChange;_lastKnownPointerPosition;_rootElement;_ownerSVGElement;_rootElementTapHighlight;_pointerMoveSubscription=xe.EMPTY;_pointerUpSubscription=xe.EMPTY;_scrollSubscription=xe.EMPTY;_resizeSubscription=xe.EMPTY;_lastTouchEventTime;_dragStartTime;_boundaryElement=null;_nativeInteractionsEnabled=!0;_initialDomRect;_previewRect;_boundaryRect;_previewTemplate;_placeholderTemplate;_handles=[];_disabledHandles=new Set;_dropContainer;_direction="ltr";_parentDragRef;_cachedShadowRoot;lockAxis;dragStartDelay=0;previewClass;scale=1;get disabled(){return this._disabled||!!(this._dropContainer&&this._dropContainer.disabled)}set disabled(t){t!==this._disabled&&(this._disabled=t,this._toggleNativeDragInteractions(),this._handles.forEach(e=>Le(e,t)))}_disabled=!1;beforeStarted=new P;started=new P;released=new P;ended=new P;entered=new P;exited=new P;dropped=new P;moved=this._moveEvents;data;constrainPosition;constructor(t,e,i,r,s,o,c){this._config=e,this._document=i,this._ngZone=r,this._viewportRuler=s,this._dragDropRegistry=o,this._renderer=c,this.withRootElement(t).withParent(e.parentDragRef||null),this._parentPositions=new kt(i),o.registerDragItem(this)}getPlaceholderElement(){return this._placeholder}getRootElement(){return this._rootElement}getVisibleElement(){return this.isDragging()?this.getPlaceholderElement():this.getRootElement()}withHandles(t){this._handles=t.map(i=>ie(i)),this._handles.forEach(i=>Le(i,this.disabled)),this._toggleNativeDragInteractions();let e=new Set;return this._disabledHandles.forEach(i=>{this._handles.indexOf(i)>-1&&e.add(i)}),this._disabledHandles=e,this}withPreviewTemplate(t){return this._previewTemplate=t,this}withPlaceholderTemplate(t){return this._placeholderTemplate=t,this}withRootElement(t){let e=ie(t);return e!==this._rootElement&&(this._removeRootElementListeners(),this._rootElementCleanups=this._ngZone.runOutsideAngular(()=>[fe(this._renderer,e,"mousedown",this._pointerDown,ir),fe(this._renderer,e,"touchstart",this._pointerDown,zr),fe(this._renderer,e,"dragstart",this._nativeDragStart,ir)]),this._initialTransform=void 0,this._rootElement=e),typeof SVGElement<"u"&&this._rootElement instanceof SVGElement&&(this._ownerSVGElement=this._rootElement.ownerSVGElement),this}withBoundaryElement(t){return this._boundaryElement=t?ie(t):null,this._resizeSubscription.unsubscribe(),t&&(this._resizeSubscription=this._viewportRuler.change(10).subscribe(()=>this._containInsideBoundaryOnResize())),this}withParent(t){return this._parentDragRef=t,this}dispose(){this._removeRootElementListeners(),this.isDragging()&&this._rootElement?.remove(),this._anchor?.remove(),this._destroyPreview(),this._destroyPlaceholder(),this._dragDropRegistry.removeDragItem(this),this._removeListeners(),this.beforeStarted.complete(),this.started.complete(),this.released.complete(),this.ended.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this._moveEvents.complete(),this._handles=[],this._disabledHandles.clear(),this._dropContainer=void 0,this._resizeSubscription.unsubscribe(),this._parentPositions.clear(),this._boundaryElement=this._rootElement=this._ownerSVGElement=this._placeholderTemplate=this._previewTemplate=this._anchor=this._parentDragRef=null}isDragging(){return this._hasStartedDragging()&&this._dragDropRegistry.isDragging(this)}reset(){this._rootElement.style.transform=this._initialTransform||"",this._activeTransform={x:0,y:0},this._passiveTransform={x:0,y:0}}disableHandle(t){!this._disabledHandles.has(t)&&this._handles.indexOf(t)>-1&&(this._disabledHandles.add(t),Le(t,!0))}enableHandle(t){this._disabledHandles.has(t)&&(this._disabledHandles.delete(t),Le(t,this.disabled))}withDirection(t){return this._direction=t,this}_withDropContainer(t){this._dropContainer=t}getFreeDragPosition(){let t=this.isDragging()?this._activeTransform:this._passiveTransform;return{x:t.x,y:t.y}}setFreeDragPosition(t){return this._activeTransform={x:0,y:0},this._passiveTransform.x=t.x,this._passiveTransform.y=t.y,this._dropContainer||this._applyRootElementTransform(t.x,t.y),this}withPreviewContainer(t){return this._previewContainer=t,this}_sortFromLastPointerPosition(){let t=this._lastKnownPointerPosition;t&&this._dropContainer&&this._updateActiveDropContainer(this._getConstrainedPointerPosition(t),t)}_removeListeners(){this._pointerMoveSubscription.unsubscribe(),this._pointerUpSubscription.unsubscribe(),this._scrollSubscription.unsubscribe(),this._cleanupShadowRootSelectStart?.(),this._cleanupShadowRootSelectStart=void 0}_destroyPreview(){this._preview?.destroy(),this._preview=null}_destroyPlaceholder(){this._placeholder?.remove(),this._placeholderRef?.destroy(),this._placeholder=this._placeholderRef=null}_pointerDown=t=>{if(this.beforeStarted.next(),this._handles.length){let e=this._getTargetHandle(t);e&&!this._disabledHandles.has(e)&&!this.disabled&&this._initializeDragSequence(e,t)}else this.disabled||this._initializeDragSequence(this._rootElement,t)};_pointerMove=t=>{let e=this._getPointerPositionOnPage(t);if(!this._hasStartedDragging()){let r=Math.abs(e.x-this._pickupPositionOnPage.x),s=Math.abs(e.y-this._pickupPositionOnPage.y);if(r+s>=this._config.dragStartThreshold){let c=Date.now()>=this._dragStartTime+this._getDragStartDelay(t),h=this._dropContainer;if(!c){this._endDragSequence(t);return}(!h||!h.isDragging()&&!h.isReceiving())&&(t.cancelable&&t.preventDefault(),this._hasStartedDragging.set(!0),this._ngZone.run(()=>this._startDragSequence(t)))}return}t.cancelable&&t.preventDefault();let i=this._getConstrainedPointerPosition(e);if(this._hasMoved=!0,this._lastKnownPointerPosition=e,this._updatePointerDirectionDelta(i),this._dropContainer)this._updateActiveDropContainer(i,e);else{let r=this.constrainPosition?this._initialDomRect:this._pickupPositionOnPage,s=this._activeTransform;s.x=i.x-r.x+this._passiveTransform.x,s.y=i.y-r.y+this._passiveTransform.y,this._applyRootElementTransform(s.x,s.y)}this._moveEvents.observers.length&&this._ngZone.run(()=>{this._moveEvents.next({source:this,pointerPosition:i,event:t,distance:this._getDragDistance(i),delta:this._pointerDirectionDelta})})};_pointerUp=t=>{this._endDragSequence(t)};_endDragSequence(t){if(this._dragDropRegistry.isDragging(this)&&(this._removeListeners(),this._dragDropRegistry.stopDragging(this),this._toggleNativeDragInteractions(),this._handles&&(this._rootElement.style.webkitTapHighlightColor=this._rootElementTapHighlight),!!this._hasStartedDragging()))if(this.released.next({source:this,event:t}),this._dropContainer)this._dropContainer._stopScrolling(),this._animatePreviewToPlaceholder().then(()=>{this._cleanupDragArtifacts(t),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)});else{this._passiveTransform.x=this._activeTransform.x;let e=this._getPointerPositionOnPage(t);this._passiveTransform.y=this._activeTransform.y,this._ngZone.run(()=>{this.ended.next({source:this,distance:this._getDragDistance(e),dropPoint:e,event:t})}),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)}}_startDragSequence(t){He(t)&&(this._lastTouchEventTime=Date.now()),this._toggleNativeDragInteractions();let e=this._getShadowRoot(),i=this._dropContainer;if(e&&this._ngZone.runOutsideAngular(()=>{this._cleanupShadowRootSelectStart=fe(this._renderer,e,"selectstart",jr,Gr)}),i){let r=this._rootElement,s=r.parentNode,o=this._placeholder=this._createPlaceholderElement(),c=this._anchor=this._anchor||this._document.createComment("");s.insertBefore(c,r),this._initialTransform=r.style.transform||"",this._preview=new qt(this._document,this._rootElement,this._direction,this._initialDomRect,this._previewTemplate||null,this.previewClass||null,this._pickupPositionOnPage,this._initialTransform,this._config.zIndex||1e3,this._renderer),this._preview.attach(this._getPreviewInsertionPoint(s,e)),Ji(r,!1,rr),this._document.body.appendChild(s.replaceChild(o,r)),this.started.next({source:this,event:t}),i.start(),this._initialContainer=i,this._initialIndex=i.getItemIndex(this)}else this.started.next({source:this,event:t}),this._initialContainer=this._initialIndex=void 0;this._parentPositions.cache(i?i.getScrollableParents():[])}_initializeDragSequence(t,e){this._parentDragRef&&e.stopPropagation();let i=this.isDragging(),r=He(e),s=!r&&e.button!==0,o=this._rootElement,c=$e(e),h=!r&&this._lastTouchEventTime&&this._lastTouchEventTime+Ur>Date.now(),g=r?zi(e):Bi(e);if(c&&c.draggable&&e.type==="mousedown"&&e.preventDefault(),i||s||h||g)return;if(this._handles.length){let T=o.style;this._rootElementTapHighlight=T.webkitTapHighlightColor||"",T.webkitTapHighlightColor="transparent"}this._hasMoved=!1,this._hasStartedDragging.set(this._hasMoved),this._removeListeners(),this._initialDomRect=this._rootElement.getBoundingClientRect(),this._pointerMoveSubscription=this._dragDropRegistry.pointerMove.subscribe(this._pointerMove),this._pointerUpSubscription=this._dragDropRegistry.pointerUp.subscribe(this._pointerUp),this._scrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(T=>this._updateOnScroll(T)),this._boundaryElement&&(this._boundaryRect=ei(this._boundaryElement));let _=this._previewTemplate;this._pickupPositionInElement=_&&_.template&&!_.matchSize?{x:0,y:0}:this._getPointerPositionInElement(this._initialDomRect,t,e);let b=this._pickupPositionOnPage=this._lastKnownPointerPosition=this._getPointerPositionOnPage(e);this._pointerDirectionDelta={x:0,y:0},this._pointerPositionAtLastDirectionChange={x:b.x,y:b.y},this._dragStartTime=Date.now(),this._dragDropRegistry.startDragging(this,e)}_cleanupDragArtifacts(t){Ji(this._rootElement,!0,rr),this._anchor.parentNode.replaceChild(this._rootElement,this._anchor),this._destroyPreview(),this._destroyPlaceholder(),this._initialDomRect=this._boundaryRect=this._previewRect=this._initialTransform=void 0,this._ngZone.run(()=>{let e=this._dropContainer,i=e.getItemIndex(this),r=this._getPointerPositionOnPage(t),s=this._getDragDistance(r),o=e._isOverContainer(r.x,r.y);this.ended.next({source:this,distance:s,dropPoint:r,event:t}),this.dropped.next({item:this,currentIndex:i,previousIndex:this._initialIndex,container:e,previousContainer:this._initialContainer,isPointerOverContainer:o,distance:s,dropPoint:r,event:t}),e.drop(this,i,this._initialIndex,this._initialContainer,o,s,r,t),this._dropContainer=this._initialContainer})}_updateActiveDropContainer({x:t,y:e},{x:i,y:r}){let s=this._initialContainer._getSiblingContainerFromPosition(this,t,e);!s&&this._dropContainer!==this._initialContainer&&this._initialContainer._isOverContainer(t,e)&&(s=this._initialContainer),s&&s!==this._dropContainer&&this._ngZone.run(()=>{this.exited.next({item:this,container:this._dropContainer}),this._dropContainer.exit(this),this._dropContainer=s,this._dropContainer.enter(this,t,e,s===this._initialContainer&&s.sortingDisabled?this._initialIndex:void 0),this.entered.next({item:this,container:s,currentIndex:s.getItemIndex(this)})}),this.isDragging()&&(this._dropContainer._startScrollingIfNecessary(i,r),this._dropContainer._sortItem(this,t,e,this._pointerDirectionDelta),this.constrainPosition?this._applyPreviewTransform(t,e):this._applyPreviewTransform(t-this._pickupPositionInElement.x,e-this._pickupPositionInElement.y))}_animatePreviewToPlaceholder(){if(!this._hasMoved)return Promise.resolve();let t=this._placeholder.getBoundingClientRect();this._preview.addClass("cdk-drag-animating"),this._applyPreviewTransform(t.left,t.top);let e=this._preview.getTransitionDuration();return e===0?Promise.resolve():this._ngZone.runOutsideAngular(()=>new Promise(i=>{let r=c=>{(!c||this._preview&&$e(c)===this._preview.element&&c.propertyName==="transform")&&(o(),i(),clearTimeout(s))},s=setTimeout(r,e*1.5),o=this._preview.addEventListener("transitionend",r)}))}_createPlaceholderElement(){let t=this._placeholderTemplate,e=t?t.template:null,i;return e?(this._placeholderRef=t.viewContainer.createEmbeddedView(e,t.context),this._placeholderRef.detectChanges(),i=dr(this._placeholderRef,this._document)):i=lr(this._rootElement),i.style.pointerEvents="none",i.classList.add("cdk-drag-placeholder"),i}_getPointerPositionInElement(t,e,i){let r=e===this._rootElement?null:e,s=r?r.getBoundingClientRect():t,o=He(i)?i.targetTouches[0]:i,c=this._getViewportScrollPosition(),h=o.pageX-s.left-c.left,g=o.pageY-s.top-c.top;return{x:s.left-t.left+h,y:s.top-t.top+g}}_getPointerPositionOnPage(t){let e=this._getViewportScrollPosition(),i=He(t)?t.touches[0]||t.changedTouches[0]||{pageX:0,pageY:0}:t,r=i.pageX-e.left,s=i.pageY-e.top;if(this._ownerSVGElement){let o=this._ownerSVGElement.getScreenCTM();if(o){let c=this._ownerSVGElement.createSVGPoint();return c.x=r,c.y=s,c.matrixTransform(o.inverse())}}return{x:r,y:s}}_getConstrainedPointerPosition(t){let e=this._dropContainer?this._dropContainer.lockAxis:null,{x:i,y:r}=this.constrainPosition?this.constrainPosition(t,this,this._initialDomRect,this._pickupPositionInElement):t;if(this.lockAxis==="x"||e==="x"?r=this._pickupPositionOnPage.y-(this.constrainPosition?this._pickupPositionInElement.y:0):(this.lockAxis==="y"||e==="y")&&(i=this._pickupPositionOnPage.x-(this.constrainPosition?this._pickupPositionInElement.x:0)),this._boundaryRect){let{x:s,y:o}=this.constrainPosition?{x:0,y:0}:this._pickupPositionInElement,c=this._boundaryRect,{width:h,height:g}=this._getPreviewRect(),_=c.top+o,b=c.bottom-(g-o),T=c.left+s,N=c.right-(h-s);i=nr(i,T,N),r=nr(r,_,b)}return{x:i,y:r}}_updatePointerDirectionDelta(t){let{x:e,y:i}=t,r=this._pointerDirectionDelta,s=this._pointerPositionAtLastDirectionChange,o=Math.abs(e-s.x),c=Math.abs(i-s.y);return o>this._config.pointerDirectionChangeThreshold&&(r.x=e>s.x?1:-1,s.x=e),c>this._config.pointerDirectionChangeThreshold&&(r.y=i>s.y?1:-1,s.y=i),r}_toggleNativeDragInteractions(){if(!this._rootElement||!this._handles)return;let t=this._handles.length>0||!this.isDragging();t!==this._nativeInteractionsEnabled&&(this._nativeInteractionsEnabled=t,Le(this._rootElement,t))}_removeRootElementListeners(){this._rootElementCleanups?.forEach(t=>t()),this._rootElementCleanups=void 0}_applyRootElementTransform(t,e){let i=1/this.scale,r=Ct(t*i,e*i),s=this._rootElement.style;this._initialTransform==null&&(this._initialTransform=s.transform&&s.transform!="none"?s.transform:""),s.transform=Et(r,this._initialTransform)}_applyPreviewTransform(t,e){let i=this._previewTemplate?.template?void 0:this._initialTransform,r=Ct(t,e);this._preview.setTransform(Et(r,i))}_getDragDistance(t){let e=this._pickupPositionOnPage;return e?{x:t.x-e.x,y:t.y-e.y}:{x:0,y:0}}_cleanupCachedDimensions(){this._boundaryRect=this._previewRect=void 0,this._parentPositions.clear()}_containInsideBoundaryOnResize(){let{x:t,y:e}=this._passiveTransform;if(t===0&&e===0||this.isDragging()||!this._boundaryElement)return;let i=this._rootElement.getBoundingClientRect(),r=this._boundaryElement.getBoundingClientRect();if(r.width===0&&r.height===0||i.width===0&&i.height===0)return;let s=r.left-i.left,o=i.right-r.right,c=r.top-i.top,h=i.bottom-r.bottom;r.width>i.width?(s>0&&(t+=s),o>0&&(t-=o)):t=0,r.height>i.height?(c>0&&(e+=c),h>0&&(e-=h)):e=0,(t!==this._passiveTransform.x||e!==this._passiveTransform.y)&&this.setFreeDragPosition({y:e,x:t})}_getDragStartDelay(t){let e=this.dragStartDelay;return typeof e=="number"?e:He(t)?e.touch:e?e.mouse:0}_updateOnScroll(t){let e=this._parentPositions.handleScroll(t);if(e){let i=$e(t);this._boundaryRect&&i!==this._boundaryElement&&i.contains(this._boundaryElement)&&Ke(this._boundaryRect,e.top,e.left),this._pickupPositionOnPage.x+=e.left,this._pickupPositionOnPage.y+=e.top,this._dropContainer||(this._activeTransform.x-=e.left,this._activeTransform.y-=e.top,this._applyRootElementTransform(this._activeTransform.x,this._activeTransform.y))}}_getViewportScrollPosition(){return this._parentPositions.positions.get(this._document)?.scrollPosition||this._parentPositions.getViewportScrollPosition()}_getShadowRoot(){return this._cachedShadowRoot===void 0&&(this._cachedShadowRoot=yt(this._rootElement)),this._cachedShadowRoot}_getPreviewInsertionPoint(t,e){let i=this._previewContainer||"global";if(i==="parent")return t;if(i==="global"){let r=this._document;return e||r.fullscreenElement||r.webkitFullscreenElement||r.mozFullScreenElement||r.msFullscreenElement||r.body}return ie(i)}_getPreviewRect(){return(!this._previewRect||!this._previewRect.width&&!this._previewRect.height)&&(this._previewRect=this._preview?this._preview.getBoundingClientRect():this._initialDomRect),this._previewRect}_nativeDragStart=t=>{if(this._handles.length){let e=this._getTargetHandle(t);e&&!this._disabledHandles.has(e)&&!this.disabled&&t.preventDefault()}else this.disabled||t.preventDefault()};_getTargetHandle(t){return this._handles.find(e=>t.target&&(t.target===e||e.contains(t.target)))}};function nr(n,t,e){return Math.max(t,Math.min(e,n))}function He(n){return n.type[0]==="t"}function jr(n){n.preventDefault()}function Tt(n,t,e){let i=sr(t,n.length-1),r=sr(e,n.length-1);if(i===r)return;let s=n[i],o=r<i?-1:1;for(let c=i;c!==r;c+=o)n[c]=n[c+o];n[r]=s}function sr(n,t){return Math.max(0,Math.min(t,n))}var It=class{_dragDropRegistry;_element;_sortPredicate;_itemPositions=[];_activeDraggables;orientation="vertical";direction;constructor(t){this._dragDropRegistry=t}_previousSwap={drag:null,delta:0,overlaps:!1};start(t){this.withItems(t)}sort(t,e,i,r){let s=this._itemPositions,o=this._getItemIndexFromPointerPosition(t,e,i,r);if(o===-1&&s.length>0)return null;let c=this.orientation==="horizontal",h=s.findIndex(R=>R.drag===t),g=s[o],_=s[h].clientRect,b=g.clientRect,T=h>o?1:-1,N=this._getItemOffsetPx(_,b,T),F=this._getSiblingOffsetPx(h,s,T),D=s.slice();return Tt(s,h,o),s.forEach((R,ni)=>{if(D[ni]===R)return;let si=R.drag===t,Vt=si?N:F,oi=si?t.getPlaceholderElement():R.drag.getRootElement();R.offset+=Vt;let ai=Math.round(R.offset*(1/R.drag.scale));c?(oi.style.transform=Et(`translate3d(${ai}px, 0, 0)`,R.initialTransform),Ke(R.clientRect,0,Vt)):(oi.style.transform=Et(`translate3d(0, ${ai}px, 0)`,R.initialTransform),Ke(R.clientRect,Vt,0))}),this._previousSwap.overlaps=Kt(b,e,i),this._previousSwap.drag=g.drag,this._previousSwap.delta=c?r.x:r.y,{previousIndex:h,currentIndex:o}}enter(t,e,i,r){let s=r==null||r<0?this._getItemIndexFromPointerPosition(t,e,i):r,o=this._activeDraggables,c=o.indexOf(t),h=t.getPlaceholderElement(),g=o[s];if(g===t&&(g=o[s+1]),!g&&(s==null||s===-1||s<o.length-1)&&this._shouldEnterAsFirstChild(e,i)&&(g=o[0]),c>-1&&o.splice(c,1),g&&!this._dragDropRegistry.isDragging(g)){let _=g.getRootElement();_.parentElement.insertBefore(h,_),o.splice(s,0,t)}else this._element.appendChild(h),o.push(t);h.style.transform="",this._cacheItemPositions()}withItems(t){this._activeDraggables=t.slice(),this._cacheItemPositions()}withSortPredicate(t){this._sortPredicate=t}reset(){this._activeDraggables?.forEach(t=>{let e=t.getRootElement();if(e){let i=this._itemPositions.find(r=>r.drag===t)?.initialTransform;e.style.transform=i||""}}),this._itemPositions=[],this._activeDraggables=[],this._previousSwap.drag=null,this._previousSwap.delta=0,this._previousSwap.overlaps=!1}getActiveItemsSnapshot(){return this._activeDraggables}getItemIndex(t){return(this.orientation==="horizontal"&&this.direction==="rtl"?this._itemPositions.slice().reverse():this._itemPositions).findIndex(i=>i.drag===t)}updateOnScroll(t,e){this._itemPositions.forEach(({clientRect:i})=>{Ke(i,t,e)}),this._itemPositions.forEach(({drag:i})=>{this._dragDropRegistry.isDragging(i)&&i._sortFromLastPointerPosition()})}withElementContainer(t){this._element=t}_cacheItemPositions(){let t=this.orientation==="horizontal";this._itemPositions=this._activeDraggables.map(e=>{let i=e.getVisibleElement();return{drag:e,offset:0,initialTransform:i.style.transform||"",clientRect:ei(i)}}).sort((e,i)=>t?e.clientRect.left-i.clientRect.left:e.clientRect.top-i.clientRect.top)}_getItemOffsetPx(t,e,i){let r=this.orientation==="horizontal",s=r?e.left-t.left:e.top-t.top;return i===-1&&(s+=r?e.width-t.width:e.height-t.height),s}_getSiblingOffsetPx(t,e,i){let r=this.orientation==="horizontal",s=e[t].clientRect,o=e[t+i*-1],c=s[r?"width":"height"]*i;if(o){let h=r?"left":"top",g=r?"right":"bottom";i===-1?c-=o.clientRect[h]-s[g]:c+=s[h]-o.clientRect[g]}return c}_shouldEnterAsFirstChild(t,e){if(!this._activeDraggables.length)return!1;let i=this._itemPositions,r=this.orientation==="horizontal";if(i[0].drag!==this._activeDraggables[0]){let o=i[i.length-1].clientRect;return r?t>=o.right:e>=o.bottom}else{let o=i[0].clientRect;return r?t<=o.left:e<=o.top}}_getItemIndexFromPointerPosition(t,e,i,r){let s=this.orientation==="horizontal",o=this._itemPositions.findIndex(({drag:c,clientRect:h})=>{if(c===t)return!1;if(r){let g=s?r.x:r.y;if(c===this._previousSwap.drag&&this._previousSwap.overlaps&&g===this._previousSwap.delta)return!1}return s?e>=Math.floor(h.left)&&e<Math.floor(h.right):i>=Math.floor(h.top)&&i<Math.floor(h.bottom)});return o===-1||!this._sortPredicate(o,t)?-1:o}},Qt=class{_document;_dragDropRegistry;_element;_sortPredicate;_rootNode;_activeItems;_previousSwap={drag:null,deltaX:0,deltaY:0,overlaps:!1};_relatedNodes=[];constructor(t,e){this._document=t,this._dragDropRegistry=e}start(t){let e=this._element.childNodes;this._relatedNodes=[];for(let i=0;i<e.length;i++){let r=e[i];this._relatedNodes.push([r,r.nextSibling])}this.withItems(t)}sort(t,e,i,r){let s=this._getItemIndexFromPointerPosition(t,e,i),o=this._previousSwap;if(s===-1||this._activeItems[s]===t)return null;let c=this._activeItems[s];if(o.drag===c&&o.overlaps&&o.deltaX===r.x&&o.deltaY===r.y)return null;let h=this.getItemIndex(t),g=t.getPlaceholderElement(),_=c.getRootElement();s>h?_.after(g):_.before(g),Tt(this._activeItems,h,s);let b=this._getRootNode().elementFromPoint(e,i);return o.deltaX=r.x,o.deltaY=r.y,o.drag=c,o.overlaps=_===b||_.contains(b),{previousIndex:h,currentIndex:s}}enter(t,e,i,r){let s=r==null||r<0?this._getItemIndexFromPointerPosition(t,e,i):r;s===-1&&(s=this._getClosestItemIndexToPointer(t,e,i));let o=this._activeItems[s],c=this._activeItems.indexOf(t);c>-1&&this._activeItems.splice(c,1),o&&!this._dragDropRegistry.isDragging(o)?(this._activeItems.splice(s,0,t),o.getRootElement().before(t.getPlaceholderElement())):(this._activeItems.push(t),this._element.appendChild(t.getPlaceholderElement()))}withItems(t){this._activeItems=t.slice()}withSortPredicate(t){this._sortPredicate=t}reset(){let t=this._element,e=this._previousSwap;for(let i=this._relatedNodes.length-1;i>-1;i--){let[r,s]=this._relatedNodes[i];r.parentNode===t&&r.nextSibling!==s&&(s===null?t.appendChild(r):s.parentNode===t&&t.insertBefore(r,s))}this._relatedNodes=[],this._activeItems=[],e.drag=null,e.deltaX=e.deltaY=0,e.overlaps=!1}getActiveItemsSnapshot(){return this._activeItems}getItemIndex(t){return this._activeItems.indexOf(t)}updateOnScroll(){this._activeItems.forEach(t=>{this._dragDropRegistry.isDragging(t)&&t._sortFromLastPointerPosition()})}withElementContainer(t){t!==this._element&&(this._element=t,this._rootNode=void 0)}_getItemIndexFromPointerPosition(t,e,i){let r=this._getRootNode().elementFromPoint(Math.floor(e),Math.floor(i)),s=r?this._activeItems.findIndex(o=>{let c=o.getRootElement();return r===c||c.contains(r)}):-1;return s===-1||!this._sortPredicate(s,t)?-1:s}_getRootNode(){return this._rootNode||(this._rootNode=yt(this._element)||this._document),this._rootNode}_getClosestItemIndexToPointer(t,e,i){if(this._activeItems.length===0)return-1;if(this._activeItems.length===1)return 0;let r=1/0,s=-1;for(let o=0;o<this._activeItems.length;o++){let c=this._activeItems[o];if(c!==t){let{x:h,y:g}=c.getRootElement().getBoundingClientRect(),_=Math.hypot(e-h,i-g);_<r&&(r=_,s=o)}}return s}},or=.05,cr=.05,$=function(n){return n[n.NONE=0]="NONE",n[n.UP=1]="UP",n[n.DOWN=2]="DOWN",n}($||{}),z=function(n){return n[n.NONE=0]="NONE",n[n.LEFT=1]="LEFT",n[n.RIGHT=2]="RIGHT",n}(z||{}),Jt=class{_dragDropRegistry;_ngZone;_viewportRuler;element;disabled=!1;sortingDisabled=!1;lockAxis;autoScrollDisabled=!1;autoScrollStep=2;enterPredicate=()=>!0;sortPredicate=()=>!0;beforeStarted=new P;entered=new P;exited=new P;dropped=new P;sorted=new P;receivingStarted=new P;receivingStopped=new P;data;_container;_isDragging=!1;_parentPositions;_sortStrategy;_domRect;_draggables=[];_siblings=[];_activeSiblings=new Set;_viewportScrollSubscription=xe.EMPTY;_verticalScrollDirection=$.NONE;_horizontalScrollDirection=z.NONE;_scrollNode;_stopScrollTimers=new P;_cachedShadowRoot=null;_document;_scrollableElements=[];_initialScrollSnap;_direction="ltr";constructor(t,e,i,r,s){this._dragDropRegistry=e,this._ngZone=r,this._viewportRuler=s;let o=this.element=ie(t);this._document=i,this.withOrientation("vertical").withElementContainer(o),e.registerDropContainer(this),this._parentPositions=new kt(i)}dispose(){this._stopScrolling(),this._stopScrollTimers.complete(),this._viewportScrollSubscription.unsubscribe(),this.beforeStarted.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this.sorted.complete(),this.receivingStarted.complete(),this.receivingStopped.complete(),this._activeSiblings.clear(),this._scrollNode=null,this._parentPositions.clear(),this._dragDropRegistry.removeDropContainer(this)}isDragging(){return this._isDragging}start(){this._draggingStarted(),this._notifyReceivingSiblings()}enter(t,e,i,r){this._draggingStarted(),r==null&&this.sortingDisabled&&(r=this._draggables.indexOf(t)),this._sortStrategy.enter(t,e,i,r),this._cacheParentPositions(),this._notifyReceivingSiblings(),this.entered.next({item:t,container:this,currentIndex:this.getItemIndex(t)})}exit(t){this._reset(),this.exited.next({item:t,container:this})}drop(t,e,i,r,s,o,c,h={}){this._reset(),this.dropped.next({item:t,currentIndex:e,previousIndex:i,container:this,previousContainer:r,isPointerOverContainer:s,distance:o,dropPoint:c,event:h})}withItems(t){let e=this._draggables;return this._draggables=t,t.forEach(i=>i._withDropContainer(this)),this.isDragging()&&(e.filter(r=>r.isDragging()).every(r=>t.indexOf(r)===-1)?this._reset():this._sortStrategy.withItems(this._draggables)),this}withDirection(t){return this._direction=t,this._sortStrategy instanceof It&&(this._sortStrategy.direction=t),this}connectedTo(t){return this._siblings=t.slice(),this}withOrientation(t){if(t==="mixed")this._sortStrategy=new Qt(this._document,this._dragDropRegistry);else{let e=new It(this._dragDropRegistry);e.direction=this._direction,e.orientation=t,this._sortStrategy=e}return this._sortStrategy.withElementContainer(this._container),this._sortStrategy.withSortPredicate((e,i)=>this.sortPredicate(e,i,this)),this}withScrollableParents(t){let e=this._container;return this._scrollableElements=t.indexOf(e)===-1?[e,...t]:t.slice(),this}withElementContainer(t){if(t===this._container)return this;let e=ie(this.element),i=this._scrollableElements.indexOf(this._container),r=this._scrollableElements.indexOf(t);return i>-1&&this._scrollableElements.splice(i,1),r>-1&&this._scrollableElements.splice(r,1),this._sortStrategy&&this._sortStrategy.withElementContainer(t),this._cachedShadowRoot=null,this._scrollableElements.unshift(t),this._container=t,this}getScrollableParents(){return this._scrollableElements}getItemIndex(t){return this._isDragging?this._sortStrategy.getItemIndex(t):this._draggables.indexOf(t)}isReceiving(){return this._activeSiblings.size>0}_sortItem(t,e,i,r){if(this.sortingDisabled||!this._domRect||!Qi(this._domRect,or,e,i))return;let s=this._sortStrategy.sort(t,e,i,r);s&&this.sorted.next({previousIndex:s.previousIndex,currentIndex:s.currentIndex,container:this,item:t})}_startScrollingIfNecessary(t,e){if(this.autoScrollDisabled)return;let i,r=$.NONE,s=z.NONE;if(this._parentPositions.positions.forEach((o,c)=>{c===this._document||!o.clientRect||i||Qi(o.clientRect,or,t,e)&&([r,s]=$r(c,o.clientRect,this._direction,t,e),(r||s)&&(i=c))}),!r&&!s){let{width:o,height:c}=this._viewportRuler.getViewportSize(),h={width:o,height:c,top:0,right:o,bottom:c,left:0};r=ur(h,e),s=pr(h,t),i=window}i&&(r!==this._verticalScrollDirection||s!==this._horizontalScrollDirection||i!==this._scrollNode)&&(this._verticalScrollDirection=r,this._horizontalScrollDirection=s,this._scrollNode=i,(r||s)&&i?this._ngZone.runOutsideAngular(this._startScrollInterval):this._stopScrolling())}_stopScrolling(){this._stopScrollTimers.next()}_draggingStarted(){let t=this._container.style;this.beforeStarted.next(),this._isDragging=!0,this._initialScrollSnap=t.msScrollSnapType||t.scrollSnapType||"",t.scrollSnapType=t.msScrollSnapType="none",this._sortStrategy.start(this._draggables),this._cacheParentPositions(),this._viewportScrollSubscription.unsubscribe(),this._listenToScrollEvents()}_cacheParentPositions(){this._parentPositions.cache(this._scrollableElements),this._domRect=this._parentPositions.positions.get(this._container).clientRect}_reset(){this._isDragging=!1;let t=this._container.style;t.scrollSnapType=t.msScrollSnapType=this._initialScrollSnap,this._siblings.forEach(e=>e._stopReceiving(this)),this._sortStrategy.reset(),this._stopScrolling(),this._viewportScrollSubscription.unsubscribe(),this._parentPositions.clear()}_startScrollInterval=()=>{this._stopScrolling(),ci(0,Wt).pipe(ke(this._stopScrollTimers)).subscribe(()=>{let t=this._scrollNode,e=this.autoScrollStep;this._verticalScrollDirection===$.UP?t.scrollBy(0,-e):this._verticalScrollDirection===$.DOWN&&t.scrollBy(0,e),this._horizontalScrollDirection===z.LEFT?t.scrollBy(-e,0):this._horizontalScrollDirection===z.RIGHT&&t.scrollBy(e,0)})};_isOverContainer(t,e){return this._domRect!=null&&Kt(this._domRect,t,e)}_getSiblingContainerFromPosition(t,e,i){return this._siblings.find(r=>r._canReceive(t,e,i))}_canReceive(t,e,i){if(!this._domRect||!Kt(this._domRect,e,i)||!this.enterPredicate(t,this))return!1;let r=this._getShadowRoot().elementFromPoint(e,i);return r?r===this._container||this._container.contains(r):!1}_startReceiving(t,e){let i=this._activeSiblings;!i.has(t)&&e.every(r=>this.enterPredicate(r,this)||this._draggables.indexOf(r)>-1)&&(i.add(t),this._cacheParentPositions(),this._listenToScrollEvents(),this.receivingStarted.next({initiator:t,receiver:this,items:e}))}_stopReceiving(t){this._activeSiblings.delete(t),this._viewportScrollSubscription.unsubscribe(),this.receivingStopped.next({initiator:t,receiver:this})}_listenToScrollEvents(){this._viewportScrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(t=>{if(this.isDragging()){let e=this._parentPositions.handleScroll(t);e&&this._sortStrategy.updateOnScroll(e.top,e.left)}else this.isReceiving()&&this._cacheParentPositions()})}_getShadowRoot(){if(!this._cachedShadowRoot){let t=yt(this._container);this._cachedShadowRoot=t||this._document}return this._cachedShadowRoot}_notifyReceivingSiblings(){let t=this._sortStrategy.getActiveItemsSnapshot().filter(e=>e.isDragging());this._siblings.forEach(e=>e._startReceiving(this,t))}};function ur(n,t){let{top:e,bottom:i,height:r}=n,s=r*cr;return t>=e-s&&t<=e+s?$.UP:t>=i-s&&t<=i+s?$.DOWN:$.NONE}function pr(n,t){let{left:e,right:i,width:r}=n,s=r*cr;return t>=e-s&&t<=e+s?z.LEFT:t>=i-s&&t<=i+s?z.RIGHT:z.NONE}function $r(n,t,e,i,r){let s=ur(t,r),o=pr(t,i),c=$.NONE,h=z.NONE;if(s){let g=n.scrollTop;s===$.UP?g>0&&(c=$.UP):n.scrollHeight-g>n.clientHeight&&(c=$.DOWN)}if(o){let g=n.scrollLeft;e==="rtl"?o===z.RIGHT?g<0&&(h=z.RIGHT):n.scrollWidth+g>n.clientWidth&&(h=z.LEFT):o===z.LEFT?g>0&&(h=z.LEFT):n.scrollWidth-g>n.clientWidth&&(h=z.RIGHT)}return[c,h]}var Ze={capture:!0},Zt={passive:!1,capture:!0},Hr=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275cmp=j({type:n,selectors:[["ng-component"]],hostAttrs:["cdk-drag-resets-container",""],decls:0,vars:0,template:function(i,r){},styles:[`@layer cdk-resets{.cdk-drag-preview{background:none;border:none;padding:0;color:inherit;inset:auto}}.cdk-drag-placeholder *,.cdk-drag-preview *{pointer-events:none !important}
`],encapsulation:2,changeDetection:0})}return n})(),ii=(()=>{class n{_ngZone=f(be);_document=f(Se);_styleLoader=f(Gi);_renderer=f(Ee).createRenderer(null,null);_cleanupDocumentTouchmove;_dropInstances=new Set;_dragInstances=new Set;_activeDragInstances=C([]);_globalListeners;_draggingPredicate=e=>e.isDragging();_domNodesToDirectives=null;pointerMove=new P;pointerUp=new P;scroll=new P;constructor(){}registerDropContainer(e){this._dropInstances.has(e)||this._dropInstances.add(e)}registerDragItem(e){this._dragInstances.add(e),this._dragInstances.size===1&&this._ngZone.runOutsideAngular(()=>{this._cleanupDocumentTouchmove?.(),this._cleanupDocumentTouchmove=fe(this._renderer,this._document,"touchmove",this._persistentTouchmoveListener,Zt)})}removeDropContainer(e){this._dropInstances.delete(e)}removeDragItem(e){this._dragInstances.delete(e),this.stopDragging(e),this._dragInstances.size===0&&this._cleanupDocumentTouchmove?.()}startDragging(e,i){if(!(this._activeDragInstances().indexOf(e)>-1)&&(this._styleLoader.load(Hr),this._activeDragInstances.update(r=>[...r,e]),this._activeDragInstances().length===1)){let r=i.type.startsWith("touch"),s=c=>this.pointerUp.next(c),o=[["scroll",c=>this.scroll.next(c),Ze],["selectstart",this._preventDefaultWhileDragging,Zt]];r?o.push(["touchend",s,Ze],["touchcancel",s,Ze]):o.push(["mouseup",s,Ze]),r||o.push(["mousemove",c=>this.pointerMove.next(c),Zt]),this._ngZone.runOutsideAngular(()=>{this._globalListeners=o.map(([c,h,g])=>fe(this._renderer,this._document,c,h,g))})}}stopDragging(e){this._activeDragInstances.update(i=>{let r=i.indexOf(e);return r>-1?(i.splice(r,1),[...i]):i}),this._activeDragInstances().length===0&&this._clearGlobalListeners()}isDragging(e){return this._activeDragInstances().indexOf(e)>-1}scrolled(e){let i=[this.scroll];return e&&e!==this._document&&i.push(new Be(r=>this._ngZone.runOutsideAngular(()=>{let s=fe(this._renderer,e,"scroll",o=>{this._activeDragInstances().length&&r.next(o)},Ze);return()=>{s()}}))),qe(...i)}registerDirectiveNode(e,i){this._domNodesToDirectives??=new WeakMap,this._domNodesToDirectives.set(e,i)}removeDirectiveNode(e){this._domNodesToDirectives?.delete(e)}getDragDirectiveForNode(e){return this._domNodesToDirectives?.get(e)||null}ngOnDestroy(){this._dragInstances.forEach(e=>this.removeDragItem(e)),this._dropInstances.forEach(e=>this.removeDropContainer(e)),this._domNodesToDirectives=null,this._clearGlobalListeners(),this.pointerMove.complete(),this.pointerUp.complete()}_preventDefaultWhileDragging=e=>{this._activeDragInstances().length>0&&e.preventDefault()};_persistentTouchmoveListener=e=>{this._activeDragInstances().length>0&&(this._activeDragInstances().some(this._draggingPredicate)&&e.preventDefault(),this.pointerMove.next(e))};_clearGlobalListeners(){this._globalListeners?.forEach(e=>e()),this._globalListeners=void 0}static \u0275fac=function(i){return new(i||n)};static \u0275prov=U({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Zr={dragStartThreshold:5,pointerDirectionChangeThreshold:5},ri=(()=>{class n{_document=f(Se);_ngZone=f(be);_viewportRuler=f(ji);_dragDropRegistry=f(ii);_renderer=f(Ee).createRenderer(null,null);constructor(){}createDrag(e,i=Zr){return new Yt(e,i,this._document,this._ngZone,this._viewportRuler,this._dragDropRegistry,this._renderer)}createDropList(e){return new Jt(e,this._dragDropRegistry,this._document,this._ngZone,this._viewportRuler)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=U({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Xt=new se("CDK_DRAG_PARENT");var mr=new se("CdkDragHandle"),hr=(()=>{class n{element=f(ye);_parentDrag=f(Xt,{optional:!0,skipSelf:!0});_dragDropRegistry=f(ii);_stateChanges=new P;get disabled(){return this._disabled}set disabled(e){this._disabled=e,this._stateChanges.next(this)}_disabled=!1;constructor(){this._parentDrag?._addHandle(this)}ngAfterViewInit(){if(!this._parentDrag){let e=this.element.nativeElement.parentElement;for(;e;){let i=this._dragDropRegistry.getDragDirectiveForNode(e);if(i){this._parentDrag=i,i._addHandle(this);break}e=e.parentElement}}}ngOnDestroy(){this._parentDrag?._removeHandle(this),this._stateChanges.complete()}static \u0275fac=function(i){return new(i||n)};static \u0275dir=Ue({type:n,selectors:[["","cdkDragHandle",""]],hostAttrs:[1,"cdk-drag-handle"],inputs:{disabled:[2,"cdkDragHandleDisabled","disabled",we]},features:[ae([{provide:mr,useExisting:n}])]})}return n})(),gr=new se("CDK_DRAG_CONFIG"),_r=new se("CdkDropList"),fr=(()=>{class n{element=f(ye);dropContainer=f(_r,{optional:!0,skipSelf:!0});_ngZone=f(be);_viewContainerRef=f(Mt);_dir=f(jt,{optional:!0});_changeDetectorRef=f(ue);_selfHandle=f(mr,{optional:!0,self:!0});_parentDrag=f(Xt,{optional:!0,skipSelf:!0});_dragDropRegistry=f(ii);_destroyed=new P;_handles=new li([]);_previewTemplate;_placeholderTemplate;_dragRef;data;lockAxis;rootElementSelector;boundaryElement;dragStartDelay;freeDragPosition;get disabled(){return this._disabled||!!(this.dropContainer&&this.dropContainer.disabled)}set disabled(e){this._disabled=e,this._dragRef.disabled=this._disabled}_disabled;constrainPosition;previewClass;previewContainer;scale=1;started=new L;released=new L;ended=new L;entered=new L;exited=new L;dropped=new L;moved=new Be(e=>{let i=this._dragRef.moved.pipe(ve(r=>({source:this,pointerPosition:r.pointerPosition,event:r.event,delta:r.delta,distance:r.distance}))).subscribe(e);return()=>{i.unsubscribe()}});_injector=f(ze);constructor(){let e=this.dropContainer,i=f(gr,{optional:!0}),r=f(ri);this._dragRef=r.createDrag(this.element,{dragStartThreshold:i&&i.dragStartThreshold!=null?i.dragStartThreshold:5,pointerDirectionChangeThreshold:i&&i.pointerDirectionChangeThreshold!=null?i.pointerDirectionChangeThreshold:5,zIndex:i?.zIndex}),this._dragRef.data=this,this._dragDropRegistry.registerDirectiveNode(this.element.nativeElement,this),i&&this._assignDefaults(i),e&&(this._dragRef._withDropContainer(e._dropListRef),e.addItem(this),e._dropListRef.beforeStarted.pipe(ke(this._destroyed)).subscribe(()=>{this._dragRef.scale=this.scale})),this._syncInputs(this._dragRef),this._handleEvents(this._dragRef)}getPlaceholderElement(){return this._dragRef.getPlaceholderElement()}getRootElement(){return this._dragRef.getRootElement()}reset(){this._dragRef.reset()}getFreeDragPosition(){return this._dragRef.getFreeDragPosition()}setFreeDragPosition(e){this._dragRef.setFreeDragPosition(e)}ngAfterViewInit(){Nt(()=>{this._updateRootElement(),this._setupHandlesListener(),this._dragRef.scale=this.scale,this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)},{injector:this._injector})}ngOnChanges(e){let i=e.rootElementSelector,r=e.freeDragPosition;i&&!i.firstChange&&this._updateRootElement(),this._dragRef.scale=this.scale,r&&!r.firstChange&&this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)}ngOnDestroy(){this.dropContainer&&this.dropContainer.removeItem(this),this._dragDropRegistry.removeDirectiveNode(this.element.nativeElement),this._ngZone.runOutsideAngular(()=>{this._handles.complete(),this._destroyed.next(),this._destroyed.complete(),this._dragRef.dispose()})}_addHandle(e){let i=this._handles.getValue();i.push(e),this._handles.next(i)}_removeHandle(e){let i=this._handles.getValue(),r=i.indexOf(e);r>-1&&(i.splice(r,1),this._handles.next(i))}_setPreviewTemplate(e){this._previewTemplate=e}_resetPreviewTemplate(e){e===this._previewTemplate&&(this._previewTemplate=null)}_setPlaceholderTemplate(e){this._placeholderTemplate=e}_resetPlaceholderTemplate(e){e===this._placeholderTemplate&&(this._placeholderTemplate=null)}_updateRootElement(){let e=this.element.nativeElement,i=e;this.rootElementSelector&&(i=e.closest!==void 0?e.closest(this.rootElementSelector):e.parentElement?.closest(this.rootElementSelector)),this._dragRef.withRootElement(i||e)}_getBoundaryElement(){let e=this.boundaryElement;return e?typeof e=="string"?this.element.nativeElement.closest(e):ie(e):null}_syncInputs(e){e.beforeStarted.subscribe(()=>{if(!e.isDragging()){let i=this._dir,r=this.dragStartDelay,s=this._placeholderTemplate?{template:this._placeholderTemplate.templateRef,context:this._placeholderTemplate.data,viewContainer:this._viewContainerRef}:null,o=this._previewTemplate?{template:this._previewTemplate.templateRef,context:this._previewTemplate.data,matchSize:this._previewTemplate.matchSize,viewContainer:this._viewContainerRef}:null;e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.scale=this.scale,e.dragStartDelay=typeof r=="object"&&r?r:bt(r),e.constrainPosition=this.constrainPosition,e.previewClass=this.previewClass,e.withBoundaryElement(this._getBoundaryElement()).withPlaceholderTemplate(s).withPreviewTemplate(o).withPreviewContainer(this.previewContainer||"global"),i&&e.withDirection(i.value)}}),e.beforeStarted.pipe(G(1)).subscribe(()=>{if(this._parentDrag){e.withParent(this._parentDrag._dragRef);return}let i=this.element.nativeElement.parentElement;for(;i;){let r=this._dragDropRegistry.getDragDirectiveForNode(i);if(r){e.withParent(r._dragRef);break}i=i.parentElement}})}_handleEvents(e){e.started.subscribe(i=>{this.started.emit({source:this,event:i.event}),this._changeDetectorRef.markForCheck()}),e.released.subscribe(i=>{this.released.emit({source:this,event:i.event})}),e.ended.subscribe(i=>{this.ended.emit({source:this,distance:i.distance,dropPoint:i.dropPoint,event:i.event}),this._changeDetectorRef.markForCheck()}),e.entered.subscribe(i=>{this.entered.emit({container:i.container.data,item:this,currentIndex:i.currentIndex})}),e.exited.subscribe(i=>{this.exited.emit({container:i.container.data,item:this})}),e.dropped.subscribe(i=>{this.dropped.emit({previousIndex:i.previousIndex,currentIndex:i.currentIndex,previousContainer:i.previousContainer.data,container:i.container.data,isPointerOverContainer:i.isPointerOverContainer,item:this,distance:i.distance,dropPoint:i.dropPoint,event:i.event})})}_assignDefaults(e){let{lockAxis:i,dragStartDelay:r,constrainPosition:s,previewClass:o,boundaryElement:c,draggingDisabled:h,rootElementSelector:g,previewContainer:_}=e;this.disabled=h??!1,this.dragStartDelay=r||0,i&&(this.lockAxis=i),s&&(this.constrainPosition=s),o&&(this.previewClass=o),c&&(this.boundaryElement=c),g&&(this.rootElementSelector=g),_&&(this.previewContainer=_)}_setupHandlesListener(){this._handles.pipe(de(e=>{let i=e.map(r=>r.element);this._selfHandle&&this.rootElementSelector&&i.push(this.element),this._dragRef.withHandles(i)}),ne(e=>qe(...e.map(i=>i._stateChanges.pipe(Ye(i))))),ke(this._destroyed)).subscribe(e=>{let i=this._dragRef,r=e.element.nativeElement;e.disabled?i.disableHandle(r):i.enableHandle(r)})}static \u0275fac=function(i){return new(i||n)};static \u0275dir=Ue({type:n,selectors:[["","cdkDrag",""]],hostAttrs:[1,"cdk-drag"],hostVars:4,hostBindings:function(i,r){i&2&&ce("cdk-drag-disabled",r.disabled)("cdk-drag-dragging",r._dragRef.isDragging())},inputs:{data:[0,"cdkDragData","data"],lockAxis:[0,"cdkDragLockAxis","lockAxis"],rootElementSelector:[0,"cdkDragRootElement","rootElementSelector"],boundaryElement:[0,"cdkDragBoundary","boundaryElement"],dragStartDelay:[0,"cdkDragStartDelay","dragStartDelay"],freeDragPosition:[0,"cdkDragFreeDragPosition","freeDragPosition"],disabled:[2,"cdkDragDisabled","disabled",we],constrainPosition:[0,"cdkDragConstrainPosition","constrainPosition"],previewClass:[0,"cdkDragPreviewClass","previewClass"],previewContainer:[0,"cdkDragPreviewContainer","previewContainer"],scale:[2,"cdkDragScale","scale",bi]},outputs:{started:"cdkDragStarted",released:"cdkDragReleased",ended:"cdkDragEnded",entered:"cdkDragEntered",exited:"cdkDragExited",dropped:"cdkDragDropped",moved:"cdkDragMoved"},exportAs:["cdkDrag"],features:[ae([{provide:Xt,useExisting:n}]),Ge]})}return n})(),ar=new se("CdkDropListGroup");var xr=(()=>{class n{element=f(ye);_changeDetectorRef=f(ue);_scrollDispatcher=f(Ui);_dir=f(jt,{optional:!0});_group=f(ar,{optional:!0,skipSelf:!0});_latestSortedRefs;_destroyed=new P;_scrollableParentsResolved;static _dropLists=[];_dropListRef;connectedTo=[];data;orientation;id=f(Hi).getId("cdk-drop-list-");lockAxis;get disabled(){return this._disabled||!!this._group&&this._group.disabled}set disabled(e){this._dropListRef.disabled=this._disabled=e}_disabled;sortingDisabled;enterPredicate=()=>!0;sortPredicate=()=>!0;autoScrollDisabled;autoScrollStep;elementContainerSelector;dropped=new L;entered=new L;exited=new L;sorted=new L;_unsortedItems=new Set;constructor(){let e=f(ri),i=f(gr,{optional:!0});this._dropListRef=e.createDropList(this.element),this._dropListRef.data=this,i&&this._assignDefaults(i),this._dropListRef.enterPredicate=(r,s)=>this.enterPredicate(r.data,s.data),this._dropListRef.sortPredicate=(r,s,o)=>this.sortPredicate(r,s.data,o.data),this._setupInputSyncSubscription(this._dropListRef),this._handleEvents(this._dropListRef),n._dropLists.push(this),this._group&&this._group._items.add(this)}addItem(e){this._unsortedItems.add(e),this._dropListRef.isDragging()&&this._syncItemsWithRef(this.getSortedItems().map(i=>i._dragRef))}removeItem(e){if(this._unsortedItems.delete(e),this._latestSortedRefs){let i=this._latestSortedRefs.indexOf(e._dragRef);i>-1&&(this._latestSortedRefs.splice(i,1),this._syncItemsWithRef(this._latestSortedRefs))}}getSortedItems(){return Array.from(this._unsortedItems).sort((e,i)=>e._dragRef.getVisibleElement().compareDocumentPosition(i._dragRef.getVisibleElement())&Node.DOCUMENT_POSITION_FOLLOWING?-1:1)}ngOnDestroy(){let e=n._dropLists.indexOf(this);e>-1&&n._dropLists.splice(e,1),this._group&&this._group._items.delete(this),this._latestSortedRefs=void 0,this._unsortedItems.clear(),this._dropListRef.dispose(),this._destroyed.next(),this._destroyed.complete()}_setupInputSyncSubscription(e){this._dir&&this._dir.change.pipe(Ye(this._dir.value),ke(this._destroyed)).subscribe(i=>e.withDirection(i)),e.beforeStarted.subscribe(()=>{let i=Zi(this.connectedTo).map(r=>{if(typeof r=="string"){let s=n._dropLists.find(o=>o.id===r);return s}return r});if(this._group&&this._group._items.forEach(r=>{i.indexOf(r)===-1&&i.push(r)}),!this._scrollableParentsResolved){let r=this._scrollDispatcher.getAncestorScrollContainers(this.element).map(s=>s.getElementRef().nativeElement);this._dropListRef.withScrollableParents(r),this._scrollableParentsResolved=!0}if(this.elementContainerSelector){let r=this.element.nativeElement.querySelector(this.elementContainerSelector);e.withElementContainer(r)}e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.sortingDisabled=this.sortingDisabled,e.autoScrollDisabled=this.autoScrollDisabled,e.autoScrollStep=bt(this.autoScrollStep,2),e.connectedTo(i.filter(r=>r&&r!==this).map(r=>r._dropListRef)).withOrientation(this.orientation)})}_handleEvents(e){e.beforeStarted.subscribe(()=>{this._syncItemsWithRef(this.getSortedItems().map(i=>i._dragRef)),this._changeDetectorRef.markForCheck()}),e.entered.subscribe(i=>{this.entered.emit({container:this,item:i.item.data,currentIndex:i.currentIndex})}),e.exited.subscribe(i=>{this.exited.emit({container:this,item:i.item.data}),this._changeDetectorRef.markForCheck()}),e.sorted.subscribe(i=>{this.sorted.emit({previousIndex:i.previousIndex,currentIndex:i.currentIndex,container:this,item:i.item.data})}),e.dropped.subscribe(i=>{this.dropped.emit({previousIndex:i.previousIndex,currentIndex:i.currentIndex,previousContainer:i.previousContainer.data,container:i.container.data,item:i.item.data,isPointerOverContainer:i.isPointerOverContainer,distance:i.distance,dropPoint:i.dropPoint,event:i.event}),this._changeDetectorRef.markForCheck()}),qe(e.receivingStarted,e.receivingStopped).subscribe(()=>this._changeDetectorRef.markForCheck())}_assignDefaults(e){let{lockAxis:i,draggingDisabled:r,sortingDisabled:s,listAutoScrollDisabled:o,listOrientation:c}=e;this.disabled=r??!1,this.sortingDisabled=s??!1,this.autoScrollDisabled=o??!1,this.orientation=c||"vertical",i&&(this.lockAxis=i)}_syncItemsWithRef(e){this._latestSortedRefs=e,this._dropListRef.withItems(e)}static \u0275fac=function(i){return new(i||n)};static \u0275dir=Ue({type:n,selectors:[["","cdkDropList",""],["cdk-drop-list"]],hostAttrs:[1,"cdk-drop-list"],hostVars:7,hostBindings:function(i,r){i&2&&(je("id",r.id),ce("cdk-drop-list-disabled",r.disabled)("cdk-drop-list-dragging",r._dropListRef.isDragging())("cdk-drop-list-receiving",r._dropListRef.isReceiving()))},inputs:{connectedTo:[0,"cdkDropListConnectedTo","connectedTo"],data:[0,"cdkDropListData","data"],orientation:[0,"cdkDropListOrientation","orientation"],id:"id",lockAxis:[0,"cdkDropListLockAxis","lockAxis"],disabled:[2,"cdkDropListDisabled","disabled",we],sortingDisabled:[2,"cdkDropListSortingDisabled","sortingDisabled",we],enterPredicate:[0,"cdkDropListEnterPredicate","enterPredicate"],sortPredicate:[0,"cdkDropListSortPredicate","sortPredicate"],autoScrollDisabled:[2,"cdkDropListAutoScrollDisabled","autoScrollDisabled",we],autoScrollStep:[0,"cdkDropListAutoScrollStep","autoScrollStep"],elementContainerSelector:[0,"cdkDropListElementContainer","elementContainerSelector"]},outputs:{dropped:"cdkDropListDropped",entered:"cdkDropListEntered",exited:"cdkDropListExited",sorted:"cdkDropListSorted"},exportAs:["cdkDropList"],features:[ae([{provide:ar,useValue:void 0},{provide:_r,useExisting:n}])]})}return n})();var vr=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=Je({type:n});static \u0275inj=Qe({providers:[ri],imports:[$i]})}return n})();var Yr=["setRepsInput"],Qr=["expandedSetElement"],Jr=(n,t)=>({"border-red-500 dark:border-red-400":n,"border-gray-300 dark:border-gray-600":t}),Xr=(n,t,e,i,r,s,o)=>({"border-orange-500 dark:border-orange-400 bg-orange-50 dark:bg-orange-900/30":n,"ring-2 ring-orange-400 dark:ring-orange-300 shadow-md":t,"dark:bg-orange-900/40":e,"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800":i,"rounded-b-none border-b-transparent dark:border-b-transparent":r,"rounded-t-none":s,"mt-4":o}),en=(n,t)=>({"border-b border-orange-300 dark:border-orange-600":n,"border-b border-gray-200 dark:border-gray-600":t}),tn=(n,t,e)=>({"bg-blue-100 dark:bg-blue-700":n,"bg-gray-50 dark:bg-gray-700":t,"cursor-default":e}),rn=(n,t)=>({"bg-blue-100 dark:bg-blue-700":n,"bg-gray-100 dark:bg-gray-700":t});function nn(n,t){if(n&1&&(a(0,"div",31),p(1),l()),n&2){let e=u();d(),E(" ",e.errorMessage(),`
`)}}function sn(n,t){if(n&1){let e=k();a(0,"button",39),S("click",function(){x(e);let r=u(2);return v(r.enableEditMode())}),I(),a(1,"svg",34),w(2,"path",40),l(),p(3," Edit "),l()}}function on(n,t){if(n&1){let e=k();a(0,"div",32)(1,"button",33),S("click",function(){x(e);let r=u();return v(r.startCurrentWorkout())}),I(),a(2,"svg",34),w(3,"path",35),l(),p(4," Start "),l(),y(5,sn,4,0,"button",36),V(),a(6,"button",37),S("click",function(){x(e);let r=u();return v(r.deleteCurrentRoutine())}),I(),a(7,"svg",34),w(8,"path",38),l(),p(9," Delete "),l()()}if(n&2){let e=u();d(5),m("ngIf",e.isViewMode)}}function an(n,t){n&1&&(a(0,"span"),p(1,"Routine name is required."),l())}function ln(n,t){if(n&1&&(a(0,"div",41),y(1,an,2,0,"span",42),l()),n&2){let e=u();d(),m("ngIf",e.f.name.errors==null?null:e.f.name.errors.required)}}function dn(n,t){if(n&1&&(a(0,"option",43),p(1),l()),n&2){let e=t.$implicit;m("value",e.value),d(),W(e.label)}}function cn(n,t){if(n&1){let e=k();a(0,"button",44),S("click",function(){x(e);let r=u();return v(r.openExerciseSelectionModal())}),p(1," + Add Exercise "),l()}if(n&2){let e=u();m("disabled",e.isViewMode)}}function un(n,t){if(n&1){let e=k();a(0,"div",69)(1,"button",70),S("click",function(){x(e);let r=u(3);return v(r.groupSelectedAsSuperset())}),p(2),l()()}if(n&2){let e=u(3);d(),m("disabled",!e.canGroupSelectedExercises()||e.isViewMode),d(),E(" Group Superset (",e.selectedExerciseIndicesForSuperset().length,") ")}}function pn(n,t){n&1&&(a(0,"div",71),I(),a(1,"svg",72),w(2,"path",73),l()())}function mn(n,t){if(n&1){let e=k();a(0,"input",74),S("change",function(r){x(e);let s=u().index,o=u(2);return v(o.toggleExerciseSelectionForSuperset(s,r))}),l()}if(n&2){let e=u().index,i=u(2);m("id","superset-select-"+e)("checked",i.selectedExerciseIndicesForSuperset().includes(e))("disabled",i.isViewMode)}}function hn(n,t){if(n&1&&(a(0,"span",75),p(1),l()),n&2){let e,i=u().$implicit;d(),K(" Superset (",(((e=i.get("supersetOrder"))==null?null:e.value)??0)+1," of ",(e=i.get("supersetSize"))==null?null:e.value,") ")}}function gn(n,t){if(n&1){let e=k();a(0,"button",76),S("click",function(){x(e);let r=u().index,s=u(2);return v(s.removeExercise(r))}),I(),a(1,"svg",77),w(2,"path",78),l(),p(3," Remove "),l()}if(n&2){let e=u(3);m("disabled",e.isViewMode)}}function _n(n,t){if(n&1){let e=k();a(0,"button",79),S("click",function(){x(e);let r=u().index,s=u(2);return v(s.ungroupSuperset(r))}),I(),a(1,"svg",77),w(2,"path",80),l(),p(3," Ungroup "),l()}if(n&2){let e=u(3);m("disabled",e.isViewMode)}}function fn(n,t){if(n&1){let e=k();a(0,"button",81),S("click",function(){x(e);let r=u(),s=r.$implicit,o=r.index,c=u(2);return v(c.addSet(s,o))}),p(1," + Add Set "),l()}if(n&2){let e=u(3);m("disabled",e.isViewMode)}}function xn(n,t){if(n&1&&(a(0,"div",82)(1,"div",83),p(2,"#"),l(),a(3,"div",84),p(4,"Reps"),l(),a(5,"div",84),p(6),l(),a(7,"div",84),p(8,"Time"),l(),a(9,"div",84),p(10,"Rest"),l(),a(11,"div",84),p(12,"Tempo"),l(),w(13,"div",85),l()),n&2){let e=u(3);d(6),E("Weight (",e.unitsService.getUnitLabel(),") ")}}function vn(n,t){if(n&1){let e=k();a(0,"div",95)(1,"button",96),S("click",function(r){x(e);let s=u(2).index,o=u(),c=o.$implicit,h=o.index;return u(2).removeSet(c,h,s),v(r.stopPropagation())}),I(),a(2,"svg",97),w(3,"path",98),l()()()}if(n&2){let e=u(5);d(),m("disabled",e.isViewMode)}}function Sn(n,t){n&1&&(a(0,"div",99),I(),a(1,"svg",100),w(2,"line",101)(3,"line",102),l()())}function yn(n,t){if(n&1){let e=k();a(0,"div",89),S("click",function(r){x(e);let s=u().index,o=u().index,c=u(2);return v(c.toggleSetExpansion(o,s,r))}),a(1,"div",90),p(2),l(),a(3,"div",91),p(4),l(),a(5,"div",91),p(6),M(7,"weightUnit"),l(),a(8,"div",91),p(9),l(),a(10,"div",91),p(11),l(),a(12,"div",92),p(13),l(),y(14,vn,4,1,"div",93)(15,Sn,4,0,"div",94),l()}if(n&2){let e,i,r,s,o,c,h,g=u(),_=g.$implicit,b=g.index,T=u(3);m("ngClass",vi(13,tn,(e=_.get("isWarmup"))==null?null:e.value,!((e=_.get("isWarmup"))!=null&&e.value)&&!T.isViewMode,T.isViewMode)),d(2),E(" ",b+1),d(2),E(" ",((i=_.get("reps"))==null?null:i.value)||"-"),d(2),E(" ",(r=_.get("weight"))!=null&&r.value?q(7,10,(r=_.get("weight"))==null?null:r.value,"1.0-2"):"-"),d(3),E(" ",(s=_.get("duration"))!=null&&s.value?((s=_.get("duration"))==null?null:s.value)+"s":"-"),d(2),E(" ",(o=_.get("restAfterSet"))==null?null:o.value,"s"),d(),m("title",(c=_.get("tempo"))==null?null:c.value),d(),W(((h=_.get("tempo"))==null?null:h.value)||"-"),d(),m("ngIf",T.isEditMode&&!T.isViewMode),d(),m("ngIf",T.isViewMode)}}function bn(n,t){if(n&1){let e=k();a(0,"div",103,0)(2,"div",104)(3,"div")(4,"label",105),p(5,"Reps"),l(),w(6,"input",106,1),l(),a(8,"div")(9,"label",105),p(10),l(),w(11,"input",107),l(),a(12,"div")(13,"label",105),p(14,"Time (s)"),l(),w(15,"input",108),l(),a(16,"div")(17,"label",105),p(18,"Tempo"),l(),w(19,"input",109),l(),a(20,"div",110)(21,"label",105),p(22,"Rest (s)"),l(),w(23,"input",111),l(),a(24,"div",112)(25,"label",105),p(26,"Set Notes (Opt.)"),l(),w(27,"input",113),l()(),a(28,"div",114)(29,"button",115),S("click",function(){x(e);let r=u(4);return v(r.collapseExpandedSet())}),p(30),l()()()}if(n&2){let e,i=u(),r=i.$implicit,s=i.index,o=u().index,c=u(2);m("ngClass",Re(15,rn,(e=r.get("isWarmup"))==null?null:e.value,!((e=r.get("isWarmup"))!=null&&e.value))),d(4),m("for","reps-exp-"+o+"-"+s),d(2),m("id","reps-exp-"+o+"-"+s),d(3),m("for","weight-exp-"+o+"-"+s),d(),E("Weight (",c.unitsService.getUnitLabel(),")"),d(),m("id","weight-exp-"+o+"-"+s),d(2),m("for","duration-exp-"+o+"-"+s),d(2),m("id","duration-exp-"+o+"-"+s),d(2),m("for","tempo-exp-"+o+"-"+s),d(2),m("id","tempo-exp-"+o+"-"+s),d(2),m("for","rest-exp-"+o+"-"+s),d(2),m("id","rest-exp-"+o+"-"+s),d(2),m("for","setNotes-exp-"+o+"-"+s),d(2),m("id","setNotes-exp-"+o+"-"+s),d(3),E(" ",c.isViewMode?"Collapse":c.isEditMode?"Done":"Close"," ")}}function wn(n,t){if(n&1&&(a(0,"div",86),y(1,yn,16,17,"div",87)(2,bn,31,18,"div",88),l()),n&2){let e=t.index,i=u().index,r=u(2);m("formGroupName",e),d(),m("ngIf",!r.isSetExpanded(i,e)),d(),m("ngIf",r.isSetExpanded(i,e))}}function kn(n,t){if(n&1){let e=k();Ce(0),a(1,"div",47),y(2,un,3,2,"div",48),a(3,"div",49),y(4,pn,3,0,"div",50),a(5,"div",51)(6,"div",52),y(7,mn,1,3,"input",53),a(8,"h3",54),y(9,hn,2,2,"span",55),p(10),l()(),a(11,"div",56)(12,"div",57)(13,"label",58),p(14,"Rounds:"),l(),a(15,"input",59),S("change",function(){let r,s=x(e),o=s.$implicit,c=s.index,h=u(2);return v(h.syncSupersetRounds((r=o.get("supersetId"))==null?null:r.value,(r=o.get("rounds"))==null?null:r.value,c))}),l()(),y(16,gn,4,1,"button",60)(17,_n,4,1,"button",61),l()(),a(18,"div",62)(19,"div",63)(20,"h4",64),p(21,"Sets:"),l(),y(22,fn,2,1,"button",65),l(),a(23,"div",66),y(24,xn,14,1,"div",67)(25,wn,3,3,"div",68),l()()()(),Ie()}if(n&2){let e,i,r,s,o,c,h,g=t.$implicit,_=t.index,b=u(2);d(2),m("ngIf",b.isEditMode&&b.selectedExerciseIndicesForSuperset().length>=2&&_===b.firstSelectedExerciseIndexForSuperset),d(),m("cdkDragDisabled",b.isViewMode||!b.isEditMode)("cdkDragData",g)("formGroupName",_)("ngClass",yi(18,Xr,(e=g.get("supersetId"))==null?null:e.value,b.selectedExerciseIndicesForSuperset().includes(_),((e=g.get("supersetId"))==null?null:e.value)&&b.selectedExerciseIndicesForSuperset().includes(_),!((e=g.get("supersetId"))!=null&&e.value)&&!b.selectedExerciseIndicesForSuperset().includes(_),((e=g.get("supersetId"))==null?null:e.value)&&(((e=g.get("supersetOrder"))==null?null:e.value)??-1)<(((e=g.get("supersetSize"))==null?null:e.value)??0)-1,((e=g.get("supersetId"))==null?null:e.value)&&(((e=g.get("supersetOrder"))==null?null:e.value)??0)>0,b.isEditMode&&b.selectedExerciseIndicesForSuperset().length>=2&&_===b.firstSelectedExerciseIndexForSuperset)),d(),m("ngIf",b.isEditMode),d(),m("ngClass",Re(26,en,((i=g.get("supersetId"))==null?null:i.value)&&(((i=g.get("supersetOrder"))==null?null:i.value)??-1)<(((i=g.get("supersetSize"))==null?null:i.value)??0)-1,!((i=g.get("supersetId"))!=null&&i.value)||(((i=g.get("supersetOrder"))==null?null:i.value)??-1)===(((i=g.get("supersetSize"))==null?null:i.value)??0)-1)),d(2),m("ngIf",b.isEditMode),d(2),m("ngIf",(r=g.get("supersetId"))==null?null:r.value),d(),E(" ",((s=g.get("exerciseName"))==null?null:s.value)||"Select Exercise"," "),d(3),m("for","rounds-"+_),d(2),m("id","rounds-"+_)("readonly",((o=g.get("supersetId"))==null?null:o.value)&&(((o=g.get("supersetOrder"))==null?null:o.value)??0)>0||b.isViewMode),d(),m("ngIf",b.isEditMode),d(),m("ngIf",b.isEditMode&&((c=g.get("supersetId"))==null?null:c.value)),d(5),m("ngIf",b.isEditMode),d(2),m("ngIf",b.getSetsFormArray(g).controls.length>0&&((h=b.expandedSetPath())==null?null:h.exerciseIndex)!==_),d(),m("ngForOf",b.getSetsFormArray(g).controls)}}function En(n,t){if(n&1){let e=k();a(0,"div",45),S("cdkDropListDropped",function(r){x(e);let s=u();return v(s.onExerciseDrop(r))}),y(1,kn,26,29,"ng-container",46),l()}if(n&2){let e=u();m("cdkDropListData",e.exercisesFormArray.controls),d(),m("ngForOf",e.exercisesFormArray.controls)}}function Cn(n,t){if(n&1){let e=k();a(0,"div",116)(1,"p",117),p(2,"No exercises added to this routine yet."),l(),a(3,"button",118),S("click",function(){x(e);let r=u();return v(r.openExerciseSelectionModal())}),p(4," + Add First Exercise "),l()()}if(n&2){let e=u();d(3),m("disabled",e.isViewMode)}}function In(n,t){if(n&1){let e=k();a(0,"div",119)(1,"button",120),S("click",function(){x(e);let r=u();return v(r.openExerciseSelectionModal())}),I(),a(2,"svg",121),w(3,"path",122),l(),p(4," Add Another Exercise "),l()()}if(n&2){let e=u();d(),m("disabled",e.isViewMode)}}function Tn(n,t){if(n&1&&(a(0,"div",123)(1,"a",124),p(2," Cancel "),l(),a(3,"button",125),p(4),l()()),n&2){let e=u();d(3),m("disabled",e.routineForm.invalid&&(e.routineForm.touched||e.routineForm.dirty)),d(),E(" ",e.isNewMode?"Create Routine":"Save Changes"," ")}}function Pn(n,t){if(n&1){let e=k();a(0,"li",143),S("click",function(){let r=x(e).$implicit,s=u(2);return v(s.selectExercise(r))}),a(1,"div")(2,"span",144),p(3),l(),a(4,"span",145),p(5),M(6,"titlecase"),M(7,"titlecase"),l()(),I(),a(8,"svg",146),w(9,"path",147),l()()}if(n&2){let e=t.$implicit;d(3),W(e.name),d(2),K("",Y(6,3,e.category)," - ",Y(7,5,e.primaryMuscleGroup))}}function Dn(n,t){n&1&&(a(0,"li",148),p(1,"No exercises match your search."),l())}function Rn(n,t){n&1&&(a(0,"li",148),p(1,"Exercise library is empty or still loading."),l())}function Vn(n,t){if(n&1){let e=k();a(0,"div",126),S("click",function(){x(e);let r=u();return v(r.closeExerciseSelectionModal())}),a(1,"div",127),S("click",function(r){return x(e),v(r.stopPropagation())}),a(2,"div",128)(3,"div",129)(4,"div",130)(5,"div",131)(6,"h3",132),p(7,"Select an Exercise"),l(),a(8,"button",133),S("click",function(){x(e);let r=u();return v(r.closeExerciseSelectionModal())}),I(),a(9,"svg",134),w(10,"path",135),l()()(),V(),a(11,"div",136)(12,"input",137),S("ngModelChange",function(r){x(e);let s=u();return v(s.modalSearchTerm.set(r))}),l()(),a(13,"div",138)(14,"ul",62),y(15,Pn,10,7,"li",139)(16,Dn,2,0,"li",140)(17,Rn,2,0,"li",140),l()()()()(),a(18,"div",141)(19,"button",142),S("click",function(){x(e);let r=u();return v(r.closeExerciseSelectionModal())}),p(20,"Cancel"),l()()()()}if(n&2){let e=u();d(12),m("ngModel",e.modalSearchTerm()),d(3),m("ngForOf",e.filteredAvailableExercises()),d(),m("ngIf",e.filteredAvailableExercises().length===0&&e.availableExercises.length>0),d(),m("ngIf",e.availableExercises.length===0)}}var Ae=class n{fb=f(mt);router=f(he);route=f(Ve);workoutService=f(Oe);exerciseService=f(Me);unitsService=f(Ne);spinnerService=f(_t);alertService=f(We);toastService=f(Fe);trackingService=f(_e);PAUSED_WORKOUT_KEY="fitTrackPro_pausedWorkoutState";PAUSED_STATE_VERSION="1.1";setRepsInputs;expandedSetElements;cdr=f(ue);routineForm;isEditMode=!1;isNewMode=!1;isViewMode=!1;currentRoutineId=null;routeSub;expandedSetPath=C(null);routineGoals=[{value:"hypertrophy",label:"Hypertrophy"},{value:"strength",label:"Strength"},{value:"muscular endurance",label:"Muscular endurance"},{value:"cardiovascular endurance",label:"Cardiovascular endurance"},{value:"fat loss / body composition",label:"Fat loss / body composition"},{value:"mobility & flexibility",label:"Mobility & flexibility"},{value:"power / explosiveness",label:"Power / explosiveness"},{value:"speed & agility",label:"Speed & agility"},{value:"balance & coordination",label:"Balance & coordination"},{value:"skill acquisition",label:"Skill acquisition"},{value:"rehabilitation / injury prevention",label:"Rehabilitation / injury prevention"},{value:"mental health / stress relief",label:"Mental health"},{value:"general health & longevity",label:"General health & longevity"},{value:"sport-specific performance",label:"Sport-specific performance"},{value:"maintenance",label:"Maintenance"},{value:"custom",label:"Custom"}];isExerciseModalOpen=C(!1);availableExercises=[];modalSearchTerm=C("");filteredAvailableExercises=A(()=>{let t=this.modalSearchTerm().toLowerCase();return t?this.availableExercises.filter(e=>e.name.toLowerCase().includes(t)||e.category.toLowerCase().includes(t)||e.primaryMuscleGroup.toLowerCase().includes(t)):this.availableExercises});selectedExerciseIndicesForSuperset=C([]);constructor(){this.routineForm=this.fb.group({name:["",B.required],description:[""],goal:["custom"],exercises:this.fb.array([])})}ngOnInit(){window.scrollTo(0,0),this.loadAvailableExercises(),this.routeSub=this.route.paramMap.pipe(ne(t=>{this.currentRoutineId=t.get("routineId");let e=this.route.snapshot.url[0]?.path;return this.isNewMode=e==="new",this.isViewMode=e==="view"&&!!this.currentRoutineId,this.isEditMode=e==="edit"&&!!this.currentRoutineId||this.isNewMode,this.expandedSetPath.set(null),this.currentRoutineId&&(this.isEditMode||this.isViewMode)&&!this.isNewMode?this.workoutService.getRoutineById(this.currentRoutineId):(this.exercisesFormArray.clear(),this.routineForm.reset({goal:"custom",exercises:[]}),this.isNewMode&&this.toggleFormState(!1),re(null))}),de(t=>{t?(this.patchFormWithRoutineData(t),this.isViewMode?this.toggleFormState(!0):this.isEditMode&&!this.isNewMode&&this.toggleFormState(!1)):(this.isEditMode||this.isViewMode)&&!this.isNewMode&&this.currentRoutineId&&(this.toastService.error(`Routine with ID ${this.currentRoutineId} not found.`,0,"Error"),this.router.navigate(["/workout"]))})).subscribe()}toggleFormState(t){t?this.routineForm.disable({emitEvent:!1}):(this.routineForm.enable({emitEvent:!1}),this.exercisesFormArray.controls.forEach(e=>{this.updateRoundsControlability(e)}))}get exercisesFormArray(){return this.routineForm.get("exercises")}getSetsFormArray(t){return t.get("sets")}loadAvailableExercises(){this.exerciseService.getExercises().subscribe(t=>{this.availableExercises=t})}patchFormWithRoutineData(t){this.routineForm.patchValue({name:t.name,description:t.description,goal:t.goal}),this.exercisesFormArray.clear(),t.exercises.forEach(e=>{let i=this.createExerciseFormGroup(e);this.exercisesFormArray.push(i)}),this.isViewMode?this.toggleFormState(!0):this.toggleFormState(!1),this.expandedSetPath.set(null)}createExerciseFormGroup(t){let e=t?.exerciseId?this.availableExercises.find(r=>r.id===t.exerciseId):null,i=this.fb.group({id:[t?.id||this.workoutService.generateWorkoutExerciseId()],exerciseId:[t?.exerciseId||"",B.required],exerciseName:[t?.exerciseName||e?.name||"Select Exercise"],notes:[t?.notes||""],sets:this.fb.array(t?.sets.map(r=>this.createSetFormGroup(r))||[]),supersetId:[t?.supersetId||null],supersetOrder:[t?.supersetOrder??null],supersetSize:[t?.supersetSize??null],rounds:[t?.rounds??1,[B.min(1)]]});return i.get("supersetId")?.valueChanges.subscribe(()=>this.updateRoundsControlability(i)),i.get("supersetOrder")?.valueChanges.subscribe(()=>this.updateRoundsControlability(i)),this.updateRoundsControlability(i),i.get("exerciseId")?.valueChanges.subscribe(r=>{let s=this.availableExercises.find(o=>o.id===r);i.get("exerciseName")?.setValue(s?.name||"Unknown Exercise",{emitEvent:!1})}),i}createSetFormGroup(t){return this.fb.group({id:[t?.id||this.workoutService.generateExerciseSetId()],reps:[t?.reps??null,[B.min(0)]],weight:[this.unitsService.convertFromKg(t?.weight,this.unitsService.currentUnit())??null,[B.min(0)]],duration:[t?.duration??null,[B.min(0)]],tempo:[t?.tempo||""],restAfterSet:[t?.restAfterSet??60,[B.required,B.min(0)]],notes:[t?.notes||""],isWarmup:[t?.isWarmup||!1]})}openExerciseSelectionModal(){this.isViewMode||(this.modalSearchTerm.set(""),this.isExerciseModalOpen.set(!0))}closeExerciseSelectionModal(){this.isExerciseModalOpen.set(!1)}onModalSearchTermChange(t){let e=t.target;this.modalSearchTerm.set(e.value)}selectExercise(t){let e=this.createExerciseFormGroup({id:this.workoutService.generateWorkoutExerciseId(),exerciseId:t.id,exerciseName:t.name,sets:[{id:this.workoutService.generateExerciseSetId(),reps:8,weight:0,restAfterSet:60,duration:0,tempo:"-",notes:""}],supersetId:null,supersetOrder:null,supersetSize:null,rounds:1});this.exercisesFormArray.push(e),this.closeExerciseSelectionModal(),this.toggleSetExpansion(this.exercisesFormArray.length-1,0)}ngAfterViewInit(){this.expandedSetElements.changes.subscribe(t=>{t.first&&this.expandedSetPath()&&setTimeout(()=>{t.first.nativeElement.scrollIntoView({behavior:"smooth",block:"center"})},0)})}addSet(t,e){if(this.isViewMode)return;let i=this.getSetsFormArray(t);i.push(this.createSetFormGroup()),this.cdr.detectChanges();let r=i.length-1;this.toggleSetExpansion(e,r)}removeSet(t,e,i){if(this.isViewMode)return;this.getSetsFormArray(t).removeAt(i);let s=this.expandedSetPath();s&&s.exerciseIndex===e&&s.setIndex===i?this.expandedSetPath.set(null):s&&s.exerciseIndex===e&&s.setIndex>i&&this.expandedSetPath.set({exerciseIndex:e,setIndex:s.setIndex-1})}toggleSetExpansion(t,e,i){if(i?.stopPropagation(),!(this.isViewMode&&!(this.expandedSetPath()?.exerciseIndex===t&&this.expandedSetPath()?.setIndex===e))){if(this.isViewMode){this.expandedSetPath.set(null);return}}let r=this.expandedSetPath();r?.exerciseIndex===t&&r?.setIndex===e?this.expandedSetPath.set(null):(this.expandedSetPath.set({exerciseIndex:t,setIndex:e}),this.cdr.detectChanges(),setTimeout(()=>{let s=this.expandedSetElements.find((o,c)=>!0);if(s){let o=s.nativeElement.querySelector('input[formControlName="reps"], input[formControlName="weight"], input[formControlName="duration"]');o instanceof HTMLInputElement&&(o.focus(),o.select())}},50))}isSetExpanded(t,e){let i=this.expandedSetPath();return i?.exerciseIndex===t&&i?.setIndex===e}collapseExpandedSet(){this.expandedSetPath.set(null)}getFormErrors(t){let e={};return Object.keys(t.controls).forEach(i=>{let r=t.get(i).errors;if(r&&(e[i]=r),t.get(i)instanceof Pi||t.get(i)instanceof Ni){let s=this.getFormErrors(t.get(i));Object.keys(s).length>0&&(e[i]=s)}}),e}get f(){return this.routineForm.controls}toggleExerciseSelectionForSuperset(t,e){if(this.isViewMode)return;let i=e.target;this.selectedExerciseIndicesForSuperset.update(r=>{let s;return i.checked?s=r.includes(t)?r:[...r,t]:s=r.filter(o=>o!==t),s.sort((o,c)=>o-c)})}canGroupSelectedExercises(){let t=this.selectedExerciseIndicesForSuperset();if(t.length<2)return!1;let e=this.exercisesFormArray.at(t[0]).get("supersetId")?.value;for(let i=1;i<t.length;i++){let r=t[i],s=this.exercisesFormArray.at(r).get("supersetId")?.value;if(e&&s&&e!==s||!e&&s)return!1}return!0}onExerciseDrop(t){if(!this.isViewMode&&t.previousContainer===t.container){let e=this.exercisesFormArray;Tt(e.controls,t.previousIndex,t.currentIndex),e.updateValueAndValidity(),this.selectedExerciseIndicesForSuperset.set([]),this.handleSupersetIntegrityAfterDrag(t.previousIndex,t.currentIndex),this.recalculateSupersetOrders(),this.expandedSetPath.set(null)}}handleSupersetIntegrityAfterDrag(t,e){let i=new Set;if(i.add(t),i.add(e),t<e)for(let s=t;s<=e;s++)i.add(s);else for(let s=e;s<=t;s++)i.add(s);let r=new Set;i.forEach(s=>{if(s<this.exercisesFormArray.length){let c=this.exercisesFormArray.at(s).get("supersetId")?.value;c&&r.add(c)}}),r.forEach(s=>{this.exercisesFormArray.controls.forEach(o=>{let c=o;c.get("supersetId")?.value===s&&c.patchValue({supersetId:null,supersetOrder:null,supersetSize:null})})}),this.recalculateSupersetOrders()}recalculateSupersetOrders(){let t=new Map;this.exercisesFormArray.controls.forEach(e=>{let i=e,r=i.get("supersetId")?.value;r?(t.has(r)||t.set(r,[]),t.get(r).push(i)):(i.patchValue({supersetOrder:null,supersetSize:null},{emitEvent:!1}),this.updateRoundsControlability(i))}),t.forEach((e,i)=>{e.length<2?e.forEach(r=>{r.patchValue({supersetId:null,supersetOrder:null,supersetSize:null}),this.updateRoundsControlability(r)}):(e.sort((r,s)=>this.exercisesFormArray.controls.indexOf(r)-this.exercisesFormArray.controls.indexOf(s)),e.forEach((r,s)=>{r.patchValue({supersetOrder:s,supersetSize:e.length},{emitEvent:!1}),this.updateRoundsControlability(r)}))}),this.exercisesFormArray.updateValueAndValidity({emitEvent:!1})}groupSelectedAsSuperset(){if(this.isViewMode)return;let t=this.selectedExerciseIndicesForSuperset().sort((o,c)=>o-c);if(t.length<2){this.toastService.warning("Select at least two exercises.",3e3,"Superset Error");return}for(let o=1;o<t.length;o++)if(t[o]!==t[o-1]+1){this.toastService.warning("Selected exercises must be next to each other to form a superset.",5e3,"Superset Error");return}let e=ge(),i=t.length,s=this.exercisesFormArray.at(t[0]).get("rounds")?.value??1;t.forEach((o,c)=>{let h=this.exercisesFormArray.at(o);h.patchValue({supersetId:e,supersetOrder:c,supersetSize:i,rounds:s}),this.updateRoundsControlability(h),h.get("sets").controls.forEach(_=>{c<i-1&&_.get("restAfterSet")?.setValue(0)})}),this.selectedExerciseIndicesForSuperset.set([]),this.toastService.success("Superset created!",3e3,"Success")}ungroupSuperset(t){if(this.isViewMode)return;let i=this.exercisesFormArray.at(t).get("supersetId")?.value;i&&(this.exercisesFormArray.controls.forEach(r=>{let s=r;s.get("supersetId")?.value===i&&(s.patchValue({supersetId:null,supersetOrder:null,supersetSize:null}),this.updateRoundsControlability(s))}),this.selectedExerciseIndicesForSuperset.set([]),this.toastService.info("Superset ungrouped.",3e3,"Ungrouped"))}removeExercise(t){if(this.isViewMode)return;let i=this.exercisesFormArray.at(t).get("supersetId")?.value;this.exercisesFormArray.removeAt(t),this.selectedExerciseIndicesForSuperset.set([]),i&&this.recalculateSupersetOrders(),this.toastService.info("Exercise removed.",2e3),this.expandedSetPath.set(null)}errorMessage=C(null);onSubmit(){if(this.isViewMode){this.toastService.info("Currently in view mode. No changes to save.",3e3,"View Mode");return}if(this.recalculateSupersetOrders(),!this.validateSupersetIntegrity()){this.toastService.error("Superset configuration is invalid. Ensure supersets have at least two contiguous exercises.",0,"Validation Error");return}let t=this.exercisesFormArray.value;for(let r=0;r<t.length;r++){let s=t[r],o=this.availableExercises.find(_=>_.id===s.exerciseId),c=s.exerciseName||o?.name||`Exercise ${r+1}`;if(!s.sets||s.sets.length===0){this.toastService.error(`The exercise "${c}" must have at least one set.`,0,"Validation Error");return}let g=this.exercisesFormArray.at(r).get("rounds")?.value;if(g!=null&&g<1){this.toastService.error(`The exercise "${c}" must have at least 1 round.`,0,"Validation Error");return}for(let _=0;_<s.sets.length;_++){let b=s.sets[_],T=`Set ${_+1} of "${c}"`,N=b.reps??0,F=b.weight??0,D=b.duration??0,R=D>0;if(!R&&o&&["cardio","stretching","plank","isometric"].includes(o.category.toLowerCase())&&(R=!0),R){if(D<=0){this.toastService.error(`${T} is timed but has no duration.`,0,"Validation Error");return}}else{if(N<=0&&F<=0){this.toastService.error(`${T} must have reps or weight.`,0,"Validation Error");return}if(N<=0&&F>0){this.toastService.error(`${T} with weight must also have reps.`,0,"Validation Error");return}}}}if(this.routineForm.invalid||!this.exercisesFormArray||this.exercisesFormArray.length===0){this.routineForm.markAllAsTouched(),this.toastService.error("Please fill required fields (Name, at least one exercise with sets).",0,"Validation Error"),console.log("Form Errors:",this.getFormErrors(this.routineForm));return}let e=this.routineForm.getRawValue(),i={id:(this.isEditMode||this.isNewMode)&&this.currentRoutineId?this.currentRoutineId:ge(),name:e.name,description:e.description,goal:e.goal,exercises:e.exercises.map(r=>Z(H({},r),{sets:r.sets.map(s=>Z(H({},s),{weight:this.unitsService.convertToKg(s.weight,this.unitsService.currentUnit())??null,restAfterSet:s.restAfterSet??0}))}))};this.isNewMode&&!this.currentRoutineId&&(i.id=ge());try{if(this.spinnerService.show(),this.isNewMode)this.workoutService.addRoutine(i),this.toastService.success("Routine created successfully!",4e3,"Success");else if(this.isEditMode&&this.currentRoutineId)this.workoutService.updateRoutine(i),this.toastService.success("Routine updated successfully!",4e3,"Success");else{this.toastService.warning("No save operation performed. Mode is unclear or ID missing.",0,"Save Warning"),this.spinnerService.hide();return}this.router.navigate(["/workout"])}catch(r){console.error("Error saving routine:",r),this.toastService.error(`Failed to save routine: ${r.message||"Unknown error"}`,0,"Save Error")}finally{this.spinnerService.hide()}}validateSupersetIntegrity(){let t=this.exercisesFormArray.value,e=new Map;for(let i of t)i.supersetId&&(e.has(i.supersetId)||e.set(i.supersetId,[]),e.get(i.supersetId).push(i));for(let[i,r]of e.entries()){if(r.length<2)return!1;let s=r.sort((o,c)=>(o.supersetOrder??1/0)-(c.supersetOrder??1/0));for(let o=0;o<s.length;o++)if(s[o].supersetOrder!==o)return!1}return!0}get firstSelectedExerciseIndexForSuperset(){let t=this.selectedExerciseIndicesForSuperset();return t.length>0?t[0]:null}updateRoundsControlability(t){let e=t.get("supersetId")?.value,i=t.get("supersetOrder")?.value,r=t.get("rounds");if(this.isViewMode){r?.disable({emitEvent:!1});return}if(e&&i!==null&&i>0){r?.disable({emitEvent:!1});let s=this.exercisesFormArray.controls.find(o=>o.get("supersetId")?.value===e&&o.get("supersetOrder")?.value===0);s&&r?.setValue(s.get("rounds")?.value??1,{emitEvent:!1})}else r?.enable({emitEvent:!1})}syncSupersetRounds(t,e,i){this.isViewMode||!t||e===null||e===void 0||e<1||this.exercisesFormArray.at(i).get("supersetOrder")?.value!==0||this.exercisesFormArray.controls.forEach(s=>{let o=s;o.get("supersetId")?.value===t&&o.get("rounds")?.value!==e&&o.get("rounds")?.setValue(e,{emitEvent:!1})})}startCurrentWorkout(){this.currentRoutineId?this.router.navigate(["/workout/play",this.currentRoutineId]):this.toastService.error("Cannot start workout: Routine ID is missing.",0,"Error")}enableEditMode(){this.isViewMode&&this.currentRoutineId&&(this.isViewMode=!1,this.isEditMode=!0,this.toggleFormState(!1),this.router.navigate(["/workout/edit",this.currentRoutineId],{replaceUrl:!0}),this.toastService.info("Edit mode enabled.",3e3,"Mode Changed"))}deleteCurrentRoutine(){return O(this,null,function*(){if(!this.currentRoutineId){this.toastService.error("Cannot delete: Routine ID is missing.",0,"Error");return}let t=yield le(this.workoutService.getRoutineById(this.currentRoutineId).pipe(G(1)));if(!t){this.toastService.error("Routine not found for deletion.",0,"Error");return}let e=(yield le(this.trackingService.getWorkoutLogsByRoutineId(this.currentRoutineId).pipe(G(1))))||[],i=`Are you sure you want to delete the routine "${t.name}"?`;e.length>0&&(i+=` This will also delete ${e.length} associated workout log(s). This action cannot be undone.`);let r=yield this.alertService.showConfirm("Delete Routine",i,"Delete");if(r&&r.data)try{this.spinnerService.show(),e.length>0&&(yield this.trackingService.clearWorkoutLogsByRoutineId(this.currentRoutineId),this.toastService.info(`${e.length} workout log(s) deleted.`,3e3,"Logs Cleared")),yield this.workoutService.deleteRoutine(this.currentRoutineId),this.toastService.success(`Routine "${t.name}" deleted.`,4e3,"Routine Deleted"),this.router.navigate(["/workout"])}catch(s){console.error("Error during deletion:",s),this.toastService.error("Failed to delete routine or logs. Please try again.",0,"Deletion Failed")}finally{this.spinnerService.hide()}})}ngOnDestroy(){this.routeSub&&this.routeSub.unsubscribe()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=j({type:n,selectors:[["app-workout-builder"]],viewQuery:function(e,i){if(e&1&&(Te(Yr,5),Te(Qr,5)),e&2){let r;Pe(r=De())&&(i.setRepsInputs=r),Pe(r=De())&&(i.expandedSetElements=r)}},features:[ae([me])],decls:37,vars:16,consts:[["expandedSetElement",""],["setRepsInput",""],["class","my-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-md dark:bg-red-900/30 dark:border-red-600 dark:text-red-300",4,"ngIf"],[1,"container","mx-auto","p-1"],[1,"mb-6","pb-4","border-b","border-gray-200","dark:border-gray-700"],[1,"flex","justify-between","items-center"],["routerLink","/workout",1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-ml-1"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"text-xl","sm:text-2xl","md:text-3xl","font-bold","text-gray-800","dark:text-gray-200","text-center","flex-grow","truncate","px-2"],[1,"w-10","h-10"],["class","mt-4 flex flex-wrap gap-2 justify-center sm:justify-start",4,"ngIf"],[1,"space-y-6","mb-6",3,"ngSubmit","formGroup"],[1,"space-y-4","p-4","bg-white","dark:bg-gray-800","rounded-lg","shadow-sm"],["for","name",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300"],["type","text","id","name","formControlName","name",1,"mt-1","block","w-full","p-2","border","rounded-md","shadow-sm","focus:ring-primary","focus:border-primary","dark:bg-gray-700","dark:border-gray-600",3,"ngClass"],["class","text-red-500 dark:text-red-400 text-xs mt-1",4,"ngIf"],["for","description",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300"],["id","description","formControlName","description","rows","3",1,"mt-1","block","w-full","p-2","border","border-gray-300","dark:border-gray-600","rounded-md","shadow-sm","focus:ring-primary","focus:border-primary","dark:bg-gray-700"],["for","goal",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300"],["id","goal","formControlName","goal",1,"mt-1","block","w-full","p-2","border","border-gray-300","dark:border-gray-600","rounded-md","shadow-sm","focus:ring-primary","focus:border-primary","dark:bg-gray-700"],[3,"value",4,"ngFor","ngForOf"],[1,"pt-4"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-xl","font-semibold","text-gray-700","dark:text-gray-300"],["type","button","class","bg-green-500 hover:enabled:bg-green-600 text-white text-sm font-medium py-2 px-3 rounded-md transition-all duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed",3,"disabled","click",4,"ngIf"],["cdkDropList","","formArrayName","exercises","class","exercise-list-container space-y-4",3,"cdkDropListData","cdkDropListDropped",4,"ngIf"],["class","text-center py-6 text-gray-500 dark:text-gray-400 border border-dashed dark:border-gray-700 rounded-md mt-4",4,"ngIf"],["class","mt-6 text-center",4,"ngIf"],["class","pt-6 flex justify-end space-x-3",4,"ngIf"],["class","fixed inset-0 bg-gray-600 bg-opacity-75 transition-opacity overflow-y-auto h-full w-full z-[70] flex items-center justify-center p-4",3,"click",4,"ngIf"],[1,"my-4","p-3","bg-red-100","border","border-red-400","text-red-700","rounded-md","dark:bg-red-900/30","dark:border-red-600","dark:text-red-300"],[1,"mt-4","flex","flex-wrap","gap-2","justify-center","sm:justify-start"],["type","button",1,"bg-green-500","hover:bg-green-600","text-white","font-semibold","py-2","px-3","rounded-md","shadow-sm","text-xs","sm:text-sm","flex","items-center",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-4","sm:size-5","mr-1"],["stroke-linecap","round","stroke-linejoin","round","d","M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"],["type","button","class","bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-2 px-3 rounded-md shadow-sm text-xs sm:text-sm flex items-center",3,"click",4,"ngIf"],["type","button",1,"bg-red-500","hover:bg-red-600","text-white","font-semibold","py-2","px-3","rounded-md","shadow-sm","text-xs","sm:text-sm","flex","items-center",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"],["type","button",1,"bg-yellow-500","hover:bg-yellow-600","text-white","font-semibold","py-2","px-3","rounded-md","shadow-sm","text-xs","sm:text-sm","flex","items-center",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"],[1,"text-red-500","dark:text-red-400","text-xs","mt-1"],[4,"ngIf"],[3,"value"],["type","button",1,"bg-green-500","hover:enabled:bg-green-600","text-white","text-sm","font-medium","py-2","px-3","rounded-md","transition-all","duration-150","ease-in-out","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["cdkDropList","","formArrayName","exercises",1,"exercise-list-container","space-y-4",3,"cdkDropListDropped","cdkDropListData"],[4,"ngFor","ngForOf"],[1,"relative","group","exercise-card-wrapper"],["class","absolute left-1/2 -translate-x-1/2 z-20","style","top: -1.25rem;",4,"ngIf"],["cdkDrag","",1,"p-2","border","rounded-lg","shadow-sm","space-y-2","exercise-item","relative","transition-all","duration-150","ease-in-out",3,"cdkDragDisabled","cdkDragData","formGroupName","ngClass"],["cdkDragHandle","","class","absolute top-2 right-2 cursor-grab p-1 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300","title","Drag to reorder",4,"ngIf"],[1,"flex","flex-col","sm:flex-row","justify-between","items-start","sm:items-center","pb-2","pt-6",3,"ngClass"],[1,"flex","items-center","pr-8","mb-2","sm:mb-0"],["type","checkbox","class","h-5 w-5 text-orange-600 border-gray-300 rounded focus:ring-orange-500 mr-3 self-start mt-1 disabled:opacity-50",3,"id","checked","disabled","change",4,"ngIf"],[1,"text-lg","font-semibold","text-gray-800","dark:text-gray-100"],["class","text-xs text-orange-600 dark:text-orange-400 font-normal block",4,"ngIf"],[1,"flex","flex-col","items-start","sm:items-end","space-y-1","flex-shrink-0","w-full","sm:w-auto"],[1,"flex","items-center","space-x-1"],[1,"text-xs","font-medium","text-gray-600","dark:text-gray-400","whitespace-nowrap",3,"for"],["type","number","formControlName","rounds","min","1",1,"w-16","p-1","text-sm","border-gray-300","dark:border-gray-600","border-2","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-700","disabled:opacity-50","disabled:bg-gray-300","dark:disabled:bg-gray-500",3,"change","id","readonly"],["type","button","class","flex items-center text-xs text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 font-medium py-1 px-2 rounded-md hover:enabled:bg-red-100 dark:enabled:hover:bg-red-900/50 disabled:opacity-50",3,"disabled","click",4,"ngIf"],["type","button","class","flex items-center text-xs text-violet-600 hover:text-violet-700 dark:text-violet-400 dark:hover:text-violet-300 font-medium py-1 px-2 rounded-md hover:bg-violet-100 dark:hover:bg-violet-900/50 disabled:opacity-50",3,"disabled","click",4,"ngIf"],[1,"space-y-1"],[1,"flex","justify-between","items-center","mb-1"],[1,"text-sm","font-semibold","text-gray-700","dark:text-gray-300"],["type","button","class","text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 font-medium py-0.5 px-1.5 rounded-md hover:enabled:bg-blue-100 dark:hover:bg-blue-900/50 disabled:opacity-50",3,"disabled","click",4,"ngIf"],["formArrayName","sets",1,"space-y-1.5"],["class","flex justify-between grid grid-cols-12 gap-x-2 py-1 px-2 text-xs font-medium text-gray-500 dark:text-gray-400 border-b dark:border-gray-600",4,"ngIf"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"absolute","left-1/2","-translate-x-1/2","z-20",2,"top","-1.25rem"],["type","button",1,"bg-orange-600","hover:bg-orange-700","text-white","text-xs","font-semibold","py-1.5","px-3","rounded-full","shadow-lg","whitespace-nowrap","transition-all","duration-150","ease-in-out","hover:scale-105","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["cdkDragHandle","","title","Drag to reorder",1,"absolute","top-2","right-2","cursor-grab","p-1","text-gray-400","hover:text-gray-600","dark:text-gray-500","dark:hover:text-gray-300"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"w-5","h-5"],["fill-rule","evenodd","d","M10 3a.75.75 0 0 1 .75.75v12.5a.75.75 0 0 1-1.5 0V3.75A.75.75 0 0 1 10 3ZM5.75 6.75a.75.75 0 0 0 0 1.5h8.5a.75.75 0 0 0 0-1.5h-8.5Zm0 5a.75.75 0 0 0 0 1.5h8.5a.75.75 0 0 0 0-1.5h-8.5Z","clip-rule","evenodd"],["type","checkbox",1,"h-5","w-5","text-orange-600","border-gray-300","rounded","focus:ring-orange-500","mr-3","self-start","mt-1","disabled:opacity-50",3,"change","id","checked","disabled"],[1,"text-xs","text-orange-600","dark:text-orange-400","font-normal","block"],["type","button",1,"flex","items-center","text-xs","text-red-600","hover:text-red-700","dark:text-red-400","dark:hover:text-red-300","font-medium","py-1","px-2","rounded-md","hover:enabled:bg-red-100","dark:enabled:hover:bg-red-900/50","disabled:opacity-50",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-4","h-4","mr-1"],["stroke-linecap","round","stroke-linejoin","round","d","m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12.56 0c.342.052.682.107 1.022.166m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"],["type","button",1,"flex","items-center","text-xs","text-violet-600","hover:text-violet-700","dark:text-violet-400","dark:hover:text-violet-300","font-medium","py-1","px-2","rounded-md","hover:bg-violet-100","dark:hover:bg-violet-900/50","disabled:opacity-50",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","d","M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75v4.5m0-4.5h-4.5m4.5 0L15 9m5.25 11.25v-4.5m0 4.5h-4.5m4.5 0L15 15"],["type","button",1,"text-xs","text-blue-600","hover:text-blue-700","dark:text-blue-400","dark:hover:text-blue-300","font-medium","py-0.5","px-1.5","rounded-md","hover:enabled:bg-blue-100","dark:hover:bg-blue-900/50","disabled:opacity-50",3,"click","disabled"],[1,"flex","justify-between","grid","grid-cols-12","gap-x-2","py-1","px-2","text-xs","font-medium","text-gray-500","dark:text-gray-400","border-b","dark:border-gray-600"],[1,"col-span-1","text-center"],[1,"col-span-2","text-center"],[1,"col-span-2"],[3,"formGroupName"],["class","grid grid-cols-12 gap-x-2 items-center py-1.5 px-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer border dark:border-gray-700",3,"ngClass","click",4,"ngIf"],["class","mt-1 p-3 rounded-md border border-gray-300 dark:border-gray-500 shadow-inner space-y-2",3,"ngClass",4,"ngIf"],[1,"grid","grid-cols-12","gap-x-2","items-center","py-1.5","px-2","rounded-md","hover:bg-gray-100","dark:hover:bg-gray-700","cursor-pointer","border","dark:border-gray-700",3,"click","ngClass"],[1,"col-span-1","text-xs","text-gray-600","dark:text-gray-400","text-center","font-medium"],[1,"col-span-2","text-xs","text-gray-700","dark:text-gray-200","text-center"],[1,"col-span-2","text-xs","text-gray-700","dark:text-gray-200","text-center","truncate",3,"title"],["class","col-span-1 flex items-center justify-end",4,"ngIf"],["class","col-span-1",4,"ngIf"],[1,"col-span-1","flex","items-center","justify-end"],["type","button","title","Remove Set",1,"text-red-500","hover:text-red-600","dark:text-red-400","dark:hover:text-red-300","p-1","rounded-full","hover:bg-red-100","dark:hover:bg-red-900/30","disabled:opacity-50",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 16 16","fill","currentColor",1,"w-3.5","h-3.5"],["fill-rule","evenodd","d","M5 3.25A2.25 2.25 0 0 0 2.75 5.5v5A2.25 2.25 0 0 0 5 12.75h6a2.25 2.25 0 0 0 2.25-2.25v-5A2.25 2.25 0 0 0 11 3.25H5Zm.97 3.97a.75.75 0 0 1 1.06 0L8 8.28l.97-.97a.75.75 0 1 1 1.06 1.06L9.06 9.25l.97.97a.75.75 0 1 1-1.06 1.06L8 10.43l-.97.97a.75.75 0 0 1-1.06-1.06L6.94 9.25l-.97-.97a.75.75 0 0 1 0-1.06Z","clip-rule","evenodd"],[1,"col-span-1"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["x1","12","y1","5","x2","12","y2","19"],["x1","5","y1","12","x2","19","y2","12"],[1,"mt-1","p-3","rounded-md","border","border-gray-300","dark:border-gray-500","shadow-inner","space-y-2",3,"ngClass"],[1,"grid","grid-cols-2","sm:grid-cols-3","md:grid-cols-4","gap-x-3","gap-y-2","items-center"],[1,"block","text-xs","font-medium","text-gray-600","dark:text-gray-400",3,"for"],["type","number","formControlName","reps","placeholder","Reps",1,"mt-0.5","w-full","p-1.5","text-sm","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-600",3,"id"],["type","number","formControlName","weight","placeholder","Weight",1,"mt-0.5","w-full","p-1.5","text-sm","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-600",3,"id"],["type","number","formControlName","duration","placeholder","Secs",1,"mt-0.5","w-full","p-1.5","text-sm","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-600",3,"id"],["type","text","formControlName","tempo","placeholder","e.g. 2010",1,"mt-0.5","w-full","p-1.5","text-sm","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-600",3,"id"],[1,"col-span-2","sm:col-span-1","md:col-span-2"],["type","number","formControlName","restAfterSet","placeholder","Rest",1,"mt-0.5","w-full","p-1.5","text-sm","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-600",3,"id"],[1,"col-span-full"],["type","text","formControlName","notes","placeholder","e.g. Drop set",1,"mt-0.5","w-full","p-1.5","text-sm","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-600",3,"id"],[1,"mt-2","text-right"],["type","button",1,"text-xs","text-blue-600","hover:text-blue-700","dark:text-blue-400","dark:hover:text-blue-300","font-medium","py-1","px-2","rounded-md","hover:bg-blue-100","dark:hover:bg-blue-900/30",3,"click"],[1,"text-center","py-6","text-gray-500","dark:text-gray-400","border","border-dashed","dark:border-gray-700","rounded-md","mt-4"],[1,"mb-2"],["type","button",1,"bg-green-500","hover:bg-green-600","text-white","text-sm","font-medium","py-2","px-3","rounded-md","transition-all","duration-150","ease-in-out","disabled:opacity-50",3,"click","disabled"],[1,"mt-6","text-center"],["type","button",1,"bg-green-500","hover:bg-green-600","text-white","font-semibold","py-2","px-6","rounded-md","shadow-md","hover:shadow-lg","transition-all","duration-300","focus:outline-none","focus:ring-2","focus:ring-green-400","focus:ring-opacity-75","disabled:opacity-50",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"w-5","h-5","mr-2","inline-block"],["d","M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z"],[1,"pt-6","flex","justify-end","space-x-3"],["routerLink","/workout",1,"px-4","py-2","border","border-gray-300","dark:border-gray-600","rounded-md","shadow-sm","text-sm","font-medium","text-gray-700","dark:text-gray-200","hover:bg-gray-50","dark:hover:bg-gray-700"],["type","submit",1,"px-4","py-2","border","border-transparent","rounded-md","shadow-sm","text-sm","font-medium","text-white","bg-primary","hover:bg-primary-dark","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-primary-dark","disabled:opacity-50","transition-all","duration-150","ease-in-out",3,"disabled"],[1,"fixed","inset-0","bg-gray-600","bg-opacity-75","transition-opacity","overflow-y-auto","h-full","w-full","z-[70]","flex","items-center","justify-center","p-4",3,"click"],[1,"relative","transform","overflow-hidden","rounded-lg","bg-white","dark:bg-gray-800","text-left","shadow-xl","transition-all","sm:my-8","sm:w-full","sm:max-w-lg",3,"click"],[1,"bg-white","dark:bg-gray-800","px-4","pt-5","pb-4","sm:p-6","sm:pb-4"],[1,"sm:flex","sm:items-start","w-full"],[1,"mt-3","text-center","sm:mt-0","sm:text-left","w-full"],[1,"flex","justify-between","items-center","pb-3"],["id","modal-title",1,"text-xl","font-semibold","leading-6","text-gray-900","dark:text-gray-100"],["type","button",1,"p-1","rounded-full","text-gray-400","hover:text-gray-600","dark:hover:text-gray-300","focus:outline-none",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","d","M6 18L18 6M6 6l12 12"],[1,"my-4"],["type","text","placeholder","Search exercises...",1,"w-full","p-2","border","border-gray-300","dark:border-gray-600","rounded-md","shadow-sm","focus:ring-primary","focus:border-primary","dark:bg-gray-700","dark:text-gray-200",3,"ngModelChange","ngModel"],[1,"mt-2","max-h-80","overflow-y-auto","pr-2"],["class","p-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md cursor-pointer transition-all duration-150 ease-in-out flex justify-between items-center",3,"click",4,"ngFor","ngForOf"],["class","text-gray-500 dark:text-gray-400 text-center p-4",4,"ngIf"],[1,"bg-gray-50","dark:bg-gray-700","px-4","py-3","sm:flex","sm:flex-row-reverse","sm:px-6"],["type","button",1,"mt-3","inline-flex","w-full","justify-center","rounded-md","bg-white","dark:bg-gray-600","px-3","py-2","text-sm","font-semibold","text-gray-900","dark:text-gray-200","shadow-sm","ring-1","ring-inset","ring-gray-300","dark:ring-gray-500","hover:bg-gray-50","dark:hover:bg-gray-500","sm:mt-0","sm:w-auto",3,"click"],[1,"p-3","hover:bg-gray-100","dark:hover:bg-gray-700","rounded-md","cursor-pointer","transition-all","duration-150","ease-in-out","flex","justify-between","items-center",3,"click"],[1,"font-medium","text-gray-800","dark:text-gray-200"],[1,"block","text-xs","text-gray-500","dark:text-gray-400"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"w-5","h-5","text-primary","dark:text-primary-light"],["fill-rule","evenodd","d","M8.22 5.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06-1.06L11.94 10 8.22 6.28a.75.75 0 0 1 0-1.06Z","clip-rule","evenodd"],[1,"text-gray-500","dark:text-gray-400","text-center","p-4"]],template:function(e,i){if(e&1&&(y(0,nn,2,1,"div",2),a(1,"div",3)(2,"header",4)(3,"div",5)(4,"button",6),I(),a(5,"svg",7),w(6,"path",8),l()(),V(),a(7,"h1",9),p(8),l(),w(9,"div",10),l(),y(10,on,10,1,"div",11),l(),a(11,"form",12),S("ngSubmit",function(){return i.onSubmit()}),a(12,"section",13)(13,"div")(14,"label",14),p(15,"Routine Name"),l(),w(16,"input",15),y(17,ln,2,1,"div",16),l(),a(18,"div")(19,"label",17),p(20,"Description (Optional)"),l(),w(21,"textarea",18),l(),a(22,"div")(23,"label",19),p(24,"Primary Goal"),l(),a(25,"select",20),y(26,dn,2,2,"option",21),l()()(),a(27,"section",22)(28,"div",23)(29,"h2",24),p(30,"Exercises"),l(),y(31,cn,2,1,"button",25),l(),y(32,En,2,2,"div",26)(33,Cn,5,1,"div",27)(34,In,5,1,"div",28),l(),y(35,Tn,5,2,"div",29),l(),y(36,Vn,21,4,"div",30),l()),e&2){let r;m("ngIf",i.errorMessage()),d(8),E(" ",i.isNewMode?"New Routine":i.isViewMode?((r=i.routineForm.get("name"))==null?null:r.value)||"View Routine":"Edit: "+(((r=i.routineForm.get("name"))==null?null:r.value)||"Routine")," "),d(2),m("ngIf",!i.isNewMode&&i.currentRoutineId),d(),m("formGroup",i.routineForm),d(5),m("ngClass",Re(13,Jr,i.f.name.invalid&&i.f.name.touched,!(i.f.name.invalid&&i.f.name.touched))),d(),m("ngIf",i.f.name.invalid&&(i.f.name.dirty||i.f.name.touched)),d(9),m("ngForOf",i.routineGoals),d(5),m("ngIf",i.isEditMode&&i.exercisesFormArray.length>0),d(),m("ngIf",i.exercisesFormArray.length>0),d(),m("ngIf",i.isEditMode&&i.exercisesFormArray.length===0),d(),m("ngIf",i.isEditMode&&i.exercisesFormArray.length>0),d(),m("ngIf",i.isEditMode||i.isNewMode),d(),m("ngIf",i.isExerciseModalOpen())}},dependencies:[ee,it,pe,J,rt,gt,dt,Oi,Fi,st,ct,Wi,ot,at,Mi,ut,pt,Ri,Vi,nt,ht,lt,vr,xr,fr,hr,ft],styles:[".exercise-list-container[_ngcontent-%COMP%]{min-height:60px}.exercise-item[_ngcontent-%COMP%]{transition:box-shadow .2s ease-in-out}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:.4;background:#ccc;border:dotted 2px #999;min-height:100px;transition:transform .25s cubic-bezier(0,0,.2,1);display:block;margin-bottom:.5rem}.cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f;border-radius:.5rem;background-color:var(--card-background-color, white)}body.dark[_ngcontent-%COMP%]   .cdk-drag-preview[_ngcontent-%COMP%]{background-color:var(--dark-card-background-color, #1f2937)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .exercise-item[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"]})};var Wn=["progressCircleSvg"];function On(n,t){if(n&1&&(a(0,"div",12),p(1),l()),n&2){let e=u(2);d(),E(" Prepare for: ",e.nextUpText," ")}}function Fn(n,t){if(n&1){let e=k();a(0,"div",2)(1,"div",3),I(),a(2,"svg",4,0),w(4,"circle",5)(5,"circle",6),l(),V(),a(6,"div",7)(7,"div",8),p(8),l(),a(9,"div",9),p(10),l()()(),a(11,"button",10),S("click",function(){x(e);let r=u();return v(r.skipTimer())}),p(12," Skip "),l(),y(13,On,2,1,"div",11),l()}if(n&2){let e=u();ce("opacity-100",e.isVisible)("opacity-0",!e.isVisible),d(4),je("r",e.getCircleRadius()),d(),je("r",e.getCircleRadius())("stroke-dasharray",e.getCircleCircumference())("stroke-dashoffset",e.strokeDashoffset()),d(3),E(" ",e.displayTime()," "),d(2),E(" ",e.mainText," "),d(3),m("ngIf",e.nextUpText)}}var Pt=class n{isVisible=!1;durationSeconds=60;mainText="RESTING";nextUpText=null;timerFinished=new L;timerSkipped=new L;progressCircleSvg;timerIntervalId;circleRadius=90;circumference=2*Math.PI*this.circleRadius;remainingTime=C(0);initialDuration=C(0);strokeDashoffset=A(()=>{if(this.initialDuration()<=0)return this.circumference;let t=this.remainingTime()/this.initialDuration();return this.circumference*(1-t)});displayTime=A(()=>{let t=this.remainingTime(),e=Math.floor(t/60),i=t%60;return`${e.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`});ngOnChanges(t){t.isVisible&&(this.isVisible?this.startTimer():this.stopTimer()),t.durationSeconds&&this.isVisible&&this.startTimer()}ngAfterViewInit(){}startTimer(){if(this.stopTimer(),this.initialDuration.set(this.durationSeconds),this.remainingTime.set(this.durationSeconds),this.durationSeconds<=0){this.timerFinished.emit();return}this.timerIntervalId=setInterval(()=>{this.remainingTime.update(t=>{let e=t-1;return e<=0?(this.stopTimer(),this.timerFinished.emit(),0):e})},1e3)}stopTimer(){this.timerIntervalId&&(clearInterval(this.timerIntervalId),this.timerIntervalId=null)}skipTimer(){this.stopTimer(),this.timerSkipped.emit()}ngOnDestroy(){this.stopTimer()}getCircleCircumference(){return this.circumference}getCircleRadius(){return this.circleRadius}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=j({type:n,selectors:[["app-full-screen-rest-timer"]],viewQuery:function(e,i){if(e&1&&Te(Wn,5),e&2){let r;Pe(r=De())&&(i.progressCircleSvg=r.first)}},inputs:{isVisible:"isVisible",durationSeconds:"durationSeconds",mainText:"mainText",nextUpText:"nextUpText"},outputs:{timerFinished:"timerFinished",timerSkipped:"timerSkipped"},features:[Ge],decls:1,vars:1,consts:[["progressCircleSvg",""],["class","fixed inset-0 z-50 flex flex-col items-center justify-center bg-black/70 backdrop-blur-sm transition-opacity duration-300 ease-in-out",3,"opacity-100","opacity-0",4,"ngIf"],[1,"fixed","inset-0","z-50","flex","flex-col","items-center","justify-center","bg-black/70","backdrop-blur-sm","transition-opacity","duration-300","ease-in-out"],[1,"relative","flex","flex-col","items-center","justify-center","text-white"],["viewBox","0 0 200 200",1,"w-64","h-64","md:w-80","md:h-80","transform","-rotate-90"],["cx","100","cy","100","fill","transparent","stroke","rgba(255, 255, 255, 0.2)","stroke-width","12"],["cx","100","cy","100","fill","transparent","stroke","currentColor","stroke-width","14","stroke-linecap","round",1,"text-blue-500","dark:text-blue-400"],[1,"absolute","inset-0","flex","flex-col","items-center","justify-center","text-center"],[1,"text-6xl","md:text-7xl","font-bold","tabular-nums"],[1,"mt-2","text-xl","md:text-2xl","font-medium","uppercase","tracking-wider"],[1,"mt-12","py-3","px-8","bg-white/20","hover:bg-white/30","text-white","font-semibold","rounded-lg","shadow-md","transition-colors","duration-150","text-lg",3,"click"],["class","mt-5 text-sm md:text-base text-gray-300",4,"ngIf"],[1,"mt-5","text-sm","md:text-base","text-gray-300"]],template:function(e,i){e&1&&y(0,Fn,14,11,"div",1),e&2&&m("ngIf",i.isVisible)},dependencies:[ee,J],encapsulation:2,changeDetection:0})};var Mn=n=>({"filter dark:invert":n}),Nn=(n,t,e,i)=>({"text-red-500":n,"animate-pulse":t,"text-green-500 dark:text-green-400":e,"text-gray-800 dark:text-gray-100":i}),Ln=(n,t)=>({"bg-green-500 hover:bg-green-600":n,"bg-yellow-500 hover:bg-yellow-600 text-black":t});function An(n,t){if(n&1){let e=k();a(0,"div",11)(1,"h2",12),p(2,"Session Paused"),l(),a(3,"p",13),p(4),l(),a(5,"button",14),S("click",function(){x(e);let r=u(2);return v(r.resumeSession())}),p(6," Resume Workout "),l(),a(7,"button",15),S("click",function(){x(e);let r=u(2);return v(r.quitWorkout())}),p(8," Quit Workout (No Save) "),l()()}if(n&2){let e=u(2);d(4),E("Elapsed Time: ",e.sessionTimerDisplay())}}function Bn(n,t){if(n&1&&w(0,"img",44),n&2){let e=u().ngIf,i=u(4);m("src",i.getIconPath(e.iconName),gi)("alt",e.name+" icon")("ngClass",xi(3,Mn,e.iconName!=="default-exercise"&&e.iconName!==""&&e.iconName!==null))}}function zn(n,t){if(n&1&&(a(0,"div",42),y(1,Bn,1,5,"img",43),l()),n&2){let e=t.ngIf;d(),m("ngIf",e.iconName)}}function Gn(n,t){n&1&&w(0,"div",45)}function Un(n,t){if(n&1&&(a(0,"span"),p(1),l()),n&2){let e=u(5);d(),E("/",e.getTotalWarmupSetsForCurrentExercise())}}function jn(n,t){if(n&1&&(a(0,"span",46),p(1),y(2,Un,2,1,"span",36),l()),n&2){let e=u(4);d(),E(" Warm-up Set ",e.getCurrentWarmupSetNumber()," "),d(),m("ngIf",e.getTotalWarmupSetsForCurrentExercise()>0)}}function $n(n,t){if(n&1&&(a(0,"span"),p(1),l()),n&2){let e=u(4);d(),K(" Set ",e.getCurrentWorkingSetNumber(),"/",e.getWorkingSetCountForCurrentExercise()," ")}}function Hn(n,t){if(n&1&&(a(0,"span",47),p(1),l()),n&2){let e=u(4);d(),K(" (Round ",e.currentBlockRound(),"/",e.totalBlockRounds(),") ")}}function Zn(n,t){if(n&1&&(a(0,"span",48),p(1),l()),n&2){let e=u().ngIf;d(),K(" (Superset ",(e.exerciseData.supersetOrder??0)+1,"/",e.exerciseData.supersetSize??"?",") ")}}function Kn(n,t){if(n&1){let e=k();a(0,"div")(1,"label",49),p(2,"Weight"),l(),a(3,"div",50)(4,"button",51),S("click",function(){x(e);let r=u(4);return v(r.decrementWeight(.5))}),I(),a(5,"svg",52),w(6,"path",53),l()(),V(),w(7,"input",54),a(8,"span",55),p(9),l(),a(10,"button",51),S("click",function(){x(e);let r=u(4);return v(r.incrementWeight(.5))}),I(),a(11,"svg",52),w(12,"path",56),l()()()()}if(n&2){let e=u(4);d(4),m("disabled",e.getDisabled()),d(5),W(e.weightUnitDisplaySymbol),d(),m("disabled",e.getDisabled())}}function qn(n,t){if(n&1){let e=k();a(0,"div")(1,"label",49),p(2,"Reps"),l(),a(3,"div",50)(4,"button",51),S("click",function(){x(e);let r=u(4);return v(r.decrementReps(1))}),I(),a(5,"svg",52),w(6,"path",53),l()(),V(),w(7,"input",57),a(8,"button",51),S("click",function(){x(e);let r=u(4);return v(r.incrementReps(1))}),I(),a(9,"svg",52),w(10,"path",56),l()()()()}if(n&2){let e=u(4);d(4),m("disabled",e.getDisabled()),d(4),m("disabled",e.getDisabled())}}function Yn(n,t){if(n&1&&(a(0,"span"),p(1),l()),n&2){let e=u(2).ngIf;d(),E("(Target: ",e.setData.duration,"s)")}}function Qn(n,t){n&1&&(a(0,"span"),p(1,"Start Timer"),l())}function Jn(n,t){n&1&&(a(0,"span"),p(1,"Pause Timer"),l())}function Xn(n,t){n&1&&(a(0,"span"),p(1,"Resume Timer"),l())}function es(n,t){if(n&1){let e=k();a(0,"button",64),S("click",function(){x(e);let r=u(5);return v(r.resetTimedSet())}),p(1," Reset "),l()}if(n&2){let e=u(5);m("disabled",e.getDisabled())}}function ts(n,t){if(n&1){let e=k();a(0,"div")(1,"label",58),p(2," Time (seconds) "),y(3,Yn,2,1,"span",36),l(),a(4,"div",59),p(5),l(),w(6,"input",60),a(7,"div",61)(8,"button",62),S("click",function(){x(e);let r=u(4);return v(r.toggleTimedSetTimer())}),y(9,Qn,2,0,"span",36)(10,Jn,2,0,"span",36)(11,Xn,2,0,"span",36),l(),y(12,es,2,1,"button",63),l()()}if(n&2){let e,i=u().ngIf,r=u(3);d(3),m("ngIf",i.setData.duration>0),d(),m("ngClass",Si(9,Nn,r.isTimedSetOvertime(),r.isTimedSetOvertime()&&r.timedSetTimerState()==="running",!r.isTimedSetOvertime()&&r.timedSetTimerState()==="running"&&(((e=r.activeSetInfo())==null||e.setData==null?null:e.setData.duration)??0)>0&&r.timedSetElapsedSeconds()>0,r.timedSetTimerState()==="idle"||r.timedSetTimerState()==="paused"||!((((e=r.activeSetInfo())==null||e.setData==null?null:e.setData.duration)??0)>0&&r.timedSetElapsedSeconds()>0&&!r.isTimedSetOvertime()))),d(),E(" ",r.timedSetDisplay()," "),d(3),m("disabled",r.getDisabled())("ngClass",Re(14,Ln,r.timedSetTimerState()==="idle"||r.timedSetTimerState()==="paused",r.timedSetTimerState()==="running")),d(),m("ngIf",r.timedSetTimerState()==="idle"),d(),m("ngIf",r.timedSetTimerState()==="running"),d(),m("ngIf",r.timedSetTimerState()==="paused"),d(),m("ngIf",r.timedSetTimerState()!=="idle")}}function is(n,t){if(n&1){let e=k();a(0,"div",70)(1,"input",71),S("ngModelChange",function(r){x(e);let s=u(5);return v(s.updateRpe(r))}),l(),a(2,"div",72)(3,"span"),p(4,"Easy"),l(),a(5,"span",73),p(6),l(),a(7,"span"),p(8,"Max Effort"),l()()()}if(n&2){let e=u(5);d(),m("ngModel",e.rpeValue()),d(5),W(e.rpeValue()||"-")}}function rs(n,t){if(n&1){let e=k();a(0,"div",65)(1,"button",66),S("click",function(){x(e);let r=u(4);return v(r.toggleRpeInput())}),p(2," Tap to track RPE (optional) "),I(),a(3,"svg",67),w(4,"path",68),l()(),y(5,is,9,2,"div",69),l()}if(n&2){let e=u(4);d(5),m("ngIf",e.showRpeSlider())}}function ns(n,t){if(n&1){let e=k();a(0,"div",29)(1,"div",30),y(2,zn,2,1,"div",31)(3,Gn,1,0,"ng-template",null,3,Q),a(5,"h2",32),p(6),l()(),a(7,"div",33)(8,"p",34),y(9,jn,3,2,"span",35)(10,$n,2,2,"span",36)(11,Hn,2,2,"span",37)(12,Zn,2,2,"span",38),l()(),a(13,"form",39),y(14,Kn,13,3,"div",36)(15,qn,11,2,"div",36)(16,ts,13,17,"div",36)(17,rs,6,1,"div",40),l(),a(18,"button",41),S("click",function(){x(e);let r=u(3);return v(r.completeSetAndProceed())}),p(19),l()()}if(n&2){let e=t.ngIf,i=u(3);d(2),m("ngIf",i.currentBaseExercise()),d(3),m("title",e.exerciseData.exerciseName),d(),E(" ",e.exerciseData.exerciseName||"Loading Exercise..."," "),d(3),m("ngIf",e.isWarmup),d(),m("ngIf",!e.isWarmup),d(),m("ngIf",i.totalBlockRounds()>1&&i.currentBlockRound()>0),d(),m("ngIf",e.exerciseData.supersetId),d(),m("formGroup",i.currentSetForm),d(),m("ngIf",i.csf.actualWeight),d(),m("ngIf",i.csf.actualReps&&e.setData.reps!==void 0),d(),m("ngIf",e.setData.duration!==void 0),d(),m("ngIf",!1),d(),m("disabled",i.sessionState()==="paused"),d(),E(" ",i.nextActionButtonLabel()," ")}}function ss(n,t){n&1&&(a(0,"p",79),p(1," All sets are done. Well done! "),l())}function os(n,t){if(n&1){let e=k();a(0,"button",80),S("click",function(){x(e);let r=u(4);return v(r.finishWorkout())}),p(1," Confirm & Finish Workout "),l()}}function as(n,t){n&1&&(a(0,"button",81),I(),a(1,"svg",18),w(2,"path",19),l()())}function ls(n,t){if(n&1&&(a(0,"div",74)(1,"h2",75),p(2),l(),y(3,ss,2,0,"p",76)(4,os,2,0,"button",77)(5,as,3,0,"button",78),l()),n&2){let e=u(3);d(2),E(" ",e.sessionState()==="error"?"Error Loading Workout":"Workout Complete!"," "),d(),m("ngIf",e.sessionState()!=="error"),d(),m("ngIf",e.sessionState()!=="error"),d(),m("ngIf",e.sessionState()==="error")}}function ds(n,t){if(n&1){let e=k();a(0,"footer",82)(1,"div",83),p(2,"UP NEXT"),l(),a(3,"div",84),p(4),l(),a(5,"div",85),p(6),M(7,"number"),a(8,"button",86),S("click",function(){x(e);let r=u(3);return v(r.skipRest())}),p(9,"(Skip)"),l()()()}if(n&2){let e=u(3);d(3),m("title",e.restTimerNextUpText()),d(),E(" ",e.restTimerNextUpText()||"Next Exercise"," "),d(2),E(" Rest: ",e.restTimerDisplay()||q(7,3,e.restDuration(),"1.0-0")+"s"," ")}}function cs(n,t){if(n&1){let e=k();Ce(0),a(1,"header",16)(2,"button",17),S("click",function(){x(e);let r=u(2);return v(r.goBack())}),I(),a(3,"svg",18),w(4,"path",19),l()(),V(),a(5,"div",20)(6,"h1",21),p(7),l(),a(8,"div",22),p(9),l()(),a(10,"button",23),S("click",function(){x(e);let r=u(2);return v(r.toggleWorkoutMenu())}),I(),a(11,"svg",24),w(12,"path",25),l()()(),V(),a(13,"main",26),y(14,ns,20,14,"div",27)(15,ls,6,4,"ng-template",null,2,Q),l(),y(17,ds,10,6,"footer",28),Ie()}if(n&2){let e=t.ngIf,i=oe(16),r=u(2);d(6),m("title",e.name),d(),E(" ",e.name||"Workout"," "),d(2),W(r.sessionTimerDisplay()),d(),m("disabled",r.sessionState()==="loading"||r.sessionState()==="error"||r.sessionState()==="paused"),d(3),ce("pb-20",r.isRestTimerVisible())("pb-4",!r.isRestTimerVisible()),d(),m("ngIf",r.activeSetInfo())("ngIfElse",i),d(3),m("ngIf",r.isRestTimerVisible())}}function us(n,t){if(n&1){let e=k();a(0,"div",87)(1,"button",88),S("click",function(){x(e);let r=u(2);return v(r.goBack())}),I(),a(2,"svg",18),w(3,"path",19),l()(),V(),a(4,"div",20)(5,"h1",89),p(6,"Error"),l()(),w(7,"div",90),l(),a(8,"div",91)(9,"h2",92),p(10,"Routine Not Found"),l(),a(11,"p",93),p(12,"The selected routine could not be loaded."),l(),a(13,"button",94),I(),a(14,"svg",18),w(15,"path",19),l()()()}}function ps(n,t){if(n&1&&(a(0,"div",8),y(1,An,9,1,"div",9)(2,cs,18,11,"ng-container",10)(3,us,16,0,"ng-template",null,1,Q),l()),n&2){let e=oe(4),i=u();d(),m("ngIf",i.sessionState()==="paused"),d(),m("ngIf",i.routine())("ngIfElse",e)}}function ms(n,t){if(n&1){let e=k();a(0,"div",95)(1,"h2",96),p(2,"Workout Menu"),l(),a(3,"button",97),S("click",function(){x(e);let r=u();return v(r.pauseSession())}),p(4," Pause Workout "),l(),a(5,"button",98),S("click",function(){x(e);let r=u();return v(r.openPerformanceInsightsFromMenu())}),p(6," View Performance Insights "),l(),a(7,"button",99),S("click",function(){x(e);let r=u();return v(r.addWarmupSet())}),p(8," + Add Warm-up Set "),l(),a(9,"button",100),S("click",function(){x(e);let r=u();return v(r.skipCurrentSet())}),p(10," Skip Current Set "),l(),a(11,"button",101),S("click",function(){x(e);let r=u();return v(r.skipCurrentExercise())}),p(12," Skip Current Exercise "),l(),a(13,"button",102),S("click",function(){x(e);let r=u();return v(r.finishWorkoutEarly())}),p(14," Finish Workout Early "),l(),a(15,"button",103),S("click",function(){x(e);let r=u();return v(r.quitWorkout())}),p(16," Quit Workout "),l(),a(17,"button",104),S("click",function(){x(e);let r=u();return v(r.closeWorkoutMenu())}),p(18," Close Menu "),l()()}if(n&2){let e=u();d(3),m("disabled",e.sessionState()!=="playing"),d(2),m("disabled",e.sessionState()==="paused"),d(2),m("disabled",!e.canAddWarmupSet()||e.sessionState()==="paused"),d(2),m("disabled",!e.activeSetInfo()||e.sessionState()==="paused"),d(2),m("disabled",!e.activeSetInfo()||e.sessionState()==="paused"),d(2),m("disabled",e.sessionState()==="paused")}}function hs(n,t){n&1&&(a(0,"span",46),p(1,"(Warm-up) "),l())}function gs(n,t){if(n&1&&(a(0,"span",128),p(1,"Reps: "),a(2,"strong",129),p(3),l()()),n&2){let e=u().$implicit;d(3),W(e.repsAchieved)}}function _s(n,t){if(n&1&&(a(0,"span",128),p(1,"Weight: "),a(2,"strong",129),p(3),M(4,"weightUnit"),l()()),n&2){let e=u().$implicit;d(3),W(Y(4,1,e.weightUsed))}}function fs(n,t){if(n&1&&(a(0,"span"),p(1,"Time: "),a(2,"strong",129),p(3),l()()),n&2){let e=u().$implicit;d(3),E("",e.durationPerformed,"s")}}function xs(n,t){if(n&1&&(a(0,"p",130),p(1),l()),n&2){let e=u().$implicit;d(),E("Notes: ",e.notes)}}function vs(n,t){if(n&1&&(a(0,"div",124)(1,"p",125),y(2,hs,2,0,"span",35),p(3),l(),y(4,gs,4,1,"span",126)(5,_s,5,3,"span",126)(6,fs,4,1,"span",36)(7,xs,2,1,"p",127),l()),n&2){let e=t.$implicit,i=t.index;d(2),m("ngIf",e.isWarmup),d(),E(" Set ",i+1,": "),d(),m("ngIf",e.repsAchieved!==void 0),d(),m("ngIf",e.weightUsed!==void 0&&e.weightUsed!==null),d(),m("ngIf",e.durationPerformed!==void 0),d(),m("ngIf",e.notes)}}function Ss(n,t){if(n&1&&(a(0,"div",122),y(1,vs,8,6,"div",123),l()),n&2){let e=u(3);d(),m("ngForOf",e.allPreviousLoggedSetsForCurrentExercise())}}function ys(n,t){if(n&1&&(a(0,"li"),p(1),l()),n&2){let e=u().ngIf;d(),E("Reps: ",e.repsAchieved)}}function bs(n,t){if(n&1&&(a(0,"li"),p(1),M(2,"weightUnit"),l()),n&2){let e=u().ngIf;d(),E("Weight: ",Y(2,1,e.weightUsed))}}function ws(n,t){if(n&1&&(a(0,"li"),p(1),l()),n&2){let e=u().ngIf;d(),E("Time: ",e.durationPerformed,"s")}}function ks(n,t){if(n&1&&(a(0,"div",131)(1,"p",132),p(2),M(3,"date"),l(),a(4,"ul",133),y(5,ys,2,1,"li",36)(6,bs,3,3,"li",36)(7,ws,2,1,"li",36),l()()),n&2){let e=t.ngIf,i=u(3);d(2),E("Last time (",q(3,4,i.lastPerformanceForCurrentExercise==null?null:i.lastPerformanceForCurrentExercise.lastPerformedDate,"dd/MM/yyyy HH:mm"),"):"),d(3),m("ngIf",e.repsAchieved!==void 0),d(),m("ngIf",e.weightUsed!==void 0&&e.weightUsed!==null),d(),m("ngIf",e.durationPerformed!==void 0)}}function Es(n,t){n&1&&(a(0,"div",131)(1,"p",134),p(2,"No previous performance recorded for this exercise yet."),l()())}function Cs(n,t){if(n&1&&(a(0,"div")(1,"span",139),p(2),l(),a(3,"strong",129),p(4),l(),a(5,"em",140),p(6),M(7,"date"),l()()),n&2){let e=t.$implicit,i=u(4);d(2),E("",e.pbType,": "),d(2),W(i.formatPbValue(e)),d(2),E(" (",q(7,3,e.timestamp,"shortDate"),")")}}function Is(n,t){if(n&1&&(a(0,"div",135)(1,"p",136),p(2),l(),a(3,"div",137),y(4,Cs,8,6,"div",138),l()()),n&2){let e,i=u(3);d(2),E("Personal Bests for ",((e=i.currentBaseExercise())==null?null:e.name)||"this exercise",":"),d(2),m("ngForOf",i.exercisePBs())}}function Ts(n,t){if(n&1&&(a(0,"div",135)(1,"p",134),p(2),l()()),n&2){let e,i=u(3);d(2),E("No personal bests recorded yet for ",(e=i.currentBaseExercise())==null?null:e.name,".")}}function Ps(n,t){if(n&1){let e=k();a(0,"div",145),S("click",function(){x(e);let r=u(4);return v(r.startEditTarget("reps"))}),p(1),l()}if(n&2){let e=u(2).ngIf;d(),E(" ",e.setData.reps," ")}}function Ds(n,t){if(n&1){let e=k();a(0,"div",146)(1,"input",147),tt("ngModelChange",function(r){x(e);let s=u(4);return et(s.editingTargetValue,r)||(s.editingTargetValue=r),v(r)}),S("keyup.enter",function(){x(e);let r=u(4);return v(r.confirmEditTarget())})("keyup.escape",function(){x(e);let r=u(4);return v(r.cancelEditTarget())}),l(),a(2,"button",148),S("click",function(){x(e);let r=u(4);return v(r.confirmEditTarget())}),p(3,"\u2713"),l(),a(4,"button",149),S("click",function(){x(e);let r=u(4);return v(r.cancelEditTarget())}),p(5,"\u2715"),l()()}if(n&2){let e=u(4);d(),Xe("ngModel",e.editingTargetValue)}}function Rs(n,t){if(n&1&&(a(0,"div",141)(1,"span",142),p(2,"Target Reps"),l(),y(3,Ps,2,1,"div",143)(4,Ds,6,1,"div",144),l()),n&2){let e=u(3);d(3),m("ngIf",e.editingTarget!=="reps"),d(),m("ngIf",e.editingTarget==="reps")}}function Vs(n,t){if(n&1){let e=k();a(0,"div",145),S("click",function(){x(e);let r=u(4);return v(r.startEditTarget("weight"))}),p(1),M(2,"weightUnit"),l()}if(n&2){let e=u(2).ngIf;d(),E(" ",Y(2,1,e.setData.weight)," ")}}function Ws(n,t){if(n&1){let e=k();a(0,"div",146)(1,"input",147),tt("ngModelChange",function(r){x(e);let s=u(4);return et(s.editingTargetValue,r)||(s.editingTargetValue=r),v(r)}),S("keyup.enter",function(){x(e);let r=u(4);return v(r.confirmEditTarget())})("keyup.escape",function(){x(e);let r=u(4);return v(r.cancelEditTarget())}),l(),a(2,"button",148),S("click",function(){x(e);let r=u(4);return v(r.confirmEditTarget())}),p(3,"\u2713"),l(),a(4,"button",149),S("click",function(){x(e);let r=u(4);return v(r.cancelEditTarget())}),p(5,"\u2715"),l()()}if(n&2){let e=u(4);d(),Xe("ngModel",e.editingTargetValue)}}function Os(n,t){if(n&1&&(a(0,"div",141)(1,"span",142),p(2,"Target Weight"),l(),y(3,Vs,3,3,"div",143)(4,Ws,6,1,"div",144),l()),n&2){let e=u(3);d(3),m("ngIf",e.editingTarget!=="weight"),d(),m("ngIf",e.editingTarget==="weight")}}function Fs(n,t){if(n&1){let e=k();a(0,"div",145),S("click",function(){x(e);let r=u(4);return v(r.startEditTarget("duration"))}),p(1),a(2,"span",150),p(3,"s"),l()()}if(n&2){let e=u(2).ngIf;d(),E(" ",e.setData.duration)}}function Ms(n,t){if(n&1){let e=k();a(0,"div",146)(1,"input",147),tt("ngModelChange",function(r){x(e);let s=u(4);return et(s.editingTargetValue,r)||(s.editingTargetValue=r),v(r)}),S("keyup.enter",function(){x(e);let r=u(4);return v(r.confirmEditTarget())})("keyup.escape",function(){x(e);let r=u(4);return v(r.cancelEditTarget())}),l(),a(2,"button",148),S("click",function(){x(e);let r=u(4);return v(r.confirmEditTarget())}),p(3,"\u2713"),l(),a(4,"button",149),S("click",function(){x(e);let r=u(4);return v(r.cancelEditTarget())}),p(5,"\u2715"),l()()}if(n&2){let e=u(4);d(),Xe("ngModel",e.editingTargetValue)}}function Ns(n,t){if(n&1&&(a(0,"div",141)(1,"span",142),p(2,"Target Time"),l(),y(3,Fs,4,1,"div",143)(4,Ms,6,1,"div",144),l()),n&2){let e=u(3);d(3),m("ngIf",e.editingTarget!=="duration"),d(),m("ngIf",e.editingTarget==="duration")}}function Ls(n,t){if(n&1&&(a(0,"div",141)(1,"span",142),p(2,"Target Tempo"),l(),a(3,"span",151),p(4),l()()),n&2){let e=u().ngIf;d(4),W(e.setData.tempo)}}function As(n,t){if(n&1){let e=k();a(0,"div",114)(1,"div",115)(2,"button",116),S("click",function(){x(e);let r=u(2);return v(r.toggleCompletedSetsInfo())}),p(3),l()(),y(4,Ss,2,1,"div",117),a(5,"div",118),y(6,ks,8,7,"div",119)(7,Es,3,0,"div",119)(8,Is,5,2,"div",120)(9,Ts,3,1,"div",120)(10,Rs,5,2,"div",121)(11,Os,5,2,"div",121)(12,Ns,5,2,"div",121)(13,Ls,5,1,"div",121),l()()}if(n&2){let e=t.ngIf,i=u(2);d(3),K(" ",i.showCompletedSetsInfo()?"Hide":"Show"," Completed Sets (",i.allPreviousLoggedSetsForCurrentExercise().length,") "),d(),m("ngIf",i.allPreviousLoggedSetsForCurrentExercise().length>0&&i.showCompletedSetsInfo()),d(2),m("ngIf",i.trackingService.findPreviousSetPerformance(i.lastPerformanceForCurrentExercise,e.setData,e.setIndex)),d(),m("ngIf",!i.lastPerformanceForCurrentExercise&&i.activeSetInfo()),d(),m("ngIf",i.exercisePBs().length>0),d(),m("ngIf",i.currentBaseExercise()&&i.exercisePBs().length===0),d(),m("ngIf",e.setData.reps!==void 0),d(),m("ngIf",e.setData.weight!==void 0&&e.setData.weight!==null),d(),m("ngIf",e.setData.duration!==void 0),d(),m("ngIf",e.setData.tempo)}}function Bs(n,t){if(n&1){let e=k();a(0,"div",105)(1,"div",106)(2,"header",107)(3,"h3",108),p(4,"Performance Insights & Targets"),l(),a(5,"button",109),S("click",function(){x(e);let r=u();return v(r.closePerformanceInsights())}),I(),a(6,"svg",24),w(7,"path",110),l()()(),y(8,As,14,11,"div",111),V(),a(9,"footer",112)(10,"button",113),S("click",function(){x(e);let r=u();return v(r.closePerformanceInsights())}),p(11," Done "),l()()()()}if(n&2){let e=u();d(8),m("ngIf",e.activeSetInfo())}}function zs(n,t){n&1&&(a(0,"div",152)(1,"p",153),p(2,"Loading workout player..."),l()())}var Dt=class n{route=f(Ve);router=f(he);workoutService=f(Oe);exerciseService=f(Me);trackingService=f(_e);alertService=f(We);toastService=f(Fe);fb=f(mt);storageService=f(Li);cdr=f(ue);unitService=f(Ne);PAUSED_WORKOUT_KEY="fitTrackPro_pausedWorkoutState";PAUSED_STATE_VERSION="1.1";nextActionButtonLabel=C("SET DONE");isRestTimerVisible=C(!1);restDuration=C(0);restTimerMainText=C("RESTING");restTimerNextUpText=C(null);currentSetForm;routineId=null;routine=C(void 0);originalRoutineSnapshot=[];currentExerciseIndex=C(0);currentSetIndex=C(0);currentWorkoutLogExercises=C([]);workoutStartTime=0;routeSub;timerSub;sessionTimerDisplay=C("00:00:00");restTimerDisplay=C(null);currentBlockRound=C(1);totalBlockRounds=C(1);wasRestTimerVisibleOnPause=!1;restTimerRemainingSecondsOnPause=0;restTimerInitialDurationOnPause=0;restTimerMainTextOnPause="RESTING";restTimerNextUpTextOnPause=null;rpeValue=C(null);rpeOptions=Array.from({length:10},(t,e)=>e+1);showRpeSlider=C(!1);timedSetTimerState=C("idle");timedSetElapsedSeconds=C(0);timedSetIntervalSub;timedSetDisplay=A(()=>{let t=this.timedSetTimerState(),e=this.timedSetElapsedSeconds(),r=this.activeSetInfo()?.setData?.duration;return t==="idle"?(r!==void 0&&r>0?r:this.csf?.actualDuration?.value??0).toString():r!==void 0&&r>0?(r-e).toString():e.toString()});isTimedSetOvertime=A(()=>{if(this.timedSetTimerState()==="idle")return!1;let e=this.timedSetElapsedSeconds(),i=this.activeSetInfo()?.setData?.duration;return i!==void 0&&i>0&&e>i});unloadNotification(t){this.sessionState()==="playing"&&this.routine()&&this.currentWorkoutLogExercises().length>0&&this.captureAndSaveStateForUnload()}get weightUnitDisplaySymbol(){return this.unitService.getUnitLabel()}getWorkingSetCountForCurrentExercise=A(()=>{let t=this.routine(),e=this.currentExerciseIndex();return t&&t.exercises[e]?t.exercises[e].sets.filter(i=>!i.isWarmup).length:0});getCurrentWorkingSetNumber=A(()=>{let t=this.activeSetInfo(),e=this.routine();if(!t||!e||t.isWarmup)return 0;let i=e.exercises[t.exerciseIndex],r=0;for(let s=0;s<=t.setIndex;s++)if(i.sets[s].isWarmup||r++,s===t.setIndex)return r;return 0});getCurrentWarmupSetNumber=A(()=>{let t=this.activeSetInfo(),e=this.routine();if(!t||!e||!t.isWarmup)return 0;let i=e.exercises[t.exerciseIndex],r=0;for(let s=0;s<=t.setIndex;s++)if(i.sets[s].isWarmup&&r++,s===t.setIndex)return r;return 0});activeSetInfo=A(()=>{let t=this.routine(),e=this.currentExerciseIndex(),i=this.currentSetIndex();if(t&&t.exercises[e]&&t.exercises[e].sets[i]){let r=t.exercises[e],s=t.exercises[e].sets[i],c=this.currentWorkoutLogExercises().find(h=>h.exerciseId===r.exerciseId)?.sets.find(h=>h.plannedSetId===s.id);return{exerciseIndex:e,setIndex:i,exerciseData:r,setData:s,isWarmup:!!s.isWarmup,baseExerciseInfo:void 0,isCompleted:!!c,actualReps:c?.repsAchieved,actualWeight:c?.weightUsed,actualDuration:c?.durationPerformed,notes:c?.notes}}return null});currentBaseExercise=C(void 0);exercisePBs=C([]);allPreviousLoggedSetsForCurrentExercise=A(()=>{let t=this.activeSetInfo();if(!t||t.setIndex===0)return[];let e=this.currentWorkoutLogExercises().find(i=>i.exerciseId===t.exerciseData.exerciseId);if(e&&e.sets.length>0){let i=[];for(let r=0;r<t.setIndex;r++){let s=t.exerciseData.sets[r]?.id;if(s){let o=e.sets.find(c=>c.plannedSetId===s);o&&i.push(o)}}return i}return[]});lastPerformanceForCurrentExercise=null;editingTarget=null;editingTargetValue="";sessionState=C("loading");sessionTimerElapsedSecondsBeforePause=0;wasTimedSetRunningOnPause=!1;isWorkoutMenuVisible=C(!1);isPerformanceInsightsVisible=C(!1);showCompletedSetsInfo=C(!1);constructor(){this.initializeCurrentSetForm()}ngOnInit(){return O(this,null,function*(){window.scrollTo(0,0),(yield this.checkForPausedSession())||this.loadNewWorkoutFromRoute()})}resetAndPatchCurrentSetForm(){this.currentSetForm.reset({rpe:null}),this.rpeValue.set(null),this.showRpeSlider.set(!1);let t=this.activeSetInfo();if(this.resetTimedSet(),t){let i=this.currentWorkoutLogExercises().find(s=>s.exerciseId===t.exerciseData.exerciseId)?.sets.find(s=>s.plannedSetId===t.setData.id),r=t.setData.duration??null;i&&i.durationPerformed!==void 0&&(r=i.durationPerformed),this.currentSetForm.patchValue({actualReps:i?.repsAchieved??t.setData.reps??null,actualWeight:i?.weightUsed??t.setData.weight??null,actualDuration:r,setNotes:i?.notes??"",rpe:null})}}startSessionTimer(){this.sessionState()!=="paused"&&(this.timerSub&&this.timerSub.unsubscribe(),this.timerSub=Ot(0,1e3).subscribe(()=>{if(this.sessionState()==="playing"){let t=Math.floor((Date.now()-this.workoutStartTime)/1e3),e=this.sessionTimerElapsedSecondsBeforePause+t,i=Math.floor(e/3600),r=Math.floor(e%3600/60),s=e%60;this.sessionTimerDisplay.set(`${String(i).padStart(2,"0")}:${String(r).padStart(2,"0")}:${String(s).padStart(2,"0")}`)}}))}updateRestTimerDisplay(t){let e=Math.floor(t/60),i=t%60;this.restTimerDisplay.set(`${String(e).padStart(2,"0")}:${String(i).padStart(2,"0")}`)}addLoggedSetToCurrentLog(t,e){let i=this.currentWorkoutLogExercises(),r=i.find(s=>s.exerciseId===t.exerciseId);if(r){let s=r.sets.findIndex(o=>o.plannedSetId===e.plannedSetId);s>-1?r.sets[s]=e:r.sets.push(e),this.currentWorkoutLogExercises.set([...i])}else r={exerciseId:t.exerciseId,exerciseName:this.currentBaseExercise()?.name||t.exerciseName||"Unknown Exercise",sets:[e]},this.currentWorkoutLogExercises.set([...i,r])}finishWorkout(){return O(this,null,function*(){if(this.sessionState()==="paused"){this.toastService.warning("Please resume workout before finishing.",3e3,"Session Paused");return}if(this.sessionState()==="loading"){this.toastService.info("Workout is still loading.",3e3,"Loading");return}if(this.currentWorkoutLogExercises().length===0){this.toastService.info("No sets logged. Workout not saved.",3e3,"Empty Workout"),this.router.navigate(["/workout"]);return}this.timerSub&&this.timerSub.unsubscribe();let t=this.routine(),e=this.currentWorkoutLogExercises(),i=!0,r=!1,s=!1,o=t?.name?`${t.name} - ${new X("en-US").transform(Date.now(),"MMM d")}`:`Ad-hoc Workout - ${new X("en-US").transform(Date.now(),"MMM d, HH:mm")}`;if(this.routineId&&this.originalRoutineSnapshot&&this.originalRoutineSnapshot.length>0&&t){if(this.comparePerformedToOriginal(e,this.originalRoutineSnapshot).majorDifference){let D=yield this.alertService.showConfirmationDialog("Workout Modified",`This workout differed from the original "${t.name}". How would you like to proceed?`,[{text:"Save as New Routine",role:"confirm",data:"new",cssClass:"bg-green-500 hover:bg-green-600 text-white"},{text:"Update Original Routine",role:"confirm",data:"update_original",cssClass:"bg-orange-500 hover:bg-orange-600 text-white"},{text:"Log (Keep Original Structure)",role:"confirm",data:"log_only",cssClass:"bg-blue-500 hover:bg-blue-600 text-white"},{text:"Discard Workout",role:"cancel",data:"discard",cssClass:"bg-gray-300 hover:bg-gray-400"}]);if(D&&D.data==="new"){r=!0;let R=yield this.alertService.showPromptDialog("New Routine Name","Enter a name for this new routine:",[{name:"newRoutineName",type:"text",placeholder:"E.g., My Custom Workout",value:o}],"Save New Routine");R&&R.newRoutineName?o=String(R.newRoutineName).trim():!R&&D.data==="new"?this.toastService.warning("New routine name not provided. Saving with default name.",3e3):i=!1}else D&&D.data==="update_original"?(s=!0,this.toastService.info(`Original routine "${t.name}" will be updated with this session's structure.`,3e3,"Updating Original")):D&&D.data==="log_only"?this.toastService.info(`Workout will be logged against "${t.name}", structure unchanged.`,3e3,"Logging to Original"):(D&&D.data==="discard"||!D||D.role==="cancel"&&D.data!=="discard")&&(i=!1)}}else if(!this.routineId&&e.length>0){r=!0;let F=yield this.alertService.showPromptDialog("Save Ad-hoc Workout","Enter a name for this new routine:",[{name:"newRoutineName",type:"text",placeholder:o,value:o}],"Save New Routine");F&&String(F.newRoutineName).trim()?o=String(F.newRoutineName).trim():F||(i=!1)}if(!i){this.toastService.info("Workout not saved.",3e3,"Cancelled"),this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),this.router.url.includes("/play")&&this.router.navigate(["/workout"]);return}let c=Date.now(),h=this.workoutStartTime-this.sessionTimerElapsedSecondsBeforePause*1e3,g=Math.round((c-h)/(1e3*60)),_=this.routineId||void 0,b=t?.name||"Ad-hoc Workout";if(r){let F={id:ge(),name:o,description:t?.description||"Workout performed on "+new X("en-US").transform(Date.now(),"mediumDate"),goal:t?.goal||"custom",exercises:this.convertLoggedToWorkoutExercises(e)};this.workoutService.addRoutine(F),_=F.id,b=F.name,this.toastService.success(`New routine "${F.name}" created.`,4e3)}let T={routineId:_,routineName:b,startTime:h,endTime:c,durationMinutes:g,exercises:this.currentWorkoutLogExercises(),date:new Date(h).toISOString().split("T")[0]},N=this.trackingService.addWorkoutLog(T);if(this.toastService.success(`Workout logged against "${b}"!`,5e3,"Workout Finished"),_){let F=yield le(this.workoutService.getRoutineById(_).pipe(G(1)));if(F){let D=Z(H({},F),{lastPerformed:new Date(h).toISOString()});s&&!r&&this.routineId===_&&(D.exercises=this.convertLoggedToWorkoutExercises(e),t&&(D.name=t.name,D.description=t.description,D.goal=t.goal),this.toastService.info(`Routine "${D.name}" structure updated.`,3e3)),this.workoutService.updateRoutine(D)}}this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),this.router.navigate(["/workout/summary",N.id])})}comparePerformedToOriginal(t,e){let i=[],r=!1;t.length!==e.length&&(i.push(`Number of exercises changed (was ${e.length}, now ${t.length}).`),r=!0);let s=Math.min(t.length,e.length);for(let o=0;o<s;o++){let c=t[o],h=e[o];if(c.exerciseId!==h.exerciseId&&(i.push(`Exercise at position ${o+1} changed (was ${h.exerciseName||h.exerciseId}, now ${c.exerciseName||c.exerciseId}).`),r=!0),c.sets.length!==h.sets.length)i.push(`Set count for "${c.exerciseName||c.exerciseId}" changed (was ${h.sets.length}, now ${c.sets.length}).`),r=!0;else for(let g=0;g<c.sets.length;g++){let _=c.sets[g],b=h.sets[g],T=!!h.sets[g]?.isWarmup,N=!!_.isWarmup;if(T!==N){i.push(`Warm-up status for set ${g+1} of "${c.exerciseName||c.exerciseId}" changed.`),r=!0;break}}r&&i.some(g=>g.includes(c.exerciseName||c.exerciseId))}if(t.length>e.length)for(let o=e.length;o<t.length;o++)i.push(`Added exercise: ${t[o].exerciseName||t[o].exerciseId}.`),r=!0;return e.length>t.length&&!r&&(i.push("One or more exercises were removed from the original routine."),r=!0),{majorDifference:r,details:i}}convertLoggedToWorkoutExercises(t){let e=this.routine();return t.map(i=>{let r=e?.exercises.find(s=>s.exerciseId===i.exerciseId);return{id:ge(),exerciseId:i.exerciseId,exerciseName:i.exerciseName,supersetId:r?.supersetId||null,supersetOrder:r?.supersetOrder??null,supersetSize:r?.supersetSize??null,rounds:r?.rounds??1,notes:i.sets.map(s=>s.notes).filter(s=>!!s).join("; ")||"",sets:i.sets.map(s=>{let o=r?.sets.find(h=>h.id===s.plannedSetId);return{id:ge(),reps:s.repsAchieved,weight:s.weightUsed,duration:s.durationPerformed,tempo:s.targetTempo||o?.tempo,restAfterSet:s.targetRestAfterSet||o?.restAfterSet||60,notes:s.notes,isWarmup:s.isWarmup}})}})}get csf(){return this.currentSetForm.controls}toggleTimedSetTimer(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Please resume to use the timer.",3e3,"Paused");return}let t=this.timedSetTimerState();t==="idle"||t==="paused"?this.startOrResumeTimedSet():t==="running"&&this.pauseTimedSet()}startOrResumeTimedSet(){if(this.timedSetTimerState()==="idle"){this.timedSetElapsedSeconds.set(0);let t=this.activeSetInfo()?.setData?.duration;t!==void 0&&t>0&&this.currentSetForm.get("actualDuration")?.setValue(t,{emitEvent:!1})}this.timedSetTimerState.set("running"),this.timedSetIntervalSub&&this.timedSetIntervalSub.unsubscribe(),this.timedSetIntervalSub=Ot(0,1e3).subscribe(()=>{this.timedSetTimerState()==="running"?(this.timedSetElapsedSeconds.update(t=>t+1),this.currentSetForm.get("actualDuration")?.setValue(this.timedSetElapsedSeconds(),{emitEvent:!1})):this.timedSetIntervalSub&&this.timedSetIntervalSub.unsubscribe()})}pauseTimedSet(){this.timedSetIntervalSub&&(this.timedSetIntervalSub.unsubscribe(),this.timedSetIntervalSub=void 0),this.timedSetTimerState.set("paused")}resetTimedSet(){this.timedSetIntervalSub&&(this.timedSetIntervalSub.unsubscribe(),this.timedSetIntervalSub=void 0),this.timedSetTimerState.set("idle"),this.timedSetElapsedSeconds.set(0);let t=this.activeSetInfo()?.setData?.duration;this.currentSetForm.get("actualDuration")?.setValue(t??0,{emitEvent:!1})}stopAndLogTimedSet(){(this.timedSetTimerState()==="running"||this.timedSetTimerState()==="paused")&&this.pauseTimedSet()}checkIfLatestSetOfExercise(){let t=this.activeSetInfo(),e=this.routine();if(!t||!e)return!1;let i=e.exercises[t.exerciseIndex];if(t.setIndex===i.sets.length-1)return!0;for(let r=t.setIndex+1;r<i.sets.length;r++)if(!i.sets[r].isWarmup)return!1;return!0}checkIfLatestSetOfWorkout(){let t=this.activeSetInfo(),e=this.routine();if(!t||!e)return!1;if(t.exerciseIndex===e.exercises.length-1)return this.checkIfLatestSetOfExercise();for(let i=t.exerciseIndex+1;i<e.exercises.length;i++)if(e.exercises[i].sets.some(s=>!s.isWarmup))return!1;return this.checkIfLatestSetOfExercise()}fetchLastPerformanceAndPatchForm(){return O(this,null,function*(){yield this.prepareCurrentSet()})}patchCurrentSetFormWithData(t){this.patchActualsFormBasedOnSessionTargets()}startEditTarget(t){let e=this.activeSetInfo();if(e)switch(this.editingTarget=t,t){case"reps":this.editingTargetValue=e.setData.reps??"";break;case"weight":this.editingTargetValue=e.setData.weight??"";break;case"duration":this.editingTargetValue=e.setData.duration??"";break}}cancelEditTarget(){this.editingTarget=null,this.editingTargetValue=""}formatPbValue(t){let e="";return t.weightUsed!==void 0&&t.weightUsed!==null?(e+=`${t.weightUsed}${this.unitService.getUnitSuffix()}`,t.repsAchieved>1&&!t.pbType.includes("RM (Actual)")&&(e+=` x ${t.repsAchieved}`)):t.repsAchieved>0&&t.pbType.includes("Max Reps")?e=`${t.repsAchieved} reps`:t.durationPerformed&&t.durationPerformed>0&&t.pbType.includes("Max Duration")&&(e=`${t.durationPerformed}s`),e||"N/A"}initializeCurrentSetForm(){this.currentSetForm=this.fb.group({actualReps:[null,[B.min(0)]],actualWeight:[null,[B.min(0)]],actualDuration:[null,[B.min(0)]],setNotes:[""],rpe:[null,[B.min(1),B.max(10)]]})}prepareCurrentSet(){return O(this,null,function*(){if(this.sessionState()==="paused"){console.log("PrepareCurrentSet: Session is paused, deferring preparation.");return}let t=this.routine(),e=this.currentExerciseIndex(),i=this.currentSetIndex();if(!t||!t.exercises[e]||!t.exercises[e].sets[i]){this.currentSetForm.reset({rpe:null}),this.rpeValue.set(null),this.showRpeSlider.set(!1),this.resetTimedSet(),this.currentBaseExercise.set(null),this.exercisePBs.set([]),this.lastPerformanceForCurrentExercise=null,console.warn("prepareCurrentSet: Could not find active set data in session routine.");return}let r=t.exercises[e],s=r.sets[i];if(this.loadBaseExerciseAndPBs(r.exerciseId),!this.lastPerformanceForCurrentExercise||this.lastPerformanceForCurrentExercise.sets[0]?.exerciseId!==r.exerciseId)try{this.lastPerformanceForCurrentExercise=yield new Promise(g=>{this.trackingService.getLastPerformanceForExercise(r.exerciseId).pipe(G(1)).subscribe(_=>g(_))})}catch(g){console.error("Error fetching last performance:",g),this.lastPerformanceForCurrentExercise=null}let o=this.trackingService.findPreviousSetPerformance(this.lastPerformanceForCurrentExercise,s,i),c;if(s.isWarmup)c=Z(H({},s),{reps:s.reps??8,weight:s.weight??null,restAfterSet:s.restAfterSet??30});else{let g=this.workoutService.suggestNextSetParameters(o,s,t.goal);c=Z(H({},g),{id:s.id,notes:g.notes??s.notes,isWarmup:!1})}let h=JSON.parse(JSON.stringify(t));h.exercises[e].sets[i]=c,this.routine.set(h),this.patchActualsFormBasedOnSessionTargets()})}patchActualsFormBasedOnSessionTargets(){if(this.sessionState()==="paused"){console.log("patchActualsFormBasedOnSessionTargets: Session is paused, deferring preparation.");return}this.currentSetForm.reset({rpe:null}),this.rpeValue.set(null),this.showRpeSlider.set(!1),this.resetTimedSet();let t=this.activeSetInfo();if(!t)return;let i=this.currentWorkoutLogExercises().find(s=>s.exerciseId===t.exerciseData.exerciseId)?.sets.find(s=>s.plannedSetId===t.setData.id),r=t.setData.duration??null;i&&i.durationPerformed!==void 0&&(r=i.durationPerformed),i?(this.currentSetForm.patchValue({actualReps:i.repsAchieved,actualWeight:i.weightUsed,actualDuration:r,setNotes:i.notes,rpe:i.rpe}),i.rpe&&this.rpeValue.set(i.rpe)):this.currentSetForm.patchValue({actualReps:t.setData.reps??(t.isWarmup?8:null),actualWeight:t.setData.weight??(t.isWarmup,null),actualDuration:r,setNotes:t.setData.notes||(t.isWarmup?"Warm-up":""),rpe:null})}loadBaseExerciseAndPBs(t){this.currentBaseExercise.set(void 0),this.exercisePBs.set([]),this.exerciseService.getExerciseById(t).subscribe(e=>{this.currentBaseExercise.set(e?Z(H({},e),{iconName:this.exerciseService.determineExerciseIcon(e,e?.name)}):null)}),this.trackingService.getAllPersonalBestsForExercise(t).pipe(G(1)).subscribe(e=>this.exercisePBs.set(e))}navigateToNextStepInWorkout(t,e){let i=t.exerciseIndex,r=t.setIndex,s=e.exercises[i],o=i,c=0,h=!1;if(r<s.sets.length-1)c=r+1;else if(s.supersetId&&s.supersetOrder!==null&&s.supersetSize!==null&&s.supersetSize!==void 0&&s.supersetOrder<s.supersetSize-1){if(o++,!(o<e.exercises.length&&e.exercises[o].supersetId===s.supersetId)){let g=this.findNextExerciseBlockStartIndex(i,e);if(g!==-1)o=g,h=!0;else{this.finishWorkout();return}}}else{let g=this.totalBlockRounds();if(this.currentBlockRound()<g)this.currentBlockRound.update(_=>_+1),s.supersetId&&s.supersetOrder!==null&&(o=i-s.supersetOrder);else{let _=this.findNextExerciseBlockStartIndex(i,e);if(_!==-1)o=_,h=!0;else{this.finishWorkout();return}}}if(h){this.currentBlockRound.set(1);let g=e.exercises[o];if(!g.supersetId||g.supersetOrder===0)this.totalBlockRounds.set(g.rounds??1);else{let _=e.exercises.find(b=>b.supersetId===g.supersetId&&b.supersetOrder===0);this.totalBlockRounds.set(_?.rounds??1)}this.lastPerformanceForCurrentExercise=null}this.currentExerciseIndex.set(o),this.currentSetIndex.set(c),t.setData.restAfterSet>0&&this.startRestPeriod(t.setData.restAfterSet),this.prepareCurrentSet()}confirmEditTarget(){let t=this.activeSetInfo();if(!t||this.editingTarget===null)return;let e=parseFloat(this.editingTargetValue);if(isNaN(e)||e<0){this.toastService.error(`Invalid value for ${this.editingTarget}. Must be non-negative.`,3e3,"Input Error");return}let i=this.routine,r=i();if(!r)return;let s=JSON.parse(JSON.stringify(r)),c=s.exercises[t.exerciseIndex].sets[t.setIndex];switch(this.editingTarget){case"reps":c.reps=e;break;case"weight":c.weight=e;break;case"duration":c.duration=e;break}i.set(s),this.toastService.success(`Target ${this.editingTarget} updated to ${e}.`,3e3,"Target Updated"),this.cancelEditTarget(),this.patchActualsFormBasedOnSessionTargets()}completeSetAndProceed(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Please resume to continue.",3e3,"Paused");return}let t=this.activeSetInfo(),e=this.routine();if(!t||!e){console.error("Cannot complete set: activeInfo or routine is not available."),this.toastService.error("Cannot complete set: data missing.",0,"Error");return}if(t.setData.duration&&t.setData.duration>0&&(this.timedSetTimerState()==="running"||this.timedSetTimerState()==="paused")&&this.stopAndLogTimedSet(),this.currentSetForm.invalid){this.currentSetForm.markAllAsTouched();let o="";for(let c of Object.keys(this.currentSetForm.controls))if(this.currentSetForm.controls[c].invalid){o=c;break}this.toastService.error(`Please correct input: ${o?o+" is invalid.":"form invalid."}`,0,"Validation Error");return}let i=this.currentSetForm.value,r=i.actualDuration;t.setData.duration&&t.setData.duration>0&&this.timedSetElapsedSeconds()>0?r=this.timedSetElapsedSeconds():i.actualDuration===null&&t.setData.duration&&(r=t.setData.duration);let s={id:t.setData.id,plannedSetId:t.setData.id,exerciseId:t.exerciseData.exerciseId,isWarmup:!!t.setData.isWarmup,repsAchieved:i.actualReps??(t.setData.isWarmup?0:t.setData.reps??0),weightUsed:i.actualWeight??(t.setData.isWarmup?null:t.setData.weight),durationPerformed:r,rpe:i.rpe??void 0,targetReps:t.setData.reps,targetWeight:t.setData.weight,targetDuration:t.setData.duration,targetTempo:t.setData.tempo,notes:i.setNotes||void 0,timestamp:new Date().toISOString()};this.addLoggedSetToCurrentLog(t.exerciseData,s),this.sessionState()==="playing"&&this.captureAndSaveStateForUnload(),this.rpeValue.set(null),this.showRpeSlider.set(!1),this.navigateToNextStepInWorkout(t,e)}findNextExerciseBlockStartIndex(t,e){for(let i=t+1;i<e.exercises.length;i++){let r=e.exercises[i];if(!r.supersetId||r.supersetOrder===0)return i}return-1}getNextUpText(t,e){if(!t||!e)return"Next Set/Exercise";let i=t.exerciseIndex,r=t.setData,s=e.exercises[i],o=s.sets,c=o.findIndex(_=>_.id===r.id);if(r.isWarmup&&c<o.length-1)if(o[c+1].isWarmup){let b=0;for(let T=0;T<=c+1;T++)o[T].isWarmup&&b++;return`Warm-up Set ${b} of ${s.exerciseName}`}else{let b=0;for(let T=0;T<=c+1;T++)o[T].isWarmup||b++;return`Set ${b} of ${s.exerciseName}`}if(c<o.length-1){let _=o[c+1],b=_.isWarmup?"Warm-up":"Set",T=0;for(let N=0;N<=c+1;N++)!!o[N].isWarmup==!!_.isWarmup&&T++;return`${b} ${T} of ${s.exerciseName}`}if(s.supersetId&&s.supersetOrder!==null&&s.supersetSize&&s.supersetOrder<s.supersetSize-1){let _=i+1;if(_<e.exercises.length&&e.exercises[_].supersetId===s.supersetId)return`SUPERSET: ${e.exercises[_].sets[0].isWarmup?"Warm-up Set 1":"Set 1"} of ${e.exercises[_].exerciseName}`}let h=this.totalBlockRounds();if(this.currentBlockRound()<h){let _=i;s.supersetId&&s.supersetOrder!==null&&(_=i-s.supersetOrder);let b=e.exercises[_],N=b.sets[0].isWarmup?"Warm-up Set 1":"Set 1";return`Round ${this.currentBlockRound()+1}: ${N} of ${b.exerciseName}`}let g=this.findNextExerciseBlockStartIndex(i,e);if(g!==-1){let _=e.exercises[g];return`${_.sets[0].isWarmup?"Warm-up Set 1":"Set 1"} of ${_.exerciseName}`}return"Finish Workout!"}getDisabled(){return this.timedSetTimerState()==="running"||this.sessionState()==="paused"}startRestPeriod(t,e=!1){if(this.sessionState()==="paused"&&!e){this.wasRestTimerVisibleOnPause=!0,this.restTimerRemainingSecondsOnPause=t,this.restTimerInitialDurationOnPause=t,this.restTimerMainTextOnPause=this.activeSetInfo()?.setData?.restAfterSet===0&&this.activeSetInfo()?.exerciseData?.supersetId?"SUPERSET TRANSITION":"RESTING";let i=this.activeSetInfo();this.routine()&&i&&(this.restTimerNextUpTextOnPause=this.activeSetInfo()?.exerciseData.exerciseName||"Next Exercise");return}if(t>0){let i=this.routine();this.restDuration.set(t),e?(this.restTimerMainText.set(this.restTimerMainTextOnPause),this.restTimerNextUpText.set(this.restTimerNextUpTextOnPause)):(this.restTimerMainText.set(this.activeSetInfo()?.setData?.restAfterSet===0&&this.activeSetInfo()?.exerciseData?.supersetId?"SUPERSET TRANSITION":"RESTING"),this.restTimerNextUpText.set(this.activeSetInfo()?.exerciseData.exerciseName||"Next Exercise")),this.isRestTimerVisible.set(!0),this.updateRestTimerDisplay(t)}else this.isRestTimerVisible.set(!1)}handleRestTimerFinished(){this.isRestTimerVisible.set(!1)}handleRestTimerSkipped(){this.isRestTimerVisible.set(!1),this.toastService.info("Rest skipped.",2e3)}skipRest(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Resume to skip rest.",3e3,"Paused");return}this.isRestTimerVisible()&&this.handleRestTimerSkipped()}pauseSession(){return O(this,null,function*(){this.sessionState()==="playing"&&(this.isPerformanceInsightsVisible.set(!1),this.closeWorkoutMenu(),this.sessionTimerElapsedSecondsBeforePause+=Math.floor((Date.now()-this.workoutStartTime)/1e3),this.timerSub&&this.timerSub.unsubscribe(),this.wasTimedSetRunningOnPause=this.timedSetTimerState()==="running",this.timedSetTimerState()==="running"&&this.pauseTimedSet(),this.wasRestTimerVisibleOnPause=this.isRestTimerVisible(),this.wasRestTimerVisibleOnPause&&(this.restTimerRemainingSecondsOnPause=this.restDuration(),this.restTimerInitialDurationOnPause=this.restDuration(),this.restTimerMainTextOnPause=this.restTimerMainText(),this.restTimerNextUpTextOnPause=this.restTimerNextUpText(),this.isRestTimerVisible.set(!1)),this.sessionState.set("paused"),this.savePausedSessionState(),this.toastService.info("Workout Paused",3e3))})}resumeSession(){this.sessionState()==="paused"&&(this.workoutStartTime=Date.now(),this.sessionState.set("playing"),this.startSessionTimer(),this.wasTimedSetRunningOnPause&&this.timedSetTimerState()==="paused"&&this.startOrResumeTimedSet(),this.wasTimedSetRunningOnPause=!1,this.wasRestTimerVisibleOnPause&&this.restTimerRemainingSecondsOnPause>0&&this.startRestPeriod(this.restTimerRemainingSecondsOnPause,!0),this.wasRestTimerVisibleOnPause=!1,this.closeWorkoutMenu(),this.closePerformanceInsights(),this.toastService.info("Workout session resumed.",3e3))}checkForPausedSession(){return O(this,null,function*(){let t=this.storageService.getItem(this.PAUSED_WORKOUT_KEY);if(t&&t.version===this.PAUSED_STATE_VERSION){let e=t.sessionRoutine?.name||"a previous session",i=[{text:"Discard",role:"cancel",data:!1,cssClass:"bg-gray-300 hover:bg-gray-500"},{text:"Resume",role:"confirm",data:!0,cssClass:"bg-green-500 hover:bg-green-600 text-white"}],r=yield this.alertService.showConfirmationDialog("Resume Workout?",`You have a paused workout session for "${e}". Would you like to resume it?`,i);return r&&r.data===!0?(yield this.loadStateFromPausedSession(t),this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),!0):(this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),this.toastService.info("Paused session discarded.",3e3),!1)}return!1})}loadNewWorkoutFromRoute(){return O(this,null,function*(){this.sessionState.set("loading"),this.workoutStartTime=Date.now(),this.sessionTimerElapsedSecondsBeforePause=0,this.originalRoutineSnapshot=[],this.routeSub=this.route.paramMap.pipe(ne(t=>(this.routineId=t.get("routineId"),this.routineId?this.workoutService.getRoutineById(this.routineId).pipe(ve(e=>e?(this.originalRoutineSnapshot=JSON.parse(JSON.stringify(e.exercises)),JSON.parse(JSON.stringify(e))):null)):re(null))),de(t=>O(this,null,function*(){if(t)if(this.routine.set(t),t.exercises.length>0){let e=t.exercises[0];if(!e.supersetId||e.supersetOrder===0)this.totalBlockRounds.set(e.rounds??1);else{let i=t.exercises.find(r=>r.supersetId===e.supersetId&&r.supersetOrder===0);this.totalBlockRounds.set(i?.rounds??1)}}else this.totalBlockRounds.set(1);else if(this.routineId){this.routine.set(null),this.sessionState.set("error"),this.toastService.error("Failed to load workout routine.",0,"Load Error"),this.router.navigate(["/workout"]);return}this.currentBlockRound.set(1),this.currentExerciseIndex.set(0),this.currentSetIndex.set(0),this.currentWorkoutLogExercises.set([]),yield this.prepareCurrentSet(),this.sessionState.set("playing"),this.startSessionTimer()}))).subscribe()})}loadStateFromPausedSession(t){return O(this,null,function*(){this.routineId=t.routineId,this.routine.set(t.sessionRoutine),this.originalRoutineSnapshot=t.originalRoutineSnapshot?JSON.parse(JSON.stringify(t.originalRoutineSnapshot)):[],this.currentExerciseIndex.set(t.currentExerciseIndex),this.currentSetIndex.set(t.currentSetIndex),this.currentWorkoutLogExercises.set(t.currentWorkoutLogExercises),this.workoutStartTime=Date.now(),this.sessionTimerElapsedSecondsBeforePause=t.sessionTimerElapsedSecondsBeforePause,this.currentBlockRound.set(t.currentBlockRound),this.totalBlockRounds.set(t.totalBlockRounds),this.timedSetTimerState.set(t.timedSetTimerState),this.timedSetElapsedSeconds.set(t.timedSetElapsedSeconds),this.wasTimedSetRunningOnPause=t.timedSetTimerState==="running"||t.timedSetTimerState==="paused",this.lastPerformanceForCurrentExercise=t.lastPerformanceForCurrentExercise,this.wasRestTimerVisibleOnPause=t.isRestTimerVisibleOnPause,this.restTimerRemainingSecondsOnPause=t.restTimerRemainingSecondsOnPause,this.restTimerInitialDurationOnPause=t.restTimerInitialDurationOnPause,this.restTimerMainTextOnPause=t.restTimerMainTextOnPause,this.restTimerNextUpTextOnPause=t.restTimerNextUpTextOnPause,yield this.prepareCurrentSet(),this.sessionState.set("playing"),this.startSessionTimer(),t.timedSetTimerState==="running"&&this.startOrResumeTimedSet(),this.wasRestTimerVisibleOnPause&&this.restTimerRemainingSecondsOnPause>0&&this.startRestPeriod(this.restTimerRemainingSecondsOnPause,!0),this.cdr.detectChanges(),this.toastService.success("Workout session resumed.",3e3,"Resumed")})}savePausedSessionState(){let t=this.routine();if(!t){console.warn("Cannot save paused state: routine data is not available.");return}let e=this.sessionTimerElapsedSecondsBeforePause;this.sessionState()==="playing"&&this.workoutStartTime>0&&(e+=Math.floor((Date.now()-this.workoutStartTime)/1e3));let i={version:this.PAUSED_STATE_VERSION,routineId:this.routineId,sessionRoutine:JSON.parse(JSON.stringify(t)),originalRoutineSnapshot:JSON.parse(JSON.stringify(this.originalRoutineSnapshot)),currentExerciseIndex:this.currentExerciseIndex(),currentSetIndex:this.currentSetIndex(),currentWorkoutLogExercises:JSON.parse(JSON.stringify(this.currentWorkoutLogExercises())),workoutStartTimeOriginal:this.workoutStartTime,sessionTimerElapsedSecondsBeforePause:e,currentBlockRound:this.currentBlockRound(),totalBlockRounds:this.totalBlockRounds(),timedSetTimerState:this.timedSetTimerState(),timedSetElapsedSeconds:this.timedSetElapsedSeconds(),isResting:this.isRestTimerVisible(),isRestTimerVisibleOnPause:this.wasRestTimerVisibleOnPause,restTimerRemainingSecondsOnPause:this.restTimerRemainingSecondsOnPause,restTimerInitialDurationOnPause:this.restTimerInitialDurationOnPause,restTimerMainTextOnPause:this.restTimerMainTextOnPause,restTimerNextUpTextOnPause:this.restTimerNextUpTextOnPause,lastPerformanceForCurrentExercise:this.lastPerformanceForCurrentExercise?JSON.parse(JSON.stringify(this.lastPerformanceForCurrentExercise)):null};this.storageService.setItem(this.PAUSED_WORKOUT_KEY,i)}captureAndSaveStateForUnload(){let t=this.sessionTimerElapsedSecondsBeforePause;this.sessionState()==="playing"&&this.workoutStartTime>0&&(t+=Math.floor((Date.now()-this.workoutStartTime)/1e3));let e=this.sessionTimerElapsedSecondsBeforePause;this.sessionTimerElapsedSecondsBeforePause=t,this.savePausedSessionState(),this.sessionTimerElapsedSecondsBeforePause=e,console.log("Session state attempt saved via beforeunload.")}addWarmupSet(){return O(this,null,function*(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Resume to add warm-up.",3e3,"Paused");return}let t=this.routine(),e=this.activeSetInfo();if(!t||!e){this.toastService.error("Cannot add warm-up: data unavailable.",0,"Error");return}let r=t.exercises[e.exerciseIndex].sets.findIndex(h=>!h.isWarmup);if(e.setIndex>0&&e.setIndex>r&&r!==-1){let h=yield this.alertService.showConfirm("Add Warm-up Set","You are past the first working set. Adding a warm-up set now will insert it before the current set. Continue?");if(!h||!h.data)return}let s={id:`warmup-${Date.now()}-${Math.random().toString(36).substring(2,7)}`,isWarmup:!0,reps:8,weight:0,duration:void 0,restAfterSet:30,notes:"Warm-up set"},o=JSON.parse(JSON.stringify(t));o.exercises[e.exerciseIndex].sets.splice(e.setIndex,0,s),this.routine.set(o),this.toastService.success("Warm-up set added. Fill details & complete.",4e3,"Warm-up Added"),yield this.prepareCurrentSet(),this.closeWorkoutMenu(),this.closePerformanceInsights()})}ngOnDestroy(){this.routeSub&&this.routeSub.unsubscribe(),this.timerSub&&this.timerSub.unsubscribe(),this.timedSetIntervalSub&&this.timedSetIntervalSub.unsubscribe(),this.isRestTimerVisible.set(!1)}getSets(){let t=this.activeSetInfo(),e=t?.exerciseData.sets||[];return t?.setData.isWarmup?e.filter(i=>!i.isWarmup):e}getWarmUpSets(){let t=this.activeSetInfo(),e=t?.exerciseData.sets||[];return t?.setData.isWarmup?e.filter(i=>i.isWarmup):[]}getTotalWarmupSetsForCurrentExercise=A(()=>{let t=this.routine(),e=this.currentExerciseIndex();return t&&t.exercises[e]?t.exercises[e].sets.filter(i=>i.isWarmup).length:0});canAddWarmupSet=A(()=>{let t=this.activeSetInfo(),e=this.routine();if(!t||!e||this.sessionState()==="paused")return!1;let i=e.exercises[t.exerciseIndex].sets;for(let r=0;r<=t.setIndex;r++)if(!i[r].isWarmup&&this.getTotalWarmupSetsForCurrentExercise()>0)return!1;return!0});getIconPath(t){return this.exerciseService.getIconPath(t)}toggleWorkoutMenu(){this.sessionState()==="paused"&&!this.isWorkoutMenuVisible()||this.sessionState()==="paused"&&this.isWorkoutMenuVisible()||(this.isWorkoutMenuVisible.update(t=>!t),this.isWorkoutMenuVisible()&&this.isPerformanceInsightsVisible.set(!1))}closeWorkoutMenu(){this.isWorkoutMenuVisible.set(!1)}skipCurrentSet(){return O(this,null,function*(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Resume to skip set.",3e3,"Paused");return}let t=this.activeSetInfo(),e=this.routine();if(!t||!e){this.toastService.error("Cannot skip set: No active set information.",0,"Error");return}let i=yield this.alertService.showConfirm("Skip Current Set",`Skip current ${t.isWarmup?"warm-up":"set "+this.getCurrentWorkingSetNumber()} of "${t.exerciseData.exerciseName}"? It won't be logged.`);!i||!i.data||(this.toastService.info(`Skipped set of ${t.exerciseData.exerciseName}.`,2e3),this.resetTimedSet(),this.navigateToNextStepInWorkout(t,e),this.closeWorkoutMenu(),this.closePerformanceInsights())})}skipCurrentExercise(){return O(this,null,function*(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Resume to skip exercise.",3e3,"Paused");return}let t=this.activeSetInfo(),e=this.routine();if(!t||!e){this.toastService.error("Cannot skip exercise: No active exercise information.",0,"Error");return}let i=yield this.alertService.showConfirm("Skip Current Exercise",`Skip all remaining sets of "${t.exerciseData.exerciseName}" for this round?`);if(!i||!i.data)return;this.toastService.info(`Skipped exercise ${t.exerciseData.exerciseName}.`,3e3);let r=t.exerciseIndex,s=this.findNextExerciseBlockStartIndex(r,e);if(s!==-1){this.currentExerciseIndex.set(s),this.currentSetIndex.set(0),this.currentBlockRound.set(1);let o=e.exercises[s];if(!o.supersetId||o.supersetOrder===0)this.totalBlockRounds.set(o.rounds??1);else{let c=e.exercises.find(h=>h.supersetId===o.supersetId&&h.supersetOrder===0);this.totalBlockRounds.set(c?.rounds??1)}this.lastPerformanceForCurrentExercise=null,this.prepareCurrentSet()}else this.finishWorkout();this.closeWorkoutMenu(),this.closePerformanceInsights()})}finishWorkoutEarly(){return O(this,null,function*(){if(this.sessionState()==="paused"){this.toastService.warning("Please resume before finishing early.",3e3,"Paused");return}let t=yield this.alertService.showConfirm("Finish Workout Early","Finish workout now? Progress will be saved.");t&&t.data&&(this.closeWorkoutMenu(),this.closePerformanceInsights(),this.finishWorkout())})}quitWorkout(){return O(this,null,function*(){let t=yield this.alertService.showConfirm("Quit Workout","Quit workout? Unsaved progress (if not paused) will be lost.");t&&t.data&&(this.sessionState.set("playing"),this.timerSub&&this.timerSub.unsubscribe(),this.timedSetIntervalSub&&this.timedSetIntervalSub.unsubscribe(),this.isRestTimerVisible.set(!1),this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),this.closeWorkoutMenu(),this.closePerformanceInsights(),this.router.navigate(["/workout"]),this.toastService.info("Workout quit. No progress saved for this session unless paused.",4e3))})}toggleCompletedSetsInfo(){this.showCompletedSetsInfo.update(t=>!t)}openPerformanceInsights(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Resume to view insights.",3e3,"Paused");return}this.isPerformanceInsightsVisible.set(!0),this.isWorkoutMenuVisible.set(!1)}closePerformanceInsights(){this.isPerformanceInsightsVisible.set(!1),this.editingTarget&&this.cancelEditTarget()}openPerformanceInsightsFromMenu(){this.closeWorkoutMenu(),this.openPerformanceInsights()}goBack(){this.currentWorkoutLogExercises().length>0&&this.sessionState()==="playing"?this.alertService.showConfirm("Exit Workout?","You have an active workout. Are you sure you want to exit? Your progress might be lost unless you pause first.").then(t=>{t&&t.data&&this.router.navigate(["/workout"])}):this.router.navigate(["/workout"])}incrementWeight(t=.5){let e=t,i=this.csf.actualWeight.value??0;this.currentSetForm.patchValue({actualWeight:parseFloat((i+e).toFixed(2))})}decrementWeight(t=.5){let e=t,i=this.csf.actualWeight.value??0;this.currentSetForm.patchValue({actualWeight:Math.max(0,parseFloat((i-e).toFixed(2)))})}incrementReps(t=1){let e=t,i=this.csf.actualReps.value??0;this.currentSetForm.patchValue({actualReps:i+e})}decrementReps(t=1){let e=t,i=this.csf.actualReps.value??0;this.currentSetForm.patchValue({actualReps:Math.max(0,i-e)})}toggleRpeInput(){this.showRpeSlider.update(t=>!t)}updateRpe(t){let e=typeof t=="string"?parseInt(t,10):t;e!==null&&!isNaN(e)&&e>=1&&e<=10?(this.rpeValue.set(e),this.currentSetForm.patchValue({rpe:e})):e===null&&(this.rpeValue.set(null),this.currentSetForm.patchValue({rpe:null}))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=j({type:n,selectors:[["app-workout-player"]],hostBindings:function(e,i){e&1&&S("beforeunload",function(s){return i.unloadNotification(s)},_i)},features:[ae([me])],decls:6,vars:8,consts:[["loadingOrError",""],["routineNotFound",""],["workoutCompleteOrError",""],["loadingBaseExIcon",""],["class","workout-player-container bg-gray-50 dark:bg-gray-950 min-h-screen flex flex-col",4,"ngIf","ngIfElse"],[3,"timerFinished","timerSkipped","isVisible","durationSeconds","mainText","nextUpText"],["class","fixed inset-0 z-50 bg-black/70 backdrop-blur-md flex flex-col items-center justify-center p-4 space-y-3 sm:space-y-4",4,"ngIf"],["style","z-index: 100","class","fixed inset-0 bg-gray-800/80 dark:bg-black/80 backdrop-blur-sm flex items-center justify-center p-4",4,"ngIf"],[1,"workout-player-container","bg-gray-50","dark:bg-gray-950","min-h-screen","flex","flex-col"],["class","fixed inset-0 z-[60] bg-black/70 backdrop-blur-sm flex flex-col items-center justify-center space-y-6 p-4",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"fixed","inset-0","z-[60]","bg-black/70","backdrop-blur-sm","flex","flex-col","items-center","justify-center","space-y-6","p-4"],[1,"text-4xl","font-bold","text-white"],[1,"text-lg","text-gray-200"],[1,"bg-green-500","hover:bg-green-600","text-white","font-bold","py-3","px-8","rounded-lg","text-xl","shadow-lg","w-full","max-w-xs",3,"click"],[1,"text-sm","text-red-300","hover:text-red-100","font-medium","py-2","px-4","rounded-md","border","border-red-300","hover:bg-red-700/30","w-full","max-w-xs","mt-2",3,"click"],[1,"fixed","top-0","left-0","right-0","z-30","bg-gray-50","dark:bg-gray-950","border-b","border-gray-200","dark:border-gray-800","p-2","flex","items-center","justify-between","h-14"],[1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-ml-1",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"text-center"],[1,"text-sm","font-semibold","text-gray-700","dark:text-gray-300","uppercase","tracking-wider","truncate","max-w-[calc(100vw-120px)]",3,"title"],[1,"text-xs","text-gray-500","dark:text-gray-400"],[1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-mr-1","disabled:opacity-50",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-6","w-6"],["stroke-linecap","round","stroke-linejoin","round","d","M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"],[1,"flex-grow","overflow-y-auto","pt-10"],["class","p-4 max-w-md mx-auto",4,"ngIf","ngIfElse"],["class","fixed bottom-0 left-0 right-0 z-30 bg-gray-50 dark:bg-gray-950 border-t border-gray-200 dark:border-gray-800 p-3 text-center h-auto min-h-[70px] flex flex-col justify-center",4,"ngIf"],[1,"p-4","max-w-md","mx-auto"],[1,"flex","text-center","justify-center","items-center","mb-1"],["class","mr-2 h-8 w-8 flex-shrink-0",4,"ngIf"],[1,"text-2xl","font-bold","text-gray-800","dark:text-gray-100","truncate",3,"title"],[1,"text-center","mb-4"],[1,"text-sm","text-gray-500","dark:text-gray-400"],["class","text-blue-500 dark:text-blue-400",4,"ngIf"],[4,"ngIf"],["class","ml-2",4,"ngIf"],["class","ml-2 text-purple-500 dark:text-purple-400 italic",4,"ngIf"],[1,"space-y-6","mb-8",3,"formGroup"],["class","pt-4",4,"ngIf"],[1,"w-full","bg-red-500","hover:bg-red-600","text-white","font-bold","py-4","px-4","rounded-2xl","shadow-md","text-lg","transition-colors","focus:outline-none","focus:ring-2","focus:ring-red-400","disabled:opacity-50",3,"click","disabled"],[1,"mr-2","h-8","w-8","flex-shrink-0"],["class","w-full h-full object-contain",3,"src","alt","ngClass",4,"ngIf"],[1,"w-full","h-full","object-contain",3,"src","alt","ngClass"],[1,"w-8","h-8","bg-gray-200","dark:bg-gray-700","rounded-md","animate-pulse","mr-2","flex-shrink-0"],[1,"text-blue-500","dark:text-blue-400"],[1,"ml-2"],[1,"ml-2","text-purple-500","dark:text-purple-400","italic"],[1,"block","text-xs","font-medium","text-gray-500","dark:text-gray-400","uppercase","tracking-wider","text-center","mb-2"],[1,"flex","items-center","justify-center","space-x-3"],["type","button",1,"p-3","bg-gray-200","dark:bg-gray-700","rounded-lg","text-gray-700","dark:text-gray-200","hover:bg-gray-300","dark:hover:bg-gray-600","disabled:opacity-50",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M20 12H4"],["type","number","formControlName","actualWeight","readonly","","placeholder","0",1,"w-28","text-center","text-3xl","font-bold","bg-transparent","border-none","p-0","focus:ring-0","text-gray-800","dark:text-gray-100"],[1,"text-lg","text-gray-700","dark:text-gray-200","-ml-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],["type","number","formControlName","actualReps","readonly","","placeholder","0",1,"w-28","text-center","text-3xl","font-bold","bg-transparent","border-none","p-0","focus:ring-0","text-gray-800","dark:text-gray-100"],["for","timedSetDisplay",1,"block","text-xs","font-medium","text-gray-500","dark:text-gray-400","uppercase","tracking-wider","text-center","mb-2"],["id","timedSetDisplay",1,"mt-1","block","w-full","p-3","border-none","text-3xl","font-bold","text-center","bg-transparent","focus:ring-0",3,"ngClass"],["type","number","formControlName","actualDuration",1,"hidden"],[1,"flex","space-x-2","mt-2","justify-center"],["type","button",1,"flex-grow","max-w-[150px]","text-white","font-medium","py-2","px-3","rounded-md","transition-colors","text-sm","disabled:opacity-50",3,"click","disabled","ngClass"],["type","button","class","flex-grow max-w-[150px] bg-gray-300 hover:bg-gray-400 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 font-medium py-2 px-3 rounded-md transition-colors text-sm disabled:opacity-50",3,"disabled","click",4,"ngIf"],["type","button",1,"flex-grow","max-w-[150px]","bg-gray-300","hover:bg-gray-400","dark:bg-gray-600","dark:hover:bg-gray-500","text-gray-800","dark:text-gray-200","font-medium","py-2","px-3","rounded-md","transition-colors","text-sm","disabled:opacity-50",3,"click","disabled"],[1,"pt-4"],["type","button",1,"w-full","text-center","text-sm","text-gray-500","dark:text-gray-400","hover:text-primary","dark:hover:text-primary-light","mb-2",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"inline","h-4","w-4","ml-1","text-gray-400","dark:text-gray-500"],["stroke-linecap","round","stroke-linejoin","round","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],["class","mt-2 px-2",4,"ngIf"],[1,"mt-2","px-2"],["type","range","min","1","max","10","step","1","formControlName","rpe",1,"w-full","h-2","bg-gray-300","dark:bg-gray-700","rounded-lg","appearance-none","cursor-pointer","[&::-webkit-slider-thumb]:bg-red-500","[&::-moz-range-thumb]:bg-red-500",3,"ngModelChange","ngModel"],[1,"flex","justify-between","text-xs","text-gray-500","dark:text-gray-400","px-1","mt-1"],[1,"font-semibold","text-red-500"],[1,"text-center","py-10","pt-16"],[1,"text-2xl","font-semibold","text-gray-700","dark:text-gray-200"],["class","text-gray-600 dark:text-gray-400 mt-2",4,"ngIf"],["class","mt-6 bg-primary hover:bg-primary-dark text-white font-bold py-3 px-6 rounded-lg shadow-md text-lg transition-colors",3,"click",4,"ngIf"],["routerLink","/profile","class","text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-primary-light p-2 -ml-1",4,"ngIf"],[1,"text-gray-600","dark:text-gray-400","mt-2"],[1,"mt-6","bg-primary","hover:bg-primary-dark","text-white","font-bold","py-3","px-6","rounded-lg","shadow-md","text-lg","transition-colors",3,"click"],["routerLink","/profile",1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-ml-1"],[1,"fixed","bottom-0","left-0","right-0","z-30","bg-gray-50","dark:bg-gray-950","border-t","border-gray-200","dark:border-gray-800","p-3","text-center","h-auto","min-h-[70px]","flex","flex-col","justify-center"],[1,"text-xs","font-semibold","text-gray-500","dark:text-gray-400","uppercase","tracking-wider"],[1,"text-lg","font-medium","text-gray-800","dark:text-gray-100","truncate","px-4",3,"title"],[1,"text-sm","text-gray-600","dark:text-gray-300"],[1,"ml-2","text-xs","text-primary","dark:text-primary-light","hover:underline",3,"click"],[1,"fixed","top-0","left-0","right-0","z-30","bg-gray-50","dark:bg-gray-950","border-b","border-gray-200","dark:border-gray-800","p-4","flex","items-center","justify-between","h-16"],[1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-ml-2",3,"click"],[1,"text-sm","font-semibold","text-gray-700","dark:text-gray-300","uppercase","tracking-wider"],[1,"w-6"],[1,"text-center","py-20","pt-24"],[1,"text-2xl","font-semibold","text-red-600","dark:text-red-400","mb-4"],[1,"text-gray-600","dark:text-gray-400"],["routerLink","/workout",1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-ml-1"],[1,"fixed","inset-0","z-50","bg-black/70","backdrop-blur-md","flex","flex-col","items-center","justify-center","p-4","space-y-3","sm:space-y-4"],[1,"text-2xl","sm:text-3xl","font-bold","text-white","mb-2","sm:mb-4"],[1,"w-full","max-w-xs","sm:max-w-sm","bg-yellow-500","hover:bg-yellow-600","text-white","font-bold","py-3","px-6","rounded-lg","text-lg","sm:text-xl","shadow-lg","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","max-w-xs","sm:max-w-sm","bg-cyan-500","hover:bg-cyan-600","text-white","font-semibold","py-2.5","sm:py-3","px-6","rounded-lg","text-md","sm:text-lg","shadow-md","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","max-w-xs","sm:max-w-sm","bg-sky-500","hover:bg-sky-600","text-white","font-semibold","py-2.5","sm:py-3","px-6","rounded-lg","text-md","sm:text-lg","shadow-md","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","max-w-xs","sm:max-w-sm","bg-blue-500","hover:bg-blue-600","text-white","font-semibold","py-2.5","sm:py-3","px-6","rounded-lg","text-md","sm:text-lg","shadow-md","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","max-w-xs","sm:max-w-sm","bg-indigo-500","hover:bg-indigo-600","text-white","font-semibold","py-2.5","sm:py-3","px-6","rounded-lg","text-md","sm:text-lg","shadow-md","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","max-w-xs","sm:max-w-sm","bg-teal-500","hover:bg-teal-600","text-white","font-semibold","py-2.5","sm:py-3","px-6","rounded-lg","text-md","sm:text-lg","shadow-md","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","max-w-xs","sm:max-w-sm","text-red-300","hover:text-red-100","font-medium","py-2.5","sm:py-3","px-6","rounded-lg","border","border-red-400","hover:bg-red-700/50","text-md","sm:text-lg",3,"click"],[1,"mt-4","sm:mt-6","text-gray-300","hover:text-white","font-medium","py-2","px-4","rounded-md","text-sm",3,"click"],[1,"fixed","inset-0","bg-gray-800/80","dark:bg-black/80","backdrop-blur-sm","flex","items-center","justify-center","p-4",2,"z-index","100"],[1,"bg-white","dark:bg-gray-800","rounded-lg","shadow-2xl","w-full","max-w-lg","max-h-[90vh]","flex","flex-col"],[1,"p-4","border-b","border-gray-200","dark:border-gray-700","flex","justify-between","items-center"],[1,"text-xl","font-semibold","text-gray-800","dark:text-gray-100"],[1,"p-1","rounded-full","text-gray-500","hover:text-gray-700","dark:text-gray-400","dark:hover:text-gray-200","hover:bg-gray-200","dark:hover:bg-gray-700","focus:outline-none",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M6 18L18 6M6 6l12 12"],["class","p-4 pt-1 overflow-y-auto",4,"ngIf"],[1,"p-4","border-t","border-gray-200","dark:border-gray-700","text-right"],[1,"bg-primary","hover:bg-primary-dark","text-white","font-semibold","py-2","px-6","rounded-md","text-sm",3,"click"],[1,"p-4","pt-1","overflow-y-auto"],[1,"mb-3"],[1,"text-xs","text-primary","dark:text-primary-light","hover:underline",3,"click"],["class","mb-4 mt-1 space-y-2 max-h-32 overflow-y-auto p-2 border dark:border-gray-700 rounded-md bg-gray-50 dark:bg-gray-700",4,"ngIf"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-2"],["class","col-span-full pt-2 text-xs",4,"ngIf"],["class","col-span-full mt-2 pt-2 border-t border-dashed border-gray-300 dark:border-gray-600 text-xs",4,"ngIf"],["class","col-span-2 md:col-span-2 mt-2 pt-2 border-t border-dashed border-gray-300 dark:border-gray-600",4,"ngIf"],[1,"mb-4","mt-1","space-y-2","max-h-32","overflow-y-auto","p-2","border","dark:border-gray-700","rounded-md","bg-gray-50","dark:bg-gray-700"],["class","p-1.5 border-b border-gray-200 dark:border-gray-600 last:border-b-0 text-xs",4,"ngFor","ngForOf"],[1,"p-1.5","border-b","border-gray-200","dark:border-gray-600","last:border-b-0","text-xs"],[1,"font-medium","text-gray-600","dark:text-gray-200","mb-0.5"],["class","mr-3",4,"ngIf"],["class","mt-1 text-gray-500 dark:text-gray-400 italic",4,"ngIf"],[1,"mr-3"],[1,"text-gray-700","dark:text-gray-300"],[1,"mt-1","text-gray-500","dark:text-gray-400","italic"],[1,"col-span-full","pt-2","text-xs"],[1,"font-medium","text-gray-500","dark:text-gray-400"],[1,"list-disc","list-inside","ml-2","text-gray-500","dark:text-gray-400"],[1,"text-gray-500","dark:text-gray-400","italic"],[1,"col-span-full","mt-2","pt-2","border-t","border-dashed","border-gray-300","dark:border-gray-600","text-xs"],[1,"font-medium","text-gray-500","dark:text-gray-400","mb-1"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-x-4","gap-y-1"],[4,"ngFor","ngForOf"],[1,"text-gray-500","dark:text-gray-400"],[1,"text-gray-400","dark:text-gray-500","text-2xs","ml-1"],[1,"col-span-2","md:col-span-2","mt-2","pt-2","border-t","border-dashed","border-gray-300","dark:border-gray-600"],[1,"block","text-sm","text-gray-500","dark:text-gray-400","mb-1"],["class","text-2xl font-bold text-gray-800 dark:text-gray-100 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 p-1 rounded",3,"click",4,"ngIf"],["class","flex items-center space-x-1",4,"ngIf"],[1,"text-2xl","font-bold","text-gray-800","dark:text-gray-100","cursor-pointer","hover:bg-gray-200","dark:hover:bg-gray-600","p-1","rounded",3,"click"],[1,"flex","items-center","space-x-1"],["type","number","autofocus","",1,"w-20","p-1","text-xl","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-600",3,"ngModelChange","keyup.enter","keyup.escape","ngModel"],[1,"p-1","text-green-500","hover:text-green-700",3,"click"],[1,"p-1","text-red-500","hover:text-red-700",3,"click"],[1,"text-lg"],[1,"text-lg","font-semibold","text-gray-800","dark:text-gray-100","p-1"],[1,"text-center","py-20"],[1,"text-xl","text-gray-600","dark:text-gray-400"]],template:function(e,i){if(e&1){let r=k();y(0,ps,5,3,"div",4),a(1,"app-full-screen-rest-timer",5),S("timerFinished",function(){return x(r),v(i.handleRestTimerFinished())})("timerSkipped",function(){return x(r),v(i.handleRestTimerSkipped())}),l(),y(2,ms,19,6,"div",6)(3,Bs,12,1,"div",7)(4,zs,3,0,"ng-template",null,0,Q)}if(e&2){let r=oe(5);m("ngIf",i.routine()!==void 0)("ngIfElse",r),d(),m("isVisible",i.isRestTimerVisible())("durationSeconds",i.restDuration())("mainText",i.restTimerMainText())("nextUpText",i.restTimerNextUpText()),d(),m("ngIf",i.isWorkoutMenuVisible()),d(),m("ngIf",i.isPerformanceInsightsVisible())}},dependencies:[ee,it,pe,J,me,X,nt,gt,dt,st,ct,Di,ot,at,ut,pt,ht,lt,ft,Pt],encapsulation:2})};function Gs(n,t){if(n&1&&(a(0,"div",10)(1,"span",11),p(2,"Total Volume:"),l(),a(3,"span",12),p(4),M(5,"number"),l()()),n&2){let e=u(2);d(4),K("",q(5,2,e.sessionTotalVolume(),"1.0-0")," ",e.unitsService.getUnitLabel())}}function Us(n,t){if(n&1&&(a(0,"li",25)(1,"p",26),p(2),l(),a(3,"p",27),p(4),l()()),n&2){let e=t.$implicit;d(2),K("",e.exerciseName," - ",e.pbType," "),d(2),W(e.value)}}function js(n,t){if(n&1&&(a(0,"div",21)(1,"h2",22),p(2," \u{1F389} New Personal Bests! \u{1F389} "),l(),a(3,"ul",23),y(4,Us,5,3,"li",24),l()()),n&2){let e=u(2);d(4),m("ngForOf",e.sessionPBs())}}function $s(n,t){if(n&1&&(a(0,"div",28)(1,"h3",29),p(2,"Your Notes for this Session:"),l(),a(3,"p",30),p(4),l()()),n&2){let e=u().ngIf;d(4),W(e.notes)}}function Hs(n,t){if(n&1){let e=k();Ce(0),a(1,"div",3)(2,"div",4),I(),a(3,"svg",5),w(4,"path",6),l(),V(),a(5,"h1",7),p(6,"Workout Complete!"),l(),a(7,"p",8),p(8,"Great job on finishing your session."),l()(),a(9,"div",9)(10,"div",10)(11,"span",11),p(12,"Routine:"),l(),a(13,"span",12),p(14),l()(),a(15,"div",10)(16,"span",11),p(17,"Date:"),l(),a(18,"span",12),p(19),M(20,"date"),l()(),a(21,"div",10)(22,"span",11),p(23,"Duration:"),l(),a(24,"span",12),p(25),l()(),y(26,Gs,6,5,"div",13),l(),y(27,js,5,1,"div",14)(28,$s,5,1,"div",15),a(29,"div",16)(30,"button",17),S("click",function(){x(e);let r=u();return v(r.viewFullLog())}),p(31," View Full Log Details "),l(),a(32,"button",18),S("click",function(){x(e);let r=u();return v(r.navigateToRoutines())}),I(),a(33,"svg",19),w(34,"path",20),l()()()(),Ie()}if(n&2){let e=t.ngIf,i=u();d(14),W(e.routineName||"Ad-hoc Workout"),d(5),W(q(20,6,e.startTime,"fullDate")),d(6),E("",e.durationMinutes," minutes"),d(),m("ngIf",i.sessionTotalVolume()>0),d(),m("ngIf",i.sessionPBs().length>0),d(),m("ngIf",e.notes)}}function Zs(n,t){n&1&&(a(0,"div",31)(1,"p",32),p(2,"Loading workout summary..."),l()())}var Rt=class n{route=f(Ve);router=f(he);trackingService=f(_e);exerciseService=f(Me);statsService=f(Ai);unitsService=f(Ne);workoutLog=C(void 0);displayExercisesSummary=C([]);sessionPBs=C([]);sessionTotalVolume=C(0);logId;ngOnInit(){(this.logId?re(this.logId):this.route.paramMap.pipe(ve(e=>e.get("logId")))).pipe(ne(e=>e?this.trackingService.getWorkoutLogById(e):re(null)),de(e=>{e?(this.workoutLog.set(e),this.sessionTotalVolume.set(this.statsService.calculateWorkoutVolume(e)),this.prepareDisplayExercisesSummary(e.exercises),this.identifySessionPBs(e)):(this.workoutLog.set(null),this.displayExercisesSummary.set([]),this.sessionPBs.set([]))})).subscribe()}prepareDisplayExercisesSummary(t){if(!t||t.length===0){this.displayExercisesSummary.set([]);return}let e=t.map(i=>this.exerciseService.getExerciseById(i.exerciseId).pipe(ve(r=>{let s=0;return i.sets.forEach(o=>{s+=(o.repsAchieved||0)*(o.weightUsed||0)}),Z(H({},i),{baseExercise:r||null,sessionVolume:s})})));di(e).subscribe({next:i=>this.displayExercisesSummary.set(i),error:i=>{console.error("Error fetching exercise details for summary:",i),this.displayExercisesSummary.set(t.map(r=>Z(H({},r),{baseExercise:null,sessionVolume:0})))}})}identifySessionPBs(t){let e=[];this.trackingService.personalBests$.pipe(G(1)).subscribe(i=>{t.exercises.forEach(s=>{let o=i[s.exerciseId];o&&s.sets.forEach(c=>{o.forEach(h=>{h.id===c.id&&h.timestamp===c.timestamp&&c.weightUsed===h.weightUsed&&c.repsAchieved===h.repsAchieved&&e.push({exerciseName:s.exerciseName,pbType:h.pbType,value:this.formatPbValueForSummary(h),isNewOrImproved:!0})})})});let r=Array.from(new Map(e.map(s=>[`${s.exerciseName}-${s.pbType}`,s])).values());this.sessionPBs.set(r)})}formatPbValueForSummary(t){let e="";return t.weightUsed!==void 0&&t.weightUsed!==null&&t.weightUsed!==0?(e+=`${t.weightUsed}kg`,t.repsAchieved>0&&(t.pbType.includes("Heaviest")||t.repsAchieved>1&&!t.pbType.includes("RM"))&&(e+=` x ${t.repsAchieved}`)):t.repsAchieved>0&&t.pbType.includes("Max Reps")?e=`${t.repsAchieved} reps`:t.durationPerformed&&t.durationPerformed>0&&t.pbType.includes("Max Duration")&&(e=`${t.durationPerformed}s`),e||"N/A"}viewFullLog(){this.workoutLog()&&this.router.navigate(["/history/log",this.workoutLog().id])}navigateToRoutines(){this.router.navigate(["/workout"])}startNewWorkout(){this.router.navigate(["/workout"])}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=j({type:n,selectors:[["app-workout-summary"]],inputs:{logId:"logId"},decls:4,vars:2,consts:[["loadingOrNotFoundSummary",""],[1,"container","mx-auto","p-4","py-8"],[4,"ngIf","ngIfElse"],[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-2xl","p-6","md:p-8","max-w-2xl","mx-auto"],[1,"text-center","mb-8"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","currentColor",1,"w-16","h-16","text-green-500","mx-auto","mb-3"],["fill-rule","evenodd","d","M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.06-1.06l-3.002 3.001-1.502-1.502a.75.75 0 0 0-1.06 1.06L9.97 12.72l3.59-3.591Z","clip-rule","evenodd"],[1,"text-4xl","font-bold","text-gray-800","dark:text-gray-100"],[1,"text-lg","text-gray-600","dark:text-gray-400","mt-1"],[1,"space-y-4","mb-8"],[1,"flex","justify-between","items-baseline","p-3","bg-gray-50","dark:bg-gray-700","rounded-md"],[1,"text-sm","font-medium","text-gray-600","dark:text-gray-300"],[1,"text-md","font-semibold","text-gray-800","dark:text-gray-100"],["class","flex justify-between items-baseline p-3 bg-gray-50 dark:bg-gray-700 rounded-md",4,"ngIf"],["class","mb-8",4,"ngIf"],["class","mb-8 p-3 bg-yellow-50 dark:bg-yellow-900/30 rounded-md",4,"ngIf"],[1,"mt-8","pt-6","border-t","border-gray-200","dark:border-gray-700","space-y-3","md:space-y-0","md:flex","md:justify-center","md:space-x-4"],[1,"w-full","md:w-auto","flex","items-center","justify-center","px-6","py-3","border","border-transparent","rounded-md","shadow-sm","text-base","font-medium","text-white","bg-primary","hover:bg-primary-dark","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-primary-dark",3,"click"],[1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-ml-1",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"mb-8"],[1,"text-xl","font-semibold","text-gray-700","dark:text-gray-300","mb-3","text-center","border-b","pb-2","dark:border-gray-700"],[1,"space-y-2","mt-3"],["class","p-2 bg-green-50 dark:bg-green-900/30 rounded-md text-center",4,"ngFor","ngForOf"],[1,"p-2","bg-green-50","dark:bg-green-900/30","rounded-md","text-center"],[1,"text-sm","font-medium","text-green-700","dark:text-green-300"],[1,"text-lg","font-bold","text-green-600","dark:text-green-200"],[1,"mb-8","p-3","bg-yellow-50","dark:bg-yellow-900/30","rounded-md"],[1,"text-sm","font-medium","text-yellow-800","dark:text-yellow-300","mb-1"],[1,"text-sm","text-yellow-700","dark:text-yellow-200","italic","whitespace-pre-line"],[1,"text-center","py-20"],[1,"text-xl","text-gray-600","dark:text-gray-400"]],template:function(e,i){if(e&1&&(a(0,"div",1),y(1,Hs,35,9,"ng-container",2)(2,Zs,3,0,"ng-template",null,0,Q),l()),e&2){let r=oe(3);d(),m("ngIf",i.workoutLog())("ngIfElse",r)}},dependencies:[ee,pe,J,me,X],encapsulation:2})};var fd=[{path:"",component:xt,title:"My Routines"},{path:"new",component:Ae,title:"Create New Routine"},{path:"edit/:routineId",component:Ae,title:"Edit Routine"},{path:"view/:routineId",component:Ae,title:"View Routine"},{path:"play/:routineId",component:Dt,title:"Workout Session"},{path:"summary/:logId",component:Rt,title:"Workout Summary"}];export{fd as WORKOUT_TRACKER_ROUTES};
