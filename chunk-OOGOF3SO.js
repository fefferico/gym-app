import{a as se,b as le,c as de,e as pe,f as ce}from"./chunk-2BMXPUF2.js";import{a as oe}from"./chunk-TFQ2OJWM.js";import{h as ne,j as ae}from"./chunk-LRT4BF4H.js";import{a as ie}from"./chunk-MZ2D64ZH.js";import"./chunk-UQBSZDXS.js";import{F as N,Ia as d,Ib as X,Ja as o,Jb as j,Ka as a,La as T,N as p,Pa as E,Qa as C,Ra as c,Rb as P,S,T as L,U as I,Ub as G,V as M,Wb as D,Z as b,aa as V,ab as s,bb as v,bd as K,ca as H,cb as m,cd as Q,ed as ee,fd as te,ga as U,gc as Z,gd as re,i as w,ia as i,ic as q,jb as Y,jc as J,la as W,lb as k,m as B,mb as A,n as F,pb as l,qa as z,qb as x,rb as y,va as g,x as R,xb as $,z as O}from"./chunk-2LJXGSDB.js";import"./chunk-GAL4ENT6.js";var ue=(r,t)=>({exercise:r,pbType:t}),xe=(r,t)=>({value:r,unit:t}),he=r=>({reps:r}),ge=r=>({notes:r}),fe=r=>["/history/log",r];function ve(r,t){r&1&&(o(0,"div",9)(1,"p",10),s(2),l(3,"translate"),a(),T(4,"div",11),a()),r&2&&(i(2),v(x(3,1,"pbTrend.loading")))}function be(r,t){if(r&1){let e=E();o(0,"div",12)(1,"p",13),I(),o(2,"svg",14),T(3,"path",15),a(),s(4),a(),M(),o(5,"button",16),C("click",function(){S(e);let u=c();return L(u.goBack())}),s(6),l(7,"translate"),a()()}if(r&2){let e=c();i(4),m(" ",e.errorMessage()," "),i(2),m(" ",x(7,2,"pbTrend.backButton")," ")}}function ye(r,t){if(r&1&&(o(0,"div"),s(1),l(2,"translate"),a()),r&2){let e=c().model;i(),v(y(2,1,"pbTrend.chart.tooltip.reps",k(4,he,e.extra.reps)))}}function _e(r,t){if(r&1&&(o(0,"div",25),s(1),l(2,"translate"),a()),r&2){let e=c().model;i(),v(y(2,1,"pbTrend.chart.tooltip.notes",k(4,ge,e.extra.notes)))}}function Te(r,t){r&1&&(o(0,"div",26),s(1),l(2,"translate"),a()),r&2&&(i(),v(x(2,1,"pbTrend.chart.tooltip.viewLog")))}function Ce(r,t){if(r&1&&(o(0,"div",21)(1,"div")(2,"strong"),s(3),l(4,"date"),a()(),o(5,"div"),s(6),l(7,"translate"),a(),g(8,ye,3,6,"div",22)(9,_e,3,6,"div",23)(10,Te,3,3,"div",24),a()),r&2){let e=t.model,n=c(2);i(3),v(y(4,5,e.name,"mediumDate")),i(3),v(y(7,8,"pbTrend.chart.tooltip.value",A(11,xe,e.value,n.yAxisLabel().split(" ")[0]))),i(2),d("ngIf",e.extra==null?null:e.extra.reps),i(),d("ngIf",e.extra==null?null:e.extra.notes),i(),d("ngIf",e.extra==null?null:e.extra.workoutLogId)}}function we(r,t){r&1&&(o(0,"th",33),s(1),l(2,"translate"),a()),r&2&&(i(),m(" ",x(2,1,"pbTrend.history.repsHeader")," "))}function ke(r,t){if(r&1&&(o(0,"td",41),s(1),a()),r&2){let e=c().$implicit;i(),m(" ",e.extra==null?null:e.extra.reps," ")}}function Pe(r,t){if(r&1&&(o(0,"a",45),T(1,"app-icon",46),s(2),l(3,"translate"),a()),r&2){let e=c().$implicit;d("routerLink",k(4,fe,e.extra==null?null:e.extra.workoutLogId)),i(2),m(" ",x(3,2,"pbTrend.history.viewLog")," ")}}function Se(r,t){if(r&1&&(o(0,"tr",39)(1,"td",40),s(2),l(3,"date"),a(),o(4,"td",41),s(5),a(),g(6,ke,2,1,"td",42),o(7,"td",43),g(8,Pe,4,6,"a",44),a()()),r&2){let e=t.$implicit,n=c(3);i(2),m(" ",y(3,4,e.name,"mediumDate")," "),i(3),m(" ",e.value," "),i(),d("ngIf",(n.currentPbType==null?null:n.currentPbType.includes("RM"))||(n.currentPbType==null?null:n.currentPbType.includes("Heaviest Lifted"))),i(2),d("ngIf",e.extra==null?null:e.extra.workoutLogId)}}function Le(r,t){if(r&1&&(o(0,"div",27)(1,"h2",28),s(2),l(3,"translate"),a(),o(4,"div",29)(5,"table",30)(6,"thead",31)(7,"tr")(8,"th",32),s(9),l(10,"translate"),a(),o(11,"th",33),s(12),a(),g(13,we,3,3,"th",34),o(14,"th",35)(15,"span",36),s(16),l(17,"translate"),a()()()(),o(18,"tbody",37),g(19,Se,9,7,"tr",38),a()()()()),r&2){let e=c(2);i(2),m(" ",x(3,6,"pbTrend.history.title")," "),i(7),m(" ",x(10,8,"pbTrend.history.dateHeader")," "),i(3),m(" ",e.yAxisLabel()," "),i(),d("ngIf",(e.currentPbType==null?null:e.currentPbType.includes("RM"))||(e.currentPbType==null?null:e.currentPbType.includes("Heaviest Lifted"))),i(3),v(x(17,10,"pbTrend.history.logHeader")),i(3),d("ngForOf",e.historyTableData())}}function Ie(r,t){if(r&1){let e=E();o(0,"div",17)(1,"ngx-charts-line-chart",18),l(2,"translate"),C("select",function(u){S(e);let f=c();return L(f.onChartSelect(u))}),g(3,Ce,11,14,"ng-template",19),a(),g(4,Le,20,12,"div",20),a()}if(r&2){let e=c();i(),d("view",e.view)("scheme",e.chartColorScheme)("results",e.chartData())("legend",e.legend)("xAxis",e.xAxis)("yAxis",e.yAxis)("showXAxisLabel",e.showXAxisLabel)("showYAxisLabel",e.showYAxisLabel)("xAxisLabel",x(2,17,"pbTrend.chart.xAxisLabel"))("yAxisLabel",e.yAxisLabel())("timeline",e.timeline)("autoScale",e.autoScale)("roundDomains",e.roundDomains)("xAxisTickFormatting",e.xAxisTickFormatting)("curve",e.lineChartCurve)("referenceLines",e.lineChartReferenceLines()),i(3),d("ngIf",e.historyTableData().length>0)}}var me=class r{route=p(Z);router=p(q);trackingService=p(ae);exerciseService=p(ne);unitsService=p(ie);toastService=p(Q);platformId=p(H);datePipe=new P("en-US");themeService=p(oe);renderer=p(W);el=p(V);translate=p(ee);themeSubscription;chartData=b(null);isLoading=b(!0);errorMessage=b(null);historyTableData=$(()=>{let t=this.chartData();return!t||!t[0]||!t[0].series?[]:[...t[0].series].sort((e,n)=>n.name.getTime()-e.name.getTime())});currentExerciseId=null;currentPbType=null;currentExerciseName=b("Exercise");yAxisLabel=b("Value");lineChartReferenceLines=b([]);view=[700,400];legend=!1;showXAxisLabel=!0;showYAxisLabel=!0;xAxis=!0;yAxis=!0;timeline=!0;autoScale=!0;roundDomains=!0;lineChartCurve=se;chartColorScheme={name:"fitTrackProScheme",selectable:!0,group:de.Ordinal,domain:["#10B981","#3B82F6","#F97316","#8B5CF6","#F59E0B","#EC4899","#14B8A6","#6366F1"]};xAxisTickFormatting=t=>t instanceof Date?this.datePipe.transform(t,"MMM d, yy")||"":String(t);constructor(){}ngOnInit(){D(this.platformId)&&(this.view=[window.innerWidth>768?700:window.innerWidth-40,400],this.updateChartTextColors(this.themeService.isDarkTheme())),this.themeService.isDarkTheme()?this.updateChartTextColors(!0):this.updateChartTextColors(!1),this.route.paramMap.pipe(O(1),N(t=>{this.isLoading.set(!0),this.errorMessage.set(null),this.chartData.set(null);let e=t.get("exerciseId"),n=t.get("pbType");if(!e||!n)return this.errorMessage.set(this.translate.instant("pbTrend.error.missingParams")),this.isLoading.set(!1),w({pb:null,exercise:null,error:"Missing parameters"});this.currentExerciseId=e;try{this.currentPbType=decodeURIComponent(n)}catch{return this.errorMessage.set(this.translate.instant("pbTrend.error.invalidPbType")),this.isLoading.set(!1),w({pb:null,exercise:null,error:"Invalid PB Type"})}return this.setYAxisLabel(this.currentPbType),F([this.trackingService.getPersonalBestForExerciseByType(this.currentExerciseId,this.currentPbType),this.exerciseService.getExerciseById(this.currentExerciseId)]).pipe(B(([u,f])=>({pb:u,exercise:f,error:null})),R(u=>(console.error("Error fetching PB trend data:",u),this.errorMessage.set(this.translate.instant("pbTrend.error.fetchFailed")),w({pb:null,exercise:null,error:"Fetch error"}))))})).subscribe(({pb:t,exercise:e,error:n})=>{if(n){this.isLoading.set(!1);return}this.currentExerciseName.set(e?.name||"Selected Exercise"),t?this.prepareChartData(t):this.errorMessage.set(this.translate.instant("pbTrend.error.noData",{exercise:this.currentExerciseName(),pbType:this.currentPbType})),this.isLoading.set(!1)})}updateChartTextColors(t){let e=t?"#E5E7EB":"#374151";this.renderer.setStyle(this.el.nativeElement,"--ngx-charts-text-color",e)}setYAxisLabel(t){t.includes("RM")||t.includes("Heaviest Lifted")?this.yAxisLabel.set(this.translate.instant("pbTrend.yAxis.weight",{unit:this.unitsService.getWeightUnitSuffix()})):t.includes("Max Reps")?this.yAxisLabel.set(this.translate.instant("pbTrend.yAxis.reps")):t.includes("Max Duration")?this.yAxisLabel.set(this.translate.instant("pbTrend.yAxis.duration")):this.yAxisLabel.set(this.translate.instant("pbTrend.yAxis.value"))}prepareChartData(t){let e=[],n=this.extractValueForChart(t,t.pbType);if(n!==null&&t.timestamp&&e.push({name:new Date(t.timestamp),value:n,extra:{reps:t.repsAchieved,notes:t.notes,workoutLogId:t.workoutLogId}}),t.history&&t.history.forEach(h=>{let _=this.extractValueForChart(h,t.pbType);_!==null&&h.timestamp&&e.push({name:new Date(h.timestamp),value:_,extra:{reps:h.repsAchieved,notes:void 0,workoutLogId:h.workoutLogId}})}),e.length<2){this.errorMessage.set(this.translate.instant("pbTrend.error.notEnoughData")),this.chartData.set(null),this.lineChartReferenceLines.set([]);return}e.sort((h,_)=>h.name.getTime()-_.name.getTime());let f=e.reduce((h,_)=>h+_.value,0)/e.length;this.lineChartReferenceLines.set([{name:this.translate.instant("pbTrend.chart.averageLine",{value:f.toFixed(1)}),value:f}]),this.chartData.set([{name:`${this.currentPbType||"PB"} Trend`,series:e}])}extractValueForChart(t,e){return e.includes("RM")||e.includes("Heaviest Lifted")?t.weightUsed??null:e.includes("Max Reps")?t.repsAchieved??null:e.includes("Max Duration")?t.durationPerformed??null:t.weightUsed&&t.weightUsed>0?t.weightUsed:t.repsAchieved>0?t.repsAchieved:t.durationPerformed&&t.durationPerformed>0?t.durationPerformed:null}onChartSelect(t){t&&t.extra&&t.extra.workoutLogId?this.router.navigate(["/history/log",t.extra.workoutLogId]):t&&t.extra&&this.toastService.info(this.translate.instant("pbTrend.chart.tooltip.value",{value:t.value,unit:this.yAxisLabel().split(" ")[0]})+` on ${this.datePipe.transform(t.name,"mediumDate")}. ${t.extra.reps?this.translate.instant("pbTrend.chart.tooltip.reps",{reps:t.extra.reps}):""}`,5e3,"PB Detail")}goBack(){this.router.navigate(["/profile/personal-bests"])}onResize(t){if(D(this.platformId)){let e=t.target;this.view=[e.innerWidth>768?700:e.innerWidth-40,400]}}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=z({type:r,selectors:[["app-pb-trend-chart"]],features:[Y([le])],decls:12,vars:12,consts:[[1,"container","mx-auto","p-4",3,"resize"],[1,"mb-6","flex","items-center"],[1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-ml-2","rounded-full","focus:outline-none","focus:ring-2","focus:ring-primary-focus",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"text-xl","sm:text-2xl","font-bold","text-gray-800","dark:text-gray-200","ml-2"],["class","text-center py-10",4,"ngIf"],["class","text-center py-10 bg-red-50 dark:bg-red-900/30 p-4 rounded-md shadow",4,"ngIf"],["class","bg-white dark:bg-gray-800 p-2 sm:p-4 rounded-md shadow-xl",4,"ngIf"],[1,"text-center","py-10"],[1,"text-lg","text-gray-600","dark:text-gray-400"],[1,"mt-4","animate-spin","rounded-full","h-12","w-12","border-b-2","border-primary","mx-auto"],[1,"text-center","py-10","bg-red-50","dark:bg-red-900/30","p-4","rounded-md","shadow"],[1,"text-lg","font-semibold","text-red-700","dark:text-red-300"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-6","h-6","inline-block","mr-2","align-middle"],["stroke-linecap","round","stroke-linejoin","round","d","M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"],[1,"mt-4","px-4","py-2","bg-primary","text-white","rounded-md","hover:bg-primary-dark","transition-colors",3,"click"],[1,"bg-white","dark:bg-gray-800","p-2","sm:p-4","rounded-md","shadow-xl"],[1,"pb-chart-container",3,"select","view","scheme","results","legend","xAxis","yAxis","showXAxisLabel","showYAxisLabel","xAxisLabel","yAxisLabel","timeline","autoScale","roundDomains","xAxisTickFormatting","curve","referenceLines"],["ngx-charts-tooltip-template",""],["class","mt-8",4,"ngIf"],[1,"chart-tooltip","bg-gray-700","text-white","p-2","rounded","shadow-lg","text-xs"],[4,"ngIf"],["class","max-w-xs truncate",4,"ngIf"],["class","mt-1 text-indigo-300",4,"ngIf"],[1,"max-w-xs","truncate"],[1,"mt-1","text-indigo-300"],[1,"mt-8"],[1,"text-lg","font-semibold","text-gray-700","dark:text-gray-300","mb-4","border-t","pt-4","dark:border-gray-700"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-gray-200","dark:divide-gray-600"],[1,"bg-gray-50","dark:bg-gray-700"],["scope","col",1,"px-4","py-3","text-left","text-xs","font-medium","text-gray-500","dark:text-gray-400","uppercase","tracking-wider","rounded-tl-md"],["scope","col",1,"px-4","py-3","text-left","text-xs","font-medium","text-gray-500","dark:text-gray-400","uppercase","tracking-wider"],["scope","col","class","px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",4,"ngIf"],["scope","col",1,"relative","px-4","py-3","border-l-0","rounded-tr-md"],[1,"sr-only"],[1,"bg-white","dark:bg-gray-800","divide-y","divide-gray-200","dark:divide-gray-700"],["class","hover:bg-gray-50 dark:hover:bg-gray-700/50",4,"ngFor","ngForOf"],[1,"hover:bg-gray-50","dark:hover:bg-gray-700/50"],[1,"px-4","py-4","whitespace-nowrap","text-sm","font-medium","text-gray-900","dark:text-gray-200"],[1,"px-4","py-4","whitespace-nowrap","text-sm","text-gray-500","dark:text-gray-300"],["class","px-4 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",4,"ngIf"],[1,"px-4","py-4","whitespace-nowrap","text-right","text-sm","font-medium"],["class","inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-focus dark:focus:ring-offset-gray-800",3,"routerLink",4,"ngIf"],[1,"inline-flex","items-center","px-3","py-1.5","border","border-transparent","text-xs","font-medium","rounded-md","shadow-sm","text-white","bg-primary","hover:bg-primary-dark","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-primary-focus","dark:focus:ring-offset-gray-800",3,"routerLink"],["name","eye",1,"h-5","w-5","mr-1"]],template:function(e,n){e&1&&(o(0,"div",0),C("resize",function(f){return n.onResize(f)},U),o(1,"div",1)(2,"button",2),C("click",function(){return n.goBack()}),I(),o(3,"svg",3),T(4,"path",4),a()(),M(),o(5,"h1",5),s(6),l(7,"translate"),l(8,"translate"),a()(),g(9,ve,5,3,"div",6)(10,be,8,4,"div",7)(11,Ie,5,19,"div",8),a()),e&2&&(i(6),m(" ",y(8,6,"pbTrend.title",A(9,ue,n.currentExerciseName(),n.currentPbType||x(7,4,"pbTrend.defaultTitle")))," "),i(3),d("ngIf",n.isLoading()),i(),d("ngIf",n.errorMessage()),i(),d("ngIf",!n.isLoading()&&!n.errorMessage()&&n.chartData()))},dependencies:[G,X,j,ce,pe,J,K,re,P,te],styles:["[_nghost-%COMP%]{--ngx-charts-text-color: #374151}[_nghost-%COMP%]     .ngx-charts text{fill:var(--ngx-charts-text-color)!important}[_nghost-%COMP%]     .ngx-charts .axis-label, [_nghost-%COMP%]     .ngx-charts .legend-label{fill:var(--ngx-charts-text-color)!important}.pb-chart-container[_ngcontent-%COMP%]     .ngx-charts{overflow:visible!important}  .chart-tooltip{pointer-events:none;font-size:.75rem}  .chart-tooltip strong{font-weight:600}","[_nghost-%COMP%]     .pb-chart-container .line-series .circle{fill:#fff;stroke:#10b981;stroke-width:2px;r:4px!important}[_nghost-%COMP%]     .pb-chart-container .x.axis .tick text{transform:rotate(-45deg) translate(-10px,-5px);text-anchor:end!important}[_nghost-%COMP%]     .pb-chart-container .ngx-charts-outer, [_nghost-%COMP%]     .pb-chart-container .axis-label, [_nghost-%COMP%]     .pb-chart-container .tick text{fill:var(--ngx-charts-text-color, #374151)}"],changeDetection:0})};export{me as PbTrendChartComponent};
