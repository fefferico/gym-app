import{a as M,b as O,c as z}from"./chunk-WQIFHN3G.js";import{a as ie}from"./chunk-HVLPQW3J.js";import{a as ae,d as f,e as se}from"./chunk-VM54IUXL.js";import{h,s as k}from"./chunk-TOOSBRU6.js";import{Ab as I,Bb as Z,Cb as E,Db as ee,Ja as w,Jb as te,K as P,Ka as m,La as x,Lb as oe,Ma as U,O as y,Qa as W,Ra as S,Sa as g,T as _,Ta as Y,U as C,Ua as T,V as H,Wb as ne,Y as B,ba as K,bb as q,db as J,hd as re,ia as L,ja as v,mb as Q,na as R,qb as X,qc as F,ra as $,rc as A,uc as b,vc as D,wa as V,wc as j,z as N}from"./chunk-LWKZRPHK.js";import{g as G}from"./chunk-GAL4ENT6.js";var pe=["*",[["","modal-footer",""]]],ge=["*","[modal-footer]"],ke=a=>({"items-center justify-center":a}),we=(a,o,e,n,r,t)=>({"rounded-md mx-2 min-w-[300px] w-full max-h-[90vh]":a,"max-w-sm":o,"max-w-md":e,"max-w-lg":n,"max-w-2xl":r,"w-screen h-screen rounded-none":t});function he(a,o){if(a&1&&(m(0,"h3",11),q(1),x()),a&2){let e=g(3);v(),J(" ",e.modalTitle()," ")}}function ye(a,o){if(a&1){let e=W();m(0,"div",6),V(1,he,2,1,"h3",7),m(2,"button",8),S("click",function(){_(e);let r=g(2);return C(r.closeModal())}),H(),m(3,"svg",9),U(4,"path",10),x()()()}if(a&2){let e=g(2);v(),w("ngIf",e.modalTitle())}}function ve(a,o){if(a&1){let e=W();m(0,"div",1),S("click",function(){_(e);let r=g();return C(r.closeModal())}),m(1,"div",2),S("click",function(r){_(e);let t=g();return C(t.onDialogClick(r))}),V(2,ye,5,1,"div",3),m(3,"div",4),T(4),x(),m(5,"div",5),T(6,1),x()()()}if(a&2){let e=g();w("@modalAnimation",e.animationState)("ngClass",Q(5,ke,e.size()!=="fullscreen"&&!e.forceFullScreen())),v(),w("@dialogAnimation",e.animationState)("ngClass",X(7,we,e.size()!=="fullscreen"&&!e.forceFullScreen(),e.size()==="sm"&&!e.forceFullScreen(),e.size()==="md"&&!e.forceFullScreen(),e.size()==="lg"&&!e.forceFullScreen(),e.size()==="xl"&&!e.forceFullScreen(),e.size()==="fullscreen"||e.forceFullScreen())),v(),w("ngIf",e.modalTitle()||!0)}}var le=class a{constructor(o){this.document=o;I(()=>{this.isOpen()?this.document.body.classList.add("overflow-hidden"):this.document.body.classList.remove("overflow-hidden")}),I(e=>{e(()=>{this.document.body.classList.remove("overflow-hidden")})})}elementRef=y(K);isOpen=ee(!1);modalTitle=E();closed=Z();size=E("lg");forceFullScreen=E(!1);get animationState(){return this.isOpen()?"open":"closed"}closeModal(){this.isOpen.set(!1),this.closed.emit()}onDialogClick(o){o.stopPropagation()}onDocumentMouseDown(o){this.isOpen()&&this.elementRef.nativeElement.contains(o.target)&&o.target.classList.contains("modal-container")&&this.closeModal()}onEscapeKey(){this.isOpen()&&this.closeModal()}static \u0275fac=function(e){return new(e||a)(R(B))};static \u0275cmp=$({type:a,selectors:[["app-modal"]],hostBindings:function(e,n){e&1&&S("mousedown",function(t){return n.onDocumentMouseDown(t)},L)("keydown.escape",function(){return n.onEscapeKey()},L)},inputs:{isOpen:[1,"isOpen"],modalTitle:[1,"modalTitle"],size:[1,"size"],forceFullScreen:[1,"forceFullScreen"]},outputs:{isOpen:"isOpenChange",closed:"closed"},ngContentSelectors:ge,decls:1,vars:1,consts:[["class","modal-container fixed inset-0 z-[1000] flex bg-black bg-opacity-60",3,"ngClass","click",4,"ngIf"],[1,"modal-container","fixed","inset-0","z-[1000]","flex","bg-black","bg-opacity-60",3,"click","ngClass"],[1,"modal-dialog","bg-white","dark:bg-gray-800","shadow-xl","flex","flex-col","overflow-hidden",3,"click","ngClass"],["class","modal-header flex items-center justify-between ml-1 p-1 md:p-1 border-gray-200 dark:border-gray-700 flex-shrink-0",4,"ngIf"],[1,"modal-body","p-1","md:p-1","space-y-4","overflow-y-auto","flex-grow","custom-scrollbar"],[1,"modal-footer","flex","items-center","p-4","md:p-5","border-t","border-gray-200","dark:border-gray-700","rounded-b","flex-shrink-0"],[1,"modal-header","flex","items-center","justify-between","ml-1","p-1","md:p-1","border-gray-200","dark:border-gray-700","flex-shrink-0"],["class","text-xl font-semibold text-gray-900 dark:text-white",4,"ngIf"],["type","button","aria-label","Close modal",1,"modal-close-button","text-gray-400","bg-transparent","hover:bg-gray-200","hover:text-gray-900","dark:hover:bg-gray-600","dark:hover:text-white","rounded-md","text-sm","w-8","h-8","ms-auto","inline-flex","justify-center","items-center",3,"click"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 14 14",1,"w-3","h-3"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"],[1,"text-xl","font-semibold","text-gray-900","dark:text-white"]],template:function(e,n){e&1&&(Y(pe),V(0,ve,7,14,"div",0)),e&2&&w("ngIf",n.isOpen())},dependencies:[ne,te,oe],styles:[".modal-footer[_ngcontent-%COMP%]:empty{display:none}"],data:{animation:[F("modalAnimation",[D("closed",b({opacity:0,visibility:"hidden"})),D("open",b({opacity:1,visibility:"visible"})),j("closed <=> open",[A("300ms ease-in-out")])]),F("dialogAnimation",[D("closed",b({opacity:0,transform:"scale(0.95) translateY(20px)",visibility:"hidden"})),D("open",b({opacity:1,transform:"scale(1) translateY(0)",visibility:"visible"})),j("closed <=> open",[A("300ms ease-in-out")])])]}})};function ce(a){return o=>{let n=(a?Math[a]:Math.trunc)(o);return n===0?0:n}}function de(a,o,e){let n=ae(a,o,e)/7;return ce(e?.roundingMethod)(n)}var me=class a{exerciseService=y(se);translate=y(re);constructor(){}calculateSetVolume(o){return(o.repsAchieved||0)*(o.weightUsed||0)}calculateWorkoutVolume(o){let e=0;return o.exercises.forEach(n=>{n.sets.forEach(r=>{e+=this.calculateSetVolume(r)})}),e}calculateTotalVolumeForAllLogs(o){return o.reduce((e,n)=>e+this.calculateWorkoutVolume(n),0)}getWeeklySummaries(o){if(!o||o.length===0)return[];let e={};o.forEach(r=>{let t=f(r.date),i=h(t,{weekStartsOn:1}),c=M(t,{weekStartsOn:1}),d=k(i,"yyyy-MM-dd");e[d]||(e[d]={logs:[],startDate:i,endDate:c}),e[d].logs.push(r)});let n=this.translate.instant("statsService.weekOf");return Object.entries(e).map(([r,t])=>{let i=this.calculateTotalVolumeForAllLogs(t.logs);return{weekLabel:`${n} ${k(t.startDate,"MMM d")}`,workoutCount:t.logs.length,totalVolume:i,weekStartDate:t.startDate,weekEndDate:t.endDate}}).sort((r,t)=>t.weekStartDate.getTime()-r.weekStartDate.getTime())}calculateTotalVolume(o){return o.exercises.reduce((e,n)=>{let r=n.sets.reduce((t,i)=>t+(i.weightUsed??0)*(i.repsAchieved??0),0);return e+r},0)}getWeeklyVolumeForChart(o){if(!o||o.length===0)return[];let e={},n=this.translate.instant("statsService.weekPrefix");return o.forEach(t=>{let i=f(t.date),c=h(i,{weekStartsOn:1}),d=k(c,"yyyy-MM-dd");e[d]||(e[d]={totalVolume:0,weekLabel:`${n}${k(c,"w")} '${k(c,"yy")}`}),e[d].totalVolume+=this.calculateTotalVolume(t)}),Object.keys(e).sort((t,i)=>new Date(t).getTime()-new Date(i).getTime()).map(t=>({date:f(t),weekLabel:e[t].weekLabel,totalVolume:e[t].totalVolume}))}getPerformanceByMuscleGroup(o){return G(this,null,function*(){if(!o||o.length===0)return[];let e=new Map,n=yield new Promise(t=>{this.exerciseService.getExercises().pipe(N(1)).subscribe(i=>t(i))}),r=new Map(n.map(t=>[t.id,t]));return o.forEach(t=>{let i=new Set;t.exercises.forEach(c=>{let d=r.get(c.exerciseId);if(d&&d.muscleGroups){let u=c.sets.reduce((s,l)=>s+this.calculateSetVolume(l),0);d.muscleGroups.forEach(s=>{let l=s.toLowerCase().trim();e.has(l)||e.set(l,{volume:0,workoutCountSet:new Set});let p=e.get(l);p.volume+=u,i.add(l)})}}),i.forEach(c=>{e.get(c)?.workoutCountSet.add(t.id)})}),Array.from(e.entries()).map(([t,i])=>({muscleGroup:t,volume:Math.round(i.volume),workoutCount:i.workoutCountSet.size})).sort((t,i)=>i.volume-t.volume)})}calculateCurrentWorkoutStreak(o,e){let n=[...o.map(l=>f(l.date)),...e.map(l=>f(l.date))];if(n.length===0)return{length:0};n.sort((l,p)=>p.getTime()-l.getTime());let r=new Date,t=h(r,{weekStartsOn:1}),i=0,c,d=n[0],u=z(r,7);if(!O(d,r,{weekStartsOn:1})&&!O(d,u,{weekStartsOn:1}))return{length:0};for(let l=0;l<260&&n.some(ue=>O(ue,t,{weekStartsOn:1}));l++)c||(c=M(t,{weekStartsOn:1})),i++,t=z(t,7);if(i===0)return{length:0};let s=h(ie(t,7),{weekStartsOn:1});return{length:i,startDate:s,endDate:c}}calculateLongestWorkoutStreak(o,e){let n=[...o.map(s=>f(s.date)),...e.map(s=>f(s.date))];if(n.length<2)return this.calculateCurrentWorkoutStreak(o,e);let r=Array.from(new Set(n.map(s=>k(h(s,{weekStartsOn:1}),"yyyy-MM-dd")))).map(s=>new Date(s)).sort((s,l)=>s.getTime()-l.getTime());if(r.length===0)return{length:0};let t=0,i=0,c,d,u;for(let s=0;s<r.length;s++)if(s===0)i=1,u=r[s];else{let l=r[s-1],p=r[s];de(p,l)===1?i++:(i>t&&(t=i,c=u,d=M(l,{weekStartsOn:1})),i=1,u=p)}return i>t&&(t=i,c=u,d=M(r[r.length-1],{weekStartsOn:1})),{length:t,startDate:c,endDate:d}}static \u0275fac=function(e){return new(e||a)};static \u0275prov=P({token:a,factory:a.\u0275fac,providedIn:"root"})};export{le as a,me as b};
