import{a as v}from"./chunk-U2BKWLUK.js";import{c as O,d as I,f as b,g as D,h as j}from"./chunk-4PTIEP3X.js";import{e as u,g as Z}from"./chunk-QUHMBDFX.js";import{h as f,j as X,n as k}from"./chunk-MJAWVQ2B.js";import{Ba as W,C as A,Db as Y,Eb as $,Fb as q,Ia as w,Ja as p,Ka as h,La as N,O as G,Ob as J,S as _,Sa as E,Ta as x,Ua as g,Va as z,W as M,Wa as L,X as C,Y as H,Zb as Q,db as R,fb as U,ga as F,na as V,oa as y,wa as B,za as K}from"./chunk-P7UMFO6N.js";import{g as P}from"./chunk-GAL4ENT6.js";var ee=class s{transform(o){return o?.sets?.length?o.sets.some(e=>typeof e.weightUsed=="number"||typeof e.weight=="number"||typeof e.targetWeight=="number"):!1}static \u0275fac=function(e){return new(e||s)};static \u0275pipe=K({name:"isWeighted",type:s,pure:!0})};var re=["*",[["","modal-footer",""]]],ae=["*","[modal-footer]"];function ie(s,o){if(s&1&&(p(0,"h3",11),R(1),h()),s&2){let e=g(3);y(),U(" ",e.modalTitle()," ")}}function se(s,o){if(s&1){let e=E();p(0,"div",6),W(1,ie,2,1,"h3",7),p(2,"button",8),x("click",function(){M(e);let t=g(2);return C(t.closeModal())}),H(),p(3,"svg",9),N(4,"path",10),h()()()}if(s&2){let e=g(2);y(),w("ngIf",e.modalTitle())}}function le(s,o){if(s&1){let e=E();p(0,"div",1),x("click",function(){M(e);let t=g();return C(t.closeModal())}),p(1,"div",2),x("click",function(t){M(e);let r=g();return C(r.onDialogClick(t))}),W(2,se,5,1,"div",3),p(3,"div",4),L(4),h(),p(5,"div",5),L(6,1),h()()()}if(s&2){let e=g();w("@modalAnimation",e.animationState),y(),w("@dialogAnimation",e.animationState),y(),w("ngIf",e.modalTitle()||!0)}}var oe=class s{elementRef=_(F);isOpen=q(!1);modalTitle=$();closed=Y();get animationState(){return this.isOpen()?"open":"closed"}closeModal(){this.isOpen.set(!1),this.closed.emit()}onDialogClick(o){o.stopPropagation()}onDocumentMouseDown(o){this.isOpen()&&this.elementRef.nativeElement.contains(o.target)&&o.target.classList.contains("modal-container")&&this.closeModal()}onEscapeKey(){this.isOpen()&&this.closeModal()}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=B({type:s,selectors:[["app-modal"]],hostBindings:function(e,n){e&1&&x("mousedown",function(r){return n.onDocumentMouseDown(r)},V)("keydown.escape",function(){return n.onEscapeKey()},V)},inputs:{isOpen:[1,"isOpen"],modalTitle:[1,"modalTitle"]},outputs:{isOpen:"isOpenChange",closed:"closed"},ngContentSelectors:ae,decls:1,vars:1,consts:[["class","modal-container fixed inset-0 z-[1000] flex items-center justify-center bg-black bg-opacity-60",3,"click",4,"ngIf"],[1,"modal-container","fixed","inset-0","z-[1000]","flex","items-center","justify-center","bg-black","bg-opacity-60",3,"click"],[1,"modal-dialog","mx-2","bg-white","dark:bg-gray-800","rounded-md","shadow-xl","min-w-[300px]","w-full","max-w-lg","md:max-w-xl","lg:max-w-2xl","max-h-[90vh]","flex","flex-col","overflow-hidden",3,"click"],["class","modal-header flex items-center justify-between ml-1 p-1 md:p-1 border-gray-200 dark:border-gray-700",4,"ngIf"],[1,"modal-body","p-1","md:p-1","space-y-4","overflow-y-auto","flex-grow"],[1,"modal-footer","flex","items-center","p-4","md:p-5","border-t","border-gray-200","dark:border-gray-700","rounded-b"],[1,"modal-header","flex","items-center","justify-between","ml-1","p-1","md:p-1","border-gray-200","dark:border-gray-700"],["class","text-xl font-semibold text-gray-900 dark:text-white",4,"ngIf"],["type","button","aria-label","Close modal",1,"modal-close-button","text-gray-400","bg-transparent","hover:bg-gray-200","hover:text-gray-900","dark:hover:bg-gray-600","dark:hover:text-white","rounded-md","text-sm","w-8","h-8","ms-auto","inline-flex","justify-center","items-center",3,"click"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 14 14",1,"w-3","h-3"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"],[1,"text-xl","font-semibold","text-gray-900","dark:text-white"]],template:function(e,n){e&1&&(z(re),W(0,le,7,3,"div",0)),e&2&&w("ngIf",n.isOpen())},dependencies:[Q,J],styles:[".modal-footer[_ngcontent-%COMP%]:empty{display:none}"],data:{animation:[O("modalAnimation",[D("closed",b({opacity:0,visibility:"hidden"})),D("open",b({opacity:1,visibility:"visible"})),j("closed <=> open",[I("300ms ease-in-out")])]),O("dialogAnimation",[D("closed",b({opacity:0,transform:"scale(0.95) translateY(20px)",visibility:"hidden"})),D("open",b({opacity:1,transform:"scale(1) translateY(0)",visibility:"visible"})),j("closed <=> open",[I("300ms ease-in-out")])])]}})};function S(s,o,e){let[n,t]=X(e?.in,s,o);return+f(n,e)==+f(t,e)}var ne=class s{exerciseService=_(Z);constructor(){}calculateSetVolume(o){return(o.repsAchieved||0)*(o.weightUsed||0)}calculateWorkoutVolume(o){let e=0;return o.exercises.forEach(n=>{n.sets.forEach(t=>{e+=this.calculateSetVolume(t)})}),e}calculateTotalVolumeForAllLogs(o){return o.reduce((e,n)=>e+this.calculateWorkoutVolume(n),0)}getWeeklySummaries(o){if(!o||o.length===0)return[];let e={};return o.forEach(n=>{let t=u(n.date),r=f(t,{weekStartsOn:1}),a=v(t,{weekStartsOn:1}),l=k(r,"yyyy-MM-dd");e[l]||(e[l]={logs:[],startDate:r,endDate:a}),e[l].logs.push(n)}),Object.entries(e).map(([n,t])=>{let r=this.calculateTotalVolumeForAllLogs(t.logs);return{weekLabel:`Week of ${k(t.startDate,"MMM d")}`,workoutCount:t.logs.length,totalVolume:r,weekStartDate:t.startDate,weekEndDate:t.endDate}}).sort((n,t)=>t.weekStartDate.getTime()-n.weekStartDate.getTime())}calculateTotalVolume(o){return o.exercises.reduce((e,n)=>{let t=n.sets.reduce((r,a)=>r+(a.weightUsed??0)*(a.repsAchieved??0),0);return e+t},0)}getWeeklyVolumeForChart(o){if(!o||o.length===0)return[];let e={};return o.forEach(t=>{let r=u(t.date),a=f(r,{weekStartsOn:1}),l=k(a,"yyyy-MM-dd");e[l]||(e[l]={totalVolume:0,weekLabel:`W${k(a,"w")} '${k(a,"yy")}`}),e[l].totalVolume+=this.calculateTotalVolume(t)}),Object.keys(e).sort((t,r)=>new Date(t).getTime()-new Date(r).getTime()).map(t=>({date:u(t),weekLabel:e[t].weekLabel,totalVolume:e[t].totalVolume}))}getPerformanceByMuscleGroup(o){return P(this,null,function*(){if(!o||o.length===0)return[];let e=new Map,n=yield new Promise(r=>{this.exerciseService.getExercises().pipe(A(1)).subscribe(a=>r(a))}),t=new Map(n.map(r=>[r.id,r]));return o.forEach(r=>{let a=new Set;r.exercises.forEach(l=>{let m=t.get(l.exerciseId);if(m&&m.muscleGroups){let i=l.sets.reduce((c,d)=>c+this.calculateSetVolume(d),0);m.muscleGroups.forEach(c=>{let d=c.toLowerCase().trim();e.has(d)||e.set(d,{volume:0,workoutCountSet:new Set});let T=e.get(d);T.volume+=i,a.add(d)})}}),a.forEach(l=>{e.get(l)?.workoutCountSet.add(r.id)})}),Array.from(e.entries()).map(([r,a])=>({muscleGroup:r,volume:Math.round(a.volume),workoutCount:a.workoutCountSet.size})).sort((r,a)=>a.volume-r.volume)})}calculateCurrentWorkoutStreak(o){if(!o||o.length===0)return{length:0};let e=[...o].sort((i,c)=>u(c.date).getTime()-u(i.date).getTime()),n=new Date,t=f(n,{weekStartsOn:1}),r=0,a,l=u(e[0].date);if(!S(l,n,{weekStartsOn:1})&&!S(l,new Date(n.getTime()-10080*60*1e3),{weekStartsOn:1}))return{length:0};for(let i=0;i<260&&e.some(d=>S(u(d.date),t,{weekStartsOn:1}));i++)a||(a=v(t,{weekStartsOn:1})),r++,t=new Date(t.getTime()-10080*60*1e3);if(r===0)return{length:0};let m=f(new Date(t.getTime()+10080*60*1e3),{weekStartsOn:1});return{length:r,startDate:m,endDate:a}}calculateLongestWorkoutStreak(o){if(!o||o.length<2)return this.calculateCurrentWorkoutStreak(o);let e=[...o].sort((i,c)=>u(i.date).getTime()-u(c.date).getTime()),n=0,t=0,r,a,l,m=Array.from(new Set(e.map(i=>k(f(u(i.date),{weekStartsOn:1}),"yyyy-MM-dd")))).map(i=>new Date(i)).sort((i,c)=>i.getTime()-c.getTime());for(let i=0;i<m.length;i++)if(i===0)t=1,l=m[i];else{let c=m[i-1],d=m[i],T=new Date(d.getTime()-10080*60*1e3);S(c,T,{weekStartsOn:1})?t++:(t>n&&(n=t,r=l,a=v(c,{weekStartsOn:1})),t=1,l=d)}return t>n&&(n=t,r=l,a=v(m[m.length-1],{weekStartsOn:1})),{length:n,startDate:r,endDate:a}}static \u0275fac=function(e){return new(e||s)};static \u0275prov=G({token:s,factory:s.\u0275fac,providedIn:"root"})};export{ee as a,oe as b,ne as c};
