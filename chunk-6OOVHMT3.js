import{a as p,b as h}from"./chunk-CTWJ5SRT.js";import{a as w}from"./chunk-Z3TB2YW3.js";import{a as M}from"./chunk-WECSLD56.js";import{J as V,M as m,U as x,r as D,u as y}from"./chunk-KIB52VSI.js";import{h as g,s as k}from"./chunk-YVG3JICA.js";import{K as b,O as S,od as L,z as v}from"./chunk-CAUFP2YI.js";import{g as W}from"./chunk-GAL4ENT6.js";var O=class l{cardColors=["#7f1d1d","#86198f","#4a044e","#1e1b4b","#1e3a8a","#064e3b","#14532d","#b91c1c","#c026d3","#701a75","#312e81","#2563eb","#047857","#15803d","#f97316","#ca8a04","#4d7c0f","#0f766e","#0369a1","#1d4ed8","#5b21b6"];getCardColors(){return this.cardColors}getTailwindColorClass(r){return r?{"#7f1d1d":"border-routine-red-800","#86198f":"border-routine-purple-800","#4a044e":"border-routine-purple-900","#1e1b4b":"border-routine-indigo-900","#1e3a8a":"border-routine-blue-800","#064e3b":"border-routine-green-900","#14532d":"border-routine-green-800","#b91c1c":"border-routine-red-700","#c026d3":"border-routine-purple-700","#701a75":"border-routine-purple-850","#312e81":"border-routine-indigo-800","#2563eb":"border-routine-blue-700","#047857":"border-routine-green-700","#15803d":"border-routine-green-600","#f97316":"border-routine-orange-500","#ca8a04":"border-routine-yellow-600","#4d7c0f":"border-routine-lime-700","#0f766e":"border-routine-teal-700","#0369a1":"border-routine-teal-600","#1d4ed8":"border-routine-blue-900","#5b21b6":"border-routine-violet-700"}[r]||"bg-gray-200":""}static \u0275fac=function(t){return new(t||l)};static \u0275prov=b({token:l,factory:l.\u0275fac,providedIn:"root"})};function E(l){return r=>{let a=(l?Math[l]:Math.trunc)(r);return a===0?0:a}}function C(l,r,t){let a=V(l,r,t)/7;return E(t?.roundingMethod)(a)}var T=class l{exerciseService=S(x);translate=S(L);constructor(){}calculateSetVolume(r){return(D(r.repsLogged)||0)*(y(r.weightLogged)||0)}calculateWorkoutVolume(r){let t=0;return r.exercises.forEach(a=>{a.sets.forEach(n=>{t+=this.calculateSetVolume(n)})}),t}calculateTotalVolumeForAllLogs(r){return r.reduce((t,a)=>t+this.calculateWorkoutVolume(a),0)}getWeeklySummaries(r){if(!r||r.length===0)return[];let t={};r.forEach(n=>{let e=m(n.date),o=g(e,{weekStartsOn:1}),i=p(e,{weekStartsOn:1}),c=k(o,"yyyy-MM-dd");t[c]||(t[c]={logs:[],startDate:o,endDate:i}),t[c].logs.push(n)});let a=this.translate.instant("statsService.weekOf");return Object.entries(t).map(([n,e])=>{let o=this.calculateTotalVolumeForAllLogs(e.logs);return{weekLabel:`${a} ${k(e.startDate,"MMM d")}`,workoutCount:e.logs.length,totalVolume:o,weekStartDate:e.startDate,weekEndDate:e.endDate}}).sort((n,e)=>e.weekStartDate.getTime()-n.weekStartDate.getTime())}calculateTotalVolume(r){return r.exercises.reduce((t,a)=>{let n=a.sets.reduce((e,o)=>e+(y(o.weightLogged)??0)*(D(o.repsLogged)??0),0);return t+n},0)}getWeeklyVolumeForChart(r){if(!r||r.length===0)return[];let t={},a=this.translate.instant("statsService.weekPrefix");return r.forEach(e=>{let o=m(e.date),i=g(o,{weekStartsOn:1}),c=k(i,"yyyy-MM-dd");t[c]||(t[c]={totalVolume:0,weekLabel:`${a}${k(i,"w")} '${k(i,"yy")}`}),t[c].totalVolume+=this.calculateTotalVolume(e)}),Object.keys(t).sort((e,o)=>new Date(e).getTime()-new Date(o).getTime()).map(e=>({date:m(e),weekLabel:t[e].weekLabel,totalVolume:t[e].totalVolume}))}getPerformanceByMuscleGroup(r){return W(this,null,function*(){if(!r||r.length===0)return[];let t=new Map,a=yield new Promise(e=>{this.exerciseService.getExercises().pipe(v(1)).subscribe(o=>e(o))}),n=new Map(a.map(e=>[e.id,e]));return r.forEach(e=>{let o=new Set;e.exercises.forEach(i=>{let c=n.get(i.exerciseId);if(c&&c.muscleGroups){let d=i.sets.reduce((u,s)=>u+this.calculateSetVolume(s),0);c.muscleGroups.forEach(u=>{let s=u.toLowerCase().trim();t.has(s)||t.set(s,{volume:0,workoutCountSet:new Set});let f=t.get(s);f.volume+=d,o.add(s)})}}),o.forEach(i=>{t.get(i)?.workoutCountSet.add(e.id)})}),Array.from(t.entries()).map(([e,o])=>({muscleGroup:e,volume:Math.round(o.volume),workoutCount:o.workoutCountSet.size})).sort((e,o)=>o.volume-e.volume)})}calculateCurrentWorkoutStreak(r,t){let a=[...r.map(s=>m(s.date)),...t.map(s=>m(s.date))];if(a.length===0)return{length:0};a.sort((s,f)=>f.getTime()-s.getTime());let n=new Date,e=g(n,{weekStartsOn:1}),o=0,i,c=a[0],d=h(n,7);if(!w(c,n,{weekStartsOn:1})&&!w(c,d,{weekStartsOn:1}))return{length:0};for(let s=0;s<260&&a.some(I=>w(I,e,{weekStartsOn:1}));s++)i||(i=p(e,{weekStartsOn:1})),o++,e=h(e,7);if(o===0)return{length:0};let u=g(M(e,7),{weekStartsOn:1});return{length:o,startDate:u,endDate:i}}calculateLongestWorkoutStreak(r,t){let a=[...r.map(u=>m(u.date)),...t.map(u=>m(u.date))];if(a.length<2)return this.calculateCurrentWorkoutStreak(r,t);let n=Array.from(new Set(a.map(u=>k(g(u,{weekStartsOn:1}),"yyyy-MM-dd")))).map(u=>new Date(u)).sort((u,s)=>u.getTime()-s.getTime());if(n.length===0)return{length:0};let e=0,o=0,i,c,d;for(let u=0;u<n.length;u++)if(u===0)o=1,d=n[u];else{let s=n[u-1],f=n[u];C(f,s)===1?o++:(o>e&&(e=o,i=d,c=p(s,{weekStartsOn:1})),o=1,d=f)}return o>e&&(e=o,i=d,c=p(n[n.length-1],{weekStartsOn:1})),{length:e,startDate:i,endDate:c}}static \u0275fac=function(t){return new(t||l)};static \u0275prov=b({token:l,factory:l.\u0275fac,providedIn:"root"})};export{O as a,T as b};
