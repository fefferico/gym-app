import{a as ot,b as Xt}from"./chunk-JZLUFH5V.js";import{a as Zt}from"./chunk-S2O4S77T.js";import"./chunk-BSHLTN6A.js";import{a as Qt}from"./chunk-GNZ76LCT.js";import{a as Re}from"./chunk-PQUGBVUE.js";import{a as zt,b as qt,c as Jt,d as Kt,e as Yt}from"./chunk-5XX3BJ6W.js";import"./chunk-RUTLHVVD.js";import{c as Ie,d as _e,g as oe,h as se,i as ve}from"./chunk-PPV5CVAY.js";import{f as jt,h as j}from"./chunk-OWRY4GQ7.js";import{a as pe}from"./chunk-4ADVCJKO.js";import{a as vt,b as me,c as Ht}from"./chunk-D7DRWHTU.js";import{$a as Ge,$b as A,A as z,Aa as b,Ba as te,Ca as ie,Db as Dt,Dc as nt,E as Se,Ea as I,Eb as be,Fa as h,G as xe,Ga as u,Gb as ke,Ha as Tt,Hb as ce,Ia as xt,Ib as ee,Jb as q,Ka as De,La as Me,M as R,Ma as Le,Na as re,O as x,Oa as Pt,P as f,Pa as fe,Q as E,Qb as Mt,R as D,Ra as m,Rb as we,Sa as V,Ta as C,Tb as ue,Ua as G,Ub as Ee,V as T,W as kt,Wa as Rt,Xa as Oe,Y as wt,Ya as Ae,Yb as N,Za as Ne,_ as ye,_b as ze,a as U,ab as ft,ac as qe,b as H,ba as Et,bb as he,bc as Je,ca as It,cb as Q,cc as Lt,da as pt,dc as Ke,ea as l,eb as ht,ec as Ye,f as L,fc as Qe,gc as Ze,hb as O,hc as Ot,ib as $,ic as At,jb as Z,jc as Xe,kb as _t,kc as Nt,lb as ne,lc as Bt,m as ge,ma as Y,mc as $t,nb as B,o as le,oa as Ct,oc as Ut,p as Ve,pb as Wt,pc as Gt,qb as Vt,qc as et,r as St,ra as _,rb as Ft,rc as tt,sa as Fe,sc as it,t as Ue,tb as je,tc as Ce,u as yt,uc as rt,vc as Te,w as bt,wa as gt,wc as Pe,xa as p,xb as He,ya as s,yb as de,za as a,zb as X}from"./chunk-VMPYKSSC.js";function ni(n,t){if(n&1&&(s(0,"option",30),m(1),O(2,"titlecase"),a()),n&2){let e=t.$implicit;p("value",e),l(),V($(2,2,e))}}function oi(n,t){if(n&1&&(s(0,"option",30),m(1),O(2,"titlecase"),a()),n&2){let e=t.$implicit;p("value",e),l(),V($(2,2,e))}}function si(n,t){if(n&1&&(s(0,"span"),m(1," of "),s(2,"strong",32),m(3),a()()),n&2){let e=u(2);l(3),V(e.allRoutinesForList().length)}}function ai(n,t){if(n&1&&(s(0,"div",31),m(1," Showing "),s(2,"strong",32),m(3),a(),_(4,si,4,1,"span",33),m(5," routines "),a()),n&2){let e=u();l(3),V(e.filteredRoutines().length),l(),p("ngIf",e.routineSearchTerm()||e.selectedRoutineGoal()||e.selectedRoutineMuscleGroup())}}function li(n,t){if(n&1&&(s(0,"p",54),m(1),a()),n&2){let e=u().$implicit;p("title",e.description),l(),V(e.description)}}function di(n,t){if(n&1&&(s(0,"div")(1,"span",43),m(2,"Goal:"),a(),s(3,"span",55),m(4),O(5,"titlecase"),a()()),n&2){let e=u().$implicit;l(4),C(" ",$(5,1,e.goal)," ")}}function ci(n,t){if(n&1&&(s(0,"span",58),m(1),O(2,"titlecase"),a()),n&2){let e=t.$implicit;l(),C(" ",$(2,1,e)," ")}}function ui(n,t){if(n&1&&(s(0,"div",56)(1,"span",43),m(2,"Muscles:"),a(),_(3,ci,3,3,"span",57),a()),n&2){let e=u().$implicit,i=u(3);l(3),p("ngForOf",i.getRoutineMainMuscleGroups(e))}}function mi(n,t){if(n&1&&(s(0,"div",59)(1,"span",43),m(2,"Last:"),a(),m(3),O(4,"date"),a()),n&2){let e=u().$implicit;l(3),C(" ",Z(4,1,e.lastPerformed,"dd/MM/yy HH:mm")," ")}}function pi(n,t){n&1&&(s(0,"div",60),m(1," Not performed "),a())}function gi(n,t){if(n&1){let e=I();s(0,"div",61)(1,"button",62),h("click",function(r){x(e);let o=u().$implicit,d=u(3);return f(d.viewRoutineDetails(o.id,r))}),E(),s(2,"svg",63),b(3,"path",64)(4,"path",65),a(),m(5," VIEW "),a(),D(),s(6,"button",66),h("click",function(r){x(e);let o=u().$implicit,d=u(3);return f(d.startWorkout(o.id,r))}),E(),s(7,"svg",67),b(8,"path",68),a(),m(9," START "),a(),D(),s(10,"button",62),h("click",function(r){x(e);let o=u().$implicit,d=u(3);return f(d.editRoutine(o.id,r))}),E(),s(11,"svg",67),b(12,"path",69),a(),m(13," EDIT "),a(),D(),s(14,"button",62),h("click",function(r){x(e);let o=u().$implicit,d=u(3);return f(d.cloneAndEditRoutine(o.id,r))}),E(),s(15,"svg",70),b(16,"path",71),a(),m(17," CLONE "),a(),D(),b(18,"div",72),s(19,"button",73),h("click",function(r){x(e);let o=u().$implicit,d=u(3);return f(d.deleteRoutine(o.id,r))}),E(),s(20,"svg",63),b(21,"path",74),a(),m(22," DELETE "),a()()}n&2&&p("@dropdownMenu",void 0)}function xi(n,t){if(n&1){let e=I();s(0,"div",75)(1,"button",76),h("click",function(r){x(e);let o=u().$implicit,d=u(3);return f(d.viewRoutineDetails(o.id,r))}),E(),s(2,"svg",67),b(3,"path",77)(4,"path",78),a(),m(5," VIEW "),a(),D(),s(6,"button",79),h("click",function(r){x(e);let o=u().$implicit,d=u(3);return f(d.startWorkout(o.id,r))}),E(),s(7,"svg",67),b(8,"path",68),a(),m(9," START "),a(),D(),s(10,"button",80),h("click",function(r){x(e);let o=u().$implicit,d=u(3);return f(d.editRoutine(o.id,r))}),E(),s(11,"svg",67),b(12,"path",69),a(),m(13," EDIT "),a(),D(),s(14,"button",81),h("click",function(r){x(e);let o=u().$implicit,d=u(3);return f(d.cloneAndEditRoutine(o.id,r))}),E(),s(15,"svg",70),b(16,"path",71),a(),m(17," CLONE "),a(),D(),s(18,"button",81),h("click",function(r){x(e);let o=u().$implicit,d=u(3);return f(d.deleteRoutine(o.id,r))}),E(),s(19,"svg",82),b(20,"path",27),a(),m(21," DELETE "),a()()}n&2&&p("@slideInOutActions",void 0)}function fi(n,t){if(n&1){let e=I();s(0,"div",37)(1,"div",38),h("click",function(){let r=x(e).$implicit,o=u(3);return f(o.viewRoutineDetails(r.id))}),s(2,"div",39)(3,"h2",40),m(4),a()(),_(5,li,2,2,"p",41),s(6,"div",42),_(7,di,6,3,"div",33),s(8,"span")(9,"span",43),m(10,"Ex:"),a(),m(11),a()(),_(12,ui,4,1,"div",44)(13,mi,5,4,"div",45)(14,pi,2,0,"div",46),a(),s(15,"div",47)(16,"div",48)(17,"button",49),h("click",function(r){let o=x(e).$implicit,d=u(3);return f(d.toggleActions(o.id,r))}),E(),s(18,"svg",50),b(19,"path",51),a()(),_(20,gi,23,1,"div",52),a()(),_(21,xi,22,1,"div",53),a()}if(n&2){let e=t.$implicit,i=u(3);l(3),p("title",e.name),l(),V(e.name),l(),p("ngIf",e.description),l(2),p("ngIf",e.goal),l(4),C(" ",e.exercises.length," "),l(),p("ngIf",i.getRoutineMainMuscleGroups(e).length>0),l(),p("ngIf",e.lastPerformed),l(),p("ngIf",!e.lastPerformed),l(6),p("ngIf",i.areActionsVisible(e.id)&&!i.menuModeCompact),l(),p("ngIf",i.areActionsVisible(e.id)&&i.menuModeCompact)}}function hi(n,t){if(n&1&&(s(0,"div",35),_(1,fi,22,10,"div",36),a()),n&2){let e=u(2);l(),p("ngForOf",e.filteredRoutines())}}function _i(n,t){if(n&1){let e=I();s(0,"button",89),h("click",function(){x(e);let r=u(3);return f(r.navigateToCreateRoutine())}),m(1," Create Your First Routine "),a()}}function vi(n,t){if(n&1&&(s(0,"div",83),E(),s(1,"svg",84),b(2,"path",85),a(),D(),s(3,"h3",86),m(4),a(),s(5,"p",87),m(6),a(),_(7,_i,2,0,"button",88),a()),n&2){let e=u(2);l(4),C(" ",e.routineSearchTerm()||e.selectedRoutineGoal()||e.selectedRoutineMuscleGroup()?"No Routines Match Filters":"No Routines Yet!"," "),l(2),C(" ",e.routineSearchTerm()||e.selectedRoutineGoal()||e.selectedRoutineMuscleGroup()?"Try adjusting your filters.":"Get started by creating your first workout routine."," "),l(),p("ngIf",!(e.routineSearchTerm()||e.selectedRoutineGoal()||e.selectedRoutineMuscleGroup()))}}function Si(n,t){if(n&1&&(s(0,"div"),_(1,hi,2,1,"div",34)(2,vi,8,3,"ng-template",null,1,ne),a()),n&2){let e=re(3),i=u();l(),p("ngIf",i.filteredRoutines().length>0)("ngIfElse",e)}}function yi(n,t){n&1&&(s(0,"div",90),E(),s(1,"svg",91),b(2,"circle",92)(3,"path",93),a(),D(),s(4,"p",94),m(5,"Loading routines..."),a()())}var st=class n{workoutService=R(Te);exerciseService=R(pe);trackingService=R(me);router=R(ue);alertService=R(Ce);spinnerService=R(nt);toastService=R(Pe);storageService=R(rt);themeService=R(Ht);platformId=R(ye);routines$;allRoutinesForList=T([]);routinesSubscription;exercisesSubscription;visibleActionsRutineId=T(null);menuModeCompact=!1;isFilterAccordionOpen=T(!1);routineSearchTerm=T("");selectedRoutineGoal=T(null);selectedRoutineMuscleGroup=T(null);uniqueRoutineGoals=T([]);uniqueRoutineMuscleGroups=T([]);allExercisesMap=new Map;PAUSED_WORKOUT_KEY="fitTrackPro_pausedWorkoutState";filteredRoutines=B(()=>{let t=this.allRoutinesForList(),e=this.routineSearchTerm().toLowerCase(),i=this.selectedRoutineGoal(),r=this.selectedRoutineMuscleGroup();return e&&(t=t.filter(o=>o.name.toLowerCase().includes(e)||o.description&&o.description.toLowerCase().includes(e))),i&&(t=t.filter(o=>o.goal?.toLowerCase()===i.toLowerCase())),r&&(t=t.filter(o=>o.exercises.some(d=>this.allExercisesMap.get(d.exerciseId)?.primaryMuscleGroup.toLowerCase()===r.toLowerCase()))),t});ngOnInit(){q(this.platformId)&&window.scrollTo(0,0),this.menuModeCompact=this.themeService.isMenuModeCompact(),this.exercisesSubscription=this.exerciseService.getExercises().subscribe(t=>{t.forEach(e=>this.allExercisesMap.set(e.id,e)),this.loadRoutinesAndPopulateFilters()}),this.routines$=this.workoutService.routines$}loadRoutinesAndPopulateFilters(){this.routinesSubscription=this.workoutService.routines$.subscribe(t=>{this.allRoutinesForList.set(t),this.populateRoutineFilterOptions(t)})}populateRoutineFilterOptions(t){if(!t)return;let e=new Set,i=new Set;t.forEach(r=>{r.goal&&e.add(r.goal),r.exercises.forEach(o=>{let d=this.allExercisesMap.get(o.exerciseId);d?.primaryMuscleGroup&&i.add(d.primaryMuscleGroup)})}),this.uniqueRoutineGoals.set(Array.from(e).sort()),this.uniqueRoutineMuscleGroups.set(Array.from(i).sort())}toggleFilterAccordion(){this.isFilterAccordionOpen.update(t=>!t)}onRoutineSearchTermChange(t){let e=t.target;this.routineSearchTerm.set(e.value)}onRoutineGoalChange(t){let e=t.target;this.selectedRoutineGoal.set(e.value||null)}onRoutineMuscleGroupChange(t){let e=t.target;this.selectedRoutineMuscleGroup.set(e.value||null)}clearRoutineFilters(){this.routineSearchTerm.set(""),this.selectedRoutineGoal.set(null),this.selectedRoutineMuscleGroup.set(null);let t=document.getElementById("routine-search-term");t&&(t.value="");let e=document.getElementById("routine-goal-filter");e&&(e.value="");let i=document.getElementById("routine-muscle-filter");i&&(i.value="")}navigateToCreateRoutine(){this.router.navigate(["/workout/routine/new"])}editRoutine(t,e){e.stopPropagation(),this.router.navigate(["/workout/routine/edit",t]),this.visibleActionsRutineId.set(null)}deleteRoutine(t,e){return L(this,null,function*(){e.stopPropagation(),this.visibleActionsRutineId.set(null);let i=this.allRoutinesForList().find(c=>c.id===t);if(!i){this.toastService.error("Routine not found for deletion.",0,"Error");return}let r=(yield le(this.trackingService.getWorkoutLogsByRoutineId(t).pipe(z(1))))||[],o=`Are you sure you want to delete the routine "${i.name}"?`;r.length>0&&(o+=` This will also delete ${r.length} associated workout log(s). This action cannot be undone.`);let d=yield this.alertService.showConfirm("Delete Routine",o,"Delete");if(d&&d.data)try{this.spinnerService.show(),r.length>0&&(yield this.trackingService.clearWorkoutLogsByRoutineId(t)),yield this.workoutService.deleteRoutine(t),this.toastService.success(`Routine "${i.name}" deleted successfully.`,4e3,"Routine Deleted")}catch(c){console.error("Error during deletion:",c),this.toastService.error("Failed to delete routine or its logs.",0,"Deletion Failed")}finally{this.spinnerService.hide()}})}startWorkout(t,e){return L(this,null,function*(){if(e.stopPropagation(),this.visibleActionsRutineId.set(null),!q(this.platformId)){this.router.navigate(["/workout/play",t]);return}let i=this.storageService.getItem(this.PAUSED_WORKOUT_KEY);if(i){let r=i.sessionRoutine?.name||"a previous session",o=i.workoutDate?` from ${j(new Date(i.workoutDate),"MMM d, HH:mm")}`:"",d=[{text:"Cancel",role:"cancel",data:"cancel"},{text:"Discard Paused & Start New",role:"confirm",data:"discard_start_new",cssClass:"bg-red-500 hover:bg-red-600 text-white"},{text:`Resume: ${r.substring(0,15)}${r.length>15?"...":""}`,role:"confirm",data:"resume_paused",cssClass:"bg-green-500 hover:bg-green-600 text-white"}],c=yield this.alertService.showConfirmationDialog("Workout in Progress",`You have a paused workout ("${r}"${o}). What would you like to do?`,d);if(c&&c.data==="resume_paused"){let g=i.routineId||"ad-hoc";this.router.navigate(["/workout/play",i.routineId||""],{queryParams:{resume:"true"}})}else c&&c.data==="discard_start_new"?(this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),this.toastService.info("Previous paused workout discarded.",3e3),this.router.navigate(["/workout/play",t])):this.toastService.info("Starting new workout cancelled.",2e3)}else this.router.navigate(["/workout/play",t])})}viewRoutineDetails(t,e){e?.stopPropagation(),this.router.navigate(["/workout/routine/view",t,{isView:"routineBuilder"}]),this.visibleActionsRutineId.set(null)}toggleActions(t,e){e.stopPropagation(),this.visibleActionsRutineId.update(i=>i===t?null:t)}areActionsVisible(t){return this.visibleActionsRutineId()===t}getRoutineMainMuscleGroups(t){if(!this.allExercisesMap.size||!t.exercises.length)return[];let e=new Set;return t.exercises.forEach(i=>{let r=this.allExercisesMap.get(i.exerciseId);r?.primaryMuscleGroup&&e.add(r.primaryMuscleGroup)}),Array.from(e).slice(0,3)}cloneAndEditRoutine(t,e){return L(this,null,function*(){e.stopPropagation(),this.visibleActionsRutineId.set(null);let i=this.allRoutinesForList().find(o=>o.id===t);if(!i){this.toastService.error("Routine not found for cloning.",0,"Error");return}let r=H(U({},structuredClone(i)),{name:i.name+" (Copy)",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()});try{this.spinnerService.show(),r=yield this.workoutService.addRoutine(r),this.toastService.success(`Routine "${r.name}" cloned successfully.`,3e3,"Routine Cloned"),this.router.navigate(["/workout/routine/edit",r.id]),this.visibleActionsRutineId.set(null)}catch(o){console.error("Error during routine cloning:",o),this.toastService.error("Failed to clone routine.",0,"Clone Failed")}finally{this.spinnerService.hide()}})}ngOnDestroy(){this.routinesSubscription?.unsubscribe(),this.exercisesSubscription?.unsubscribe()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=Y({type:n,selectors:[["app-routine-list"]],decls:46,vars:16,consts:[["loadingRoutines",""],["noRoutines",""],[1,"container","mx-auto","p-1","sm:p-4"],[1,"flex","justify-between","items-center","mb-2","pb-2","border-b","border-gray-200","dark:border-gray-700"],[1,"text-2xl","font-bold","text-gray-800","dark:text-gray-200"],["type","button",1,"p-2","rounded-md","text-gray-600","dark:text-gray-300","hover:bg-gray-200","dark:hover:bg-gray-700","focus:outline-none","focus:ring-2","focus:ring-primary","dark:focus:ring-primary-light","transition-all","duration-300","ease-in-out",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-6","h-6","transition-transform","duration-300"],["stroke-linecap","round","stroke-linejoin","round","d","M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0M3.75 18H7.5m3-6h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0M3.75 12H7.5"],[1,"sr-only"],[1,"bg-primary","hover:bg-primary-dark","text-white","font-semibold","py-2","px-3","rounded-md","shadow-sm","hover:shadow-md","transition-all","duration-200","focus:outline-none","focus:ring-2","focus:ring-primary-light","focus:ring-opacity-75","text-sm","mb-2",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"w-4","h-4","mr-1.5","inline-block"],["d","M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z"],[1,"overflow-hidden","transition-all","duration-500","ease-in-out"],[1,"p-4","bg-white","dark:bg-gray-700","rounded-lg","shadow-md","border","dark:border-gray-600"],[1,"text-xl","font-semibold","text-gray-700","dark:text-gray-300","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","items-end"],["for","routine-search-term",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-1"],["type","text","id","routine-search-term","placeholder","Enter routine name or description...",1,"block","w-full","p-2","border","border-gray-300","dark:border-gray-600","rounded-md","shadow-sm","focus:ring-primary","focus:border-primary","dark:bg-gray-600","dark:text-gray-200",3,"input","value"],["for","routine-goal-filter",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-1"],["id","routine-goal-filter",1,"block","w-full","p-2","border","border-gray-300","dark:border-gray-600","rounded-md","shadow-sm","focus:ring-primary","focus:border-primary","dark:bg-gray-600","dark:text-gray-200",3,"change","value"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","routine-muscle-filter",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-1"],["id","routine-muscle-filter",1,"block","w-full","p-2","border","border-gray-300","dark:border-gray-600","rounded-md","shadow-sm","focus:ring-primary","focus:border-primary","dark:bg-gray-600","dark:text-gray-200",3,"change","value"],[1,"mt-4","flex","justify-between","items-center"],[1,"flex","px-4","py-2","bg-yellow-200","dark:bg-yellow-700","text-gray-700","dark:text-gray-200","rounded-md","hover:bg-yellow-300","dark:hover:bg-yellow-500","text-sm","items-center",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-5","mr-2"],["stroke-linecap","round","stroke-linejoin","round","d","m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"],["class","text-sm text-gray-600 dark:text-gray-400",4,"ngIf"],[4,"ngIf","ngIfElse"],[3,"value"],[1,"text-sm","text-gray-600","dark:text-gray-400"],[1,"text-gray-800","dark:text-gray-200"],[4,"ngIf"],["class","grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4",4,"ngIf","ngIfElse"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4","mt-4"],["class","bg-white dark:bg-gray-700 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-200 relative group",4,"ngFor","ngForOf"],[1,"bg-white","dark:bg-gray-700","rounded-lg","shadow-md","hover:shadow-lg","transition-shadow","duration-200","relative","group"],[1,"p-3","cursor-pointer",3,"click"],[1,"flex","justify-between","items-start","mb-1.5"],[1,"text-lg","font-semibold","text-primary","dark:text-primary-light","truncate","pr-8",3,"title"],["class","text-gray-600 dark:text-gray-400 mb-2 line-clamp-2 text-sm sm:text-xs",3,"title",4,"ngIf"],[1,"flex","justify-between","text-xs","text-gray-500","dark:text-gray-300","mb-2","space-x-2"],[1,"font-medium"],["class","text-sm sm:text-xs text-gray-500 dark:text-gray-300 mb-2",4,"ngIf"],["class","text-sm sm:text-xs text-gray-500 dark:text-gray-300",4,"ngIf"],["class","text-sm sm:text-xs text-gray-500 dark:text-gray-300 italic",4,"ngIf"],[1,"absolute","top-2","right-2"],[1,"relative"],[1,"p-1.5","text-gray-500","dark:text-gray-400","hover:bg-gray-200","dark:hover:bg-gray-700","rounded-full","focus:outline-none",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","d","M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"],["class","origin-top-right absolute right-0 top-full mt-1 sm:mt-2 w-40 sm:w-48 rounded-md shadow-lg bg-white dark:bg-gray-800 ring-1 ring-black dark:ring-gray-600 ring-opacity-5 focus:outline-none py-1 z-50 sm:z-50",4,"ngIf"],["class",`absolute inset-x-0 bottom-0 p-2 bg-gray-100 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-700
                           flex flex-wrap gap-1.5 justify-center z-20 rounded-b-lg`,4,"ngIf"],[1,"text-gray-600","dark:text-gray-400","mb-2","line-clamp-2","text-sm","sm:text-xs",3,"title"],[1,"text-2xs","bg-blue-100","text-blue-700","dark:bg-blue-700","dark:text-blue-200","px-1.5","py-0.5","rounded-full","mx-1","inline-block"],[1,"text-sm","sm:text-xs","text-gray-500","dark:text-gray-300","mb-2"],["class","text-2xs bg-purple-100 text-purple-700 dark:bg-purple-700 dark:text-purple-200 px-1.5 py-0.5 rounded-full mx-1 mb-1 inline-block",4,"ngFor","ngForOf"],[1,"text-2xs","bg-purple-100","text-purple-700","dark:bg-purple-700","dark:text-purple-200","px-1.5","py-0.5","rounded-full","mx-1","mb-1","inline-block"],[1,"text-sm","sm:text-xs","text-gray-500","dark:text-gray-300"],[1,"text-sm","sm:text-xs","text-gray-500","dark:text-gray-300","italic"],[1,"origin-top-right","absolute","right-0","top-full","mt-1","sm:mt-2","w-40","sm:w-48","rounded-md","shadow-lg","bg-white","dark:bg-gray-800","ring-1","ring-black","dark:ring-gray-600","ring-opacity-5","focus:outline-none","py-1","z-50","sm:z-50"],[1,"w-full","text-left","px-3","py-1.5","sm:px-4","sm:py-2","text-gray-700","dark:text-gray-200","hover:bg-gray-100","dark:hover:bg-gray-500","flex","items-center",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"w-3.5","h-3.5","sm:w-4","sm:h-4","mr-2"],["d","M10 12.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5Z"],["fill-rule","evenodd","d","M.664 10.59a1.651 1.651 0 010-1.186A10.004 10.004 0 0110 3c4.257 0 7.893 2.66 9.336 6.41.147.381.146.804 0 1.186A10.004 10.004 0 0110 17c-4.257 0-7.893-2.66-9.336-6.41ZM14 10a4 4 0 11-8 0 4 4 0 018 0Z","clip-rule","evenodd"],[1,"w-full","text-left","px-3","py-1.5","sm:px-4","sm:py-2","font-medium","text-green-600","dark:text-green-400","hover:bg-green-50","dark:hover:bg-green-700/30","flex","items-center",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","2","stroke","currentColor",1,"size-4","mr-2"],["stroke-linecap","round","stroke-linejoin","round","d","M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"],["stroke-linecap","round","stroke-linejoin","round","d","m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24",1,"size-4","mr-2"],["d","M 5 3 H 16 A 2 2 0 0 1 18 5 V 16 A 2 2 0 0 1 16 18 H 5 A 2 2 0 0 1 3 16 V 5 A 2 2 0 0 1 5 3 Z M 8 6 H 19 A 2 2 0 0 1 21 8 V 19 A 2 2 0 0 1 19 21 H 8 A 2 2 0 0 1 6 19 V 8 A 2 2 0 0 1 8 6 Z","fill","none","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round",1,"ng-tns-c238015746-6"],[1,"my-0.5","sm:my-1","border-t","border-gray-200","dark:border-gray-600"],[1,"w-full","text-left","px-3","py-1.5","sm:px-4","sm:py-2","text-red-600","dark:text-red-400","hover:bg-red-50","dark:hover:bg-red-600/50","flex","items-center",3,"click"],["fill-rule","evenodd","d","M8.75 1A2.75 2.75 0 006 3.75v.443c-.795.077-1.58.177-2.365.298a.75.75 0 10.23 1.482l.149-.022.841 10.518A2.75 2.75 0 007.596 19h4.807a2.75 2.75 0 002.742-2.53l.841-10.52.149.023a.75.75 0 00.23-1.482A41.03 41.03 0 0014 4.193V3.75A2.75 2.75 0 0011.25 1h-2.5ZM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4ZM8.58 7.72a.75.75 0 00-1.5.06l.3 7.5a.75.75 0 101.5-.06l-.3-7.5Zm4.34.06a.75.75 0 10-1.5-.06l-.3 7.5a.75.75 0 101.5.06l.3-7.5Z","clip-rule","evenodd"],[1,"absolute","inset-x-0","bottom-0","p-2","bg-gray-100","dark:bg-gray-700","border-t","border-gray-200","dark:border-gray-700","flex","flex-wrap","gap-1.5","justify-center","z-20","rounded-b-lg"],["title","View Details",1,"flex-1","text-xs","min-w-[70px]","flex","items-center","justify-center","p-1.5","bg-cyan-500","text-white","rounded-md","hover:bg-cyan-600","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"],["stroke-linecap","round","stroke-linejoin","round","d","M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"],["title","Start Workout",1,"flex-1","text-xs","min-w-[70px]","flex","items-center","justify-center","p-1.5","bg-green-500","text-white","rounded-md","hover:bg-green-600","transition-colors",3,"click"],["title","Edit Routine",1,"flex-1","text-xs","min-w-[70px]","flex","items-center","justify-center","p-1.5","bg-yellow-500","text-white","rounded-md","hover:bg-yellow-600","transition-colors",3,"click"],["title","Delete Routine",1,"flex-1","text-xs","min-w-[70px]","flex","items-center","justify-center","p-1.5","bg-red-500","text-white","rounded-md","hover:bg-red-600","transition-colors",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","2","stroke","currentColor",1,"size-4","mr-1"],[1,"text-center","py-12","px-6","bg-white","dark:bg-gray-700","rounded-lg","shadow-md"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-16","h-16","mx-auto","text-gray-400","dark:text-gray-200","mb-4"],["stroke-linecap","round","stroke-linejoin","round","d","M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 0 1 0 3.75H5.625a1.875 1.875 0 0 1 0-3.75Z"],[1,"text-xl","font-semibold","text-gray-700","dark:text-gray-300","mb-2"],[1,"text-gray-500","dark:text-gray-400","mb-6"],["class","bg-primary hover:bg-primary-dark text-white font-semibold py-2 px-6 rounded-md shadow-md hover:shadow-lg transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-primary-light focus:ring-opacity-75",3,"click",4,"ngIf"],[1,"bg-primary","hover:bg-primary-dark","text-white","font-semibold","py-2","px-6","rounded-md","shadow-md","hover:shadow-lg","transition-all","duration-300","focus:outline-none","focus:ring-2","focus:ring-primary-light","focus:ring-opacity-75",3,"click"],[1,"text-center","py-10"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","h-8","w-8","text-primary","dark:text-primary-light","mx-auto"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"text-lg","text-gray-600","dark:text-gray-400","mt-3"]],template:function(e,i){if(e&1){let r=I();s(0,"div",2)(1,"header",3)(2,"h1",4),m(3,"My Routines"),a(),s(4,"button",5),h("click",function(){return x(r),f(i.toggleFilterAccordion())}),E(),s(5,"svg",6),b(6,"path",7),a(),D(),s(7,"span",8),m(8,"Toggle Filters"),a()()(),s(9,"button",9),h("click",function(){return x(r),f(i.navigateToCreateRoutine())}),E(),s(10,"svg",10),b(11,"path",11),a(),m(12," NEW ROUTINE "),a(),D(),s(13,"div",12)(14,"div",13)(15,"h2",14),m(16,"Filter Routines"),a(),s(17,"div",15)(18,"div")(19,"label",16),m(20,"Search Name/Desc."),a(),s(21,"input",17),h("input",function(d){return x(r),f(i.onRoutineSearchTermChange(d))}),a()(),s(22,"div")(23,"label",18),m(24,"Goal"),a(),s(25,"select",19),h("change",function(d){return x(r),f(i.onRoutineGoalChange(d))}),s(26,"option",20),m(27,"Any Goal"),a(),_(28,ni,3,4,"option",21),a()(),s(29,"div")(30,"label",22),m(31,"Targets Muscle"),a(),s(32,"select",23),h("change",function(d){return x(r),f(i.onRoutineMuscleGroupChange(d))}),s(33,"option",20),m(34,"Any Muscle Group"),a(),_(35,oi,3,4,"option",21),a()()(),s(36,"div",24)(37,"button",25),h("click",function(){return x(r),f(i.clearRoutineFilters())}),E(),s(38,"svg",26),b(39,"path",27),a(),m(40," Clear Routine Filters "),a(),_(41,ai,6,2,"div",28),a()()(),_(42,Si,4,2,"div",29),O(43,"async"),_(44,yi,6,0,"ng-template",null,0,ne),a()}if(e&2){let r=re(45);l(5),fe("rotate-180",i.isFilterAccordionOpen()),l(8),Pt("max-height",i.isFilterAccordionOpen()?"1000px":"0px"),fe("mb-6",i.isFilterAccordionOpen()),l(8),p("value",i.routineSearchTerm()),l(4),p("value",i.selectedRoutineGoal()||""),l(3),p("ngForOf",i.uniqueRoutineGoals()),l(4),p("value",i.selectedRoutineMuscleGroup()||""),l(3),p("ngForOf",i.uniqueRoutineMuscleGroups()),l(6),p("ngIf",i.allRoutinesForList().length>0),l(),p("ngIf",$(43,14,i.routines$))("ngIfElse",r)}},dependencies:[ee,de,X,Dt,be,ke],encapsulation:2,data:{animation:[Ie("slideInOutActions",[se("void",oe({height:"0px",opacity:0,overflow:"hidden",paddingTop:"0",paddingBottom:"0",marginTop:"0",marginBottom:"0"})),se("*",oe({height:"*",opacity:1,overflow:"hidden",paddingTop:"0.5rem",paddingBottom:"0.5rem"})),ve("void <=> *",_e("200ms ease-in-out"))]),Ie("dropdownMenu",[se("void",oe({opacity:0,transform:"scale(0.75) translateY(-10px)",transformOrigin:"top right"})),se("*",oe({opacity:1,transform:"scale(1) translateY(0)",transformOrigin:"top right"})),ve("void => *",[_e("150ms cubic-bezier(0.25, 0.8, 0.25, 1)")]),ve("* => void",[_e("100ms cubic-bezier(0.25, 0.8, 0.25, 1)")])])]}})};var ki=["setRepsInput"],wi=["expandedSetElement"],at=(n,t)=>({"border-red-500 dark:border-red-400":n,"border-gray-300 dark:border-gray-500":t}),Ei=n=>({"superset-spacing":n}),Ii=(n,t)=>({"absolute top-1 right-1 sm:static":n,"absolute top-2 right-2":t}),Ci=(n,t)=>({"text-m":n,"text-lg":t}),Ti=(n,t)=>({"sm:inline sm:mr-1":n,"block text-xs leading-tight":t}),Pi=(n,t)=>({"border-b border-orange-300 dark:border-orange-600":n,"border-b border-gray-200 dark:border-gray-600":t}),ei=()=>["warmup","dropset","failure","amrap","myorep","restpause"],Ri=(n,t)=>({"bg-gray-50 dark:bg-gray-700/50 text-gray-800 dark:text-gray-200":n,"cursor-default":t}),Wi=n=>({"bg-gray-100 dark:bg-gray-800/50":n});function Vi(n,t){if(n&1&&(s(0,"div",18),m(1),a()),n&2){let e=u();l(),C(" ",e.errorMessage(),`
`)}}function Fi(n,t){if(n&1){let e=I();s(0,"button",27),h("click",function(){x(e);let r=u(2);return f(r.enableEditMode())}),E(),s(1,"svg",25),b(2,"path",28),a(),m(3," EDIT "),a()}}function Di(n,t){if(n&1){let e=I();s(0,"div",19)(1,"button",20),h("click",function(){x(e);let r=u();return f(r.startCurrentWorkout())}),E(),s(2,"svg",21),b(3,"path",22),a(),m(4," START "),a(),_(5,Fi,4,0,"button",23),D(),s(6,"button",24),h("click",function(){x(e);let r=u();return f(r.deleteCurrentRoutine())}),E(),s(7,"svg",25),b(8,"path",26),a(),m(9," DELETE "),a()()}if(n&2){let e=u();l(5),p("ngIf",e.isViewMode)}}function Mi(n,t){n&1&&(s(0,"span"),m(1,"Routine name is required."),a())}function Li(n,t){if(n&1&&(s(0,"div",37),_(1,Mi,2,0,"span",13),a()),n&2){let e,i=u(2);l(),p("ngIf",(e=i.builderForm.get("name"))==null||e.errors==null?null:e.errors.required)}}function Oi(n,t){if(n&1&&(s(0,"option",38),m(1),a()),n&2){let e=t.$implicit;p("value",e.value),l(),C("",e.label," ")}}function Ai(n,t){if(n&1&&(te(0),s(1,"div")(2,"label",29),m(3,"Routine Name"),a(),b(4,"input",30),_(5,Li,2,1,"div",31),a(),s(6,"div")(7,"label",32),m(8,"Description (Optional)"),a(),b(9,"textarea",33),a(),s(10,"div")(11,"label",34),m(12,"Primary Goal"),a(),s(13,"select",35),_(14,Oi,2,2,"option",36),a()(),ie()),n&2){let e,i,r=u();l(4),p("ngClass",Q(3,at,((e=r.builderForm.get("name"))==null?null:e.invalid)&&((e=r.builderForm.get("name"))==null?null:e.touched),!((e=r.builderForm.get("name"))!=null&&e.invalid&&((e=r.builderForm.get("name"))!=null&&e.touched)))),l(),p("ngIf",((i=r.builderForm.get("name"))==null?null:i.invalid)&&(((i=r.builderForm.get("name"))==null?null:i.dirty)||((i=r.builderForm.get("name"))==null?null:i.touched))),l(9),p("ngForOf",r.routineGoals)}}function Ni(n,t){n&1&&(s(0,"span"),m(1,"Date is required."),a())}function Bi(n,t){if(n&1&&(s(0,"div",37),_(1,Ni,2,0,"span",13),a()),n&2){let e,i=u(2);l(),p("ngIf",(e=i.builderForm.get("workoutDate"))==null||e.errors==null?null:e.errors.required)}}function $i(n,t){n&1&&(s(0,"span"),m(1,"Start time is required."),a())}function Ui(n,t){if(n&1&&(s(0,"div",37),_(1,$i,2,0,"span",13),a()),n&2){let e,i=u(2);l(),p("ngIf",(e=i.builderForm.get("startTime"))==null||e.errors==null?null:e.errors.required)}}function Gi(n,t){n&1&&(s(0,"span"),m(1,"Min duration is 1."),a())}function ji(n,t){if(n&1&&(s(0,"div",37),_(1,Gi,2,0,"span",13),a()),n&2){let e,i=u(2);l(),p("ngIf",(e=i.builderForm.get("durationMinutes"))==null||e.errors==null?null:e.errors.min)}}function Hi(n,t){if(n&1&&(s(0,"option",38),m(1),a()),n&2){let e=t.$implicit;p("value",e.id),l(),V(e.name)}}function zi(n,t){if(n&1&&(te(0),s(1,"div",39)(2,"div")(3,"label",40),m(4,"Workout Date"),a(),b(5,"input",41),_(6,Bi,2,1,"div",31),a(),s(7,"div")(8,"label",42),m(9,"Start Time"),a(),b(10,"input",43),_(11,Ui,2,1,"div",31),a(),s(12,"div")(13,"label",44),m(14,"Duration (min)"),a(),b(15,"input",45),_(16,ji,2,1,"div",31),a()(),s(17,"div")(18,"label",46),m(19,"Workout Title (Optional)"),a(),b(20,"input",47),a(),s(21,"div")(22,"label",48),m(23,"Based on Routine (Optional)"),a(),s(24,"select",49)(25,"option",50),m(26,"-- Log Ad-hoc Exercises --"),a(),_(27,Hi,2,2,"option",36),a()(),s(28,"div")(29,"label",51),m(30,"Overall Notes (Optional)"),a(),b(31,"textarea",52),a(),ie()),n&2){let e,i,r,o,d,c,g=u();l(5),p("ngClass",Q(7,at,((e=g.builderForm.get("workoutDate"))==null?null:e.invalid)&&((e=g.builderForm.get("workoutDate"))==null?null:e.touched),!((e=g.builderForm.get("workoutDate"))!=null&&e.invalid&&((e=g.builderForm.get("workoutDate"))!=null&&e.touched)))),l(),p("ngIf",((i=g.builderForm.get("workoutDate"))==null?null:i.invalid)&&(((i=g.builderForm.get("workoutDate"))==null?null:i.dirty)||((i=g.builderForm.get("workoutDate"))==null?null:i.touched))),l(4),p("ngClass",Q(10,at,((r=g.builderForm.get("startTime"))==null?null:r.invalid)&&((r=g.builderForm.get("startTime"))==null?null:r.touched),!((r=g.builderForm.get("startTime"))!=null&&r.invalid&&((r=g.builderForm.get("startTime"))!=null&&r.touched)))),l(),p("ngIf",((o=g.builderForm.get("startTime"))==null?null:o.invalid)&&(((o=g.builderForm.get("startTime"))==null?null:o.dirty)||((o=g.builderForm.get("startTime"))==null?null:o.touched))),l(4),p("ngClass",Q(13,at,((d=g.builderForm.get("durationMinutes"))==null?null:d.invalid)&&((d=g.builderForm.get("durationMinutes"))==null?null:d.touched),!((d=g.builderForm.get("durationMinutes"))!=null&&d.invalid&&((d=g.builderForm.get("durationMinutes"))!=null&&d.touched)))),l(),p("ngIf",((c=g.builderForm.get("durationMinutes"))==null?null:c.invalid)&&(((c=g.builderForm.get("durationMinutes"))==null?null:c.dirty)||((c=g.builderForm.get("durationMinutes"))==null?null:c.touched))),l(11),p("ngForOf",g.availableRoutines)}}function qi(n,t){if(n&1){let e=I();s(0,"button",61),h("click",function(){x(e);let r=u(2);return f(r.openExerciseSelectionModal())}),m(1," + Add Exercise "),a()}}function Ji(n,t){if(n&1){let e=I();s(0,"button",77),h("click",function(){x(e);let r=u(5);return f(r.groupSelectedAsSuperset())}),m(1),a()}if(n&2){let e=u(5);p("disabled",e.isViewMode),l(),C(" Group Superset (",e.selectedExerciseIndicesForSuperset().length,") ")}}function Ki(n,t){if(n&1){let e=I();s(0,"button",78),h("click",function(){x(e);let r=u(2).index,o=u(3);return f(o.ungroupSuperset(r))}),m(1),a()}if(n&2){let e=u(5);p("disabled",e.isViewMode),l(),C(" Ungroup Superset (",e.selectedExerciseIndicesForSuperset().length,") ")}}function Yi(n,t){if(n&1&&(s(0,"div",74),_(1,Ji,2,2,"button",75)(2,Ki,2,2,"button",76),a()),n&2){let e=u(4);l(),p("ngIf",!e.canUngroupSelectedExercises()),l(),p("ngIf",e.canUngroupSelectedExercises())}}function Qi(n,t){if(n&1&&(s(0,"div",79),E(),s(1,"svg",80),b(2,"path",81),a()()),n&2){let e=u(4);p("ngClass",Q(1,Ii,e.isCompactView,!e.isCompactView&&(e.mode!=="routineBuilder"||!e.isEditMode||e.isViewMode)))}}function Zi(n,t){if(n&1){let e=I();s(0,"input",82),h("change",function(r){x(e);let o=u().index,d=u(3);return f(d.toggleExerciseSelectionForSuperset(o,r))}),a()}if(n&2){let e=u().index,i=u(3);p("id","superset-select-"+e)("checked",i.selectedExerciseIndicesForSuperset().includes(e))("disabled",i.isViewMode)}}function Xi(n,t){if(n&1&&(s(0,"span",87),m(1),a()),n&2){let e,i,r=u(2),o=r.$implicit,d=r.index,c=u(3);p("ngClass",Q(3,Ti,!c.isCompactView&&((e=c.expandedSetPath())==null?null:e.exerciseIndex)===d,c.isCompactView&&((e=c.expandedSetPath())==null?null:e.exerciseIndex)!==d)),l(),G(" Superset (",(((i=o.get("supersetOrder"))==null?null:i.value)??0)+1," of ",(i=o.get("supersetSize"))==null?null:i.value,") ")}}function er(n,t){if(n&1&&(s(0,"div",88),m(1),a()),n&2){let e=u(2).$implicit,i=u(3);l(),G(" ",i.getSetsFormArray(e).controls.length," ",i.getSetsFormArray(e).controls.length===1?"set":"sets"," ")}}function tr(n,t){if(n&1&&(s(0,"div",83)(1,"h3",84),_(2,Xi,2,6,"span",85),m(3),a(),_(4,er,2,2,"div",86),a()),n&2){let e,i,r,o,d=u(),c=d.$implicit,g=d.index,y=u(3);l(),p("ngClass",Q(4,Ci,y.isCompactView&&((e=y.expandedSetPath())==null?null:e.exerciseIndex)!==g,!y.isCompactView&&((e=y.expandedSetPath())==null?null:e.exerciseIndex)===g)),l(),p("ngIf",y.mode==="routineBuilder"&&((i=c.get("supersetId"))==null?null:i.value)),l(),C(" ",((r=c.get("exerciseName"))==null?null:r.value)||"Select Exercise"," "),l(),p("ngIf",(y.isCompactView||!y.isCompactView&&((o=y.expandedSetPath())==null?null:o.exerciseIndex)!==g)&&y.getSetsFormArray(c).controls.length>0)}}function ir(n,t){if(n&1){let e=I();s(0,"div",89)(1,"button",90),h("click",function(r){x(e);let o=u().index;return u(3).removeExercise(o),f(r.stopPropagation())}),E(),s(2,"svg",91),b(3,"rect",92)(4,"path",93),a()()()}}function rr(n,t){if(n&1&&(s(0,"span",106),m(1),a()),n&2){let e,i=u(2).$implicit;l(),G(" Superset (",(((e=i.get("supersetOrder"))==null?null:e.value)??0)+1," of ",(e=i.get("supersetSize"))==null?null:e.value,") ")}}function nr(n,t){if(n&1){let e=I();s(0,"div",107)(1,"label",108),m(2,"Rounds:"),a(),s(3,"input",109),h("change",function(){let r;x(e);let o=u(2),d=o.$implicit,c=o.index,g=u(3);return f(g.syncSupersetRounds((r=d.get("supersetId"))==null?null:r.value,(r=d.get("rounds"))==null?null:r.value,c))}),a()()}if(n&2){let e,i=u(2),r=i.$implicit,o=i.index,d=u(3);l(),p("for","rounds-"+o),l(2),p("id","rounds-"+o)("readonly",((e=r.get("supersetId"))==null?null:e.value)&&(((e=r.get("supersetOrder"))==null?null:e.value)??0)>0||d.isViewMode)}}function or(n,t){if(n&1){let e=I();s(0,"button",110),h("click",function(){x(e);let r=u(2).index,o=u(3);return f(o.removeExercise(r))}),E(),s(1,"svg",111),b(2,"rect",92)(3,"path",93),a(),m(4," Remove "),a()}}function sr(n,t){if(n&1){let e=I();s(0,"button",112),h("click",function(){x(e);let r=u(2).index,o=u(3);return f(o.ungroupSuperset(r))}),E(),s(1,"svg",113),b(2,"path",114),a(),m(3," Ungroup "),a()}if(n&2){let e=u(5);p("disabled",e.isViewMode)}}function ar(n,t){if(n&1){let e=I();s(0,"button",122),h("click",function(r){x(e);let o=u(3),d=o.$implicit,c=o.index;return u(3).addSet(d,c),f(r.stopPropagation())}),m(1," + Add Set "),a()}}function lr(n,t){if(n&1&&(s(0,"div",123)(1,"div",124),m(2,"#"),a(),s(3,"div",125),m(4,"Type"),a(),s(5,"div",126),m(6),a(),s(7,"div",125),m(8),a(),s(9,"div",124),m(10),a(),s(11,"div",126),m(12),a(),s(13,"div",124),m(14),a(),b(15,"div",127),a()),n&2){let e=u(6);l(6),V(e.mode==="manualLogEntry"?"Reps Ach.":"Reps"),l(2),G("",e.mode==="manualLogEntry"?"Wt Used":"Weight"," (",e.unitsService.getUnitLabel(),")"),l(2),V(e.mode==="manualLogEntry"?"Time Perf.":"Time"),l(2),V(e.mode==="routineBuilder"?"Rest":"Notes"),l(2),V(e.mode==="routineBuilder"?"Tempo":"")}}function dr(n,t){if(n&1&&(te(0),m(1),ie()),n&2){let e,i=u(2).$implicit;l(),C("",(e=i.get("restAfterSet"))==null?null:e.value,"s")}}function cr(n,t){if(n&1&&(te(0),m(1),ie()),n&2){let e,i=u(2).$implicit;l(),V(((e=i.get("notes"))==null?null:e.value)||"-")}}function ur(n,t){if(n&1&&(te(0),m(1),ie()),n&2){let e,i=u(2).$implicit;l(),V(((e=i.get("tempo"))==null?null:e.value)||"-")}}function mr(n,t){if(n&1){let e=I();s(0,"div",139)(1,"button",140),h("click",function(r){x(e);let o=u(2).index,d=u(3),c=d.$implicit,g=d.index;return u(3).removeSet(c,g,o),f(r.stopPropagation())}),E(),s(2,"svg",91),b(3,"rect",92)(4,"path",93),a()()()}}function pr(n,t){n&1&&b(0,"div",127)}function gr(n,t){if(n&1){let e=I();s(0,"div",131),h("click",function(r){x(e);let o=u().index,d=u(3).index,c=u(3);return f(c.toggleSetExpansion(d,o,r))}),s(1,"div",132),m(2),a(),s(3,"div",133),O(4,"titlecase"),m(5),O(6,"titlecase"),a(),s(7,"div",134),m(8),a(),s(9,"div",134),m(10),O(11,"weightUnit"),a(),s(12,"div",135),m(13),a(),s(14,"div",133),_(15,dr,2,1,"ng-container",13)(16,cr,2,1,"ng-container",13),a(),s(17,"div",136),_(18,ur,2,1,"ng-container",13),a(),_(19,mr,5,0,"div",137)(20,pr,1,0,"div",138),a()}if(n&2){let e,i,r,o,d,c,g,y,v=u(),k=v.$implicit,P=v.index,S=u(6);p("ngClass",Q(22,Ri,!ft(21,ei).includes(((e=k.get("type"))==null?null:e.value)??"")&&!S.isViewMode,S.isViewMode)),l(2),V(P+1),l(),p("title",$(4,14,(i=k.get("type"))==null?null:i.value)),l(2),V($(6,16,(r=k.get("type"))==null?null:r.value)||"Standard"),l(3),V((o=k.get(S.mode==="manualLogEntry"?"repsAchieved":"reps"))==null?null:o.value??"-"),l(2),V(Z(11,18,(d=k.get(S.mode==="manualLogEntry"?"weightUsed":"weight"))==null?null:d.value,"1.0-2")),l(3),V((c=k.get(S.mode==="manualLogEntry"?"durationPerformed":"duration"))!=null&&c.value?((c=k.get(S.mode==="manualLogEntry"?"durationPerformed":"duration"))==null?null:c.value)+"s":"-"),l(),p("title",S.mode==="routineBuilder"?((g=k.get("restAfterSet"))==null?null:g.value)+"s":(g=k.get("notes"))==null?null:g.value),l(),p("ngIf",S.mode==="routineBuilder"),l(),p("ngIf",S.mode==="manualLogEntry"),l(),p("title",(y=k.get("tempo"))==null?null:y.value),l(),p("ngIf",S.mode==="routineBuilder"),l(),p("ngIf",!S.isViewMode),l(),p("ngIf",S.isViewMode)}}function xr(n,t){if(n&1&&(s(0,"option",38),m(1),a()),n&2){let e=t.$implicit;p("value",e.value),l(),V(e.label)}}function fr(n,t){if(n&1&&(s(0,"div")(1,"label",144),m(2,"Tempo"),a(),b(3,"input",155),a()),n&2){let e=u(2).index,i=u(3).index,r=u(3);l(),p("for","tempo-exp-"+i+"-"+e),l(2),p("id","tempo-exp-"+i+"-"+e)("readonly",r.isViewMode)}}function hr(n,t){if(n&1&&(s(0,"div")(1,"label",144),m(2,"Rest (s)"),a(),b(3,"input",156),a()),n&2){let e=u(2).index,i=u(3).index,r=u(3);l(),p("for","rest-exp-"+i+"-"+e),l(2),p("id","rest-exp-"+i+"-"+e)("readonly",r.isViewMode)}}function _r(n,t){if(n&1){let e=I();s(0,"div",141,0)(2,"div",142)(3,"div",143)(4,"label",144),m(5,"Set Type"),a(),s(6,"select",145),_(7,xr,2,2,"option",36),a()(),s(8,"div")(9,"label",144),m(10),a(),b(11,"input",146),a(),s(12,"div")(13,"label",144),m(14),a(),b(15,"input",147),a(),s(16,"div")(17,"label",144),m(18),a(),b(19,"input",148),a(),_(20,fr,4,3,"div",13)(21,hr,4,3,"div",13),s(22,"div",149)(23,"label",144),m(24,"Set Notes"),a(),b(25,"input",150),a()(),s(26,"div",151)(27,"button",152),h("click",function(r){x(e);let o=u(7);return f(o.collapseExpandedSet(!1,r))}),E(),s(28,"svg",153),b(29,"path",154),a()()()()}if(n&2){let e,i=u(),r=i.$implicit,o=i.index,d=u(3).index,c=u(3);p("ngClass",he(27,Wi,!ft(26,ei).includes(((e=r.get("type"))==null?null:e.value)??""))),l(4),p("for","setType-exp-"+d+"-"+o),l(2),p("id","setType-exp-"+d+"-"+o)("disabled",c.isViewMode),l(),p("ngForOf",c.availableSetTypes),l(2),p("for","reps-exp-"+d+"-"+o),l(),C("Reps ",c.mode==="manualLogEntry"?"(Achieved)":""),l(),p("id","reps-exp-"+d+"-"+o)("formControlName",c.mode==="manualLogEntry"?"repsAchieved":"reps")("readonly",c.isViewMode),l(2),p("for","weight-exp-"+d+"-"+o),l(),G("Weight (",c.unitsService.getUnitLabel(),") ",c.mode==="manualLogEntry"?"(Used)":""),l(),p("id","weight-exp-"+d+"-"+o)("formControlName",c.mode==="manualLogEntry"?"weightUsed":"weight")("readonly",c.isViewMode),l(2),p("for","duration-exp-"+d+"-"+o),l(),C("Time (s) ",c.mode==="manualLogEntry"?"(Performed)":""),l(),p("id","duration-exp-"+d+"-"+o)("formControlName",c.mode==="manualLogEntry"?"durationPerformed":"duration")("readonly",c.isViewMode),l(),p("ngIf",c.mode==="routineBuilder"),l(),p("ngIf",c.mode==="routineBuilder"),l(2),p("for","setNotes-exp-"+d+"-"+o),l(2),p("id","setNotes-exp-"+d+"-"+o)("readonly",c.isViewMode)}}function vr(n,t){if(n&1&&(s(0,"div",128),_(1,gr,21,25,"div",129)(2,_r,30,29,"div",130),a()),n&2){let e=t.index,i=u(3).index,r=u(3);p("formGroupName",e),l(),p("ngIf",!r.isSetExpanded(i,e)),l(),p("ngIf",r.isSetExpanded(i,e))}}function Sr(n,t){if(n&1&&(s(0,"div",115)(1,"div",116)(2,"h4",117),m(3,"Sets:"),a(),_(4,ar,2,0,"button",118),a(),s(5,"div",119),_(6,lr,16,6,"div",120)(7,vr,3,3,"div",121),a()()),n&2){let e,i=u(2),r=i.$implicit,o=i.index,d=u(3);l(4),p("ngIf",!d.isViewMode),l(2),p("ngIf",d.getSetsFormArray(r).controls.length>0&&((e=d.expandedSetPath())==null?null:e.exerciseIndex)!==o),l(),p("ngForOf",d.getSetsFormArray(r).controls)}}function yr(n,t){if(n&1&&(s(0,"div",94)(1,"div",95)(2,"div",96)(3,"h3",97),_(4,rr,2,2,"span",98),m(5),a()(),s(6,"div",99),_(7,nr,4,3,"div",100)(8,or,5,0,"button",101)(9,sr,4,1,"button",102),a()(),s(10,"div")(11,"label",103),m(12),a(),b(13,"textarea",104),a(),_(14,Sr,8,3,"div",105),a()),n&2){let e,i,r,o,d,c=u(),g=c.$implicit,y=c.index,v=u(3);l(),p("ngClass",Q(11,Pi,v.mode==="routineBuilder"&&((e=g.get("supersetId"))==null?null:e.value)&&(((e=g.get("supersetOrder"))==null?null:e.value)??-1)<(((e=g.get("supersetSize"))==null?null:e.value)??0)-1,!(v.mode==="routineBuilder"&&((e=g.get("supersetId"))!=null&&e.value))||v.mode==="routineBuilder"&&(((e=g.get("supersetOrder"))==null?null:e.value)??-1)===(((e=g.get("supersetSize"))==null?null:e.value)??0)-1)),l(3),p("ngIf",v.mode==="routineBuilder"&&((i=g.get("supersetId"))==null?null:i.value)),l(),C(" ",((r=g.get("exerciseName"))==null?null:r.value)||"Select Exercise"," "),l(2),p("ngIf",v.mode==="routineBuilder"&&((o=g.get("supersetId"))==null?null:o.value)),l(),p("ngIf",!v.isViewMode),l(),p("ngIf",v.mode==="routineBuilder"&&v.isEditMode&&((d=g.get("supersetId"))==null?null:d.value)),l(2),p("for","exerciseNotes-"+y),l(),C(" ",v.mode==="routineBuilder"?"Exercise Notes (Optional)":"Notes for this Logged Exercise (Optional)"," "),l(),p("id","exerciseNotes-"+y)("readonly",v.isViewMode),l(),p("ngIf",!v.isCompactView)}}function br(n,t){if(n&1){let e=I();s(0,"button",157),h("click",function(r){x(e);let o=u(4);return f(o.collapseExpandedSet(!0,r))}),E(),s(1,"svg",153),b(2,"path",154),a()()}}function kr(n,t){if(n&1){let e=I();te(0),s(1,"div",64),h("click",function(r){let o=x(e).index,d=u(3);return f(d.toggleSetExpansion(o,0,r))}),_(2,Yi,3,2,"div",65),s(3,"div",66)(4,"div",67),_(5,Qi,3,4,"div",68)(6,Zi,1,3,"input",69)(7,tr,5,7,"div",70)(8,ir,5,0,"div",71),a(),_(9,yr,15,14,"div",72)(10,br,3,0,"button",73),a()(),ie()}if(n&2){let e,i,r,o,d=t.$implicit,c=t.index,g=u(3);l(),p("ngClass",he(12,Ei,g.isSupersetSpacing(c))),l(),p("ngIf",g.mode==="routineBuilder"&&g.isEditMode&&g.selectedExerciseIndicesForSuperset().length>=2&&c===g.firstSelectedExerciseIndexForSuperset),l(),p("cdkDragDisabled",g.mode!=="routineBuilder"||g.isViewMode||!g.isEditMode)("cdkDragData",d)("formGroupName",c)("ngClass",g.getExerciseCardClasses(d,c)),l(2),p("ngIf",g.mode==="routineBuilder"&&g.isEditMode&&!g.isViewMode),l(),p("ngIf",g.mode==="routineBuilder"&&g.isEditMode&&!g.isViewMode),l(),p("ngIf",g.isCompactView||!g.isCompactView&&((e=g.expandedSetPath())==null?null:e.exerciseIndex)!==c),l(),p("ngIf",(g.isCompactView||!g.isCompactView&&((i=g.expandedSetPath())==null?null:i.exerciseIndex)!==c)&&!g.isViewMode),l(),p("ngIf",((r=g.expandedSetPath())==null?null:r.exerciseIndex)===c),l(),p("ngIf",!g.isCompactView&&((o=g.expandedSetPath())==null?null:o.exerciseIndex)===c)}}function wr(n,t){if(n&1){let e=I();s(0,"div",62),h("cdkDropListDropped",function(r){x(e);let o=u(2);return f(o.onExerciseDrop(r))}),_(1,kr,11,14,"ng-container",63),a()}if(n&2){let e=u(2);p("cdkDropListData",e.exercisesFormArray.controls)("cdkDropListDisabled",e.mode!=="routineBuilder"||e.isViewMode),l(),p("ngForOf",e.exercisesFormArray.controls)}}function Er(n,t){if(n&1){let e=I();s(0,"div",158)(1,"p",159),m(2,"No exercises added yet."),a(),s(3,"button",160),h("click",function(){x(e);let r=u(2);return f(r.openExerciseSelectionModal())}),m(4," + Add First Exercise "),a()()}}function Ir(n,t){if(n&1){let e=I();s(0,"div",158)(1,"p",159),m(2,"Select a routine or add exercises manually to log."),a(),s(3,"button",160),h("click",function(){x(e);let r=u(2);return f(r.openExerciseSelectionModal())}),m(4," + Add First Exercise to Log "),a()()}}function Cr(n,t){n&1&&(s(0,"div",161),m(1," The selected routine has no exercises. Add them manually or edit the routine template. "),a())}function Tr(n,t){if(n&1){let e=I();s(0,"div",162)(1,"button",163),h("click",function(){x(e);let r=u(2);return f(r.openExerciseSelectionModal())}),E(),s(2,"svg",164),b(3,"path",165),a(),m(4," Add Another Exercise "),a()()}}function Pr(n,t){if(n&1&&(s(0,"section",53)(1,"div",54)(2,"h2",55),m(3),a(),_(4,qi,2,0,"button",56),a(),_(5,wr,2,3,"div",57)(6,Er,5,0,"div",58)(7,Ir,5,0,"div",58)(8,Cr,2,0,"div",59)(9,Tr,5,0,"div",60),a()),n&2){let e,i,r,o=u();l(3),V(o.mode==="routineBuilder"?"Exercises":"Logged Exercises"),l(),p("ngIf",!o.isViewMode&&(!o.exercisesFormArray.controls||o.exercisesFormArray.controls.length>0)),l(),p("ngIf",o.exercisesFormArray.length>0),l(),p("ngIf",!o.isViewMode&&o.exercisesFormArray.length===0&&o.mode==="routineBuilder"&&((e=o.builderForm.get("goal"))==null?null:e.value)!=="rest"),l(),p("ngIf",o.mode==="manualLogEntry"&&o.exercisesFormArray.length===0&&!((i=o.builderForm.get("routineIdForLog"))!=null&&i.value)),l(),p("ngIf",o.mode==="manualLogEntry"&&o.exercisesFormArray.length===0&&((r=o.builderForm.get("routineIdForLog"))==null?null:r.value)),l(),p("ngIf",!o.isViewMode&&o.exercisesFormArray.length>0)}}function Rr(n,t){n&1&&(s(0,"section",166)(1,"p",167),m(2,"This is a rest day routine. No exercises are needed."),a()())}function Wr(n,t){if(n&1&&(s(0,"div",168)(1,"button",169),m(2," Cancel "),a(),s(3,"button",170),m(4),a()()),n&2){let e,i=u();l(),p("routerLink",i.mode==="routineBuilder"?"/workout":"/history/list"),l(2),p("disabled",i.builderForm.invalid||i.exercisesFormArray.length===0&&!(i.mode==="routineBuilder"&&((e=i.builderForm.get("goal"))==null?null:e.value)==="rest")),l(),C(" ",i.mode==="routineBuilder"?i.isNewMode?"CREATE ROUTINE":"SAVE CHANGES":i.isNewMode?"Log Workout":"Save Log Changes"," ")}}function Vr(n,t){if(n&1){let e=I();s(0,"li",188),h("click",function(){let r=x(e).$implicit,o=u(2);return f(o.mode==="routineBuilder"?o.selectExercise(r):o.selectExerciseForLog(r))}),s(1,"div")(2,"span",189),m(3),a(),s(4,"span",190),m(5),O(6,"titlecase"),O(7,"titlecase"),a()(),E(),s(8,"svg",191),b(9,"path",192),a()()}if(n&2){let e=t.$implicit;l(3),V(e.name),l(2),G("",$(6,3,e.category)," - ",$(7,5,e.primaryMuscleGroup))}}function Fr(n,t){n&1&&(s(0,"li",193),m(1,"No exercises match your search or library is empty."),a())}function Dr(n,t){if(n&1){let e=I();s(0,"div",171),h("click",function(){x(e);let r=u();return f(r.closeExerciseSelectionModal())}),s(1,"div",172),h("click",function(r){return x(e),f(r.stopPropagation())}),s(2,"div",173)(3,"div",174)(4,"h3",175),m(5,"Add Exercise"),a(),s(6,"button",176),h("click",function(){x(e);let r=u();return f(r.closeExerciseSelectionModal())}),E(),s(7,"svg",177),b(8,"path",178),a()()(),D(),s(9,"div",179)(10,"input",180),h("ngModelChange",function(r){x(e);let o=u();return f(o.modalSearchTerm.set(r))}),a()(),s(11,"div",181)(12,"ul",115),_(13,Vr,10,7,"li",182)(14,Fr,2,0,"li",183),a()(),s(15,"div",184)(16,"button",185),h("click",function(){x(e);let r=u();return f(r.handleTrulyCustomExerciseEntry())}),m(17," Or, create a new custom exercise entry... "),a()()(),s(18,"div",186)(19,"button",187),h("click",function(){x(e);let r=u();return f(r.closeExerciseSelectionModal())}),m(20,"Cancel"),a()()()()}if(n&2){let e=u();l(10),p("ngModel",e.modalSearchTerm()),l(3),p("ngForOf",e.filteredAvailableExercises()),l(),p("ngIf",e.filteredAvailableExercises().length===0)}}var ae=class n{fb=R(et);router=R(ue);route=R(we);workoutService=R(Te);exerciseService=R(pe);unitsService=R(Re);spinnerService=R(nt);alertService=R(Ce);toastService=R(Pe);trackingService=R(me);cdr=R(je);platformId=R(ye);setRepsInputs;expandedSetElements;builderForm;mode="routineBuilder";isEditMode=!1;isNewMode=!0;isViewMode=!1;currentRoutineId=null;currentLogId=null;routeSub;initialRoutineIdForLogEdit=void 0;isCompactView=!0;expandedSetPath=T(null);availableSetTypes=[{value:"standard",label:"Standard"},{value:"warmup",label:"Warm-up"},{value:"superset",label:"Superset"},{value:"amrap",label:"AMRAP"},{value:"dropset",label:"Dropset"},{value:"failure",label:"To Failure"},{value:"myorep",label:"Myo-rep"},{value:"restpause",label:"Rest-Pause"},{value:"custom",label:"Custom Type"}];routineGoals=[{value:"hypertrophy",label:"Hypertrophy"},{value:"strength",label:"Strength"},{value:"muscular endurance",label:"Muscular endurance"},{value:"cardiovascular endurance",label:"Cardiovascular endurance"},{value:"fat loss / body composition",label:"Fat loss / body composition"},{value:"mobility & flexibility",label:"Mobility & flexibility"},{value:"power / explosiveness",label:"Power / explosiveness"},{value:"speed & agility",label:"Speed & agility"},{value:"balance & coordination",label:"Balance & coordination"},{value:"skill acquisition",label:"Skill acquisition"},{value:"rehabilitation / injury prevention",label:"Rehabilitation / injury prevention"},{value:"mental health / stress relief",label:"Mental health"},{value:"general health & longevity",label:"General health & longevity"},{value:"sport-specific performance",label:"Sport-specific performance"},{value:"maintenance",label:"Maintenance"},{value:"rest",label:"Rest"},{value:"custom",label:"Custom"}];isExerciseModalOpen=!1;availableExercises=[];availableRoutines=[];modalSearchTerm=T("");filteredAvailableExercises=B(()=>{let t=this.modalSearchTerm().toLowerCase();return t?this.availableExercises.filter(e=>e.name.toLowerCase().includes(t)||e.category.toLowerCase().includes(t)||e.primaryMuscleGroup&&e.primaryMuscleGroup.toLowerCase().includes(t)):this.availableExercises});selectedExerciseIndicesForSuperset=T([]);constructor(){this.builderForm=this.fb.group({name:[""],description:[""],goal:["custom"],workoutDate:[""],startTime:[""],durationMinutes:[60,[A.min(1)]],overallNotesLog:[""],routineIdForLog:[""],exercises:this.fb.array([])})}ngOnInit(){q(this.platformId)&&window.scrollTo(0,0),this.loadAvailableExercises(),this.workoutService.routines$.pipe(z(1)).subscribe(t=>this.availableRoutines=t),this.routeSub=this.route.data.pipe(Se(t=>{if(this.mode=t.mode||"routineBuilder",this.isNewMode=t.isNew===!0,console.log(`Builder ngOnInit: Mode=${this.mode}, isNewMode=${this.isNewMode}`),this.currentRoutineId=this.route.snapshot.paramMap.get("routineId"),this.currentLogId=this.route.snapshot.paramMap.get("logId"),this.isViewMode=this.mode==="routineBuilder"&&!!this.currentRoutineId&&!this.isNewMode&&this.route.snapshot.routeConfig?.path?.includes("view")||!1,this.isEditMode=!this.isNewMode&&!this.isViewMode,this.configureFormValidatorsAndFieldsForMode(),this.expandedSetPath.set(null),this.exercisesFormArray.clear({emitEvent:!1}),this.builderForm.reset(this.getDefaultFormValuesForMode(),{emitEvent:!1}),this.mode==="routineBuilder"){if(this.currentRoutineId&&(this.isEditMode||this.isViewMode))return this.workoutService.getRoutineById(this.currentRoutineId)}else if(this.mode==="manualLogEntry"){if(this.currentLogId&&this.isEditMode)return this.trackingService.getWorkoutLogById(this.currentLogId);if(this.currentRoutineId&&this.isNewMode)return this.workoutService.getRoutineById(this.currentRoutineId)}return ge(null)}),xe(t=>{t?this.mode==="routineBuilder"?this.patchFormWithRoutineData(t):this.mode==="manualLogEntry"&&this.isEditMode&&this.currentLogId?this.patchFormWithLogData(t):this.mode==="manualLogEntry"&&this.isNewMode&&this.currentRoutineId&&this.prefillLogFormFromRoutine(t):!this.isNewMode&&(this.currentRoutineId||this.currentLogId)&&(this.toastService.error("Data not found.",0,"Error"),this.router.navigate([this.mode==="routineBuilder"?"/workout":"/history/list"])),this.isViewMode?this.toggleFormState(!0):this.toggleFormState(!1)})).subscribe(),this.mode==="manualLogEntry"&&this.builderForm.get("routineIdForLog")?.valueChanges.subscribe(t=>{if(this.isEditMode&&t===this.initialRoutineIdForLogEdit&&!this.builderForm.get("routineIdForLog")?.dirty)return;let e=this.availableRoutines.find(i=>i.id===t);e?this.prefillLogFormFromRoutine(e,!1):(this.exercisesFormArray.clear(),this.isEditMode||this.builderForm.get("name")?.setValue("Ad-hoc Workout"))}),this.builderForm.get("goal")?.valueChanges.subscribe(t=>{if(this.mode==="routineBuilder"&&t==="rest"){for(;this.exercisesFormArray.length;)this.exercisesFormArray.removeAt(0);this.exercisesFormArray.clearValidators()}this.exercisesFormArray.updateValueAndValidity()})}getDefaultFormValuesForMode(){if(this.mode==="manualLogEntry"){let t=new Date;return{name:"",description:"",goal:"custom",workoutDate:j(t,"yyyy-MM-dd"),startTime:j(t,"HH:mm"),durationMinutes:60,overallNotesLog:"",routineIdForLog:"",exercises:[]}}else return{name:"",description:"",goal:"custom",workoutDate:"",startTime:"",durationMinutes:60,overallNotesLog:"",routineIdForLog:"",exercises:[]}}configureFormValidatorsAndFieldsForMode(){let t=this.builderForm.get("name"),e=this.builderForm.get("goal"),i=this.builderForm.get("workoutDate"),r=this.builderForm.get("startTime"),o=this.builderForm.get("durationMinutes");t?.clearValidators(),e?.clearValidators(),i?.clearValidators(),r?.clearValidators(),o?.clearValidators(),this.mode==="routineBuilder"?(t?.setValidators(A.required),e?.setValidators(A.required),this.builderForm.get("exercises")?.setValidators(A.nullValidator)):(i?.setValidators(A.required),r?.setValidators(A.required),o?.setValidators([A.required,A.min(1)]),this.builderForm.get("exercises")?.setValidators(A.required)),this.builderForm.updateValueAndValidity({emitEvent:!1})}toggleFormState(t){t?this.builderForm.disable({emitEvent:!1}):(this.builderForm.enable({emitEvent:!1}),this.mode==="routineBuilder"?(this.builderForm.get("workoutDate")?.disable({emitEvent:!1}),this.builderForm.get("startTime")?.disable({emitEvent:!1}),this.builderForm.get("durationMinutes")?.disable({emitEvent:!1}),this.builderForm.get("overallNotesLog")?.disable({emitEvent:!1}),this.builderForm.get("routineIdForLog")?.disable({emitEvent:!1})):(this.builderForm.get("description")?.disable({emitEvent:!1}),this.builderForm.get("goal")?.disable({emitEvent:!1})),this.exercisesFormArray.controls.forEach(e=>{this.updateRoundsControlability(e)}))}get exercisesFormArray(){return this.builderForm.get("exercises")}getSetsFormArray(t){return t.get("sets")}loadAvailableExercises(){this.exerciseService.getExercises().pipe(z(1)).subscribe(t=>this.availableExercises=t)}patchFormWithRoutineData(t){this.builderForm.patchValue({name:t.name,description:t.description,goal:t.goal},{emitEvent:!1}),this.exercisesFormArray.clear({emitEvent:!1}),t.exercises.forEach(e=>{this.exercisesFormArray.push(this.createExerciseFormGroup(e,!0,!1),{emitEvent:!1})}),this.builderForm.markAsPristine()}patchFormWithLogData(t){this.initialRoutineIdForLogEdit=t.routineId,this.builderForm.patchValue({name:t.routineName||"Logged Workout",workoutDate:j(vt(t.date),"yyyy-MM-dd"),startTime:j(new Date(t.startTime),"HH:mm"),durationMinutes:t.durationMinutes||60,overallNotesLog:t.notes||"",routineIdForLog:t.routineId||""},{emitEvent:!1}),this.exercisesFormArray.clear({emitEvent:!1}),t.exercises.forEach(e=>{this.exercisesFormArray.push(this.createExerciseFormGroupFromLog(e),{emitEvent:!1})}),this.toggleFormState(!1),this.expandedSetPath.set(null),this.builderForm.markAsPristine()}prefillLogFormFromRoutine(t,e=!0){let i={name:`Log: ${t.name}`,routineIdForLog:t.id};if(e){let r=new Date;i.workoutDate=j(r,"yyyy-MM-dd"),i.startTime=j(r,"HH:mm"),i.durationMinutes=60}this.builderForm.patchValue(i,{emitEvent:!1}),this.exercisesFormArray.clear({emitEvent:!1}),t.exercises.forEach(r=>{this.exercisesFormArray.push(this.createExerciseFormGroup(r,!1,!0),{emitEvent:!1})}),this.builderForm.markAsDirty()}createExerciseFormGroup(t,e=!1,i=!1){let r=t?.exerciseId?this.availableExercises.find(c=>c.id===t.exerciseId):null,o=t?.sets||[],d=this.fb.group({id:[t?.id||this.workoutService.generateWorkoutExerciseId()],exerciseId:[t?.exerciseId||"",A.required],exerciseName:[t?.exerciseName||r?.name||"Select Exercise"],notes:[t?.notes||""],sets:this.fb.array(o.map(c=>this.createSetFormGroup(c,i))),supersetId:[e?t?.supersetId:null],supersetOrder:[e?t?.supersetOrder:null],supersetSize:[e?t?.supersetSize:null],rounds:[e?t?.rounds??0:0,[A.min(0)]]});return e?(d.get("supersetId")?.valueChanges.subscribe(()=>this.updateRoundsControlability(d)),d.get("supersetOrder")?.valueChanges.subscribe(()=>this.updateRoundsControlability(d)),this.updateRoundsControlability(d)):d.get("rounds")?.enable({emitEvent:!1}),d.get("exerciseId")?.valueChanges.subscribe(c=>{let g=this.availableExercises.find(y=>y.id===c);d.get("exerciseName")?.setValue(g?.name||"Unknown Exercise",{emitEvent:!1})}),d}createExerciseFormGroupFromLog(t){return this.fb.group({id:[t.exerciseId||N()],exerciseId:[t.exerciseId,A.required],exerciseName:[t.exerciseName,A.required],notes:[t.notes||""],sets:this.fb.array(t.sets.map(e=>this.createSetFormGroup(e,!0))),supersetId:[null],supersetOrder:[null],supersetSize:[null],rounds:[0]})}createSetFormGroup(t,e=!1){let i,r,o,d,c,g,y,v=N(),k,P=new Date().toISOString();if(t)if(v=t.id||v,"repsAchieved"in t){let w=t;i=w.repsAchieved,r=w.weightUsed,o=w.durationPerformed,d=w.notes,c=w.type||"standard",k=w.plannedSetId,P=w.timestamp,g=w.targetTempo||"",y=60}else{let w=t;i=w.reps,r=w.weight,o=w.duration,d=w.notes,c=w.type||"standard",g=w.tempo,y=w.restAfterSet,k=w.id}else i=null,r=null,o=null,d="",c="standard",g="",y=60;let S={id:[v],type:[c,A.required],notes:[d||""]};return e?(S.repsAchieved=[i??null,[A.required,A.min(0)]],S.weightUsed=[this.unitsService.convertFromKg(r,this.unitsService.currentUnit())??null,[A.min(0)]],S.durationPerformed=[o??null,[A.min(0)]],S.plannedSetId=[k],S.timestamp=[P]):(S.reps=[i??null,[A.min(0)]],S.weight=[this.unitsService.convertFromKg(r,this.unitsService.currentUnit())??null,[A.min(0)]],S.duration=[o??null,[A.min(0)]],S.tempo=[g||""],S.restAfterSet=[y??60,[A.required,A.min(0)]]),this.fb.group(S)}openExerciseSelectionModal(){this.isViewMode||(this.modalSearchTerm.set(""),this.isExerciseModalOpen=!0)}closeExerciseSelectionModal(){this.isExerciseModalOpen=!1}onModalSearchTermChange(t){let e=t.target;this.modalSearchTerm.set(e.value)}selectExercise(t){let e=this.createExerciseFormGroup({id:this.workoutService.generateWorkoutExerciseId(),exerciseId:t.id,exerciseName:t.name,sets:[{id:this.workoutService.generateExerciseSetId(),type:"standard",reps:8,weight:0,restAfterSet:60,duration:void 0,tempo:"",notes:""}],supersetId:null,supersetOrder:null,supersetSize:null,rounds:0,type:"standard"},!0,!1);this.exercisesFormArray.push(e),this.closeExerciseSelectionModal(),this.toggleSetExpansion(this.exercisesFormArray.length-1,0)}selectExerciseForLog(t){let e={id:this.workoutService.generateWorkoutExerciseId(),exerciseId:t.id,exerciseName:t.name,sets:[{id:this.workoutService.generateExerciseSetId(),type:"standard",reps:8,weight:0,restAfterSet:60,duration:void 0,tempo:"",notes:""}],type:"standard",supersetId:null,supersetOrder:null,supersetSize:null,rounds:0};this.exercisesFormArray.push(this.createExerciseFormGroup(e,!1,!0)),this.closeExerciseSelectionModal()}ngAfterViewInit(){this.expandedSetElements.changes.subscribe(t=>{t.first&&this.expandedSetPath()&&setTimeout(()=>{t.first.nativeElement.scrollIntoView({behavior:"smooth",block:"center"})},0)})}addSet(t,e){if(this.isViewMode)return;let i=this.getSetsFormArray(t),r;if(i.length>0){let d=i.at(i.length-1).value,c=U({},d);if(delete c.id,this.mode==="manualLogEntry"){let g=t.get("exerciseId")?.value;r=this.createSetFormGroup({id:c.id??this.workoutService.generateExerciseSetId(),exerciseId:g,exerciseName:c.exerciseName,repsAchieved:c.repsAchieved,weightUsed:c.weightUsed,durationPerformed:c.durationPerformed,notes:c.notes,type:c.type,plannedSetId:c.plannedSetId,timestamp:new Date().toISOString(),targetReps:c.targetReps,targetWeight:c.targetWeight,targetDuration:c.targetDuration,targetTempo:c.targetTempo},!0)}else r=this.createSetFormGroup({id:c.id??this.workoutService.generateExerciseSetId(),reps:c.reps,weight:c.weight,duration:c.duration,notes:c.notes,type:c.type,tempo:c.tempo,restAfterSet:c.restAfterSet},!1)}else r=this.createSetFormGroup(void 0,this.mode==="manualLogEntry");i.push(r),this.cdr.detectChanges();let o=i.length-1;this.toggleSetExpansion(e,o)}removeSet(t,e,i,r){if(r?.stopPropagation(),this.isViewMode)return;this.getSetsFormArray(t).removeAt(i);let d=this.expandedSetPath();d&&d.exerciseIndex===e&&d.setIndex===i?this.expandedSetPath.set(null):d&&d.exerciseIndex===e&&d.setIndex>i&&this.expandedSetPath.set({exerciseIndex:e,setIndex:d.setIndex-1})}toggleSetExpansion(t,e,i){if(i?.stopPropagation(),i&&(i.target instanceof HTMLInputElement||i.target instanceof HTMLTextAreaElement||i.target instanceof HTMLSelectElement))return;if(this.isViewMode&&!(this.expandedSetPath()?.exerciseIndex===t&&this.expandedSetPath()?.setIndex===e)){this.expandedSetPath.set({exerciseIndex:t,setIndex:e}),this.isCompactView=!1;return}else if(this.isViewMode){this.expandedSetPath.set(null);return}let r=this.expandedSetPath();if(r?.exerciseIndex===t&&r?.setIndex===e){if(this.expandedSetPath.set(null),!this.isCompactView)return}else this.expandedSetPath.set({exerciseIndex:t,setIndex:e}),this.isCompactView=!1,this.cdr.detectChanges(),setTimeout(()=>{let o=this.expandedSetElements.first?.nativeElement;if(o){let d=o.querySelector('input[type="text"], input[type="number"]');d&&d.focus()}},50)}isSetExpanded(t,e){let i=this.expandedSetPath();return i?.exerciseIndex===t&&i?.setIndex===e}collapseExpandedSet(t=!1,e){this.expandedSetPath.set(null),this.isCompactView=t,e?.stopPropagation()}getFormErrors(t){let e={};return Object.keys(t.controls).forEach(i=>{let r=t.get(i).errors;if(r&&(e[i]=r),t.get(i)instanceof Lt||t.get(i)instanceof Gt){let o=this.getFormErrors(t.get(i));Object.keys(o).length>0&&(e[i]=o)}}),e}get f(){return this.builderForm.controls}toggleExerciseSelectionForSuperset(t,e){if(this.isViewMode)return;let i=e.target;this.selectedExerciseIndicesForSuperset.update(r=>{let o;return i.checked?o=r.includes(t)?r:[...r,t]:o=r.filter(d=>d!==t),o.sort((d,c)=>d-c)}),this.isCompactView}canGroupSelectedExercises(){let t=this.selectedExerciseIndicesForSuperset();if(t.length<2)return!1;let e=this.exercisesFormArray.at(t[0]).get("supersetId")?.value;for(let i=1;i<t.length;i++){let r=t[i],o=this.exercisesFormArray.at(r).get("supersetId")?.value;if(e&&o&&e!==o||!e&&o)return!1}return!0}canUngroupSelectedExercises(){let t=this.selectedExerciseIndicesForSuperset();if(t.length===0)return!1;let e=Array.from(new Set(t.map(r=>this.exercisesFormArray.at(r).get("supersetId")?.value).filter(r=>!!r)));return Array.from(new Set(e)).length===1}onExerciseDrop(t){if(!this.isViewMode&&t.previousContainer===t.container){let e=this.exercisesFormArray;zt(e.controls,t.previousIndex,t.currentIndex),e.updateValueAndValidity(),this.selectedExerciseIndicesForSuperset.set([]),this.handleSupersetIntegrityAfterDrag(t.previousIndex,t.currentIndex),this.recalculateSupersetOrders(),this.expandedSetPath.set(null)}}handleSupersetIntegrityAfterDrag(t,e){let i=new Set;if(i.add(t),i.add(e),t<e)for(let o=t;o<=e;o++)i.add(o);else for(let o=e;o<=t;o++)i.add(o);let r=new Set;i.forEach(o=>{if(o<this.exercisesFormArray.length){let c=this.exercisesFormArray.at(o).get("supersetId")?.value;c&&r.add(c)}}),r.forEach(o=>{this.exercisesFormArray.controls.forEach(d=>{let c=d;c.get("supersetId")?.value===o&&c.patchValue({supersetId:null,supersetOrder:null,supersetSize:null})})}),this.recalculateSupersetOrders()}recalculateSupersetOrders(){let t=new Map;this.exercisesFormArray.controls.forEach(e=>{let i=e,r=i.get("supersetId")?.value;r?(t.has(r)||t.set(r,[]),t.get(r).push(i)):(i.patchValue({supersetOrder:null,supersetSize:null},{emitEvent:!1}),this.updateRoundsControlability(i))}),t.forEach((e,i)=>{e.length<2?e.forEach(r=>{r.patchValue({supersetId:null,supersetOrder:null,supersetSize:null}),this.updateRoundsControlability(r)}):(e.sort((r,o)=>this.exercisesFormArray.controls.indexOf(r)-this.exercisesFormArray.controls.indexOf(o)),e.forEach((r,o)=>{r.patchValue({supersetOrder:o,supersetSize:e.length},{emitEvent:!1}),this.updateRoundsControlability(r)}))}),this.exercisesFormArray.updateValueAndValidity({emitEvent:!1})}groupSelectedAsSuperset(){if(this.isViewMode)return;let t=this.selectedExerciseIndicesForSuperset().sort((o,d)=>o-d);if(t.length<2){this.toastService.warning("Select at least two exercises.",3e3,"Superset Error");return}for(let o=1;o<t.length;o++)if(t[o]!==t[o-1]+1){this.toastService.warning("Selected exercises must be next to each other to form a superset.",5e3,"Superset Error");return}let e=N(),i=t.length,r=1;t.forEach((o,d)=>{let c=this.exercisesFormArray.at(o);c.patchValue({supersetId:e,supersetOrder:d,supersetSize:i,rounds:r}),this.updateRoundsControlability(c),c.get("sets").controls.forEach(y=>{d<i-1&&y.get("restAfterSet")?.setValue(0)})}),this.selectedExerciseIndicesForSuperset.set([]),this.toastService.success("Superset created!",3e3,"Success")}ungroupSuperset(t){if(this.isViewMode)return;let i=this.exercisesFormArray.at(t).get("supersetId")?.value;i&&(this.exercisesFormArray.controls.forEach(r=>{let o=r;o.get("supersetId")?.value===i&&(o.patchValue({supersetId:null,supersetOrder:null,supersetSize:null}),this.updateRoundsControlability(o))}),this.selectedExerciseIndicesForSuperset.set([]),this.toastService.info("Superset ungrouped.",3e3,"Ungrouped"))}removeExercise(t){if(this.isViewMode)return;let i=this.exercisesFormArray.at(t).get("supersetId")?.value;this.exercisesFormArray.removeAt(t),this.selectedExerciseIndicesForSuperset.set([]),i&&this.recalculateSupersetOrders(),this.toastService.info("Exercise removed.",2e3),this.expandedSetPath.set(null)}errorMessage=T(null);onSubmit(){return L(this,null,function*(){if(this.isViewMode){this.toastService.info("View mode. No changes.",3e3,"View Mode");return}this.mode==="routineBuilder"&&this.recalculateSupersetOrders();let t=this.mode==="routineBuilder"&&this.builderForm.get("goal")?.value==="rest";if(this.mode==="routineBuilder"&&(this.builderForm.get("name")?.invalid||this.builderForm.get("goal")?.invalid)||this.mode==="manualLogEntry"&&(this.builderForm.get("workoutDate")?.invalid||this.builderForm.get("startTime")?.invalid||this.builderForm.get("durationMinutes")?.invalid)){this.builderForm.markAllAsTouched(),this.toastService.error("Please fill all required details.",0,"Validation Error");return}if(!t&&this.exercisesFormArray.length===0){this.toastService.error(this.mode==="manualLogEntry"?"Log must have exercises.":"Routine needs exercises.",0,"Validation Error");return}if(this.mode==="routineBuilder"&&!t&&!this.validateSupersetIntegrity()){this.toastService.error("Invalid superset configuration.",0,"Validation Error");return}if(this.builderForm.invalid){this.toastService.error("Please correct validation errors.",0,"Validation Error"),this.builderForm.markAllAsTouched();return}let e=this.builderForm.getRawValue();this.spinnerService.show(this.isNewMode?"Saving...":"Updating...");try{if(this.mode==="routineBuilder"){let i={id:this.currentRoutineId||N(),name:e.name,description:e.description,goal:e.goal,exercises:e.goal==="rest"?[]:e.exercises.map(r=>H(U({},r),{sets:r.sets.map(o=>H(U({},o),{weight:this.unitsService.convertToKg(o.weight,this.unitsService.currentUnit())??null}))}))};this.isNewMode?this.workoutService.addRoutine(i):this.workoutService.updateRoutine(i),this.toastService.success(`Routine ${this.isNewMode?"created":"updated"}!`,4e3,"Success"),this.router.navigate(["/workout"])}else{let i=e.workoutDate,r=e.startTime,o=`${i}T${r}:00`,d;try{let v=vt(o);if(!jt(v))throw new Error("Invalid date/time for log entry");d=v.getTime()}catch{this.toastService.error("Invalid date or time format.",0,"Error"),this.spinnerService.hide();return}let c;e.durationMinutes&&(c=new Date(d).setMinutes(new Date(d).getMinutes()+e.durationMinutes));let g=e.exercises.map(v=>({exerciseId:v.exerciseId,exerciseName:v.exerciseName,notes:v.notes,sets:v.sets.map(k=>({id:k.id||N(),exerciseName:v.exerciseName,plannedSetId:k.plannedSetId,exerciseId:v.exerciseId,type:k.type,repsAchieved:k.repsAchieved,weightUsed:this.unitsService.convertToKg(k.weightUsed,this.unitsService.currentUnit())??null,durationPerformed:k.durationPerformed,notes:k.notes,targetReps:k.targetReps,targetWeight:k.targetWeight,targetDuration:k.targetDuration,targetTempo:k.targetTempo,rpe:void 0,timestamp:k.timestamp||new Date().toISOString()})),rounds:v.rounds||0,type:v.type||"standard"})),y={date:j(new Date(d),"yyyy-MM-dd"),startTime:d,endTime:c,durationMinutes:e.durationMinutes,routineId:e.routineIdForLog||void 0,routineName:e.routineIdForLog?this.availableRoutines.find(v=>v.id===e.routineIdForLog)?.name||e.name||"Workout from Routine":e.name||"Ad-hoc Workout",notes:e.overallNotesLog,exercises:g};if(this.isEditMode&&this.currentLogId){let v=H(U({},y),{id:this.currentLogId});yield this.trackingService.updateWorkoutLog(v),this.toastService.success("Log updated!",4e3,"Success"),this.router.navigate(["/history/log",this.currentLogId])}else{let v=y,k=this.trackingService.addWorkoutLog(v);this.toastService.success("Workout logged!",4e3,"Success"),this.router.navigate(["/history/log",k.id])}}this.builderForm.markAsPristine()}catch(i){console.error("Error saving:",i),this.toastService.error(`Failed to save: ${i.message||"Unknown error"}`,0,"Save Error")}finally{this.spinnerService.hide()}})}validateSupersetIntegrity(){let t=this.exercisesFormArray.value,e=new Map;for(let i of t)i.supersetId&&(e.has(i.supersetId)||e.set(i.supersetId,[]),e.get(i.supersetId).push(i));for(let[i,r]of e.entries()){if(r.length<2)return!1;let o=r.sort((c,g)=>(c.supersetOrder??1/0)-(g.supersetOrder??1/0));for(let c=0;c<o.length;c++)if(o[c].supersetOrder!==c)return!1;let d=o.map(c=>this.exercisesFormArray.controls.findIndex(g=>g.get("id")?.value===c.id));for(let c=1;c<d.length;c++)if(d[c]!==d[c-1]+1)return!1}return!0}get firstSelectedExerciseIndexForSuperset(){let t=this.selectedExerciseIndicesForSuperset();return t.length>0?t[0]:null}updateRoundsControlability(t){let e=t.get("supersetId")?.value,i=t.get("supersetOrder")?.value,r=t.get("rounds");if(this.isViewMode){r?.disable({emitEvent:!1});return}if(e&&i!==null&&i>0){r?.disable({emitEvent:!1});let o=this.exercisesFormArray.controls.find(d=>d.get("supersetId")?.value===e&&d.get("supersetOrder")?.value===0);o&&r?.setValue(o.get("rounds")?.value??1,{emitEvent:!1})}else r?.enable({emitEvent:!1})}syncSupersetRounds(t,e,i){this.isViewMode||!t||e===null||e===void 0||e<1||this.exercisesFormArray.at(i).get("supersetOrder")?.value!==0||this.exercisesFormArray.controls.forEach(o=>{let d=o;d.get("supersetId")?.value===t&&d.get("rounds")?.value!==e&&d.get("rounds")?.setValue(e,{emitEvent:!1})})}startCurrentWorkout(){this.currentRoutineId?this.router.navigate(["/workout/play",this.currentRoutineId]):this.toastService.error("Cannot start workout: Routine ID is missing.",0,"Error")}enableEditMode(){this.isViewMode&&this.currentRoutineId&&(this.isViewMode=!1,this.isEditMode=!0,this.toggleFormState(!1),this.toastService.info("Edit mode enabled.",3e3,"Mode Changed"))}deleteCurrentRoutine(){return L(this,null,function*(){if(!this.currentRoutineId){this.toastService.error("Cannot delete: Routine ID is missing.",0,"Error");return}let t=yield le(this.workoutService.getRoutineById(this.currentRoutineId).pipe(z(1)));if(!t){this.toastService.error("Routine not found for deletion.",0,"Error");return}let e=(yield le(this.trackingService.getWorkoutLogsByRoutineId(this.currentRoutineId).pipe(z(1))))||[],i=`Are you sure you want to delete the routine "${t.name}"?`;e.length>0&&(i+=` This will also delete ${e.length} associated workout log(s). This action cannot be undone.`);let r=yield this.alertService.showConfirm("Delete Routine",i,"Delete");if(r&&r.data)try{this.spinnerService.show(),e.length>0&&(yield this.trackingService.clearWorkoutLogsByRoutineId(this.currentRoutineId),this.toastService.info(`${e.length} workout log(s) deleted.`,3e3,"Logs Cleared")),yield this.workoutService.deleteRoutine(this.currentRoutineId),this.toastService.success(`Routine "${t.name}" deleted.`,4e3,"Routine Deleted"),this.router.navigate(["/workout"])}catch(o){console.error("Error during deletion:",o),this.toastService.error("Failed to delete routine or logs. Please try again.",0,"Deletion Failed")}finally{this.spinnerService.hide()}})}ngOnDestroy(){this.routeSub&&this.routeSub.unsubscribe()}getExerciseCardClasses(t,e){let i=this.mode==="routineBuilder"&&!!t.get("supersetId")?.value,r=t.get("supersetOrder")?.value??-1,o=t.get("exerciseName")?.value,d=t.get("supersetSize")?.value??0,c=this.mode==="routineBuilder"&&this.selectedExerciseIndicesForSuperset().includes(e),g=i&&r===0,y=i&&r===d-1,v=i&&!g&&!y,k=this.isCompactView,P=this.isEditMode,S=this.firstSelectedExerciseIndexForSuperset,w=t.get("sets")?.value||[],F=w.length>0&&w.every(W=>W.type==="warmup");return{"p-1.5 sm:p-2":!0,"border rounded":!0,"shadow-sm":!0,"border-orange-500 dark:border-orange-400 bg-orange-50 dark:bg-orange-800/30":i,"ring-2 ring-orange-400 dark:ring-orange-300 shadow-md":c,"dark:bg-orange-800/40":i&&c,"bg-blue-800/40":F,"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800":!i&&!c&&!F,"rounded-b-none border-b-transparent dark:border-b-transparent":this.mode==="routineBuilder"&&i&&(g||v),"rounded-t-none border-t-transparent dark:border-t-transparent":i&&(y||v),"border-x border-t":i&&g,"mb-2":!i||i&&y}}hasAdjacentSupersets(t){let e=this.exercisesFormArray;if(t<0||t>=e.length)return!1;let i=e.at(t).get("supersetId")?.value;if(!i)return!1;if(t>0){let r=e.at(t-1).get("supersetId")?.value;if(r&&r===i)return!0}if(t<e.length-1){let r=e.at(t+1).get("supersetId")?.value;if(r&&r===i)return!0}return!1}isSupersetSpacing(t){if(t<=0)return!1;let e=this.exercisesFormArray.at(t).get("id")?.value,i=this.exercisesFormArray.at(t-1).get("id")?.value;return t>0&&e&&e!==i}handleTrulyCustomExerciseEntry(t=!1){return L(this,null,function*(){let e=[{name:"exerciseName",type:"text",placeholder:"Custom Exercise Name",value:"",attributes:{required:!0},label:"Custom Exercise Name"},{name:"numSets",type:"number",placeholder:"Number of Sets (e.g., 3)",value:"3",attributes:{min:"1",required:!0},label:"Number of Sets"},{name:"equipmentNeeded",type:"text",placeholder:"Equipment",value:"",attributes:{required:!1},label:"Equipment"},{name:"description",type:"textarea",placeholder:"Description",value:"",attributes:{required:!1},label:"Description"}];t&&this.toastService.error("Invalid input for custom exercise.",0,"Error");let i=yield this.alertService.showPromptDialog("Add New Custom Exercise","Define exercise name and sets:",e,"Add Exercise");if(i&&i.exerciseName){let r=String(i.exerciseName).trim(),o=String(i.description).trim(),d=i.numSets?parseInt(String(i.numSets),10):3;if(!r||d<=0){this.toastService.error("Invalid input for custom exercise.",0,"Error");return}let c=Array.from({length:d},()=>({id:`custom-adhoc-set-${N()}`,reps:8,weight:null,duration:void 0,restAfterSet:60,type:"standard",notes:""})),y={id:`custom-adhoc-ex-${r.trim().toLowerCase().replace(/\s+/g,"-")}-${N()}`,name:r,description:o,category:"custom",muscleGroups:[],primaryMuscleGroup:"",imageUrls:[]};this.closeExerciseSelectionModal(),this.exerciseService.addExercise(y);let v={id:this.workoutService.generateWorkoutExerciseId(),exerciseId:y.id,exerciseName:y.name,sets:c,type:"standard",supersetId:null,supersetOrder:null,supersetSize:null,rounds:0};this.exercisesFormArray.push(this.createExerciseFormGroup(v,!0,!1)),this.toggleSetExpansion(this.exercisesFormArray.length-1,0)}else{if(!i)return;this.handleTrulyCustomExerciseEntry(!0);return}})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=Y({type:n,selectors:[["app-workout-builder"]],viewQuery:function(e,i){if(e&1&&(De(ki,5),De(wi,5)),e&2){let r;Me(r=Le())&&(i.setRepsInputs=r),Me(r=Le())&&(i.expandedSetElements=r)}},features:[Ge([ce])],decls:19,vars:11,consts:[["expandedSetElement",""],["class","my-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-md dark:bg-red-900/30 dark:border-red-600 dark:text-red-300",4,"ngIf"],[1,"container","mx-auto","p-1","sm:p-4"],[1,"mb-6","pb-4","border-b","border-gray-200","dark:border-gray-700"],[1,"flex","justify-between","items-center"],[1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-ml-1",3,"routerLink"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"text-xl","sm:text-2xl","md:text-2xl","font-bold","text-gray-800","dark:text-gray-200","text-center","flex-grow","truncate","px-2"],[1,"w-10","h-10"],["class","mt-4 flex flex-wrap gap-2 justify-center",4,"ngIf"],[1,"space-y-6","mb-6",3,"ngSubmit","formGroup"],[1,"space-y-4","p-4","bg-white","dark:bg-gray-800","rounded-lg","shadow-sm"],[4,"ngIf"],["class","pt-4 px-1",4,"ngIf"],["class","p-4 bg-blue-50 dark:bg-blue-900/30 rounded-lg text-center",4,"ngIf"],["class","pt-6 flex justify-end space-x-3",4,"ngIf"],["class","fixed inset-0 bg-gray-700 bg-opacity-75 transition-opacity overflow-y-auto h-full w-full z-[70] flex items-center justify-center p-4",3,"click",4,"ngIf"],[1,"my-4","p-3","bg-red-100","border","border-red-400","text-red-700","rounded-md","dark:bg-red-900/30","dark:border-red-600","dark:text-red-300"],[1,"mt-4","flex","flex-wrap","gap-2","justify-center"],["type","button",1,"bg-green-500","hover:bg-green-600","text-white","font-semibold","py-3","px-3","rounded-md","shadow-sm","text-m","flex","items-center",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","3","stroke","currentColor",1,"size-4","sm:size-5","mr-1"],["stroke-linecap","round","stroke-linejoin","round","d","M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"],["type","button","class","bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-3 px-3 rounded-md shadow-sm text-m flex items-center",3,"click",4,"ngIf"],["type","button",1,"bg-red-500","hover:bg-red-600","text-white","font-semibold","py-3","px-3","rounded-md","shadow-sm","text-m","flex","items-center",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","2","stroke","currentColor",1,"size-4","sm:size-5","mr-1"],["stroke-linecap","round","stroke-linejoin","round","d","m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"],["type","button",1,"bg-yellow-500","hover:bg-yellow-600","text-white","font-semibold","py-3","px-3","rounded-md","shadow-sm","text-m","flex","items-center",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"],["for","routineName",1,"block","text-m","font-medium","text-gray-700","dark:text-gray-300"],["type","text","id","routineName","formControlName","name",1,"mt-1","block","w-full","p-2","border","rounded-md","shadow-sm","focus:ring-primary","focus:border-primary","dark:bg-gray-600","dark:border-gray-500","dark:text-gray-200",3,"ngClass"],["class","text-red-500 dark:text-red-400 text-xs mt-1",4,"ngIf"],["for","description",1,"block","text-m","font-medium","text-gray-700","dark:text-gray-300"],["id","description","formControlName","description","rows","3",1,"mt-1","block","w-full","p-2","border","border-gray-300","dark:border-gray-500","rounded-md","shadow-sm","dark:bg-gray-600","dark:text-gray-200"],["for","goal",1,"block","text-m","font-medium","text-gray-700","dark:text-gray-300"],["id","goal","formControlName","goal",1,"mt-1","block","w-full","p-2","border","border-gray-300","dark:border-gray-500","rounded-md","shadow-sm","dark:bg-gray-600","dark:text-gray-200"],[3,"value",4,"ngFor","ngForOf"],[1,"text-red-500","dark:text-red-400","text-xs","mt-1"],[3,"value"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],["for","workoutDate",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300"],["type","date","id","workoutDate","formControlName","workoutDate",1,"mt-1","block","w-full","p-2","border","rounded-md","shadow-sm","dark:bg-gray-600","dark:border-gray-500","dark:text-gray-200",3,"ngClass"],["for","startTime",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300"],["type","time","id","startTime","formControlName","startTime",1,"mt-1","block","w-full","p-2","border","rounded-md","shadow-sm","dark:bg-gray-600","dark:border-gray-500","dark:text-gray-200",3,"ngClass"],["for","durationMinutes",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300"],["type","number","id","durationMinutes","formControlName","durationMinutes",1,"mt-1","block","w-full","p-2","border","rounded-md","shadow-sm","dark:bg-gray-600","dark:border-gray-500","dark:text-gray-200",3,"ngClass"],["for","logWorkoutName",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300"],["type","text","id","logWorkoutName","formControlName","name","placeholder","e.g., Morning Chest Session",1,"mt-1","block","w-full","p-2","border","border-gray-300","dark:border-gray-500","rounded-md","shadow-sm","dark:bg-gray-600","dark:text-gray-200"],["for","routineIdForLog",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300"],["id","routineIdForLog","formControlName","routineIdForLog",1,"mt-1","block","w-full","p-2","border","border-gray-300","dark:border-gray-500","rounded-md","shadow-sm","dark:bg-gray-600","dark:text-gray-200"],["value",""],["for","overallNotesLog",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300"],["id","overallNotesLog","formControlName","overallNotesLog","rows","2",1,"mt-1","block","w-full","p-2","border","border-gray-300","dark:border-gray-500","rounded-md","shadow-sm","dark:bg-gray-600","dark:text-gray-200"],[1,"pt-4","px-1"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-xl","font-semibold","text-gray-700","dark:text-gray-300"],["type","button","class","bg-green-500 hover:enabled:bg-green-600 text-white text-m font-medium py-2 px-3 rounded-md transition-all duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed",3,"click",4,"ngIf"],["cdkDropList","","formArrayName","exercises","class","exercise-list-container space-y-4",3,"cdkDropListData","cdkDropListDisabled","cdkDropListDropped",4,"ngIf"],["class","text-center py-6 text-gray-500 dark:text-gray-400 border border-dashed dark:border-gray-700 rounded-md mt-4",4,"ngIf"],["class","text-center py-4 text-gray-500 dark:text-gray-400",4,"ngIf"],["class","mt-6 text-center",4,"ngIf"],["type","button",1,"bg-green-500","hover:enabled:bg-green-600","text-white","text-m","font-medium","py-2","px-3","rounded-md","transition-all","duration-150","ease-in-out","disabled:opacity-50","disabled:cursor-not-allowed",3,"click"],["cdkDropList","","formArrayName","exercises",1,"exercise-list-container","space-y-4",3,"cdkDropListDropped","cdkDropListData","cdkDropListDisabled"],[4,"ngFor","ngForOf"],[1,"relative","group","exercise-card-wrapper",3,"click","ngClass"],["class","absolute left-1/2 -translate-x-1/2 z-20","style","top: -1.25rem;",4,"ngIf"],["cdkDrag","",1,"exercise-item","relative","transition-all",3,"cdkDragDisabled","cdkDragData","formGroupName","ngClass"],[1,"flex","items-center","space-x-2"],["cdkDragHandle","","class","cdk-drag-handle cursor-grab p-1 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300 flex-shrink-0 top-1 right-1 sm:static","title","Drag to reorder",3,"ngClass",4,"ngIf"],["type","checkbox","title","Select the exercise for the Superset","class","h-4 w-4 text-orange-600 border-gray-300 dark:border-gray-600 rounded focus:ring-orange-500 flex-shrink-0 disabled:opacity-50",3,"id","checked","disabled","change",4,"ngIf"],["class","flex-grow min-w-0",4,"ngIf"],["class","flex-shrink-0 ml-auto",4,"ngIf"],["class","space-y-3",4,"ngIf"],["type","button","title","Collapse exercise","class","bg-blue-200 mt-1 p-1 text-blue-600 hover:text-gray-500 dark:text-gray-400 dark:hover:text-gray-200 flex-shrink-0  rounded-md",3,"click",4,"ngIf"],[1,"absolute","left-1/2","-translate-x-1/2","z-20",2,"top","-1.25rem"],["type","button","class","bg-orange-600 hover:bg-orange-700 text-white text-xs font-semibold py-1.5 px-3 rounded-full shadow-lg",3,"disabled","click",4,"ngIf"],["type","button","class","bg-violet-600 hover:bg-violet-700 text-white text-xs font-semibold py-1.5 px-3 rounded-full shadow-lg",3,"disabled","click",4,"ngIf"],["type","button",1,"bg-orange-600","hover:bg-orange-700","text-white","text-xs","font-semibold","py-1.5","px-3","rounded-full","shadow-lg",3,"click","disabled"],["type","button",1,"bg-violet-600","hover:bg-violet-700","text-white","text-xs","font-semibold","py-1.5","px-3","rounded-full","shadow-lg",3,"click","disabled"],["cdkDragHandle","","title","Drag to reorder",1,"cdk-drag-handle","cursor-grab","p-1","text-gray-400","hover:text-gray-600","dark:text-gray-500","dark:hover:text-gray-300","flex-shrink-0","top-1","right-1","sm:static",3,"ngClass"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24",1,"w-5","h-5"],["d","M 7 17 L 7 3 M 4 6 L 7 3 L 10 6 M 17 7 L 17 21 M 14 18 L 17 21 L 20 18","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["type","checkbox","title","Select the exercise for the Superset",1,"h-4","w-4","text-orange-600","border-gray-300","dark:border-gray-600","rounded","focus:ring-orange-500","flex-shrink-0","disabled:opacity-50",3,"change","id","checked","disabled"],[1,"flex-grow","min-w-0"],[1,"font-semibold","text-gray-800","dark:text-gray-100","truncate",3,"ngClass"],["class","text-xs text-orange-600 dark:text-orange-400 font-normal block",3,"ngClass",4,"ngIf"],["class","text-s text-gray-500 dark:text-gray-400 mt-0.5",4,"ngIf"],[1,"text-xs","text-orange-600","dark:text-orange-400","font-normal","block",3,"ngClass"],[1,"text-s","text-gray-500","dark:text-gray-400","mt-0.5"],[1,"flex-shrink-0","ml-auto"],["type","button","title","Remove Exercise",1,"p-1","text-red-500","hover:text-red-700","dark:text-red-400","dark:hover:text-red-300","rounded-full","hover:bg-red-100","dark:hover:bg-red-900/30","disabled:opacity-50",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 16 16",1,"w-4","h-4"],["width","16","height","16","rx","3","ry","3","fill","red"],["fill","#ffffff","fill-rule","evenodd","clip-rule","evenodd","d","M4.22 4.22a.75.75 0 0 1 1.06 0L8 7.94l2.72-2.72a.75.75 0 1 1 1.06 1.06L9.06 9l2.72 2.72a.75.75 0 1 1-1.06 1.06L8 10.06 5.28 12.78a.75.75 0 0 1-1.06-1.06L6.94 9 4.22 6.28a.75.75 0 0 1 0-1.06z"],[1,"space-y-3"],[1,"flex","flex-col","sm:flex-row","justify-between","items-start","sm:items-center","pb-2","pt-1","sm:pt-0",3,"ngClass"],[1,"flex-grow"],[1,"text-lg","font-semibold","text-gray-800","dark:text-gray-100"],["class","text-xs text-orange-600 dark:text-orange-400 font-normal block",4,"ngIf"],[1,"flex","flex-col","items-start","sm:items-end","space-y-1","flex-shrink-0","w-full","sm:w-auto","mt-2","sm:mt-0"],["class","flex items-center space-x-1",4,"ngIf"],["type","button","class","flex items-center text-xs text-red-600 bg-red-200 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 font-medium py-1 px-2 rounded-md hover:enabled:bg-red-100 dark:enabled:hover:bg-red-900/50 disabled:opacity-50",3,"click",4,"ngIf"],["type","button","class","flex bg-violet-200 items-center text-xs text-violet-600 hover:text-violet-700 dark:text-violet-400 dark:hover:text-violet-300 font-medium py-1 px-2 rounded-md hover:bg-violet-100 dark:hover:bg-violet-900/50 disabled:opacity-50",3,"disabled","click",4,"ngIf"],[1,"block","text-s","font-medium","text-gray-600","dark:text-gray-400","mb-0.5",3,"for"],["formControlName","notes","rows","1",1,"mt-0.5","block","w-full","p-1.5","text-sm","border-gray-300","dark:border-gray-500","rounded-md","shadow-sm","dark:bg-gray-600","dark:text-gray-200",3,"id","readonly"],["class","space-y-1",4,"ngIf"],[1,"text-xs","text-orange-600","dark:text-orange-400","font-normal","block"],[1,"flex","items-center","space-x-1"],[1,"text-xs","font-medium","text-gray-600","dark:text-gray-400","whitespace-nowrap",3,"for"],["type","number","formControlName","rounds","min","1",1,"w-16","p-1","text-m","border-gray-300","dark:border-gray-500","border-2","rounded-md","focus:ring-primary","focus:border-primary","dark:bg-gray-600","dark:text-gray-200","disabled:opacity-50","disabled:bg-gray-300","dark:disabled:bg-gray-500",3,"change","id","readonly"],["type","button",1,"flex","items-center","text-xs","text-red-600","bg-red-200","hover:text-red-700","dark:text-red-400","dark:hover:text-red-300","font-medium","py-1","px-2","rounded-md","hover:enabled:bg-red-100","dark:enabled:hover:bg-red-900/50","disabled:opacity-50",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 16 16",1,"w-4","h-4","mr-2"],["type","button",1,"flex","bg-violet-200","items-center","text-xs","text-violet-600","hover:text-violet-700","dark:text-violet-400","dark:hover:text-violet-300","font-medium","py-1","px-2","rounded-md","hover:bg-violet-100","dark:hover:bg-violet-900/50","disabled:opacity-50",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-4","h-4","mr-1"],["stroke-linecap","round","stroke-linejoin","round","d","M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75v4.5m0-4.5h-4.5m4.5 0L15 9m5.25 11.25v-4.5m0 4.5h-4.5m4.5 0L15 15"],[1,"space-y-1"],[1,"flex","justify-between","items-center","mb-1"],[1,"text-m","font-semibold","text-gray-700","dark:text-gray-300"],["type","button","class","text-xs bg-blue-200 text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 font-medium py-0.5 px-1.5 rounded-md hover:enabled:bg-blue-100 dark:hover:bg-blue-900/50",3,"click",4,"ngIf"],["formArrayName","sets",1,"space-y-1.5"],["class","grid grid-cols-12 gap-x-1 py-1 px-1.5 text-xs font-medium text-gray-500 dark:text-gray-400 border-b dark:border-gray-600",4,"ngIf"],[3,"formGroupName",4,"ngFor","ngForOf"],["type","button",1,"text-xs","bg-blue-200","text-blue-600","hover:text-blue-700","dark:text-blue-400","dark:hover:text-blue-300","font-medium","py-0.5","px-1.5","rounded-md","hover:enabled:bg-blue-100","dark:hover:bg-blue-900/50",3,"click"],[1,"grid","grid-cols-12","gap-x-1","py-1","px-1.5","text-xs","font-medium","text-gray-500","dark:text-gray-400","border-b","dark:border-gray-600"],[1,"col-span-1","text-center"],[1,"col-span-2","text-center","truncate"],[1,"col-span-2","text-center"],[1,"col-span-1"],[3,"formGroupName"],["class","grid grid-cols-12 gap-x-1 items-center py-1.5 px-1.5 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800/60 cursor-pointer border dark:border-gray-700 dark:text-white",3,"ngClass","click",4,"ngIf"],["class","mt-1 p-3 rounded-md border border-gray-300 dark:border-gray-500 shadow-inner space-y-2",3,"ngClass",4,"ngIf"],[1,"grid","grid-cols-12","gap-x-1","items-center","py-1.5","px-1.5","rounded-md","hover:bg-gray-100","dark:hover:bg-gray-800/60","cursor-pointer","border","dark:border-gray-700","dark:text-white",3,"click","ngClass"],[1,"col-span-1","text-xs","text-center","font-medium"],[1,"col-span-2","text-xs","text-center","truncate",3,"title"],[1,"col-span-2","text-xs","text-center"],[1,"col-span-1","text-xs","text-center"],[1,"col-span-1","text-xs","text-center","truncate",3,"title"],["class","col-span-1 flex items-center justify-end",4,"ngIf"],["class","col-span-1",4,"ngIf"],[1,"col-span-1","flex","items-center","justify-end"],["type","button","title","Remove Set",1,"flex","items-center","text-red-500","hover:text-red-600","dark:text-red-400","dark:hover:text-red-300","p-0.5","rounded-full","hover:bg-red-100","dark:hover:bg-red-900/30","disabled:opacity-50",3,"click"],[1,"mt-1","p-3","rounded-md","border","border-gray-300","dark:border-gray-500","shadow-inner","space-y-2",3,"ngClass"],[1,"grid","grid-cols-2","sm:grid-cols-3","gap-x-3","gap-y-2","items-end"],[1,"col-span-full","sm:col-span-1"],[1,"block","text-s","font-medium","text-gray-600","dark:text-gray-400",3,"for"],["formControlName","type",1,"mt-0.5","w-full","p-1.5","text-m","border-gray-300","dark:border-gray-500","rounded-md","dark:bg-gray-600","dark:text-gray-200","disabled:opacity-70","disabled:cursor-not-allowed",3,"id","disabled"],["type","number","placeholder","Reps",1,"mt-0.5","w-full","p-1.5","text-m","border-gray-300","dark:border-gray-500","rounded-md","dark:bg-gray-600","dark:text-gray-200","disabled:opacity-70","disabled:cursor-not-allowed",3,"id","formControlName","readonly"],["type","number","placeholder","Weight",1,"mt-0.5","w-full","p-1.5","text-m","border-gray-300","dark:border-gray-500","rounded-md","dark:bg-gray-600","dark:text-gray-200","disabled:opacity-70","disabled:cursor-not-allowed",3,"id","formControlName","readonly"],["type","number","placeholder","Secs",1,"mt-0.5","w-full","p-1.5","text-m","border-gray-300","dark:border-gray-500","rounded-md","dark:bg-gray-600","dark:text-gray-200","disabled:opacity-70","disabled:cursor-not-allowed",3,"id","formControlName","readonly"],[1,"col-span-full"],["type","text","formControlName","notes","placeholder","e.g. Good form",1,"mt-0.5","w-full","p-1.5","text-m","border-gray-300","dark:border-gray-500","rounded-md","dark:bg-gray-600","dark:text-gray-200","disabled:opacity-70","disabled:cursor-not-allowed",3,"id","readonly"],[1,"mt-2","text-right"],["type","button","title","Collapse set",1,"bg-blue-200","text-xs","text-blue-600","hover:text-blue-700","dark:text-blue-400","dark:hover:text-blue-300","font-medium","py-1","px-2","rounded-md",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","width","24","height","24"],["d","M 12 5 L 12 10 M 9 7 L 12 10 L 15 7 M 12 19 L 12 14 M 9 17 L 12 14 L 15 17","fill","none","stroke","currentColor","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],["type","text","formControlName","tempo","placeholder","e.g. 2010",1,"mt-0.5","w-full","p-1.5","text-m","border-gray-300","dark:border-gray-500","rounded-md","dark:bg-gray-600","dark:text-gray-200","disabled:opacity-70","disabled:cursor-not-allowed",3,"id","readonly"],["type","number","formControlName","restAfterSet","placeholder","Rest",1,"mt-0.5","w-full","p-1.5","text-m","border-gray-300","dark:border-gray-500","rounded-md","dark:bg-gray-600","dark:text-gray-200","disabled:opacity-70","disabled:cursor-not-allowed",3,"id","readonly"],["type","button","title","Collapse exercise",1,"bg-blue-200","mt-1","p-1","text-blue-600","hover:text-gray-500","dark:text-gray-400","dark:hover:text-gray-200","flex-shrink-0","rounded-md",3,"click"],[1,"text-center","py-6","text-gray-500","dark:text-gray-400","border","border-dashed","dark:border-gray-700","rounded-md","mt-4"],[1,"mb-2"],["type","button",1,"bg-green-500","hover:bg-green-600","text-white","text-m","font-medium","py-2","px-3","rounded-md",3,"click"],[1,"text-center","py-4","text-gray-500","dark:text-gray-400"],[1,"mt-6","text-center"],["type","button",1,"bg-green-500","hover:bg-green-600","text-white","font-semibold","py-2","px-6","rounded-md","shadow-md","hover:shadow-lg","transition-all","duration-300","focus:outline-none","focus:ring-2","focus:ring-green-400","focus:ring-opacity-75",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"w-5","h-5","mr-2","inline-block"],["d","M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z"],[1,"p-4","bg-blue-50","dark:bg-blue-900/30","rounded-lg","text-center"],[1,"text-m","text-blue-700","dark:text-blue-300"],[1,"pt-6","flex","justify-end","space-x-3"],["type","button",1,"px-4","py-2","border","border-gray-300","dark:border-gray-600","rounded-md","shadow-sm","text-m","font-medium","text-gray-700","dark:text-gray-200","hover:bg-gray-50","dark:hover:bg-gray-700",3,"routerLink"],["type","submit",1,"px-4","py-2","border","border-transparent","rounded-md","shadow-sm","text-sm","font-medium","text-white","bg-primary","hover:bg-primary-dark","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-primary-dark","disabled:opacity-50",3,"disabled"],[1,"fixed","inset-0","bg-gray-700","bg-opacity-75","transition-opacity","overflow-y-auto","h-full","w-full","z-[70]","flex","items-center","justify-center","p-4",3,"click"],[1,"relative","transform","overflow-hidden","rounded-lg","bg-white","dark:bg-gray-700","text-left","shadow-xl","transition-all","sm:my-8","sm:w-full","sm:max-w-lg",3,"click"],[1,"bg-white","dark:bg-gray-700","px-4","pt-5","pb-4","sm:p-6","sm:pb-4"],[1,"flex","justify-between","items-center","pb-3"],[1,"text-xl","font-semibold","text-gray-900","dark:text-gray-100"],["type","button",1,"p-1","rounded-full","text-gray-400","hover:text-gray-600",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","d","M6 18 18 6M6 6l12 12"],[1,"my-4"],["type","text","placeholder","Search exercises...",1,"w-full","p-2","border","border-gray-300","dark:border-gray-600","rounded-md","dark:bg-gray-700","dark:text-gray-200",3,"ngModelChange","ngModel"],[1,"mt-2","max-h-80","overflow-y-auto"],["class","p-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md cursor-pointer flex justify-between items-center",3,"click",4,"ngFor","ngForOf"],["class","text-gray-500 dark:text-gray-400 text-center p-4",4,"ngIf"],[1,"mt-4","pt-4","border-t","border-gray-200","dark:border-gray-600","text-center"],["type","button",1,"text-sm","text-primary","dark:text-primary-light","hover:underline",3,"click"],[1,"bg-gray-50","dark:bg-gray-700","px-4","py-3","sm:flex","sm:flex-row-reverse","sm:px-6"],["type","button",1,"mt-3","inline-flex","w-full","justify-center","rounded-md","bg-white","dark:bg-gray-700","px-3","py-2","text-sm","font-semibold","text-gray-900","dark:text-gray-200","shadow-sm","ring-1","ring-inset","ring-gray-300","dark:ring-gray-500","hover:bg-gray-50","dark:hover:bg-gray-500","sm:mt-0","sm:w-auto",3,"click"],[1,"p-3","hover:bg-gray-100","dark:hover:bg-gray-700","rounded-md","cursor-pointer","flex","justify-between","items-center",3,"click"],[1,"font-medium","text-gray-800","dark:text-gray-200"],[1,"block","text-xs","text-gray-500","dark:text-gray-400"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"w-5","h-5","text-primary","dark:text-primary-light"],["fill-rule","evenodd","d","M8.22 5.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06-1.06L11.94 10 8.22 6.28a.75.75 0 0 1 0-1.06Z","clip-rule","evenodd"],[1,"text-gray-500","dark:text-gray-400","text-center","p-4"]],template:function(e,i){if(e&1&&(_(0,Vi,2,1,"div",1),s(1,"div",2)(2,"header",3)(3,"div",4)(4,"button",5),E(),s(5,"svg",6),b(6,"path",7),a()(),D(),s(7,"h1",8),m(8),a(),b(9,"div",9),a(),_(10,Di,10,1,"div",10),a(),s(11,"form",11),h("ngSubmit",function(){return i.onSubmit()}),s(12,"section",12),_(13,Ai,15,6,"ng-container",13)(14,zi,32,16,"ng-container",13),a(),_(15,Pr,10,7,"section",14)(16,Rr,3,0,"section",15)(17,Wr,5,3,"div",16),a(),_(18,Dr,21,3,"div",17),a()),e&2){let r,o,d;p("ngIf",i.errorMessage()),l(4),p("routerLink",i.mode==="routineBuilder"?"/workout":"/history/list"),l(4),C(" ",i.mode==="routineBuilder"?i.isNewMode?"New Routine":i.isViewMode?((r=i.builderForm.get("name"))==null?null:r.value)||"View Routine":"Edit: "+(((r=i.builderForm.get("name"))==null?null:r.value)||"Routine"):i.isNewMode?"Log Past Workout":"Edit Log: "+(((r=i.builderForm.get("name"))==null?null:r.value)||"Workout")," "),l(2),p("ngIf",i.mode==="routineBuilder"&&!i.isNewMode&&i.currentRoutineId),l(),p("formGroup",i.builderForm),l(2),p("ngIf",i.mode==="routineBuilder"),l(),p("ngIf",i.mode==="manualLogEntry"),l(),p("ngIf",i.mode==="manualLogEntry"||((o=i.builderForm.get("goal"))==null?null:o.value)!=="rest"),l(),p("ngIf",i.mode==="routineBuilder"&&((d=i.builderForm.get("goal"))==null?null:d.value)==="rest"),l(),p("ngIf",!i.isViewMode),l(),p("ngIf",i.isExerciseModalOpen)}},dependencies:[ee,He,de,X,be,it,Ye,Bt,$t,ze,Qe,Nt,qe,Je,Ut,Ze,Xe,Ot,At,Ee,tt,Ke,Yt,Kt,Jt,qt,ot],styles:[".exercise-list-container[_ngcontent-%COMP%]{min-height:60px}.exercise-item[_ngcontent-%COMP%]{transition:box-shadow .2s ease-in-out}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:.4;background:#ccc;border:dotted 2px #999;min-height:100px;transition:transform .25s cubic-bezier(0,0,.2,1);display:block;margin-bottom:.5rem}.cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f;border-radius:.5rem;background-color:var(--card-background-color, white)}body.dark[_ngcontent-%COMP%]   .cdk-drag-preview[_ngcontent-%COMP%]{background-color:var(--dark-card-background-color, #1f2937)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .exercise-item[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drag-handle[_ngcontent-%COMP%]{cursor:grab;padding:.25rem;color:#9ca3af;display:flex;flex-shrink:0;position:relative;top:.25rem;right:.25rem}.cdk-drag-handle[_ngcontent-%COMP%]:hover{color:#4b5563}.dark[_ngcontent-%COMP%]   .cdk-drag-handle[_ngcontent-%COMP%]{color:#6b7280}.dark[_ngcontent-%COMP%]   .cdk-drag-handle[_ngcontent-%COMP%]:hover{color:#d1d5db}@media (min-width: 640px){.cdk-drag-handle[_ngcontent-%COMP%]{position:static}}.superset-spacing[_ngcontent-%COMP%]{margin-top:0!important}"]})};var Mr=["progressCircleSvg"];function Lr(n,t){if(n&1&&(s(0,"div",13),m(1),a()),n&2){let e=u(2);l(),C(" Prepare for: ",e.nextUpText," ")}}function Or(n,t){if(n&1){let e=I();s(0,"div",2)(1,"div",3),E(),s(2,"svg",4,0),b(4,"circle",5)(5,"circle",6),a(),D(),s(6,"div",7)(7,"div",8),m(8),s(9,"span",9),m(10),a()(),s(11,"div",10),m(12),a()()(),s(13,"button",11),h("click",function(){x(e);let r=u();return f(r.skipTimer())}),m(14," Skip "),a(),_(15,Lr,2,1,"div",12),a()}if(n&2){let e=u();fe("opacity-100",e.isVisible)("opacity-0",!e.isVisible),l(4),gt("r",e.getCircleRadius()),l(),gt("r",e.getCircleRadius())("stroke-dasharray",e.getCircleCircumference())("stroke-dashoffset",e.strokeDashoffset()),l(3),C(" ",e.displayTime()),l(2),V(e.displayTentsTime()),l(2),C(" ",e.mainText," "),l(3),p("ngIf",e.nextUpText)}}var lt=class n{isVisible=!1;durationSeconds=60;mainText="RESTING";nextUpText=null;timerFinished=new Fe;timerSkipped=new Fe;progressCircleSvg;timerIntervalId;circleRadius=90;circumference=2*Math.PI*this.circleRadius;timerUpdateIntervalMs=100;remainingTime=T(0);initialDuration=T(0);strokeDashoffset=B(()=>{let t=this.initialDuration();if(t<=0)return this.circumference;let e=Math.max(0,this.remainingTime())/t;return this.circumference*(1-e)});displayTime=B(()=>{let t=Math.max(0,this.remainingTime()),e=Math.floor(t/60),i=Math.floor(t%60);return e>0?`${e}:${i.toString().padStart(2,"0")}`:`${i}`});displayTentsTime=B(()=>`.${Math.floor(Math.max(0,this.remainingTime())*10)%10}`);ngOnChanges(t){t.isVisible&&(this.isVisible?this.startTimer():this.stopTimer()),t.durationSeconds&&this.isVisible?this.startTimer():t.durationSeconds&&!this.isVisible&&(this.initialDuration.set(this.durationSeconds),this.remainingTime.set(this.durationSeconds))}ngAfterViewInit(){}startTimer(){if(this.stopTimer(),this.initialDuration.set(this.durationSeconds),this.remainingTime.set(this.durationSeconds),this.durationSeconds<=0){this.timerFinished.emit();return}let t=this.timerUpdateIntervalMs/1e3;this.timerIntervalId=setInterval(()=>{this.remainingTime.update(e=>{let i=e-t;return i<=0?(this.stopTimer(),this.timerFinished.emit(),0):i})},this.timerUpdateIntervalMs)}stopTimer(){this.timerIntervalId&&(clearInterval(this.timerIntervalId),this.timerIntervalId=null)}skipTimer(){this.stopTimer(),this.timerSkipped.emit()}ngOnDestroy(){this.stopTimer()}getCircleCircumference(){return this.circumference}getCircleRadius(){return this.circleRadius}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=Y({type:n,selectors:[["app-full-screen-rest-timer"]],viewQuery:function(e,i){if(e&1&&De(Mr,5),e&2){let r;Me(r=Le())&&(i.progressCircleSvg=r.first)}},inputs:{isVisible:"isVisible",durationSeconds:"durationSeconds",mainText:"mainText",nextUpText:"nextUpText"},outputs:{timerFinished:"timerFinished",timerSkipped:"timerSkipped"},features:[kt],decls:1,vars:1,consts:[["progressCircleSvg",""],["class","fixed inset-0 z-50 flex flex-col items-center justify-center bg-black/70 backdrop-blur-sm transition-opacity duration-300 ease-in-out",3,"opacity-100","opacity-0",4,"ngIf"],[1,"fixed","inset-0","z-50","flex","flex-col","items-center","justify-center","bg-black/70","backdrop-blur-sm","transition-opacity","duration-300","ease-in-out"],[1,"relative","flex","flex-col","items-center","justify-center","text-white"],["viewBox","0 0 200 200",1,"w-64","h-64","md:w-80","md:h-80","transform","-rotate-90"],["cx","100","cy","100","fill","transparent","stroke","rgba(255, 255, 255, 0.2)","stroke-width","12"],["cx","100","cy","100","fill","transparent","stroke","currentColor","stroke-width","14","stroke-linecap","round",1,"text-primary"],[1,"absolute","inset-0","flex","flex-col","items-center","justify-center","text-center"],[1,"text-6xl","md:text-7xl","font-bold","tabular-nums"],[1,"text-4xl","md:text-5xl","font-bold","tabular-nums"],[1,"mt-2","text-xl","md:text-2xl","font-medium","uppercase","tracking-wider"],[1,"mt-12","py-3","px-8","bg-white/20","hover:bg-white/30","text-white","font-semibold","rounded-lg","shadow-md","transition-colors","duration-150","text-lg",3,"click"],["class","mt-5 text-center text-m md:text-base text-gray-300",4,"ngIf"],[1,"mt-5","text-center","text-m","md:text-base","text-gray-300"]],template:function(e,i){e&1&&_(0,Or,16,12,"div",1),e&2&&p("ngIf",i.isVisible)},dependencies:[ee,X],encapsulation:2,changeDetection:0})};var dt=class n{longPress=new Fe;pressTimer;longPressDuration=500;onPressStart(t){this.clearTimeout(),this.pressTimer=setTimeout(()=>{this.longPress.emit(t)},this.longPressDuration)}onPressEnd(){this.clearTimeout()}clearTimeout(){this.pressTimer&&(clearTimeout(this.pressTimer),this.pressTimer=null)}static \u0275fac=function(e){return new(e||n)};static \u0275dir=Ct({type:n,selectors:[["","appLongPress",""]],hostBindings:function(e,i){e&1&&h("mousedown",function(o){return i.onPressStart(o)})("touchstart",function(o){return i.onPressStart(o)})("mouseup",function(){return i.onPressEnd()})("mouseleave",function(){return i.onPressEnd()})("touchend",function(){return i.onPressEnd()})("touchcancel",function(){return i.onPressEnd()})},outputs:{longPress:"longPress"}})};var Ar=["*",[["","modal-footer",""]]],Nr=["*","[modal-footer]"];function Br(n,t){if(n&1&&(s(0,"h3",11),m(1),a()),n&2){let e=u(3);l(),C(" ",e.modalTitle()," ")}}function $r(n,t){if(n&1){let e=I();s(0,"div",6),_(1,Br,2,1,"h3",7),s(2,"button",8),h("click",function(){x(e);let r=u(2);return f(r.closeModal())}),E(),s(3,"svg",9),b(4,"path",10),a()()()}if(n&2){let e=u(2);l(),p("ngIf",e.modalTitle())}}function Ur(n,t){if(n&1){let e=I();s(0,"div",1),h("click",function(){x(e);let r=u();return f(r.closeModal())}),s(1,"div",2),h("click",function(r){x(e);let o=u();return f(o.onDialogClick(r))}),_(2,$r,5,1,"div",3),s(3,"div",4),xt(4),a(),s(5,"div",5),xt(6,1),a()()()}if(n&2){let e=u();p("@modalAnimation",e.animationState),l(),p("@dialogAnimation",e.animationState),l(),p("ngIf",e.modalTitle()||!0)}}var ct=class n{elementRef=R(wt);isOpen=Ft(!1);modalTitle=Vt();closed=Wt();get animationState(){return this.isOpen()?"open":"closed"}closeModal(){this.isOpen.set(!1),this.closed.emit()}onDialogClick(t){t.stopPropagation()}onDocumentMouseDown(t){this.isOpen()&&this.elementRef.nativeElement.contains(t.target)&&t.target.classList.contains("modal-container")&&this.closeModal()}onEscapeKey(){this.isOpen()&&this.closeModal()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=Y({type:n,selectors:[["app-modal"]],hostBindings:function(e,i){e&1&&h("mousedown",function(o){return i.onDocumentMouseDown(o)},pt)("keydown.escape",function(){return i.onEscapeKey()},pt)},inputs:{isOpen:[1,"isOpen"],modalTitle:[1,"modalTitle"]},outputs:{isOpen:"isOpenChange",closed:"closed"},ngContentSelectors:Nr,decls:1,vars:1,consts:[["class","modal-container fixed inset-0 z-[1000] flex items-center justify-center bg-black bg-opacity-60",3,"click",4,"ngIf"],[1,"modal-container","fixed","inset-0","z-[1000]","flex","items-center","justify-center","bg-black","bg-opacity-60",3,"click"],[1,"modal-dialog","mx-2","bg-white","dark:bg-gray-800","rounded-lg","shadow-xl","min-w-[300px]","w-full","max-w-lg","md:max-w-xl","lg:max-w-2xl","max-h-[90vh]","flex","flex-col","overflow-hidden",3,"click"],["class","modal-header flex items-center justify-between ml-1 p-1 md:p-1 border-gray-200 dark:border-gray-700",4,"ngIf"],[1,"modal-body","p-1","md:p-1","space-y-4","overflow-y-auto","flex-grow"],[1,"modal-footer","flex","items-center","p-4","md:p-5","border-t","border-gray-200","dark:border-gray-700","rounded-b"],[1,"modal-header","flex","items-center","justify-between","ml-1","p-1","md:p-1","border-gray-200","dark:border-gray-700"],["class","text-xl font-semibold text-gray-900 dark:text-white",4,"ngIf"],["type","button","aria-label","Close modal",1,"modal-close-button","text-gray-400","bg-transparent","hover:bg-gray-200","hover:text-gray-900","dark:hover:bg-gray-600","dark:hover:text-white","rounded-lg","text-sm","w-8","h-8","ms-auto","inline-flex","justify-center","items-center",3,"click"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 14 14",1,"w-3","h-3"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"],[1,"text-xl","font-semibold","text-gray-900","dark:text-white"]],template:function(e,i){e&1&&(Tt(Ar),_(0,Ur,7,3,"div",0)),e&2&&p("ngIf",i.isOpen())},dependencies:[ee,X],styles:[".modal-footer[_ngcontent-%COMP%]:empty{display:none}"],data:{animation:[Ie("modalAnimation",[se("closed",oe({opacity:0,visibility:"hidden"})),se("open",oe({opacity:1,visibility:"visible"})),ve("closed <=> open",[_e("300ms ease-in-out")])]),Ie("dialogAnimation",[se("closed",oe({opacity:0,transform:"scale(0.95) translateY(20px)",visibility:"hidden"})),se("open",oe({opacity:1,transform:"scale(1) translateY(0)",visibility:"visible"})),ve("closed <=> open",[_e("300ms ease-in-out")])])]}})};var Gr=n=>({"filter dark:invert":n}),jr=(n,t,e,i)=>({"text-red-500":n,"animate-pulse":t,"text-green-500 dark:text-green-400":e,"text-gray-800 dark:text-gray-100":i}),Hr=(n,t)=>({"bg-green-500 hover:bg-green-600":n,"bg-yellow-500 hover:bg-yellow-600 text-black":t}),zr=(n,t,e,i)=>({"bg-red-500 hover:bg-red-600 focus:ring-red-400":n,"bg-green-500 hover:bg-green-600 focus:ring-green-400":t,"bg-blue-500 hover:bg-blue-600 focus:ring-blue-400":e,"bg-gray-400 dark:bg-gray-600 text-gray-800 dark:text-gray-200 cursor-not-allowed":i}),ti=n=>({"rotate-180":n});function qr(n,t){if(n&1){let e=I();s(0,"div",13)(1,"h2",14),m(2,"Session Paused"),a(),s(3,"p",15),m(4),a(),s(5,"button",16),h("click",function(){x(e);let r=u(2);return f(r.resumeSession())}),m(6," Resume Workout "),a(),s(7,"button",17),h("click",function(){x(e);let r=u(2);return f(r.quitWorkout())}),m(8," Quit Workout (No Save) "),a()()}if(n&2){let e=u(2);l(4),C("Elapsed Time: ",e.sessionTimerDisplay())}}function Jr(n,t){if(n&1&&b(0,"img",48),n&2){let e=u().ngIf,i=u(4);p("src",i.getIconPath(e.iconName),Et)("alt",e.name+" icon")("ngClass",he(3,Gr,e.iconName!=="default-exercise"&&e.iconName!==""&&e.iconName!==null))}}function Kr(n,t){if(n&1&&(s(0,"div",46),_(1,Jr,1,5,"img",47),a()),n&2){let e=t.ngIf;l(),p("ngIf",e.iconName)}}function Yr(n,t){n&1&&b(0,"div",49)}function Qr(n,t){if(n&1){let e=I();E(),s(0,"svg",50),h("click",function(){x(e);let r=u().ngIf,o=u(3);return f(o.openModal(r.exerciseData))}),b(1,"circle",51)(2,"circle",52)(3,"rect",53),a()}}function Zr(n,t){if(n&1&&(s(0,"span"),m(1),a()),n&2){let e=u(5);l(),C("/",e.getTotalWarmupSetsForCurrentExercise())}}function Xr(n,t){if(n&1&&(s(0,"span",54),m(1),_(2,Zr,2,1,"span",39),a()),n&2){let e=u(4);l(),C(" Warm-up Set ",e.getCurrentWarmupSetNumber()," "),l(),p("ngIf",e.getTotalWarmupSetsForCurrentExercise()>0)}}function en(n,t){if(n&1&&(s(0,"span"),m(1),a()),n&2){let e=u(4);l(),G(" Set ",e.getCurrentWorkingSetNumber(),"/",e.getWorkingSetCountForCurrentExercise()," ")}}function tn(n,t){if(n&1&&(s(0,"span",55),m(1),a()),n&2){let e=u(4);l(),G(" (Round ",e.currentBlockRound(),"/",e.totalBlockRounds(),") ")}}function rn(n,t){if(n&1&&(s(0,"span",56),m(1),a()),n&2){let e=u().ngIf;l(),G(" (Superset ",(e.exerciseData.supersetOrder??0)+1,"/",e.exerciseData.supersetSize??"?",") ")}}function nn(n,t){n&1&&(s(0,"span",60),m(1,"Marked as Skipped"),a())}function on(n,t){n&1&&(s(0,"span",61),m(1,"Marked for Later"),a())}function sn(n,t){if(n&1&&(s(0,"div",57),_(1,nn,2,0,"span",58)(2,on,2,0,"span",59),a()),n&2){let e=u().ngIf;l(),p("ngIf",e.exerciseData.sessionStatus==="skipped"),l(),p("ngIf",e.exerciseData.sessionStatus==="do_later")}}function an(n,t){if(n&1){let e=I();s(0,"div",62)(1,"h3",63),m(2,"Get Ready!"),a(),s(3,"p",64),m(4),a(),s(5,"p",65),m(6),O(7,"weightUnit"),a(),s(8,"button",66),h("click",function(){x(e);let r=u(4);return f(r.skipPresetTimer())}),m(9," Skip Countdown & Start Set "),a()()}if(n&2){let e=u().ngIf,i=u(3);l(4),C("",i.presetTimerCountdownDisplay(),"s"),l(2),Rt(" Upcoming: ",e.setData.reps?e.setData.reps+" reps":""," ",e.setData.reps&&e.setData.weight?" at ":""," ",e.setData.weight?$(7,5,e.setData.weight):""," ",e.setData.duration?e.setData.duration+"s":""," ")}}function ln(n,t){if(n&1){let e=I();s(0,"div")(1,"label",71),m(2,"Weight"),a(),s(3,"div",72)(4,"button",73),h("mousedown",function(r){x(e);let o=u(5);return f(o.onWeightDecrementPointerDown(r))})("longPress",function(r){x(e);let o=u(5);return f(o.onWeightDecrementPointerDown(r))}),E(),s(5,"svg",74),b(6,"path",75),a()(),D(),s(7,"div",76),h("click",function(){x(e);let r=u(5);return f(r.editWeightWithPrompt())}),m(8),O(9,"number"),a(),b(10,"input",77),s(11,"span",78),m(12),a(),s(13,"button",73),h("mousedown",function(r){x(e);let o=u(5);return f(o.onWeightIncrementPointerDown(r))})("longPress",function(r){x(e);let o=u(5);return f(o.onWeightIncrementPointerDown(r))}),E(),s(14,"svg",74),b(15,"path",79),a()()()()}if(n&2){let e=u(5);l(4),p("disabled",e.getDisabled()),l(4),C(" ",Z(9,4,e.csf.actualWeight.value,"1.0-2")??"0"," "),l(4),V(e.weightUnitDisplaySymbol),l(),p("disabled",e.getDisabled())}}function dn(n,t){if(n&1){let e=I();s(0,"div")(1,"label",71),m(2,"Reps"),a(),s(3,"div",72)(4,"button",80),h("click",function(){x(e);let r=u(5);return f(r.decrementReps(1))}),E(),s(5,"svg",74),b(6,"path",75),a()(),D(),b(7,"input",81),s(8,"button",80),h("click",function(){x(e);let r=u(5);return f(r.incrementReps(1))}),E(),s(9,"svg",74),b(10,"path",79),a()()()()}if(n&2){let e=u(5);l(4),p("disabled",e.getDisabled()),l(4),p("disabled",e.getDisabled())}}function cn(n,t){if(n&1&&(s(0,"span"),m(1),O(2,"date"),a()),n&2){let e=u(3).ngIf;l(),C("(Target: ",_t(2,1,e.setData.duration*1e3,"mm:ss","UTC"),")")}}function un(n,t){n&1&&(s(0,"span"),m(1,"Start Timer"),a())}function mn(n,t){n&1&&(s(0,"span"),m(1,"Pause Timer"),a())}function pn(n,t){n&1&&(s(0,"span"),m(1,"Resume Timer"),a())}function gn(n,t){if(n&1){let e=I();s(0,"button",88),h("click",function(){x(e);let r=u(6);return f(r.resetTimedSet())}),m(1," Reset "),a()}if(n&2){let e=u(6);p("disabled",e.getDisabled())}}function xn(n,t){if(n&1){let e=I();s(0,"div")(1,"label",82),m(2," Time (seconds) "),_(3,cn,3,5,"span",39),a(),s(4,"div",83),m(5),O(6,"date"),a(),b(7,"input",84),s(8,"div",85)(9,"button",86),h("click",function(){x(e);let r=u(5);return f(r.toggleTimedSetTimer())}),_(10,un,2,0,"span",39)(11,mn,2,0,"span",39)(12,pn,2,0,"span",39),a(),_(13,gn,2,1,"button",87),a()()}if(n&2){let e,i=u(2).ngIf,r=u(3);l(3),p("ngIf",i.setData.duration>0),l(),p("ngClass",ht(13,jr,r.isTimedSetOvertime(),r.isTimedSetOvertime()&&r.timedSetTimerState()==="running",!r.isTimedSetOvertime()&&r.timedSetTimerState()==="running"&&(((e=r.activeSetInfo())==null||e.setData==null?null:e.setData.duration)??0)>0&&r.timedSetElapsedSeconds()>0,r.timedSetTimerState()==="idle"||r.timedSetTimerState()==="paused"||!((((e=r.activeSetInfo())==null||e.setData==null?null:e.setData.duration)??0)>0&&r.timedSetElapsedSeconds()>0&&!r.isTimedSetOvertime()))),l(),C(" ",_t(6,9,r.timedSetDisplay()*1e3,"mm:ss","UTC")," "),l(4),p("disabled",r.getDisabled())("ngClass",Q(18,Hr,r.timedSetTimerState()==="idle"||r.timedSetTimerState()==="paused",r.timedSetTimerState()==="running")),l(),p("ngIf",r.timedSetTimerState()==="idle"),l(),p("ngIf",r.timedSetTimerState()==="running"),l(),p("ngIf",r.timedSetTimerState()==="paused"),l(),p("ngIf",r.timedSetTimerState()!=="idle")}}function fn(n,t){if(n&1&&(s(0,"div")(1,"form",67),_(2,ln,16,7,"div",39)(3,dn,11,2,"div",39)(4,xn,14,21,"div",39),s(5,"div",68)(6,"label",69),m(7,"Set Notes (Optional)"),a(),b(8,"textarea",70),a()()()),n&2){let e=u().ngIf,i=u(3);l(),p("formGroup",i.currentSetForm),l(),p("ngIf",i.csf.actualWeight),l(),p("ngIf",i.csf.actualReps&&e.setData.reps!==void 0),l(),p("ngIf",e.setData.duration!==void 0),l(4),p("disabled",i.getDisabled())}}function hn(n,t){if(n&1){let e=I();s(0,"div",89)(1,"div",90)(2,"button",91),h("click",function(){x(e);let r=u(4);return f(r.handleMainAction())}),m(3),a()()()}if(n&2){let e=u(4);l(2),p("disabled",e.sessionState()==="paused"||e.playerSubState()===e.PlayerSubState.PresetCountdown&&e.presetTimerCountdownDisplay()!=="0"&&e.presetTimerCountdownDisplay()!==null||e.playerSubState()===e.PlayerSubState.Resting&&e.isRestTimerVisible())("ngClass",ht(3,zr,e.playerSubState()===e.PlayerSubState.PerformingSet&&!e.checkIfLatestSetOfWorkoutConsideringPending(),e.playerSubState()===e.PlayerSubState.PerformingSet&&e.checkIfLatestSetOfWorkoutConsideringPending(),e.playerSubState()===e.PlayerSubState.PresetCountdown,e.playerSubState()===e.PlayerSubState.Resting&&e.isRestTimerVisible())),l(),C(" ",e.mainActionButtonLabel()," ")}}function _n(n,t){if(n&1&&(s(0,"div",92)(1,"span",93),m(2,"Next up: "),a(),s(3,"span"),m(4),a()()),n&2){let e=u(4);p("title",e.getNextUpText(e.activeSetInfo(),e.routine()??null)||"Next Exercise"),l(4),V(e.getNextUpText(e.activeSetInfo(),e.routine()??null)||"Next Exercise")}}function vn(n,t){if(n&1&&(s(0,"div",31)(1,"div",32),_(2,Kr,2,1,"div",33)(3,Yr,1,0,"ng-template",null,3,ne),s(5,"h2",34),m(6),a(),_(7,Qr,4,0,"svg",35),a(),s(8,"div",36)(9,"p",37),_(10,Xr,3,2,"span",38)(11,en,2,2,"span",39)(12,tn,2,2,"span",40)(13,rn,2,2,"span",41),a()(),_(14,sn,3,2,"div",42)(15,an,10,7,"div",43)(16,fn,9,5,"div",39)(17,hn,4,8,"div",44)(18,_n,5,2,"div",45),a()),n&2){let e=t.ngIf,i=re(4),r=u(3);l(2),p("ngIf",r.currentBaseExercise())("ngIfElse",i),l(3),p("title",e.exerciseData.exerciseName),l(),C(" ",e.exerciseData.exerciseName||"Loading Exercise..."," "),l(),p("ngIf",e.exerciseData.id),l(3),p("ngIf",e.type==="warmup"),l(),p("ngIf",e.type!=="warmup"),l(),p("ngIf",r.totalBlockRounds()>1&&r.currentBlockRound()>0),l(),p("ngIf",e.exerciseData.supersetId),l(),p("ngIf",e.exerciseData.sessionStatus&&e.exerciseData.sessionStatus!=="pending"),l(),p("ngIf",r.playerSubState()===r.PlayerSubState.PresetCountdown),l(),p("ngIf",r.playerSubState()===r.PlayerSubState.PerformingSet),l(),p("ngIf",r.routine()&&r.sessionState()==="playing"&&r.activeSetInfo()),l(),p("ngIf",r.getNextUpText(r.activeSetInfo(),r.routine()??null))}}function Sn(n,t){if(n&1&&(s(0,"p",100),m(1),a()),n&2){let e=u(4);l(),C(" ",e.currentWorkoutLogExercises().length===0?"No sets were logged.":"All planned sets are done. Well done!"," ")}}function yn(n,t){if(n&1){let e=I();s(0,"button",101),h("click",function(){x(e);let r=u(4);return f(r.finishWorkoutAndReportStatus())}),m(1," Confirm & Save Workout "),a()}}function bn(n,t){n&1&&(s(0,"button",102),m(1," Back to Workouts "),a())}function kn(n,t){n&1&&(s(0,"button",103),m(1," Go Back "),a())}function wn(n,t){if(n&1&&(s(0,"div",94)(1,"h2",95),m(2),a(),_(3,Sn,2,1,"p",96)(4,yn,2,0,"button",97)(5,bn,2,0,"button",98)(6,kn,2,0,"button",99),a()),n&2){let e=u(3);l(2),C(" ",e.sessionState()==="error"?"Error Loading Workout":e.currentWorkoutLogExercises().length===0?"Workout Ended":"Workout Complete!"," "),l(),p("ngIf",e.sessionState()!=="error"),l(),p("ngIf",e.sessionState()!=="error"&&e.currentWorkoutLogExercises().length>0),l(),p("ngIf",e.sessionState()!=="error"&&e.currentWorkoutLogExercises().length===0),l(),p("ngIf",e.sessionState()==="error")}}function En(n,t){if(n&1){let e=I();s(0,"div")(1,"div",106),m(2,"UP NEXT"),a(),s(3,"div",107),m(4),a(),s(5,"div",108),m(6),O(7,"number"),s(8,"button",109),h("click",function(){x(e);let r=u(4);return f(r.skipRest())}),m(9,"(Skip)"),a()()()}if(n&2){let e=u(4);l(3),p("title",e.restTimerNextUpText()),l(),C(" ",e.restTimerNextUpText()||"Next Exercise"," "),l(2),C(" Rest: ",e.restTimerDisplay()||Z(7,3,e.restDuration(),"1.0-0")+"s"," ")}}function In(n,t){if(n&1){let e=I();s(0,"div")(1,"div",107),m(2),a(),s(3,"div",110),m(4),a(),s(5,"button",111),h("click",function(){x(e);let r=u(4);return f(r.skipPresetTimer())}),m(6,"(Skip Countdown)"),a()()}if(n&2){let e=u(4);l(),p("title",e.restTimerMainText()),l(),C(" ",e.restTimerMainText()," "),l(2),C(" ",e.presetTimerCountdownDisplay(),"s ")}}function Cn(n,t){if(n&1&&(s(0,"footer",104)(1,"div",105),_(2,En,10,6,"div",39)(3,In,7,3,"div",39),a()()),n&2){let e=u(3);l(2),p("ngIf",e.playerSubState()===e.PlayerSubState.Resting&&!e.isRestTimerVisible()),l(),p("ngIf",e.playerSubState()===e.PlayerSubState.PresetCountdown)}}function Tn(n,t){if(n&1){let e=I();te(0),s(1,"header",18)(2,"button",19),h("click",function(){x(e);let r=u(2);return f(r.goBack())}),E(),s(3,"svg",20),b(4,"path",21),a()(),D(),s(5,"div",22)(6,"h1",23),m(7),a(),s(8,"div",24),m(9),a()(),s(10,"button",25),h("click",function(){x(e);let r=u(2);return f(r.toggleWorkoutMenu())}),E(),s(11,"svg",26),b(12,"path",27),a()()(),D(),s(13,"main",28),_(14,vn,19,14,"div",29)(15,wn,7,5,"ng-template",null,2,ne),a(),_(17,Cn,4,2,"footer",30),ie()}if(n&2){let e=t.ngIf,i=re(16),r=u(2);l(6),p("title",e.name),l(),C(" ",e.name||"Workout"," "),l(2),V(r.sessionTimerDisplay()),l(),p("disabled",r.sessionState()==="loading"||r.sessionState()==="error"||r.sessionState()==="paused"&&!r.isWorkoutMenuVisible()),l(3),fe("pb-24",!0),l(),p("ngIf",r.activeSetInfo())("ngIfElse",i),l(3),p("ngIf",r.routine()&&r.sessionState()==="playing"&&r.activeSetInfo()&&(r.playerSubState()===r.PlayerSubState.Resting&&!r.isRestTimerVisible()||r.playerSubState()===r.PlayerSubState.PresetCountdown))}}function Pn(n,t){if(n&1){let e=I();s(0,"div",112)(1,"button",113),h("click",function(){x(e);let r=u(2);return f(r.goBack())}),E(),s(2,"svg",20),b(3,"path",21),a()(),D(),s(4,"div",22)(5,"h1",114),m(6,"Error"),a()(),b(7,"div",115),a(),s(8,"div",116)(9,"h2",117),m(10,"Routine Not Found"),a(),s(11,"p",118),m(12,"The selected routine could not be loaded."),a(),s(13,"button",119),E(),s(14,"svg",20),b(15,"path",21),a()()()}}function Rn(n,t){if(n&1&&(s(0,"div",10),_(1,qr,9,1,"div",11)(2,Tn,18,9,"ng-container",12)(3,Pn,16,0,"ng-template",null,1,ne),a()),n&2){let e=re(4),i=u();l(),p("ngIf",i.sessionState()==="paused"),l(),p("ngIf",i.routine())("ngIfElse",e)}}function Wn(n,t){n&1&&(s(0,"span",145),m(1,"(already started main sets)"),a())}function Vn(n,t){if(n&1){let e=I();s(0,"div",120)(1,"div",121),b(2,"div"),s(3,"button",122),h("click",function(){x(e);let r=u();return f(r.closeWorkoutMenu())}),E(),s(4,"svg",123),b(5,"path",124),a()(),D(),b(6,"div"),a(),s(7,"h2",125),m(8,"Workout Menu"),a(),s(9,"button",126),h("click",function(){x(e);let r=u();return f(r.pauseSession())}),E(),s(10,"svg",127),b(11,"circle",128)(12,"rect",129)(13,"rect",130),a(),m(14," Pause Workout "),a(),D(),s(15,"button",131),h("click",function(){x(e);let r=u();return f(r.jumpToExercise())}),E(),s(16,"svg",132),b(17,"path",133),a(),m(18," Jump to Exercise "),a(),D(),s(19,"button",134),h("click",function(){x(e);let r=u();return f(r.openPerformanceInsightsFromMenu())}),E(),s(20,"svg",135),b(21,"path",136),a(),m(22," Performance Insights "),a(),D(),s(23,"button",137),h("click",function(){x(e);let r=u();return f(r.addWarmupSet())}),s(24,"p"),m(25,"+ Add Warm-up Set"),a(),_(26,Wn,2,0,"span",138),a(),s(27,"button",139),h("click",function(){x(e);let r=u();return f(r.addExerciseDuringSession())}),m(28," + Add Exercise to Session "),a(),s(29,"button",140),h("click",function(){x(e);let r=u();return f(r.skipCurrentSet())}),m(30," Skip Current Set "),a(),s(31,"button",141),h("click",function(){x(e);let r=u();return f(r.skipCurrentExercise())}),m(32," Mark Exercise as Skipped "),a(),s(33,"button",142),h("click",function(){x(e);let r=u();return f(r.markCurrentExerciseDoLater())}),m(34," Mark Exercise for Later "),a(),s(35,"button",143),h("click",function(){x(e);let r=u();return f(r.finishWorkoutEarly())}),m(36," Finish Workout Early "),a(),s(37,"button",144),h("click",function(){x(e);let r=u();return f(r.quitWorkout())}),m(38," Quit Workout (No Save) "),a()()}if(n&2){let e,i=u();l(9),p("disabled",i.sessionState()!=="playing"),l(6),p("disabled",i.sessionState()==="paused"||!(!((e=i.routine())==null||e.exercises==null)&&e.exercises.length)),l(4),p("disabled",i.sessionState()==="paused"||!i.activeSetInfo()),l(4),p("disabled",!i.canAddWarmupSet()||i.sessionState()==="paused"||!i.activeSetInfo()),l(3),p("ngIf",!i.canAddWarmupSet()),l(),p("disabled",i.sessionState()==="paused"),l(2),p("disabled",!i.activeSetInfo()||i.sessionState()==="paused"),l(2),p("disabled",!i.activeSetInfo()||i.sessionState()==="paused"),l(2),p("disabled",!i.activeSetInfo()||i.sessionState()==="paused"),l(2),p("disabled",i.sessionState()==="paused")}}function Fn(n,t){n&1&&(s(0,"span",185),m(1,"(Warm-up) "),a())}function Dn(n,t){if(n&1&&(s(0,"span"),m(1,"Reps: "),s(2,"strong",186),m(3),a()()),n&2){let e=u().$implicit;l(3),V(e.repsAchieved)}}function Mn(n,t){if(n&1&&(s(0,"span"),m(1,"Weight: "),s(2,"strong",186),m(3),O(4,"weightUnit"),a()()),n&2){let e=u().$implicit;l(3),V($(4,1,e.weightUsed))}}function Ln(n,t){if(n&1&&(s(0,"span",187),m(1,"Time: "),s(2,"strong",186),m(3),a()()),n&2){let e=u().$implicit;l(3),C("",e.durationPerformed,"s")}}function On(n,t){if(n&1&&(s(0,"p",188),m(1),a()),n&2){let e=u().$implicit;l(),C(" ",e.notes," ")}}function An(n,t){if(n&1&&(s(0,"div",179)(1,"p",180),_(2,Fn,2,0,"span",181),m(3),a(),s(4,"div",182),_(5,Dn,4,1,"span",39)(6,Mn,5,3,"span",39)(7,Ln,4,1,"span",183),a(),_(8,On,2,1,"p",184),a()),n&2){let e=t.$implicit,i=t.index;l(2),p("ngIf",e.type==="warmup"),l(),C(" Set #",i+1,": "),l(2),p("ngIf",e.repsAchieved!==void 0),l(),p("ngIf",e.weightUsed!==void 0&&e.weightUsed!==null),l(),p("ngIf",e.durationPerformed!==void 0),l(),p("ngIf",e.notes)}}function Nn(n,t){if(n&1&&(s(0,"div",177),_(1,An,9,6,"div",178),a()),n&2){let e=u(3);l(),p("ngForOf",e.allPreviousLoggedSetsForCurrentExercise())}}function Bn(n,t){n&1&&(s(0,"div",189),m(1," No sets completed yet for this exercise in this workout. "),a())}function $n(n,t){n&1&&(s(0,"span",185),m(1," (Warm-up)"),a())}function Un(n,t){if(n&1&&(s(0,"span"),m(1,"Reps: "),s(2,"strong",186),m(3),a()()),n&2){let e=u().$implicit;l(3),V(e.repsAchieved)}}function Gn(n,t){if(n&1&&(s(0,"span"),m(1,"Weight: "),s(2,"strong",186),m(3),O(4,"weightUnit"),a()()),n&2){let e=u().$implicit;l(3),V($(4,1,e.weightUsed))}}function jn(n,t){if(n&1&&(s(0,"span",187),m(1,"Time: "),s(2,"strong",186),m(3),a()()),n&2){let e=u().$implicit;l(3),C("",e.durationPerformed,"s")}}function Hn(n,t){if(n&1&&(s(0,"p",188),m(1),a()),n&2){let e=u().$implicit;l(),C(" ",e.notes," ")}}function zn(n,t){if(n&1&&(s(0,"div",179)(1,"p",180)(2,"span",191),m(3),a(),_(4,$n,2,0,"span",181),m(5),a(),s(6,"div",182),_(7,Un,4,1,"span",39)(8,Gn,5,3,"span",39)(9,jn,4,1,"span",183),a(),_(10,Hn,2,1,"p",184),a()),n&2){let e=t.$implicit,i=t.index;l(3),C("",e.exerciseName||"Exercise",":"),l(),p("ngIf",e.type==="warmup"),l(),C(" Set #",i+1,": "),l(2),p("ngIf",e.repsAchieved!==void 0),l(),p("ngIf",e.weightUsed!==void 0&&e.weightUsed!==null),l(),p("ngIf",e.durationPerformed!==void 0),l(),p("ngIf",e.notes)}}function qn(n,t){if(n&1&&(s(0,"div",190),_(1,zn,11,7,"div",178),a()),n&2){let e=u(3);l(),p("ngForOf",e.allPreviousLoggedSetsForCurrentSession())}}function Jn(n,t){n&1&&(s(0,"div",189),m(1," No sets logged today for any exercise yet. "),a())}function Kn(n,t){if(n&1&&(s(0,"li",200)(1,"span",201),m(2,"Reps:"),a(),s(3,"strong",202),m(4),a()()),n&2){let e=u().ngIf;l(4),V(e.repsAchieved)}}function Yn(n,t){if(n&1&&(s(0,"li",200)(1,"span",201),m(2,"Weight:"),a(),s(3,"strong",202),m(4),O(5,"weightUnit"),a()()),n&2){let e=u().ngIf;l(4),V($(5,1,e.weightUsed))}}function Qn(n,t){if(n&1&&(s(0,"li",200)(1,"span",201),m(2,"Time:"),a(),s(3,"strong",202),m(4),a()()),n&2){let e=u().ngIf;l(4),C("",e.durationPerformed,"s")}}function Zn(n,t){if(n&1&&(s(0,"li",203),m(1),a()),n&2){let e=u().ngIf;l(),C("Notes: ",e.notes)}}function Xn(n,t){if(n&1&&(s(0,"div",192)(1,"p",193)(2,"span",194),E(),s(3,"svg",195),b(4,"path",196),a(),m(5),O(6,"date"),a()(),D(),s(7,"ul",197),_(8,Kn,5,1,"li",198)(9,Yn,6,3,"li",198)(10,Qn,5,1,"li",198)(11,Zn,2,1,"li",199),a()()),n&2){let e=t.ngIf,i=u(3);l(5),C(" Last time (",Z(6,5,i.lastPerformanceForCurrentExercise==null?null:i.lastPerformanceForCurrentExercise.lastPerformedDate,"dd/MM/yy HH:mm"),"): "),l(3),p("ngIf",e.repsAchieved!==void 0),l(),p("ngIf",e.weightUsed!==void 0&&e.weightUsed!==null),l(),p("ngIf",e.durationPerformed!==void 0),l(),p("ngIf",e.notes)}}function eo(n,t){n&1&&(s(0,"div",204),m(1," No previous performance recorded for this exercise yet. "),a())}function to(n,t){if(n&1&&(s(0,"div")(1,"span"),m(2),a(),s(3,"strong",212),m(4),a(),s(5,"em",213),m(6),O(7,"date"),a()()),n&2){let e=t.$implicit,i=u(5);l(2),C("",e.pbType,": "),l(2),V(i.formatPbValue(e)),l(2),C(" (",Z(7,3,e.timestamp,"shortDate"),")")}}function io(n,t){if(n&1&&(s(0,"div",210),_(1,to,8,6,"div",211),a()),n&2){let e=u(4);l(),p("ngForOf",e.exercisePBs())}}function ro(n,t){if(n&1&&(s(0,"div",214),m(1),a()),n&2){let e,i=u(4);l(),C(" No personal bests recorded yet for ",(e=i.currentBaseExercise())==null?null:e.name,". ")}}function no(n,t){if(n&1&&(s(0,"div",205)(1,"p",206)(2,"span",194),E(),s(3,"svg",195),b(4,"path",207),a(),m(5),a()(),_(6,io,2,1,"div",208)(7,ro,2,1,"div",209),a()),n&2){let e,i,r=u(3);l(5),C(" Personal Bests for ",((e=r.currentBaseExercise())==null?null:e.name)||"this exercise",": "),l(),p("ngIf",r.exercisePBs().length>0),l(),p("ngIf",r.currentBaseExercise()&&r.exercisePBs().length===0&&!(!((i=r.currentBaseExercise())==null||i.id==null)&&i.id.startsWith("custom-")))}}function oo(n,t){if(n&1){let e=I();s(0,"div",219),h("click",function(){x(e);let r=u(4);return f(r.startEditTarget("reps"))}),m(1),a()}if(n&2){let e=u(2).ngIf;l(),C(" ",e.setData.reps," ")}}function so(n,t){if(n&1){let e=I();s(0,"div",220)(1,"input",221),Ne("ngModelChange",function(r){x(e);let o=u(4);return Ae(o.editingTargetValue,r)||(o.editingTargetValue=r),f(r)}),h("keyup.enter",function(){x(e);let r=u(4);return f(r.confirmEditTarget())})("keyup.escape",function(){x(e);let r=u(4);return f(r.cancelEditTarget())}),a(),s(2,"button",222),h("click",function(){x(e);let r=u(4);return f(r.confirmEditTarget())}),E(),s(3,"svg",223),b(4,"path",224),a()(),D(),s(5,"button",225),h("click",function(){x(e);let r=u(4);return f(r.cancelEditTarget())}),E(),s(6,"svg",223),b(7,"path",226),a()()()}if(n&2){let e=u(4);l(),Oe("ngModel",e.editingTargetValue)}}function ao(n,t){if(n&1&&(s(0,"div",215)(1,"label",216),m(2,"Target Reps"),a(),_(3,oo,2,1,"div",217)(4,so,8,1,"div",218),a()),n&2){let e=u(3);l(3),p("ngIf",e.editingTarget!=="reps"),l(),p("ngIf",e.editingTarget==="reps")}}function lo(n,t){if(n&1){let e=I();s(0,"div",219),h("click",function(){x(e);let r=u(4);return f(r.startEditTarget("weight"))}),m(1),O(2,"weightUnit"),a()}if(n&2){let e=u(2).ngIf;l(),C(" ",$(2,1,e.setData.weight)," ")}}function co(n,t){if(n&1){let e=I();s(0,"div",220)(1,"input",221),Ne("ngModelChange",function(r){x(e);let o=u(4);return Ae(o.editingTargetValue,r)||(o.editingTargetValue=r),f(r)}),h("keyup.enter",function(){x(e);let r=u(4);return f(r.confirmEditTarget())})("keyup.escape",function(){x(e);let r=u(4);return f(r.cancelEditTarget())}),a(),s(2,"button",222),h("click",function(){x(e);let r=u(4);return f(r.confirmEditTarget())}),E(),s(3,"svg",223),b(4,"path",224),a()(),D(),s(5,"button",225),h("click",function(){x(e);let r=u(4);return f(r.cancelEditTarget())}),E(),s(6,"svg",223),b(7,"path",226),a()()()}if(n&2){let e=u(4);l(),Oe("ngModel",e.editingTargetValue)}}function uo(n,t){if(n&1&&(s(0,"div",215)(1,"label",216),m(2,"Target Weight"),a(),_(3,lo,3,3,"div",217)(4,co,8,1,"div",218),a()),n&2){let e=u(3);l(3),p("ngIf",e.editingTarget!=="weight"),l(),p("ngIf",e.editingTarget==="weight")}}function mo(n,t){if(n&1){let e=I();s(0,"div",219),h("click",function(){x(e);let r=u(4);return f(r.startEditTarget("duration"))}),m(1),s(2,"span",227),m(3,"s"),a()()}if(n&2){let e=u(2).ngIf;l(),C(" ",e.setData.duration)}}function po(n,t){if(n&1){let e=I();s(0,"div",220)(1,"input",221),Ne("ngModelChange",function(r){x(e);let o=u(4);return Ae(o.editingTargetValue,r)||(o.editingTargetValue=r),f(r)}),h("keyup.enter",function(){x(e);let r=u(4);return f(r.confirmEditTarget())})("keyup.escape",function(){x(e);let r=u(4);return f(r.cancelEditTarget())}),a(),s(2,"button",222),h("click",function(){x(e);let r=u(4);return f(r.confirmEditTarget())}),E(),s(3,"svg",223),b(4,"path",224),a()(),D(),s(5,"button",225),h("click",function(){x(e);let r=u(4);return f(r.cancelEditTarget())}),E(),s(6,"svg",223),b(7,"path",226),a()()()}if(n&2){let e=u(4);l(),Oe("ngModel",e.editingTargetValue)}}function go(n,t){if(n&1&&(s(0,"div",215)(1,"label",216),m(2,"Target Time"),a(),_(3,mo,4,1,"div",217)(4,po,8,1,"div",218),a()),n&2){let e=u(3);l(3),p("ngIf",e.editingTarget!=="duration"),l(),p("ngIf",e.editingTarget==="duration")}}function xo(n,t){if(n&1&&(s(0,"div",215)(1,"label",216),m(2,"Target Tempo"),a(),s(3,"span",228),m(4),a()()),n&2){let e=u().ngIf;l(4),V(e.setData.tempo)}}function fo(n,t){if(n&1&&(s(0,"div",229)(1,"p",230)(2,"span",194),E(),s(3,"svg",195),b(4,"path",231),a(),m(5," Planned Notes for this Set: "),a()(),D(),s(6,"p",232),m(7),a()()),n&2){let e=u().ngIf;l(7),V(e.setData.notes)}}function ho(n,t){if(n&1){let e=I();s(0,"div",158)(1,"div",159)(2,"button",160),h("click",function(){x(e);let r=u(2);return f(r.toggleCompletedSetsForExerciseInfo())}),s(3,"span",161),E(),s(4,"svg",162),b(5,"path",136),a(),m(6),a(),s(7,"svg",163),b(8,"path",164),a()(),_(9,Nn,2,1,"div",165)(10,Bn,2,0,"div",166),a(),D(),s(11,"div",159)(12,"button",160),h("click",function(){x(e);let r=u(2);return f(r.toggleCompletedSetsForDayInfo())}),s(13,"span",161),E(),s(14,"svg",162),b(15,"path",167),a(),m(16),a(),s(17,"svg",163),b(18,"path",164),a()(),_(19,qn,2,1,"div",168)(20,Jn,2,0,"div",166),a(),_(21,Xn,12,8,"div",169)(22,eo,2,0,"div",170)(23,no,8,3,"div",171),D(),s(24,"div",172)(25,"h4",173),m(26,"Set Targets:"),a(),s(27,"div",174),_(28,ao,5,2,"div",175)(29,uo,5,2,"div",175)(30,go,5,2,"div",175)(31,xo,5,1,"div",175),a()(),_(32,fo,8,1,"div",176),a()}if(n&2){let e,i,r,o=t.ngIf,d=u(2);l(6),G(" This Exercise (",((e=d.currentBaseExercise())==null?null:e.name)||"Current",") - Completed Sets (",d.allPreviousLoggedSetsForCurrentExercise().length,") "),l(),p("ngClass",he(17,ti,d.showCompletedSetsForExerciseInfo())),l(2),p("ngIf",d.allPreviousLoggedSetsForCurrentExercise().length>0&&d.showCompletedSetsForExerciseInfo()),l(),p("ngIf",d.allPreviousLoggedSetsForCurrentExercise().length===0&&d.showCompletedSetsForExerciseInfo()),l(6),C(" Today's Logged Sets (All Exercises) (",d.allPreviousLoggedSetsForCurrentSession().length,") "),l(),p("ngClass",he(19,ti,d.showCompletedSetsForDayInfo())),l(2),p("ngIf",d.allPreviousLoggedSetsForCurrentSession().length>0&&d.showCompletedSetsForDayInfo()),l(),p("ngIf",d.allPreviousLoggedSetsForCurrentSession().length===0&&d.showCompletedSetsForDayInfo()),l(),p("ngIf",d.trackingService.findPreviousSetPerformance(d.lastPerformanceForCurrentExercise,o.setData,o.setIndex)),l(),p("ngIf",!d.lastPerformanceForCurrentExercise&&d.activeSetInfo()&&!(!((i=d.activeSetInfo())==null||i.exerciseData==null||i.exerciseData.exerciseId==null)&&i.exerciseData.exerciseId.startsWith("custom-"))),l(),p("ngIf",d.exercisePBs().length>0||d.currentBaseExercise()&&!(!((r=d.currentBaseExercise())==null||r.id==null)&&r.id.startsWith("custom-"))),l(5),p("ngIf",o.setData.reps!==void 0),l(),p("ngIf",o.setData.weight!==void 0&&o.setData.weight!==null),l(),p("ngIf",o.setData.duration!==void 0),l(),p("ngIf",o.setData.tempo),l(),p("ngIf",o.setData.notes)}}function _o(n,t){if(n&1){let e=I();s(0,"div",146)(1,"div",147)(2,"header",148)(3,"div",149),E(),s(4,"svg",150),b(5,"path",151),a(),D(),s(6,"h3",152),m(7,"Performance Insights & Targets"),a()(),s(8,"button",122),h("click",function(){x(e);let r=u();return f(r.closePerformanceInsights())}),E(),s(9,"svg",153),b(10,"path",154),a()()(),_(11,ho,33,21,"div",155),D(),s(12,"footer",156)(13,"button",157),h("click",function(){x(e);let r=u();return f(r.closePerformanceInsights())}),m(14," Done "),a()()()()}if(n&2){let e=u();l(11),p("ngIf",e.activeSetInfo())}}function vo(n,t){if(n&1){let e=I();s(0,"li",251),h("click",function(){let r=x(e).$implicit,o=u(2);return f(o.selectExerciseToAddFromModal(r))}),s(1,"div")(2,"span",252),m(3),a(),s(4,"span",253),m(5),O(6,"titlecase"),O(7,"titlecase"),a()(),E(),s(8,"svg",254),b(9,"path",255),a()()}if(n&2){let e=t.$implicit;l(3),V(e.name),l(2),G("",$(6,3,e.category)," - ",$(7,5,e.primaryMuscleGroup))}}function So(n,t){n&1&&(s(0,"li",256),m(1,"No exercises match your search."),a())}function yo(n,t){n&1&&(s(0,"li",256),m(1,"Exercise library is empty or still loading."),a())}function bo(n,t){if(n&1){let e=I();s(0,"div",233),h("click",function(){x(e);let r=u();return f(r.closeExerciseSelectionModal())}),s(1,"div",234),h("click",function(r){return x(e),f(r.stopPropagation())}),s(2,"div",235)(3,"div",236)(4,"h3",237),m(5,"Add Exercise to Session"),a(),s(6,"button",238),h("click",function(){x(e);let r=u();return f(r.closeExerciseSelectionModal())}),E(),s(7,"svg",239),b(8,"path",240),a()()(),D(),s(9,"div",241)(10,"input",242),h("ngModelChange",function(r){x(e);let o=u();return f(o.modalSearchTerm.set(r))}),a()(),s(11,"div",243)(12,"ul",244),_(13,vo,10,7,"li",245)(14,So,2,0,"li",246)(15,yo,2,0,"li",246),a()(),s(16,"div",247)(17,"button",248),h("click",function(){x(e);let r=u();return f(r.handleTrulyCustomExerciseEntry())}),m(18," Or, create a new custom exercise entry... "),a()()(),s(19,"div",249)(20,"button",250),h("click",function(){x(e);let r=u();return f(r.closeExerciseSelectionModal())}),m(21," Cancel "),a()()()()}if(n&2){let e=u();l(10),p("ngModel",e.modalSearchTerm()),l(3),p("ngForOf",e.filteredAvailableExercises()),l(),p("ngIf",e.filteredAvailableExercises().length===0&&e.availableExercises.length>0),l(),p("ngIf",e.availableExercises.length===0)}}function ko(n,t){n&1&&(s(0,"div",257)(1,"p",258),m(2,"Loading workout player..."),a()())}function wo(n,t){if(n&1){let e=I();s(0,"app-modal",259),Ne("isOpenChange",function(r){x(e);let o=u();return Ae(o.isSimpleModalOpen,r)||(o.isSimpleModalOpen=r),f(r)}),b(1,"app-exercise-detail",260),a()}if(n&2){let e=u();Oe("isOpen",e.isSimpleModalOpen),p("modalTitle",e.exerciseDetailsName),l(),p("id",e.exerciseDetailsId)("isModal",!0)}}var ii=(i=>(i.PerformingSet="performing_set",i.PresetCountdown="preset_countdown",i.Resting="resting",i))(ii||{}),ut=class n{route=R(we);router=R(ue);workoutService=R(Te);exerciseService=R(pe);trackingService=R(me);alertService=R(Ce);toastService=R(Pe);fb=R(et);storageService=R(rt);cdr=R(je);unitService=R(Re);appSettingsService=R(Qt);platformId=R(ye);routine=T(void 0);program=T(void 0);sessionState=T("loading");PlayerSubState=ii;playerSubState=T("performing_set");currentExerciseIndex=T(0);currentSetIndex=T(0);currentBlockRound=T(1);totalBlockRounds=T(1);sessionTimerDisplay=T("00:00:00");workoutStartTime=0;sessionTimerElapsedSecondsBeforePause=0;timerSub;timedSetTimerState=T("idle");timedSetElapsedSeconds=T(0);timedSetIntervalSub;soundPlayedForThisCountdownSegment=!1;presetTimerCountdownDisplay=T(null);presetTimerDuration=T(0);presetTimerSub;isRestTimerVisible=T(!1);restDuration=T(0);restTimerDisplay=T(null);restTimerMainText=T("RESTING");restTimerNextUpText=T(null);nextActionButtonLabel=B(()=>{switch(this.playerSubState()){case"preset_countdown":return"GETTING READY...";case"resting":return"RESTING...";case"performing_set":default:return"SET DONE"}});currentSetForm;lastPerformanceForCurrentExercise=null;editingTarget=null;editingTargetValue="";routineId=null;isExerciseModalOpen=T(!1);availableExercises=[];modalSearchTerm=T("");filteredAvailableExercises=B(()=>{let t=this.modalSearchTerm().toLowerCase();return t?this.availableExercises.filter(e=>e.name.toLowerCase().includes(t)||e.category.toLowerCase().includes(t)||e.primaryMuscleGroup&&e.primaryMuscleGroup.toLowerCase().includes(t)):this.availableExercises});PAUSED_WORKOUT_KEY="fitTrackPro_pausedWorkoutState";PAUSED_STATE_VERSION="1.2";originalRoutineSnapshot=[];currentWorkoutLogExercises=T([]);wasRestTimerVisibleOnPause=!1;restTimerRemainingSecondsOnPause=0;restTimerInitialDurationOnPause=0;restTimerMainTextOnPause="RESTING";restTimerNextUpTextOnPause=null;wasTimedSetRunningOnPause=!1;autoSaveSub;AUTO_SAVE_INTERVAL_MS=8e3;isSessionConcluded=!1;routerEventsSub;isInitialLoadComplete=!1;exercisesProposedThisCycle={doLater:!1,skipped:!1};shouldStartWithPresetTimer=B(()=>{let t=this.activeSetInfo();if(!t)return!1;let e=this.appSettingsService.enablePresetTimer(),i=this.appSettingsService.presetTimerDurationSeconds();if(!e||i<=0)return!1;let r=this.routine(),o=t.exerciseIndex,d=t.setIndex;if(!r||!r.exercises[o]||!r.exercises[o].sets[d])return!1;let c=o===0&&d===0&&this.currentBlockRound()===1,g=1/0;if(d>0)g=r.exercises[o].sets[d-1].restAfterSet;else if(o>0){let y=r.exercises[o-1];g=y.sets[y.sets.length-1].restAfterSet}return c||g===0});mainActionButtonLabel=B(()=>{let t=this.activeSetInfo(),e=this.routine();switch(this.playerSubState()){case"preset_countdown":return`PREPARING... ${this.presetTimerCountdownDisplay()}s`;case"resting":return`RESTING: ${this.restTimerDisplay()}`;case"performing_set":if(this.checkIfLatestSetOfWorkoutConsideringPending()){let i=this.activeSetInfo()?.exerciseData.sessionStatus;if(i==="skipped"||i==="do_later"){if(t&&e&&t.exerciseData.sets.length>0){let r=this.currentWorkoutLogExercises().find(d=>d.exerciseId===t.exerciseData.exerciseId);if(!(r&&r.sets.length===t.exerciseData.sets.length))return this.checkIfSetIsPartOfRounds()?this.checkIfLatestSetOfRound()?"COMPLETE ROUND":"SET DONE":this.checkIfLatestSetOfExercise()?"COMPLETE EXERCISE":"SET DONE"}return i==="skipped"?"SKIPPED":"DO LATER"}if(t!==null){let r=this.currentWorkoutLogExercises().find(d=>d.exerciseId===t.exerciseData.exerciseId);if(r&&r.sets.length===t.exerciseData.sets.length){if(this.checkIfLatestSetOfExercise())return this.checkIfSetIsPartOfRounds()?this.checkIfLatestSetOfRound()?this.checkIfLatestRoundOfRounds()?"FINISH WORKOUT":"COMPLETE ROUND":"COMPLETE EXERCISE":"SET DONE"}else return this.checkIfSetIsPartOfRounds()?this.checkIfLatestSetOfRound()?"COMPLETE ROUND":"SET DONE":this.checkIfLatestSetOfExercise()?"COMPLETE EXERCISE":"SET DONE"}return"FINISH WORKOUT"}else return this.checkIfLatestSetOfExercise()?this.checkIfSetIsPartOfRounds()&&this.checkIfLatestSetOfRound()?"COMPLETE ROUND":"COMPLETE EXERCISE":"SET DONE";default:return"SET DONE"}});routeSub;rpeValue=T(null);rpeOptions=Array.from({length:10},(t,e)=>e+1);showRpeSlider=T(!1);timedSetDisplay=B(()=>{let t=this.timedSetTimerState(),e=this.timedSetElapsedSeconds(),r=this.activeSetInfo()?.setData?.duration;return t==="idle"?(r!==void 0&&r>0?r:this.csf?.actualDuration?.value??0).toString():r!==void 0&&r>0?(r-e).toString():e.toString()});isTimedSetOvertime=B(()=>{if(this.timedSetTimerState()==="idle")return!1;let e=this.timedSetElapsedSeconds(),i=this.activeSetInfo()?.setData?.duration;return i!==void 0&&i>0&&e>i});unloadNotification(t){this.sessionState()==="playing"&&this.routine()&&this.currentWorkoutLogExercises().length>0&&this.captureAndSaveStateForUnload()}get weightUnitDisplaySymbol(){return this.unitService.getUnitLabel()}getWorkingSetCountForCurrentExercise=B(()=>{let t=this.routine(),e=this.currentExerciseIndex();return t&&t.exercises[e]?t.exercises[e].sets.filter(i=>i.type!=="warmup").length:0});getCurrentWorkingSetNumber=B(()=>{let t=this.activeSetInfo(),e=this.routine();if(!t||!e||t.type==="warmup")return 0;let i=e.exercises[t.exerciseIndex],r=0;for(let o=0;o<=t.setIndex;o++)i.sets[o].type!=="warmup"&&r++;return r});getCurrentWarmupSetNumber=B(()=>{let t=this.activeSetInfo(),e=this.routine();if(!t||!e||t.type!=="warmup")return 0;let i=e.exercises[t.exerciseIndex],r=0;for(let o=0;o<=t.setIndex;o++)i.sets[o].type==="warmup"&&r++;return r});activeSetInfo=B(()=>{let t=this.routine(),e=this.currentExerciseIndex(),i=this.currentSetIndex();if(t&&t.exercises[e]&&t.exercises[e].sets[i]){let r=t.exercises[e],o=t.exercises[e].sets[i],c=this.currentWorkoutLogExercises().find(g=>g.exerciseId===r.exerciseId)?.sets.find(g=>g.plannedSetId===o.id);return{exerciseIndex:e,setIndex:i,exerciseData:r,setData:o,type:o.type??"standard",baseExerciseInfo:void 0,isCompleted:!!c,actualReps:c?.repsAchieved,actualWeight:c?.weightUsed,actualDuration:c?.durationPerformed,notes:c?.notes}}return null});currentBaseExercise=T(void 0);exercisePBs=T([]);allPreviousLoggedSetsForCurrentExercise=B(()=>{let t=this.activeSetInfo();if(!t||t.setIndex===0)return[];let e=this.currentWorkoutLogExercises().find(i=>i.exerciseId===t.exerciseData.exerciseId);if(e&&e.sets.length>0){let i=[];for(let r=0;r<t.setIndex;r++){let o=t.exerciseData.sets[r]?.id;if(o){let d=e.sets.find(c=>c.plannedSetId===o);d&&i.push(d)}}return i}return[]});allPreviousLoggedSetsForCurrentSession=B(()=>{let t=this.activeSetInfo();if(!t)return[];let e=[];for(let i of this.currentWorkoutLogExercises())for(let r of i.sets){let o=this.routine();if(!o)continue;let d=o.exercises.findIndex(c=>c.exerciseId===i.exerciseId);if(!(d<0)){if(d<t.exerciseIndex)e.push(r);else if(d===t.exerciseIndex){let c=o.exercises[d].sets.findIndex(g=>g.id===r.plannedSetId);c>-1&&c<t.setIndex&&e.push(r)}}}return e});isWorkoutMenuVisible=T(!1);isPerformanceInsightsVisible=T(!1);showCompletedSetsInfo=T(!1);isPerformingDeferredExercise=!1;lastActivatedDeferredExerciseId=null;constructor(){this.initializeCurrentSetForm()}resetAndPatchCurrentSetForm(){this.currentSetForm.reset({rpe:null,setNotes:""}),this.rpeValue.set(null),this.showRpeSlider.set(!1),this.resetTimedSet(),this.patchActualsFormBasedOnSessionTargets()}startSessionTimer(){this.sessionState()!=="paused"&&(this.timerSub&&this.timerSub.unsubscribe(),this.timerSub=Ue(0,1e3).subscribe(()=>{if(this.sessionState()==="playing"){let t=Math.floor((Date.now()-this.workoutStartTime)/1e3),e=this.sessionTimerElapsedSecondsBeforePause+t,i=Math.floor(e/3600),r=Math.floor(e%3600/60),o=e%60;this.sessionTimerDisplay.set(`${String(i).padStart(2,"0")}:${String(r).padStart(2,"0")}:${String(o).padStart(2,"0")}`)}}))}updateRestTimerDisplay(t){let e=Math.floor(t/60),i=t%60;this.restTimerDisplay.set(`${String(e).padStart(2,"0")}:${String(i).padStart(2,"0")}`)}addLoggedSetToCurrentLog(t,e){let i=this.currentWorkoutLogExercises(),r=this.routine()?.exercises.findIndex(c=>c.id===t.id),o,d=-1;for(let c=0;c<i.length;c++){let g=i[c],y=this.routine()?.exercises[c];if(g.exerciseId===t.exerciseId&&y&&y.id===t.id){o=g,d=c;break}}if(o){let c=o.sets.findIndex(g=>g.plannedSetId===e.plannedSetId);c>-1?o.sets[c]=e:o.sets.push(e)}else{let c=this.currentBaseExercise()?.name||t.exerciseName||"Unknown Exercise",g={exerciseId:t.exerciseId,exerciseName:c,sets:[e],rounds:t.rounds||0,type:e.type||"standard"};typeof r=="number"&&r>=0&&r<=i.length?i.splice(r,0,g):i.push(g)}this.currentWorkoutLogExercises.set([...i])}finishWorkout(){return L(this,null,function*(){yield this.finishWorkoutAndReportStatus()})}comparePerformedToOriginal(t,e){let i=[],r=!1,o=e.filter(g=>t.some(y=>y.exerciseId===g.exerciseId)),d=t.filter(g=>e.some(y=>(y.exerciseId===g.exerciseId||g.exerciseName===y.exerciseName)&&y.type!==g.type)),c=t.filter(g=>!e.some(y=>y.exerciseId===g.exerciseId)&&g.exerciseId.startsWith("custom-exercise-"));(d.length!==e.length||c.length>0)&&(i.push("Number of exercises or their content changed."),r=!0),c.length>0&&i.push(`${c.length} custom exercise(s) added.`);for(let g of e){let y=t.find(v=>v.exerciseId===g.exerciseId);if(!y){i.push(`Exercise "${g.exerciseName||g.exerciseId}" was in the plan but not performed.`),r=!0;continue}if(y.sets.length!==g.sets.length&&y.rounds!==g.rounds)i.push(`Set count for "${y.exerciseName||y.exerciseId}" changed (was ${g.sets.length}, now ${y.sets.length}).`),r=!0;else for(let v=0;v<y.sets.length;v++){let k=g.sets[v]?.type==="warmup",P=y.sets[v]?.type==="warmup";if(k!==P){i.push(`Warm-up status for set ${v+1} of "${y.exerciseName}" changed.`),r=!0;break}}}return{majorDifference:r,details:i}}convertLoggedToWorkoutExercises(t){let e=this.routine();return t.map(i=>{let r=e?.exercises.find(d=>d.exerciseId===i.exerciseId);return{id:N(),exerciseId:i.exerciseId,exerciseName:i.exerciseName,supersetId:r?.supersetId||null,supersetOrder:r?.supersetOrder??null,supersetSize:r?.supersetSize??null,rounds:r?.rounds??1,notes:r?.notes,sets:i.sets.map(d=>{let c=r?.sets.find(g=>g.id===d.plannedSetId);return{id:N(),reps:d.targetReps??d.repsAchieved,weight:d.targetWeight??d.weightUsed,duration:d.targetDuration??d.durationPerformed,tempo:d.targetTempo||c?.tempo,restAfterSet:c?.restAfterSet||60,notes:d.notes,type:d.type}}),type:(r?.supersetSize??0)>=1?"superset":"standard"}})}get csf(){return this.currentSetForm.controls}toggleTimedSetTimer(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Please resume to use the timer.",3e3,"Paused");return}let t=this.timedSetTimerState();t==="idle"||t==="paused"?this.startOrResumeTimedSet():t==="running"&&this.pauseTimedSet()}startOrResumeTimedSet(){if(this.timedSetTimerState()==="idle"){this.timedSetElapsedSeconds.set(0);let t=this.activeSetInfo()?.setData?.duration;t!==void 0&&t>0&&this.currentSetForm.get("actualDuration")?.setValue(t,{emitEvent:!1}),this.soundPlayedForThisCountdownSegment=!1}this.timedSetTimerState.set("running"),this.timedSetIntervalSub&&this.timedSetIntervalSub.unsubscribe(),this.timedSetIntervalSub=Ue(0,1e3).subscribe(()=>{if(this.timedSetTimerState()==="running"){this.timedSetElapsedSeconds.update(d=>d+1);let t=this.timedSetElapsedSeconds();this.currentSetForm.get("actualDuration")?.setValue(t,{emitEvent:!1});let i=this.activeSetInfo()?.setData?.duration,r=this.appSettingsService.enableTimerCountdownSound(),o=this.appSettingsService.countdownSoundSeconds();if(r&&i&&i>20&&t>0){let d=i-t;d<=o&&d>=0&&(d===0?(this.playClientGong(),this.soundPlayedForThisCountdownSegment=!0):this.playClientBeep())}}else this.timedSetIntervalSub&&this.timedSetIntervalSub.unsubscribe()})}pauseTimedSet(){this.timedSetIntervalSub&&(this.timedSetIntervalSub.unsubscribe(),this.timedSetIntervalSub=void 0),this.timedSetTimerState.set("paused")}resetTimedSet(){this.timedSetIntervalSub&&(this.timedSetIntervalSub.unsubscribe(),this.timedSetIntervalSub=void 0),this.timedSetTimerState.set("idle"),this.timedSetElapsedSeconds.set(0);let t=this.activeSetInfo()?.setData?.duration;this.currentSetForm.get("actualDuration")?.setValue(t??0,{emitEvent:!1}),this.soundPlayedForThisCountdownSegment=!1}stopAndLogTimedSet(){(this.timedSetTimerState()==="running"||this.timedSetTimerState()==="paused")&&this.pauseTimedSet()}checkIfLatestSetOfExercise(){let t=this.activeSetInfo(),e=this.routine();if(!t||!e)return!1;if(t.exerciseData.sessionStatus&&t.exerciseData.sessionStatus!=="pending")return!0;let i=e.exercises[t.exerciseIndex];if(t.setIndex===i.sets.length-1)return!0;for(let r=t.setIndex+1;r<i.sets.length;r++)if(i.sets[r].type!=="warmup")return!1;return!0}checkIfLatestSetOfRound(){let t=this.activeSetInfo(),e=this.routine();if(!t||!e)return!1;let i=e.exercises[t.exerciseIndex];if(!i.supersetId&&(!i.rounds||i.rounds<=1))return!1;let r=t.exerciseIndex,o=t.exerciseIndex;return i.supersetId&&i.supersetOrder!==null&&(r=t.exerciseIndex-i.supersetOrder,o=r+(i.supersetSize?i.supersetSize-1:0)),t.exerciseIndex===o&&t.setIndex===e.exercises[o].sets.length-1}checkIfLatestRoundOfRounds(){let t=this.routine(),e=this.activeSetInfo();if(!t||!e)return!1;let i=t.exercises[e.exerciseIndex];if(!i)return!1;let r=i.rounds??1;return i.supersetId&&i.supersetOrder!==null&&(r=t.exercises.find(d=>d.supersetId===i.supersetId&&d.supersetOrder===0)?.rounds??1),this.currentBlockRound()===r}checkIfSetIsPartOfRounds(){let t=this.activeSetInfo(),e=this.routine();if(!t||!e)return!1;let i=e.exercises[t.exerciseIndex];return i?i.supersetId&&i.supersetOrder!==null?(e.exercises.find(c=>c.supersetId===i.supersetId&&c.supersetOrder===0)?.rounds??1)>0:(i.rounds&&i.supersetId!==void 0&&i.supersetId!==null?1:0)>0:!1}checkIfLatestSetOfWorkout(){return this.checkIfLatestSetOfWorkoutConsideringPending()}checkIfLatestSetOfWorkoutConsideringPending(){let t=this.activeSetInfo(),e=this.routine();if(!t||!e)return!1;if(t.exerciseData.sessionStatus&&t.exerciseData.sessionStatus!=="pending"){for(let o=t.exerciseIndex+1;o<e.exercises.length;o++)if(e.exercises[o].sessionStatus==="pending")return!1;return!e.exercises.some(o=>(o.sessionStatus==="do_later"||o.sessionStatus==="skipped")&&!this.isExerciseFullyLogged(o.exerciseId,t.exerciseIndex,o.sets.length))}if(!this.checkIfLatestSetOfExercise())return!1;for(let r=t.exerciseIndex+1;r<e.exercises.length;r++)if(e.exercises[r].sessionStatus==="pending"&&e.exercises[r].sets.length>0)return!1;return!e.exercises.some((r,o)=>(r.sessionStatus==="do_later"||r.sessionStatus==="skipped")&&!this.isExerciseFullyLogged(r.exerciseId,o,r.sets.length))}tryProceedToDeferredExercisesOrFinish(t){return L(this,null,function*(){console.log("tryProceedToDeferredExercisesOrFinish: ENTERED. Proposed flags before:",JSON.stringify(this.exercisesProposedThisCycle));let e=new Set(this.currentWorkoutLogExercises().map(c=>c.exerciseId)),i=this.getUnfinishedExercises().filter(c=>c.exerciseId!==t.exercises[this.currentExerciseIndex()].exerciseId);console.log("Unfinished exercises (excluding current):",i.map(c=>c.exerciseName));let r=t.exercises.map((c,g)=>H(U({},c),{originalIndex:g})).filter((c,g)=>(c.sessionStatus==="do_later"||c.sessionStatus==="skipped")&&!this.isExerciseFullyLogged(c.exerciseId,g,c.sets.length)).sort((c,g)=>c.sessionStatus==="do_later"&&g.sessionStatus==="skipped"?-1:c.sessionStatus==="skipped"&&g.sessionStatus==="do_later"?1:c.originalIndex-g.originalIndex),o=i.map((c,g)=>H(U({},c),{originalIndex:t.exercises.findIndex(y=>y.id===c.id)})),d=r.concat(o);if(console.log("tryProceedToDeferredExercisesOrFinish: Found unfinished deferred/skipped:",r.map(c=>`${c.exerciseName} (${c.sessionStatus})`)),d.length>0){let c=!1,g,y=!1,v=!1;if(d.length===1){let k=d[0],P=yield this.alertService.showConfirmationDialog(`Unfinished: ${k.exerciseName}`,`You have "${k.exerciseName}" (${k.sessionStatus==="do_later"?"Do Later":"Skipped"}) remaining. Complete it now?`,[{text:"Complete It",role:"confirm",data:k.originalIndex,cssClass:"bg-blue-500 hover:bg-blue-600 text-white"},{text:"Finish Workout",role:"destructive",data:"finish_now",cssClass:"bg-green-500 hover:bg-green-600 text-white"},{text:"Cancel (Decide Later)",role:"cancel",data:"cancel_deferred_choice"}]);P&&typeof P.data=="number"?(c=!0,g=P.data):P&&P.data==="finish_now"?y=!0:v=!0}else{let P=[...d.map(w=>{let F="",M="bg-gray-500 dark:bg-gray-700 dark:text-gray-100 hover:bg-gray-300 hover:text-gray-500 hover:dark:bg-gray-300 hover:dark:text-gray-500";switch(w.sessionStatus){case"do_later":F="Do Later",M="bg-orange-500 hover:bg-orange-600 text-white";break;case"skipped":F="Skipped",M="bg-yellow-500 hover:bg-yellow-600 text-black";break;case"pending":F="Pending",M="bg-violet-500 hover:bg-violet-600 text-black";break;default:F=w.sessionStatus||""}return{text:`${w.exerciseName} (${F})`,role:"confirm",data:w.originalIndex,cssClass:M}}),{text:"Finish Workout Now",role:"destructive",data:"finish_now",cssClass:"bg-green-500 hover:bg-green-600 text-white mt-4"},{text:"Cancel (Decide Later)",role:"cancel",data:"cancel_deferred_choice"}],S=yield this.alertService.showConfirmationDialog("Unfinished Exercises","You have unfinished exercises. Would you like to complete any of them now, or finish the workout?",P);S&&typeof S.data=="number"?(c=!0,g=S.data):S&&S.data==="finish_now"?y=!0:v=!0}if(y){console.log("tryProceedToDeferredExercisesOrFinish: User chose 'Finish Workout Now'."),yield this.finishWorkoutAndReportStatus();return}if(v){console.log("tryProceedToDeferredExercisesOrFinish: User cancelled choice of deferred exercises. Setting proposal flags."),d.forEach(k=>{k.sessionStatus==="do_later"&&(this.exercisesProposedThisCycle.doLater=!0),k.sessionStatus==="skipped"&&(this.exercisesProposedThisCycle.skipped=!0)}),console.log("tryProceedToDeferredExercisesOrFinish: Proposed flags after cancel:",JSON.stringify(this.exercisesProposedThisCycle)),this.cdr.detectChanges();return}if(c&&g!==void 0){let k=t.exercises[g];console.log(`tryProceedToDeferredExercisesOrFinish: User selected exercise: ${k.exerciseName}`),this.isPerformingDeferredExercise=!0,this.lastActivatedDeferredExerciseId=k.id;let P=JSON.parse(JSON.stringify(t));P.exercises[g].sessionStatus="pending",this.routine.set(P),this.currentExerciseIndex.set(g),this.currentSetIndex.set(this.findFirstUnloggedSetIndex(k.exerciseId,k.sets.map(w=>w.id))||0),this.currentBlockRound.set(1);let S=P.exercises[g];if(!S.supersetId||S.supersetOrder===0)this.totalBlockRounds.set(S.rounds??1);else{let w=P.exercises.find(F=>F.supersetId===S.supersetId&&F.supersetOrder===0);this.totalBlockRounds.set(w?.rounds??1)}this.lastPerformanceForCurrentExercise=null,this.playerSubState.set("performing_set"),yield this.prepareCurrentSet();return}}console.log("tryProceedToDeferredExercisesOrFinish: No unfinished exercises to propose or all paths handled. Finishing workout."),yield this.finishWorkoutAndReportStatus()})}isExerciseFullyLogged(t,e,i){let r=this.currentWorkoutLogExercises().find((o,d)=>o.exerciseId===t);return r?r.sets.length>=i:!1}findFirstUnloggedSetIndex(t,e){let i=this.currentWorkoutLogExercises().find(o=>o.exerciseId===t);if(!i)return 0;let r=new Set(i.sets.map(o=>o.plannedSetId));for(let o=0;o<e.length;o++)if(!r.has(e[o]))return o;return null}fetchLastPerformanceAndPatchForm(){return L(this,null,function*(){yield this.prepareCurrentSet()})}patchCurrentSetFormWithData(t){this.patchActualsFormBasedOnSessionTargets()}startEditTarget(t){let e=this.activeSetInfo();if(e)switch(this.editingTarget=t,t){case"reps":this.editingTargetValue=e.setData.reps??"";break;case"weight":this.editingTargetValue=e.setData.weight??"";break;case"duration":this.editingTargetValue=e.setData.duration??"";break}}cancelEditTarget(){this.editingTarget=null,this.editingTargetValue=""}formatPbValue(t){let e="";return t.weightUsed!==void 0&&t.weightUsed!==null?(e+=`${t.weightUsed}${this.unitService.getUnitSuffix()}`,t.repsAchieved>1&&!t.pbType.includes("RM (Actual)")&&(e+=` x ${t.repsAchieved}`)):t.repsAchieved>0&&t.pbType.includes("Max Reps")?e=`${t.repsAchieved} reps`:t.durationPerformed&&t.durationPerformed>0&&t.pbType.includes("Max Duration")&&(e=`${t.durationPerformed}s`),e||"N/A"}initializeCurrentSetForm(){this.currentSetForm=this.fb.group({actualReps:[null,[A.min(0)]],actualWeight:[null,[A.min(0)]],actualDuration:[null,[A.min(0)]],setNotes:[""],rpe:[null,[A.min(1),A.max(10)]]})}prepareCurrentSet(){return L(this,null,function*(){if(console.log("prepareCurrentSet: START"),this.sessionState()==="paused"){console.log("prepareCurrentSet: Session is paused, deferring preparation.");return}let t=this.routine();if(!t||t.exercises.length===0){console.warn("prepareCurrentSet: No sessionRoutine or no exercises in routine. Current routine:",t),this.sessionState.set("error"),this.toastService.error("Cannot prepare set: Routine data is missing or empty.",0,"Error");return}let e=this.currentExerciseIndex(),i=this.currentSetIndex();if(console.log(`prepareCurrentSet: Initial target - exIndex: ${e}, sIndex: ${i}, sessionStatus: ${t.exercises[e]?.sessionStatus}`),t.exercises[e]?.sessionStatus!=="pending"){console.log(`prepareCurrentSet: Initial target Ex ${e} (name: ${t.exercises[e]?.exerciseName}) is ${t.exercises[e]?.sessionStatus}. Finding first 'pending'.`);let W=this.findFirstPendingExerciseAndSet(t);if(W)e=W.exerciseIndex,i=W.setIndex,this.currentExerciseIndex.set(e),this.currentSetIndex.set(i),this.isPerformingDeferredExercise=!1,console.log(`prepareCurrentSet: Found first pending - exIndex: ${e} (name: ${t.exercises[e]?.exerciseName}), sIndex: ${i}`);else{console.log("prepareCurrentSet: No 'pending' exercises found in the entire routine. Proceeding to deferred/finish evaluation."),this.exercisesProposedThisCycle={doLater:!1,skipped:!1},yield this.tryProceedToDeferredExercisesOrFinish(t);return}}if(e>=t.exercises.length||!t.exercises[e]||i>=t.exercises[e].sets.length||!t.exercises[e].sets[i]){this.currentSetForm.reset({rpe:null,setNotes:""}),this.resetTimedSet(),this.currentBaseExercise.set(null),this.exercisePBs.set([]),this.lastPerformanceForCurrentExercise=null,this.rpeValue.set(null),this.showRpeSlider.set(!1),console.error(`prepareCurrentSet: CRITICAL ERROR - Calculated exIndex ${e} or sIndex ${i} is out of bounds or data is invalid.`),this.sessionState.set("error"),this.toastService.error("Error preparing set: Invalid exercise or set index.",0,"Load Error");return}let r=t.exercises[e],o=r.sets[i];console.log(`prepareCurrentSet: Preparing for Ex: "${r.exerciseName}", Set: ${i+1}, Type: ${o.type}`);let c=(this.originalRoutineSnapshot.find(W=>W.exerciseId===r.exerciseId)||r)?.sets[i]||o;this.loadBaseExerciseAndPBs(r.exerciseId),(!this.lastPerformanceForCurrentExercise||this.lastPerformanceForCurrentExercise.sets[0]?.exerciseId!==r.exerciseId)&&(this.lastPerformanceForCurrentExercise=yield le(this.trackingService.getLastPerformanceForExercise(r.exerciseId).pipe(z(1))));let g=this.trackingService.findPreviousSetPerformance(this.lastPerformanceForCurrentExercise,c,i),y;c.type==="warmup"?y=U({},c):y=this.workoutService.suggestNextSetParameters(g,c,t.goal),y.id=o.id,y.type=o.type,y.notes=o.notes||y.notes;let v=JSON.parse(JSON.stringify(t));v.exercises[e].sets[i]=y,this.routine.set(v),this.patchActualsFormBasedOnSessionTargets();let k=this.appSettingsService.enablePresetTimer(),P=this.appSettingsService.enablePresetTimerAfterRest(),S=this.appSettingsService.presetTimerDurationSeconds(),w=this.currentWorkoutLogExercises().length===0&&this.currentBlockRound()===1&&e===this.findFirstPendingExerciseAndSet(t)?.exerciseIndex&&i===this.findFirstPendingExerciseAndSet(t)?.setIndex,F=1/0;if(i>0)F=r.sets[i-1].restAfterSet;else if(e>0){let W=e-1,J=!1;for(;W>=0;){if(this.isExerciseFullyLogged(t.exercises[W].exerciseId,W,t.exercises[W].sets.length)||t.exercises[W].sessionStatus==="pending"&&this.currentWorkoutLogExercises().some(K=>K.exerciseId===t.exercises[W].exerciseId)){let K=t.exercises[W];K.sets.length>0&&(F=K.sets[K.sets.length-1].restAfterSet,J=!0);break}W--}J||(F=1/0)}if(k&&S>0&&(this.playerSubState()!=="resting"&&(w||F===0)||P)){console.log("prepareCurrentSet: Starting pre-set timer for:",r.exerciseName,"Set:",i+1),this.playerSubState.set("preset_countdown");let W=this.activeSetInfo();W?this.startPresetTimer(S,W):(console.error("prepareCurrentSet: ActiveSetInfo is null before starting preset timer. Aborting preset."),this.playerSubState.set("performing_set"))}else console.log("prepareCurrentSet: No pre-set timer, setting to PerformingSet for:",r.exerciseName,"Set:",i+1),this.playerSubState.set("performing_set");this.sessionState()!=="playing"&&this.sessionState()!=="paused"&&(console.log("prepareCurrentSet: Setting sessionState to Playing."),this.sessionState.set("playing")),console.log("prepareCurrentSet: END")})}findFirstPendingExerciseAndSet(t){if(!t||!t.exercises)return null;for(let e=0;e<t.exercises.length;e++){let i=t.exercises[e];if(i.sessionStatus==="pending"&&i.sets&&i.sets.length>0){let r=this.findFirstUnloggedSetIndex(i.exerciseId,i.sets.map(o=>o.id))??0;if(r<i.sets.length)return{exerciseIndex:e,setIndex:r};console.warn(`Exercise ${i.exerciseName} is pending, but all sets appear logged or index is invalid.`)}}return null}patchActualsFormBasedOnSessionTargets(){if(this.sessionState()==="paused"){console.log("patchActualsFormBasedOnSessionTargets: Session is paused, deferring preparation.");return}this.currentSetForm.patchValue({rpe:null},{emitEvent:!1}),this.rpeValue.set(null),this.showRpeSlider.set(!1),this.resetTimedSet();let t=this.activeSetInfo();if(!t)return;let i=this.currentWorkoutLogExercises().find(d=>d.exerciseId===t.exerciseData.exerciseId)?.sets.find(d=>d.plannedSetId===t.setData.id),r=t.setData.duration??null;i&&i.durationPerformed!==void 0&&(r=i.durationPerformed);let o=t.setData.weight;if(o==null){let c=(this.currentWorkoutLogExercises().find(g=>g.exerciseId===t.exerciseData.exerciseId)?.sets||[]).filter(g=>{let y=t.exerciseData.sets.find(v=>v.id===g.plannedSetId);return y&&t.exerciseData.sets.indexOf(y)<t.setIndex}).sort((g,y)=>t.exerciseData.sets.findIndex(v=>v.id===g.plannedSetId)-t.exerciseData.sets.findIndex(v=>v.id===y.plannedSetId));if(c.length>0){let g=c[c.length-1];g.weightUsed!==null&&g.weightUsed!==void 0&&(o=g.weightUsed,t.type)}else t.type==="warmup"&&(t.setData.weight===null||t.setData.weight===void 0)&&(o=t.setData.weight??null)}i?(this.currentSetForm.patchValue({actualReps:i.repsAchieved,actualWeight:i.weightUsed,actualDuration:r,setNotes:i.notes??"",rpe:i.rpe},{emitEvent:!1}),i.rpe&&this.rpeValue.set(i.rpe)):this.currentSetForm.patchValue({actualReps:t.setData.reps??(t.type==="warmup"?8:null),actualWeight:o??null,actualDuration:r,setNotes:t.setData.notes||(t.type==="warmup"?"Warm-up":""),rpe:null},{emitEvent:!1})}editWeightWithPrompt(){return L(this,null,function*(){if(this.getDisabled()||this.playerSubState()!=="performing_set"){this.toastService.warning("Cannot edit weight now.",2e3);return}if(!this.activeSetInfo())return;let e=this.csf.actualWeight.value,i=yield this.alertService.showPromptDialog("Enter Weight","",[{name:"newWeight",type:"number",placeholder:`Current: ${e??"0"} ${this.weightUnitDisplaySymbol}`,value:e??void 0,attributes:{step:1,min:"0",inputmode:"decimal"}}],"Set Weight");if(i&&i.newWeight!==void 0&&i.newWeight!==null){let r=parseFloat(String(i.newWeight));!isNaN(r)&&r>=0?this.currentSetForm.patchValue({actualWeight:r}):this.toastService.error("Invalid weight entered.",3e3,"Error")}})}loadBaseExerciseAndPBs(t){if(t.startsWith("custom-exercise-")){this.currentBaseExercise.set({id:t,name:this.activeSetInfo()?.exerciseData.exerciseName||"Custom Exercise",category:"custom",description:"",iconName:"custom-exercise",muscleGroups:[],primaryMuscleGroup:"",equipment:"",imageUrls:[]}),this.exercisePBs.set([]);return}this.currentBaseExercise.set(void 0),this.exercisePBs.set([]),this.exerciseService.getExerciseById(t).subscribe(e=>{this.currentBaseExercise.set(e?H(U({},e),{iconName:this.exerciseService.determineExerciseIcon(e,e?.name)}):null)}),this.trackingService.getAllPersonalBestsForExercise(t).pipe(z(1)).subscribe(e=>this.exercisePBs.set(e))}confirmEditTarget(){let t=this.activeSetInfo();if(!t||this.editingTarget===null)return;let e=parseFloat(this.editingTargetValue);if(isNaN(e)||e<0){this.toastService.error(`Invalid value for ${this.editingTarget}. Must be non-negative.`,3e3,"Input Error");return}let i=this.routine,r=i();if(!r)return;let o=JSON.parse(JSON.stringify(r)),c=o.exercises[t.exerciseIndex].sets[t.setIndex];switch(this.editingTarget){case"reps":c.reps=e;break;case"weight":c.weight=e;break;case"duration":c.duration=e;break}i.set(o),this.toastService.success(`Target ${this.editingTarget} updated to ${e}.`,3e3,"Target Updated"),this.cancelEditTarget(),this.patchActualsFormBasedOnSessionTargets()}completeAndLogCurrentSet(){let t=this.activeSetInfo(),e=this.routine();if(!t||!e){this.toastService.error("Cannot log set: data unavailable.",0);return}if(t.setData.duration&&t.setData.duration>0&&(this.timedSetTimerState()==="running"||this.timedSetTimerState()==="paused")&&this.stopAndLogTimedSet(),this.soundPlayedForThisCountdownSegment=!1,this.currentSetForm.invalid){this.currentSetForm.markAllAsTouched();let d="";for(let c of Object.keys(this.currentSetForm.controls))if(this.currentSetForm.controls[c].invalid){d=c;break}this.toastService.error(`Please correct input: ${d?d+" is invalid.":"form invalid."}`,0,"Validation Error");return}let i=this.currentSetForm.value,r=i.actualDuration;t.setData.duration&&t.setData.duration>0&&this.timedSetElapsedSeconds()>0?r=this.timedSetElapsedSeconds():i.actualDuration===null&&t.setData.duration&&(r=t.setData.duration);let o={id:N(),exerciseName:t.exerciseData.exerciseName,plannedSetId:t.setData.id,exerciseId:t.exerciseData.exerciseId,type:t.setData.type,repsAchieved:i.actualReps??(t.setData.type==="warmup"?0:t.setData.reps??0),weightUsed:i.actualWeight??(t.setData.type==="warmup"?null:t.setData.weight),durationPerformed:r,rpe:i.rpe??void 0,targetReps:t.setData.reps,targetWeight:t.setData.weight,targetDuration:t.setData.duration,targetTempo:t.setData.tempo,notes:i.setNotes?.trim()||void 0,timestamp:new Date().toISOString()};this.addLoggedSetToCurrentLog(t.exerciseData,o),this.sessionState()==="playing"&&this.captureAndSaveStateForUnload(),this.rpeValue.set(null),this.showRpeSlider.set(!1),this.editingTarget=null,this.currentSetForm.patchValue({setNotes:""},{emitEvent:!1}),this.navigateToNextStepInWorkout(t,e)}findNextExerciseBlockStartIndex(t,e){for(let i=t+1;i<e.exercises.length;i++){let r=e.exercises[i];if(r.sessionStatus==="pending"&&(!r.supersetId||r.supersetOrder===0))return i}return-1}getNextUpText(t,e){if(!t||!e)return"Next Set/Exercise";let i=e.exercises,r=t.exerciseIndex,o=t.setIndex,d=(S,w)=>{let F=this.currentWorkoutLogExercises().find(J=>J.exerciseId===S.exerciseId&&e.exercises[w].id===S.id),M=(S.sets?.length??0)*(S.rounds??1),W=F?.sets?.length??0;return S.sessionStatus==="pending"&&W<M},c=S=>{let w=S.rounds??1;return S.supersetId&&S.supersetOrder!==null&&(w=i.find(W=>W.supersetId===S.supersetId&&W.supersetOrder===0)?.rounds??1),{round:this.currentBlockRound?this.currentBlockRound():1,totalRounds:w}},g=i[r];if(g){if(o+1<g.sets.length){let S=g.sets[o+1],w=1;S.type==="warmup"?w=g.sets.slice(0,o+2).filter(K=>K.type==="warmup").length:w=g.sets.slice(0,o+2).filter(K=>K.type!=="warmup").length;let F=S.type==="warmup"?"Warm-up":"Set",{round:M,totalRounds:W}=c(g),J=W>1?` (Round ${M}/${W})`:"";return`${F} ${w}/${g.sets.length} of ${g.exerciseName}${J}`}for(let S=r+1;S<i.length;S++){let w=i[S];if(d(w,S)){let M=w.sets[0].type==="warmup"?"Warm-up":"Set",W=1,{round:J,totalRounds:K}=c(w),ri=K>1?` (Round ${J}/${K})`:"";return`${M} ${W} of ${w.exerciseName}${ri}`}}}if(i.some(S=>S.sessionStatus==="do_later"&&!this.exercisesProposedThisCycle.doLater))return"Do Later Exercises";if(i.some(S=>S.sessionStatus==="skipped"&&!this.exercisesProposedThisCycle.skipped))return"Skipped Exercises";let{round:k,totalRounds:P}=c(g);if(P>1&&k<P){let S="";if(g.supersetId&&g.supersetOrder!==null){let w=i.filter(M=>M.supersetId===g.supersetId),F=g.supersetOrder??0;F+1<w.length?S=w[F+1].exerciseName||"":S=w[0].exerciseName||""}else S=g.exerciseName||"";return`Complete Round ${k}/${P}${S?` [Next exercise: ${S}]`:""}${g.sets?.length?` (${g.sets.length} sets)`:""}`}return P>=1?"":"Complete"}skipRest(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Resume to skip rest.",3e3,"Paused");return}(this.isRestTimerVisible()||this.playerSubState()==="resting")&&this.handleRestTimerSkipped()}pauseSession(){return L(this,null,function*(){this.sessionState()==="playing"&&(this.isPerformanceInsightsVisible.set(!1),this.closeWorkoutMenu(),this.sessionTimerElapsedSecondsBeforePause+=Math.floor((Date.now()-this.workoutStartTime)/1e3),this.timerSub&&this.timerSub.unsubscribe(),this.wasTimedSetRunningOnPause=this.timedSetTimerState()==="running",this.timedSetTimerState()==="running"&&this.pauseTimedSet(),this.wasRestTimerVisibleOnPause=this.isRestTimerVisible(),this.wasRestTimerVisibleOnPause&&(this.restTimerRemainingSecondsOnPause=this.restDuration(),this.restTimerInitialDurationOnPause=this.restDuration(),this.restTimerMainTextOnPause=this.restTimerMainText(),this.restTimerNextUpTextOnPause=this.restTimerNextUpText(),this.isRestTimerVisible.set(!1)),this.stopAutoSave(),this.sessionState.set("paused"),this.savePausedSessionState(),this.toastService.info("Workout Paused",3e3))})}loadStateFromPausedSession(t){return L(this,null,function*(){this.routineId=t.routineId,this.routine.set(t.sessionRoutine),this.originalRoutineSnapshot=t.originalRoutineSnapshot?JSON.parse(JSON.stringify(t.originalRoutineSnapshot)):[],this.currentExerciseIndex.set(t.currentExerciseIndex),this.currentSetIndex.set(t.currentSetIndex),this.currentWorkoutLogExercises.set(t.currentWorkoutLogExercises),this.workoutStartTime=Date.now(),this.sessionTimerElapsedSecondsBeforePause=t.sessionTimerElapsedSecondsBeforePause,this.currentBlockRound.set(t.currentBlockRound),this.totalBlockRounds.set(t.totalBlockRounds),this.timedSetTimerState.set(t.timedSetTimerState),this.timedSetElapsedSeconds.set(t.timedSetElapsedSeconds),this.wasTimedSetRunningOnPause=t.timedSetTimerState==="running"||t.timedSetTimerState==="paused",this.lastPerformanceForCurrentExercise=t.lastPerformanceForCurrentExercise,this.wasRestTimerVisibleOnPause=t.isRestTimerVisibleOnPause,this.restTimerRemainingSecondsOnPause=t.restTimerRemainingSecondsOnPause,this.restTimerInitialDurationOnPause=t.restTimerInitialDurationOnPause,this.restTimerMainTextOnPause=t.restTimerMainTextOnPause,this.restTimerNextUpTextOnPause=t.restTimerNextUpTextOnPause,this.exercisesProposedThisCycle={doLater:!1,skipped:!1},this.isPerformingDeferredExercise=!1,this.lastActivatedDeferredExerciseId=null,yield this.prepareCurrentSet(),this.sessionState()!=="error"&&this.routine()&&(this.sessionState.set("playing"),this.startSessionTimer(),this.startAutoSave()),(t.timedSetTimerState==="running"||t.timedSetTimerState==="paused")&&(this.startOrResumeTimedSet(),t.timedSetTimerState==="paused"&&this.pauseTimedSet()),this.wasRestTimerVisibleOnPause&&this.restTimerRemainingSecondsOnPause>0&&this.startRestPeriod(this.restTimerRemainingSecondsOnPause,!0),this.cdr.detectChanges(),this.toastService.success("Workout session resumed.",3e3,"Resumed")})}savePausedSessionState(){let t=this.routine();if(!t){console.warn("Cannot save paused state: routine data is not available.");return}let e=this.sessionTimerElapsedSecondsBeforePause;this.sessionState()==="playing"&&this.workoutStartTime>0&&(e+=Math.floor((Date.now()-this.workoutStartTime)/1e3));let i,r=this.currentWorkoutLogExercises()[0]?.sets[0]?.timestamp,o=r?new Date(r):this.workoutStartTime>0?new Date(this.workoutStartTime-this.sessionTimerElapsedSecondsBeforePause*1e3):new Date;i=j(o,"yyyy-MM-dd");let d={version:this.PAUSED_STATE_VERSION,routineId:this.routineId,sessionRoutine:JSON.parse(JSON.stringify(t)),originalRoutineSnapshot:JSON.parse(JSON.stringify(this.originalRoutineSnapshot)),currentExerciseIndex:this.currentExerciseIndex(),currentSetIndex:this.currentSetIndex(),currentWorkoutLogExercises:JSON.parse(JSON.stringify(this.currentWorkoutLogExercises())),workoutStartTimeOriginal:this.workoutStartTime,sessionTimerElapsedSecondsBeforePause:e,currentBlockRound:this.currentBlockRound(),totalBlockRounds:this.totalBlockRounds(),timedSetTimerState:this.timedSetTimerState(),timedSetElapsedSeconds:this.timedSetElapsedSeconds(),isResting:this.isRestTimerVisible(),isRestTimerVisibleOnPause:this.playerSubState()==="resting",restTimerRemainingSecondsOnPause:this.restDuration(),restTimerInitialDurationOnPause:this.restTimerInitialDurationOnPause,restTimerMainTextOnPause:this.restTimerMainText(),restTimerNextUpTextOnPause:this.restTimerNextUpText(),lastPerformanceForCurrentExercise:this.lastPerformanceForCurrentExercise?JSON.parse(JSON.stringify(this.lastPerformanceForCurrentExercise)):null,workoutDate:i};this.storageService.setItem(this.PAUSED_WORKOUT_KEY,d),console.log("Paused session state saved.",d)}captureAndSaveStateForUnload(){let t=this.sessionTimerElapsedSecondsBeforePause;this.sessionState()==="playing"&&this.workoutStartTime>0&&(t+=Math.floor((Date.now()-this.workoutStartTime)/1e3));let e=this.sessionTimerElapsedSecondsBeforePause;this.sessionTimerElapsedSecondsBeforePause=t,this.savePausedSessionState(),this.sessionTimerElapsedSecondsBeforePause=e,console.log("Session state attempt saved via beforeunload.")}addWarmupSet(){return L(this,null,function*(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Resume to add warm-up.",3e3,"Paused");return}let t=this.routine(),e=this.activeSetInfo();if(!t||!e){this.toastService.error("Cannot add warm-up: data unavailable.",0,"Error");return}let i=t.exercises[e.exerciseIndex],r=i.sets.findIndex(v=>v.type!=="warmup"),o=i.supersetId&&i.supersetOrder!==null,d=e.setIndex===r&&r!==-1;if(o&&d){let v={id:`warmup-${N()}`,type:"warmup",reps:8,weight:0,duration:void 0,restAfterSet:30,notes:"Warm-up set"},k=JSON.parse(JSON.stringify(t)),P=e.exerciseIndex-(i.supersetOrder??0);P<0&&(P=0);let S={id:`warmup-ex-${N()}`,exerciseId:i.exerciseId,exerciseName:`${i.exerciseName} (Warm-up)`,sets:[v],rounds:1,supersetId:null,supersetOrder:null,supersetSize:null,sessionStatus:"pending",type:"standard"};this.addExerciseToCurrentRoutine(S,P),this.toastService.success("Warm-up set added as a separate exercise before superset.",4e3,"Warm-up Added"),this.closeWorkoutMenu(),this.closePerformanceInsights();return}if(e.setIndex>0&&e.setIndex>r&&r!==-1){let v=yield this.alertService.showConfirm("Add Warm-up Set","You are past the first working set. Adding a warm-up set now will insert it before the current set. Continue?");if(!v||!v.data)return}let c={id:`warmup-${N()}`,type:"warmup",reps:8,weight:0,duration:void 0,restAfterSet:30,notes:"Warm-up set"},g=JSON.parse(JSON.stringify(t));g.exercises[e.exerciseIndex].sets.splice(e.setIndex,0,c),this.routine.set(g),this.toastService.success("Warm-up set added. Fill details & complete.",4e3,"Warm-up Added"),yield this.prepareCurrentSet(),this.closeWorkoutMenu(),this.closePerformanceInsights()})}getSets(){let t=this.activeSetInfo(),e=t?.exerciseData.sets||[];return t?.setData.type==="warmup"?e.filter(i=>i.type!=="warmup"):e}getWarmUpSets(){let t=this.activeSetInfo(),e=t?.exerciseData.sets||[];return t?.setData.type==="warmup"?e.filter(i=>i.type==="warmup"):[]}getTotalWarmupSetsForCurrentExercise=B(()=>{let t=this.routine(),e=this.currentExerciseIndex();return t&&t.exercises[e]?t.exercises[e].sets.filter(i=>i.type==="warmup").length:0});canAddWarmupSet=B(()=>{let t=this.activeSetInfo(),e=this.routine();if(!t||!e||this.sessionState()==="paused")return!1;let i=e.exercises[t.exerciseIndex].sets;return!(this.currentWorkoutLogExercises().find(o=>o.exerciseId===t.exerciseData.exerciseId)?.sets.some(o=>o.plannedSetId===t.setData.id)&&t.type!=="warmup")});getIconPath(t){return this.exerciseService.getIconPath(t)}toggleWorkoutMenu(){this.sessionState()==="paused"&&!this.isWorkoutMenuVisible()||(this.isWorkoutMenuVisible.update(t=>!t),this.isWorkoutMenuVisible()&&this.isPerformanceInsightsVisible.set(!1))}closeWorkoutMenu(){this.isWorkoutMenuVisible.set(!1),window.scrollTo(0,0)}skipCurrentSet(){return L(this,null,function*(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Resume to skip set.",3e3,"Paused");return}let t=this.activeSetInfo(),e=this.routine();if(!t||!e){this.toastService.error("Cannot skip set: No active set information.",0,"Error");return}if(t.setIndex===t.exerciseData.sets.length-1&&t.exerciseData.sessionStatus==="pending"){let i=yield this.alertService.showConfirmationDialog("Last Set",`This is the last set of "${t.exerciseData.exerciseName}". Skip the entire exercise instead?`,[{text:"Skip Set Only",role:"cancel",data:"skip_set"},{text:"Skip Exercise",role:"confirm",data:"skip_exercise",cssClass:"bg-orange-500"}]);if(i&&i.data==="skip_exercise"){yield this.markCurrentExerciseStatus("skipped"),this.closeWorkoutMenu();return}else if(!i||i.role==="cancel"&&i.data!=="skip_set")return}else{let i=yield this.alertService.showConfirm("Skip Current Set",`Skip current ${t.type==="warmup"?"warm-up":"set "+this.getCurrentWorkingSetNumber()} of "${t.exerciseData.exerciseName}"? It won't be logged.`);if(!i||!i.data)return}this.soundPlayedForThisCountdownSegment=!1,this.toastService.info(`Skipped set of ${t.exerciseData.exerciseName}.`,2e3),this.resetTimedSet(),this.navigateToNextStepInWorkout(t,e),this.closeWorkoutMenu(),this.closePerformanceInsights()})}skipCurrentExercise(){return L(this,null,function*(){yield this.markCurrentExerciseStatus("skipped")})}markCurrentExerciseDoLater(){return L(this,null,function*(){yield this.markCurrentExerciseStatus("do_later")})}markCurrentExerciseStatus(t){return L(this,null,function*(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Resume to mark exercise.",3e3,"Paused");return}let e=this.routine(),i=this.activeSetInfo();if(!e||!i){this.toastService.error("Cannot update exercise status: data unavailable.",0,"Error");return}let r=i.exerciseData.exerciseName,o=t==="skipped"?"Skip":"Mark for Later",d=JSON.parse(JSON.stringify(e)),c=d.exercises.find(g=>g.id===i.exerciseData.id);if(c){let g=c.sessionStatus;c.sessionStatus=t,this.routine.set(d),this.toastService.info(`"${r}" marked as ${t}.`,2e3),this.resetTimedSet(),this.isPerformingDeferredExercise&&i.exerciseData.id===this.lastActivatedDeferredExerciseId?(console.log(`markCurrentExerciseStatus: Re-marking a deferred exercise (${r}) as ${t}. Re-evaluating all deferred.`),this.isPerformingDeferredExercise=!1,this.lastActivatedDeferredExerciseId=null,this.exercisesProposedThisCycle={doLater:!1,skipped:!1},yield this.tryProceedToDeferredExercisesOrFinish(d)):(console.log(`markCurrentExerciseStatus: Marking main sequence exercise (${r}) as ${t}. Advancing.`),yield this.navigateToNextStepInWorkout(i,d,!0))}this.closeWorkoutMenu(),this.closePerformanceInsights()})}addExerciseDuringSession(){return L(this,null,function*(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Resume to add exercise.",3e3,"Paused"),this.closeWorkoutMenu();return}this.openExerciseSelectionModal()})}selectExerciseToAddFromModal(t){return L(this,null,function*(){if(this.closeExerciseSelectionModal(),!this.routine()){this.toastService.error("Cannot add exercise: routine data unavailable.",0,"Error");return}let i=yield this.alertService.showPromptDialog(`Add ${t.name}`,"How many sets?",[{name:"numSets",type:"number",placeholder:"e.g., 3",value:"3",attributes:{min:"1",required:!0}}],"Next");if(!i||!i.numSets||parseInt(String(i.numSets),10)<=0){this.toastService.info("Exercise addition cancelled or invalid set count.",2e3);return}let r=parseInt(String(i.numSets),10),o=[];for(let c=0;c<r;c++)o.push({id:`custom-set-${N()}`,reps:8,weight:null,duration:void 0,restAfterSet:60,type:"standard",notes:""});let d={id:`session-ex-${N()}`,exerciseId:t.id,exerciseName:t.name,sets:o,rounds:1,supersetId:null,supersetOrder:null,supersetSize:null,sessionStatus:"pending",type:"standard"};this.addExerciseToCurrentRoutine(d)})}handleTrulyCustomExerciseEntry(){return L(this,null,function*(){if(this.closeExerciseSelectionModal(),!this.routine())return;let e=[{name:"exerciseName",type:"text",placeholder:"Custom Exercise Name",value:"",attributes:{required:!0}},{name:"numSets",type:"number",placeholder:"Number of Sets (e.g., 3)",value:"3",attributes:{min:"1",required:!0}}],i=yield this.alertService.showPromptDialog("Add New Custom Exercise","Define exercise name and sets:",e,"Add Exercise");if(i&&i.exerciseName&&i.numSets){let r=String(i.exerciseName).trim(),o=parseInt(String(i.numSets),10);if(!r||o<=0){this.toastService.error("Invalid input for custom exercise.",0,"Error");return}let d=Array.from({length:o},()=>({id:`custom-adhoc-set-${N()}`,reps:8,weight:null,duration:void 0,restAfterSet:60,type:"standard",notes:""})),c={id:`custom-adhoc-ex-${N()}`,exerciseId:`custom-exercise-${N()}`,exerciseName:r,sets:d,rounds:1,supersetId:null,sessionStatus:"pending",supersetOrder:null,type:"standard"};this.addExerciseToCurrentRoutine(c)}})}addExerciseToCurrentRoutine(t,e){return L(this,null,function*(){let i=this.routine();if(!i)return;let r=e!=null,o=JSON.parse(JSON.stringify(i)),d=e??this.currentExerciseIndex()+1,c=this.activeSetInfo();if(!r&&c&&c.exerciseData.supersetId&&c.exerciseData.supersetOrder!==null&&c.exerciseData.supersetSize&&(d=c.exerciseIndex-c.exerciseData.supersetOrder+c.exerciseData.supersetSize),o.exercises.splice(d,0,t),this.routine.set(o),r)this.currentExerciseIndex.set(d),this.currentSetIndex.set(0),this.currentBlockRound.set(1),this.totalBlockRounds.set(t.rounds??1),this.lastPerformanceForCurrentExercise=null,this.isPerformingDeferredExercise=!0,this.playerSubState.set("performing_set"),yield this.prepareCurrentSet();else{let g=yield this.alertService.showConfirm("Exercise Added",`"${t.exerciseName}" added. Start it now? (Otherwise, it will appear after your current block)`);g&&g.data?(this.currentExerciseIndex.set(d),this.currentSetIndex.set(0),this.currentBlockRound.set(1),this.totalBlockRounds.set(t.rounds??1),this.lastPerformanceForCurrentExercise=null,this.isPerformingDeferredExercise=!0,this.lastActivatedDeferredExerciseId=t.id,this.playerSubState.set("performing_set"),yield this.prepareCurrentSet()):this.toastService.success(`"${t.exerciseName}" added to the queue.`,3e3,"Exercise Added")}})}addCustomExercise(){return L(this,null,function*(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Resume to add exercise.",3e3,"Paused");return}let t=this.routine();if(!t){this.toastService.error("Cannot add exercise: routine data unavailable.",0,"Error");return}let e=[{name:"exerciseName",type:"text",placeholder:"Exercise Name (e.g., Custom Bicep Curl)",value:"",attributes:{required:!0}},{name:"numSets",type:"number",placeholder:"Number of Sets (e.g., 3)",value:"3",attributes:{min:"1",required:!0}},{name:"repsPerSet",type:"number",placeholder:"Reps per Set (e.g., 10)",value:"10",attributes:{min:"0"}},{name:"weightPerSet",type:"number",placeholder:"Weight (optional)",value:"",attributes:{min:"0",step:"any"}},{name:"restAfterSet",type:"number",placeholder:"Rest after set (sec, e.g., 60)",value:"60",attributes:{min:"0"}}],i=yield this.alertService.showPromptDialog("Add Custom Exercise","Define the new exercise:",e,"Add Exercise");if(i&&i.exerciseName&&i.numSets){let r=String(i.exerciseName).trim(),o=parseInt(String(i.numSets),10),d=i.repsPerSet?parseInt(String(i.repsPerSet),10):null,c=i.weightPerSet!==""&&i.weightPerSet!==null?parseFloat(String(i.weightPerSet)):null,g=i.restAfterSet?parseInt(String(i.restAfterSet),10):60;if(!r||o<=0){this.toastService.error("Invalid input for custom exercise.",0,"Error");return}let y=[];for(let F=0;F<o;F++)y.push({id:`custom-set-${N()}`,reps:d||8,weight:c,duration:void 0,restAfterSet:g,type:"standard",notes:""});let v={id:`custom-ex-${N()}`,exerciseId:`custom-exercise-${N()}`,exerciseName:r,sets:y,rounds:1,supersetId:null,sessionStatus:"pending",supersetOrder:null,type:"standard"},k=JSON.parse(JSON.stringify(t)),P=this.currentExerciseIndex()+1,S=this.activeSetInfo();S&&S.exerciseData.supersetId&&S.exerciseData.supersetOrder!==null&&S.exerciseData.supersetSize&&(P=S.exerciseIndex-S.exerciseData.supersetOrder+S.exerciseData.supersetSize),k.exercises.splice(P,0,v),this.routine.set(k);let w=yield this.alertService.showConfirm("Exercise Added",`"${r}" added. Start it now? (Otherwise, it will appear after your current block)`);w&&w.data?(this.currentExerciseIndex.set(P),this.currentSetIndex.set(0),this.currentBlockRound.set(1),this.totalBlockRounds.set(v.rounds??1),this.lastPerformanceForCurrentExercise=null,this.playerSubState.set("performing_set"),yield this.prepareCurrentSet()):this.toastService.success(`"${r}" added to the queue.`,3e3,"Exercise Added")}this.closeWorkoutMenu()})}finishWorkoutEarly(){return L(this,null,function*(){if(this.sessionState()==="paused"){this.toastService.warning("Please resume before finishing early.",3e3,"Paused");return}let t=yield this.alertService.showConfirm("Finish Workout Early","Finish workout now? Current progress will be saved.");t&&t.data&&(this.closeWorkoutMenu(),this.closePerformanceInsights(),(yield this.finishWorkoutAndReportStatus())||(this.toastService.info("Workout finished early. Paused session cleared.",4e3),this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),this.router.url.includes("/play")&&this.router.navigate(["/workout"])))})}mapWorkoutExerciseToLoggedWorkoutExercise(t){return{exerciseId:t.exerciseId,exerciseName:t.exerciseName||"",sets:t.sets.map(e=>({id:N(),exerciseName:t.exerciseName,plannedSetId:e.id,exerciseId:t.exerciseId,type:t.type,repsAchieved:0,weightUsed:void 0,durationPerformed:void 0,rpe:void 0,targetReps:e.reps,targetWeight:e.weight,targetDuration:e.duration,targetTempo:e.tempo,notes:e.notes,timestamp:new Date().toISOString()})),rounds:t.rounds??1,type:(t.sets&&t.sets[0]&&t.sets[0].type||t.type)??"standard"}}finishWorkoutAndReportStatus(){return L(this,null,function*(){if(this.stopAutoSave(),this.sessionState()==="paused")return this.toastService.warning("Please resume workout before finishing.",3e3,"Session Paused"),!1;if(this.sessionState()==="loading")return this.toastService.info("Workout is still loading.",3e3,"Loading"),!1;let t=this.routine()?.exercises.map(M=>this.mapWorkoutExerciseToLoggedWorkoutExercise(M));if(t===void 0||t.length===0)return!1;if(t.length===0)return this.toastService.info("No sets logged. Workout not saved.",3e3,"Empty Workout"),this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),this.router.url.includes("/play")&&this.router.navigate(["/workout"]),!1;this.timerSub&&this.timerSub.unsubscribe();let e=this.routine(),i=this.program(),r=!0,o=!1,d=!1,c=e?.name?`${e.name} - ${j(new Date,"MMM d")}`:`Ad-hoc Workout - ${j(new Date,"MMM d, HH:mm")}`,g=this.originalRoutineSnapshot.filter(M=>e?.exercises.find(W=>W.id===M.id&&W.sessionStatus==="pending")||t.some(W=>W.exerciseId===M.exerciseId));if(this.routineId&&this.originalRoutineSnapshot&&this.originalRoutineSnapshot.length>0&&e){let M=this.comparePerformedToOriginal(t,g);if(M.majorDifference){let W=yield this.alertService.showConfirmationDialog("Routine Structure Changed",`You made significant changes to the routine structure:

${M.details.join(`
`)}

Would you like to save this as a new routine, update the original, or cancel?`,[{text:"Save as New Routine",role:"confirm",data:"new",cssClass:"bg-green-600"},{text:"Update Original Routine",role:"destructive",data:"update",cssClass:"bg-blue-600"},{text:"Cancel",role:"cancel",data:"cancel"}]);if(W&&W.data==="new"){let J=yield this.alertService.showPromptDialog("New Routine Name","Enter a name for your new routine:",[{name:"newRoutineName",type:"text",placeholder:c,value:c,attributes:{required:!0}}],"Save Routine");J&&String(J.newRoutineName).trim()?(c=String(J.newRoutineName).trim(),o=!0):r=!1}else W&&W.data==="update"?d=!0:r=!1}}else if(!this.routineId&&t.length>0){o=!0;let M=yield this.alertService.showPromptDialog("Save as New Routine","Enter a name for your new routine:",[{name:"newRoutineName",type:"text",placeholder:c,value:c,attributes:{required:!0}}],"Save Routine");M&&String(M.newRoutineName).trim()?c=String(M.newRoutineName).trim():M||(r=!1)}if(!r)return this.toastService.info("Finish workout cancelled. Session remains active/paused.",3e3,"Cancelled"),this.sessionState()==="playing"&&this.startAutoSave(),!1;let y=Date.now(),v=this.workoutStartTime-this.sessionTimerElapsedSecondsBeforePause*1e3,k=Math.round((y-v)/(1e3*60)),P=this.routineId||void 0,S=e?.name||"Ad-hoc Workout";if(o){let M={name:c,description:e?.description||"Workout performed on "+j(new Date,"MMM d, yyyy"),goal:e?.goal||"custom",exercises:this.convertLoggedToWorkoutExercises(t)},W=this.workoutService.addRoutine(M);P=W.id,S=W.name,this.toastService.success(`New routine "${W.name}" created.`,4e3)}let w={routineId:P,routineName:S,date:j(new Date(v),"yyyy-MM-dd"),startTime:v,endTime:y,durationMinutes:k,exercises:t,notes:e?.notes,programId:i?.id},F=this.trackingService.addWorkoutLog(w);if(this.toastService.success("Congrats! Workout completed!",5e3,"Workout Finished"),P){let M=yield le(this.workoutService.getRoutineById(P).pipe(z(1)));if(M){let W=H(U({},M),{lastPerformed:new Date(v).toISOString()});d&&!o&&this.routineId===P&&(W.exercises=this.convertLoggedToWorkoutExercises(t)),this.workoutService.updateRoutine(W)}}return this.isSessionConcluded=!0,this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),this.router.navigate(["/workout/summary",F.id]),!0})}quitWorkout(){return L(this,null,function*(){let t=yield this.alertService.showConfirm("Quit Workout","Quit workout? Unsaved progress (if not paused) will be lost.");t&&t.data&&(this.stopAllActivity(),this.isSessionConcluded=!0,this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),this.closeWorkoutMenu(),this.closePerformanceInsights(),this.router.navigate(["/workout"]),this.toastService.info("Workout quit. No progress saved for this session.",4e3))})}toggleCompletedSetsInfo(){this.showCompletedSetsInfo.update(t=>!t)}openPerformanceInsights(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Resume to view insights.",3e3,"Paused");return}this.isPerformanceInsightsVisible.set(!0),this.isWorkoutMenuVisible.set(!1)}closePerformanceInsights(){this.isPerformanceInsightsVisible.set(!1),this.editingTarget&&this.cancelEditTarget()}openPerformanceInsightsFromMenu(){this.closeWorkoutMenu(),this.openPerformanceInsights()}goBack(){this.currentWorkoutLogExercises().length>0&&this.sessionState()==="playing"?this.alertService.showConfirm("Exit Workout?","You have an active workout. Are you sure you want to exit? Your progress might be lost unless you pause first.").then(t=>{t&&t.data&&this.router.navigate(["/workout"])}):this.router.navigate(["/workout"])}incrementWeight(t=.5){let e=this.appSettingsService.getSettings().weightStep||t,i=this.csf.actualWeight.value??0;this.currentSetForm.patchValue({actualWeight:parseFloat((i+e).toFixed(2))})}pressStartTime=null;weightIncrementIntervalId=null;weightDecrementIntervalId=null;onWeightIncrementPointerDown(t){if(this.weightIncrementIntervalId!==null)return;this.incrementWeight(),this.weightIncrementIntervalId=setInterval(()=>{this.incrementWeight()},100);let e=()=>{this.weightIncrementIntervalId!==null&&(clearInterval(this.weightIncrementIntervalId),this.weightIncrementIntervalId=null),document.removeEventListener("mouseup",e),document.removeEventListener("touchend",e),document.removeEventListener("mouseleave",e)};document.addEventListener("mouseup",e),document.addEventListener("touchend",e),document.addEventListener("mouseleave",e)}onWeightIncrementPointerUp(t){this.weightIncrementIntervalId!==null&&(clearInterval(this.weightIncrementIntervalId),this.weightIncrementIntervalId=null),document.removeEventListener("mouseup",this.onWeightIncrementPointerUp),document.removeEventListener("touchend",this.onWeightIncrementPointerUp),document.removeEventListener("mouseleave",this.onWeightIncrementPointerUp)}onWeightDecrementPointerDown(t){if(this.weightDecrementIntervalId!==null)return;this.decrementWeight(),this.weightDecrementIntervalId=setInterval(()=>{this.decrementWeight()},100);let e=()=>{this.weightDecrementIntervalId!==null&&(clearInterval(this.weightDecrementIntervalId),this.weightDecrementIntervalId=null),document.removeEventListener("mouseup",e),document.removeEventListener("touchend",e),document.removeEventListener("mouseleave",e)};document.addEventListener("mouseup",e),document.addEventListener("touchend",e),document.addEventListener("mouseleave",e)}onWeightDecrementPointerUp(t){this.weightDecrementIntervalId!==null&&(clearInterval(this.weightDecrementIntervalId),this.weightDecrementIntervalId=null),document.removeEventListener("mouseup",this.onWeightDecrementPointerUp),document.removeEventListener("touchend",this.onWeightDecrementPointerUp),document.removeEventListener("mouseleave",this.onWeightDecrementPointerUp)}decrementWeight(t=.5){let e=this.appSettingsService.getSettings().weightStep||t,i=this.csf.actualWeight.value??0;this.currentSetForm.patchValue({actualWeight:Math.max(0,parseFloat((i-e).toFixed(2)))})}incrementReps(t=1){let e=t,i=this.csf.actualReps.value??0;this.currentSetForm.patchValue({actualReps:i+e})}decrementReps(t=1){let e=t,i=this.csf.actualReps.value??0;this.currentSetForm.patchValue({actualReps:Math.max(0,i-e)})}toggleRpeInput(){this.showRpeSlider.update(t=>!t)}updateRpe(t){let e=typeof t=="string"?parseInt(t,10):t;e!==null&&!isNaN(e)&&e>=1&&e<=10?(this.rpeValue.set(e),this.currentSetForm.patchValue({rpe:e})):e===null&&(this.rpeValue.set(null),this.currentSetForm.patchValue({rpe:null}))}startAutoSave(){q(this.platformId)&&(this.autoSaveSub&&this.autoSaveSub.unsubscribe(),this.autoSaveSub=yt(this.AUTO_SAVE_INTERVAL_MS).subscribe(()=>{this.sessionState()==="playing"&&this.routine()&&(console.log("Auto-saving workout state..."),this.savePausedSessionState())}))}stopAutoSave(){this.autoSaveSub&&(this.autoSaveSub.unsubscribe(),this.autoSaveSub=void 0)}ngOnInit(){return L(this,null,function*(){q(this.platformId)&&window.scrollTo(0,0),(yield this.checkForPausedSession(!1))?this.isInitialLoadComplete=!0:this.loadNewWorkoutFromRoute(),q(this.platformId)&&(this.routerEventsSub=this.router.events.pipe(bt(e=>e instanceof Mt),xe(e=>L(this,null,function*(){let i=this.route.snapshot,r=e.urlAfterRedirects.startsWith("/workout/play/"),o=i.paramMap.get("routineId");r&&(this.routineId===o&&this.isInitialLoadComplete&&this.sessionState()!=="playing"?!(yield this.checkForPausedSession(!0))&&this.sessionState()!=="playing"&&this.loadNewWorkoutFromRoute():this.routineId)}))).subscribe()),this.loadAvailableExercises()})}loadNewWorkoutFromRoute(){return L(this,null,function*(){console.log("loadNewWorkoutFromRoute - START"),this.isInitialLoadComplete=!1,this.sessionState.set("loading"),this.exercisesProposedThisCycle={doLater:!1,skipped:!1},this.isPerformingDeferredExercise=!1,this.lastActivatedDeferredExerciseId=null,this.stopAllActivity(),this.workoutStartTime=Date.now(),this.sessionTimerElapsedSecondsBeforePause=0,this.originalRoutineSnapshot=[],this.currentWorkoutLogExercises.set([]),this.currentSetIndex.set(0),this.currentBlockRound.set(1),this.routine.set(void 0),this.program.set(void 0),this.routeSub&&this.routeSub.unsubscribe(),this.routeSub=this.route.paramMap.pipe(Se(t=>{let e=t.get("routineId");return console.log("loadNewWorkoutFromRoute - paramMap emitted, newRoutineId:",e),e?(this.routineId=e,this.workoutService.getRoutineById(this.routineId).pipe(Ve(i=>{if(i){console.log("loadNewWorkoutFromRoute: Fetched original routine -",i.name),this.originalRoutineSnapshot=JSON.parse(JSON.stringify(i.exercises));let r=JSON.parse(JSON.stringify(i));return r.exercises.forEach(o=>{o.sessionStatus="pending",o.id||(o.id=N()),o.sets.forEach(d=>{d.id||(d.id=N()),d.type||(d.type="standard")})}),r}return console.warn("loadNewWorkoutFromRoute: No original routine found for ID:",this.routineId),null}))):(this.toastService.error("No routine specified to play.",0,"Error"),this.router.navigate(["/workout"]),this.sessionState.set("error"),ge(null))}),xe(t=>L(this,null,function*(){if(console.log("loadNewWorkoutFromRoute - tap operator. Session routine copy:",t?t.name:"null"),this.sessionState()==="paused"){console.log("loadNewWorkoutFromRoute - tap: Session is paused, skipping setup."),this.isInitialLoadComplete=!0;return}if(t){this.exercisesProposedThisCycle={doLater:!1,skipped:!1},this.isPerformingDeferredExercise=!1,this.lastActivatedDeferredExerciseId=null,this.routine.set(t);let e=this.findFirstPendingExerciseAndSet(t);if(e){this.currentExerciseIndex.set(e.exerciseIndex),this.currentSetIndex.set(e.setIndex),console.log(`loadNewWorkoutFromRoute - Initial pending set to Ex: ${e.exerciseIndex}, Set: ${e.setIndex}`);let i=t.exercises[e.exerciseIndex];if(!i.supersetId||i.supersetOrder===0)this.totalBlockRounds.set(i.rounds??1);else{let r=t.exercises.find(o=>o.supersetId===i.supersetId&&o.supersetOrder===0);this.totalBlockRounds.set(r?.rounds??1)}}else{console.log("loadNewWorkoutFromRoute: Routine loaded but no initial pending exercises. Will try deferred/finish."),this.currentExerciseIndex.set(0),this.currentSetIndex.set(0),this.totalBlockRounds.set(1),this.exercisesProposedThisCycle={doLater:!1,skipped:!1},yield this.tryProceedToDeferredExercisesOrFinish(t),this.isInitialLoadComplete=!0;return}this.currentBlockRound.set(1),this.currentWorkoutLogExercises.set([]),yield this.prepareCurrentSet(),this.sessionState()!=="error"&&this.sessionState()!=="paused"&&(this.startSessionTimer(),this.startAutoSave())}else this.routineId&&(console.error("loadNewWorkoutFromRoute - tap: Failed to load routine for ID or routine was null:",this.routineId),this.routine.set(null),this.sessionState.set("error"),this.toastService.error("Failed to load workout routine.",0,"Load Error"),q(this.platformId)&&this.router.navigate(["/workout"]),this.stopAutoSave());this.isInitialLoadComplete=!0,console.log("loadNewWorkoutFromRoute - END tap operator. Final sessionState:",this.sessionState())}))).subscribe({error:t=>{console.error("loadNewWorkoutFromRoute - Error in observable pipeline:",t),this.routine.set(null),this.sessionState.set("error"),this.toastService.error("Critical error loading workout.",0,"Load Error"),q(this.platformId)&&this.router.navigate(["/workout"]),this.isInitialLoadComplete=!0}})})}checkForPausedSession(t=!1){return L(this,null,function*(){let e=this.storageService.getItem(this.PAUSED_WORKOUT_KEY),i=this.route.snapshot.paramMap.get("routineId"),r=this.route.snapshot.queryParamMap.get("resume")==="true";if(console.log("WorkoutPlayer.checkForPausedSession ...",!!e),e&&e.version===this.PAUSED_STATE_VERSION){if(i&&e.routineId===null)return console.log("WorkoutPlayer.checkForPausedSession - Current route is for a specific routine, but paused session was ad-hoc. Discarding paused session."),this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),!1;if(!i&&e.routineId!==null)return console.log("WorkoutPlayer.checkForPausedSession - Current route is ad-hoc, but paused session was for a specific routine. Discarding paused session."),this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),!1;if(i&&e.routineId&&i!==e.routineId)return console.log("WorkoutPlayer.checkForPausedSession - Paused session routine ID does not match current route routine ID. Discarding paused session."),this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),!1;let o=!1;if(r)o=!0,this.router.navigate([],{relativeTo:this.route,queryParams:{resume:null},queryParamsHandling:"merge",replaceUrl:!0});else if(t)o=!0;else{let d=yield this.alertService.showConfirmationDialog("Resume Paused Workout?","You have a paused workout session. Would you like to resume it?",[{text:"Resume",role:"confirm",data:!0,cssClass:"bg-green-600"},{text:"Discard",role:"cancel",data:!1,cssClass:"bg-red-600"}]);o=!!(d&&d.data===!0)}return o?(this.stopAllActivity(),this.routeSub&&this.routeSub.unsubscribe(),yield this.loadStateFromPausedSession(e),this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),this.isInitialLoadComplete=!0,!0):(this.storageService.removeItem(this.PAUSED_WORKOUT_KEY),this.toastService.info("Paused session discarded.",3e3),!1)}return!1})}stopAllActivity(){console.log("stopAllActivity - Stopping timers and auto-save."),this.stopAutoSave(),this.timerSub&&this.timerSub.unsubscribe(),this.timedSetIntervalSub&&this.timedSetIntervalSub.unsubscribe(),this.isRestTimerVisible.set(!1)}resumeSession(){return L(this,null,function*(){this.sessionState()==="paused"?(console.log("resumeSession button clicked - transitioning from Paused to Playing"),this.workoutStartTime=Date.now(),this.sessionState.set("playing"),this.startSessionTimer(),this.startAutoSave(),this.wasTimedSetRunningOnPause&&this.timedSetTimerState()==="paused"&&this.startOrResumeTimedSet(),this.wasTimedSetRunningOnPause=!1,this.wasRestTimerVisibleOnPause&&this.restTimerRemainingSecondsOnPause>0&&this.startRestPeriod(this.restTimerRemainingSecondsOnPause,!0),this.wasRestTimerVisibleOnPause=!1,this.closeWorkoutMenu(),this.closePerformanceInsights(),this.toastService.info("Workout session resumed.",3e3)):!(yield this.checkForPausedSession(!0))&&this.sessionState()!=="playing"&&this.routineId&&this.loadNewWorkoutFromRoute()})}ngOnDestroy(){this.routeSub&&this.routeSub.unsubscribe(),this.timerSub&&this.timerSub.unsubscribe(),this.timedSetIntervalSub&&this.timedSetIntervalSub.unsubscribe(),this.routerEventsSub&&this.routerEventsSub.unsubscribe(),this.presetTimerSub&&this.presetTimerSub.unsubscribe(),this.stopAutoSave(),this.isRestTimerVisible.set(!1),q(this.platformId)&&!this.isSessionConcluded&&(this.sessionState()==="playing"||this.sessionState()==="paused")&&this.routine()&&this.currentWorkoutLogExercises().length>0&&(console.log("WorkoutPlayer ngOnDestroy - Saving state..."),this.savePausedSessionState())}playClientBeep(t=800,e=150){if(q(this.platformId))try{let i=window.AudioContext||window.webkitAudioContext;if(!i){console.warn("Web Audio API not supported in this browser.");return}let r=new i,o=r.createOscillator();o.type="sine",o.frequency.setValueAtTime(t,r.currentTime),o.connect(r.destination),o.start(),o.stop(r.currentTime+e/1e3),setTimeout(()=>{r.state!=="closed"&&r.close()},e+50)}catch(i){console.error("Error playing beep sound:",i)}}playClientGong(t=440,e=700){if(q(this.platformId))try{let i=window.AudioContext||window.webkitAudioContext;if(!i){console.warn("Web Audio API not supported in this browser.");return}let r=new i,o=r.createOscillator(),d=r.createGain();o.type="triangle",o.frequency.setValueAtTime(200,r.currentTime),d.gain.setValueAtTime(1,r.currentTime),d.gain.exponentialRampToValueAtTime(.001,r.currentTime+2),o.connect(d),d.connect(r.destination),o.start(),o.stop(r.currentTime+2)}catch(i){console.error("Error playing gong sound:",i)}}startPresetTimer(t,e){this.playerSubState.set("preset_countdown"),this.presetTimerDuration.set(t);let i=t;this.presetTimerCountdownDisplay.set(String(i)),this.restTimerMainText.set(`GET READY: ${e.exerciseData.exerciseName}`);let r=e.type==="warmup"?`Warm-up ${this.getWarmupSetNumberForDisplay(e.exerciseData,e.setIndex)}/${this.getTotalWarmupSetsForExercise(e.exerciseData)}`:`Set ${this.getWorkingSetNumberForDisplay(e.exerciseData,e.setIndex)}/${this.getWorkingSetCountForExercise(e.exerciseData)}`;this.restTimerNextUpText.set(r),this.presetTimerSub&&this.presetTimerSub.unsubscribe(),this.presetTimerSub=Ue(0,1e3).pipe(z(t+1)).subscribe({next:()=>{this.presetTimerCountdownDisplay.set(String(i)),i<=this.appSettingsService.countdownSoundSeconds()&&i>0&&this.appSettingsService.enableTimerCountdownSound()&&t>5&&this.playClientBeep(600,150),i--},complete:()=>{this.playerSubState()==="preset_countdown"&&(this.playClientBeep(1e3,250),this.handlePresetTimerFinished())}})}handlePresetTimerFinished(){this.presetTimerSub&&(this.presetTimerSub.unsubscribe(),this.presetTimerSub=void 0),this.presetTimerCountdownDisplay.set(null),this.playerSubState.set("performing_set"),this.cdr.detectChanges(),console.log("Pre-set timer finished. Player state set to PerformingSet.")}skipPresetTimer(){this.playerSubState()==="preset_countdown"&&(this.presetTimerSub&&(this.presetTimerSub.unsubscribe(),this.presetTimerSub=void 0),this.handlePresetTimerFinished())}getWarmupSetNumberForDisplay(t,e){let i=0;for(let r=0;r<=e;r++)t.sets[r].type==="warmup"&&i++;return i}getTotalWarmupSetsForExercise(t){return t.sets.filter(e=>e.type==="warmup").length}getWorkingSetNumberForDisplay(t,e){let i=0;for(let r=0;r<=e;r++)t.sets[r].type!=="warmup"&&i++;return i}getWorkingSetCountForExercise(t){return t.sets.filter(e=>e.type!=="warmup").length}findNextPlayableItemIndices(t,e,i,r=!1){let o=t,d=e,c=!1,g=!1,y=!1,v=i.exercises[t];if(r||d>=v.sets.length-1){if(d=0,!r&&v.supersetId&&v.supersetOrder!==null&&v.supersetOrder<(v.supersetSize||1)-1){let S=t+1;for(;S<i.exercises.length&&(i.exercises[S].supersetId!==v.supersetId||i.exercises[S].sessionStatus!=="pending");)S++;if(S<i.exercises.length&&i.exercises[S].supersetId===v.supersetId)return o=S,{nextExIdx:o,nextSetIdx:d,blockChanged:c,isEndOfAllPending:g,roundIncremented:y}}let k=this.totalBlockRounds();if(!r&&this.currentBlockRound()<k){this.currentBlockRound.update(M=>M+1),y=!0;let S=t;v.supersetId&&v.supersetOrder!==null&&(S=t-v.supersetOrder);let w=S,F=!1;for(;w<i.exercises.length&&(v.supersetId?i.exercises[w].supersetId===v.supersetId:w===S);){if(i.exercises[w].sessionStatus==="pending"){o=w,F=!0;break}w++}if(!F)this.currentBlockRound.set(k),y=!1;else return{nextExIdx:o,nextSetIdx:d,blockChanged:c,isEndOfAllPending:g,roundIncremented:y}}c=!0,this.currentBlockRound.set(1),y=!1;let P=t+1;v.supersetId&&v.supersetOrder!==null&&(P=t-v.supersetOrder+(v.supersetSize||1)),o=-1;for(let S=P;S<i.exercises.length;S++){let w=i.exercises[S];if(w.sessionStatus==="pending"){if(!w.supersetId||w.supersetOrder===0){o=S;break}let F=S-(w.supersetOrder||0);if(F>=0&&i.exercises[F].sessionStatus==="pending"&&i.exercises[F].supersetId===w.supersetId){o=F;break}}}}else d++;return(o===-1||o>=i.exercises.length||o!==-1&&i.exercises[o].sessionStatus!=="pending")&&(g=!0,o=-1),{nextExIdx:o,nextSetIdx:d,blockChanged:c,isEndOfAllPending:g,roundIncremented:y}}getUnfinishedExercises(){let t=this.routine(),e=this.currentWorkoutLogExercises();return t?t.exercises.filter((i,r)=>{let o=e.find(d=>d.exerciseId===i.exerciseId&&t.exercises[r].id===i.id);return!o||o.sets.length<i.sets.length}):[]}getFinishedExercises(){let t=this.routine(),e=this.currentWorkoutLogExercises();return t?t.exercises.filter((i,r)=>{let o=e.find(d=>d.exerciseId===i.exerciseId&&t.exercises[r].id===i.id);return o&&o.sets.length>=i.sets.length}):[]}navigateToNextStepInWorkout(t,e,i=!1){return L(this,null,function*(){let r=t.exerciseData,o=this.isExerciseFullyLogged(r.exerciseId,t.exerciseIndex,r.sets.length);if(this.isPerformingDeferredExercise&&r.id===this.lastActivatedDeferredExerciseId&&o){console.log("navigateToNextStepInWorkout: Completed an explicitly chosen deferred/skipped exercise. Re-evaluating all remaining."),this.isPerformingDeferredExercise=!1,this.lastActivatedDeferredExerciseId=null,this.exercisesProposedThisCycle={doLater:!1,skipped:!1},yield this.tryProceedToDeferredExercisesOrFinish(e);return}let{nextExIdx:d,nextSetIdx:c,blockChanged:g,isEndOfAllPending:y,roundIncremented:v}=this.findNextPlayableItemIndices(t.exerciseIndex,t.setIndex,e,i);if(y){console.log("navigateToNextStepInWorkout: No more 'pending' exercises in main sequence. Attempting to proceed to deferred or finish."),this.isPerformingDeferredExercise=!1,this.lastActivatedDeferredExerciseId=null,this.exercisesProposedThisCycle={doLater:!1,skipped:!1},yield this.tryProceedToDeferredExercisesOrFinish(e);return}if(d===-1)return;let k=e.exercises[d];if(k&&r&&k.id===r.id&&console.log("Next exercise is the same as just completed:",k.exerciseName),this.currentWorkoutLogExercises().some(w=>w.exerciseId===k?.exerciseId&&e.exercises.find(F=>F.id===k?.id)&&this.isExerciseFullyLogged(k?.id,d,k.sets?.length))&&(console.log("Next exercise is already logged in currentWorkoutLogExercises:",k?.exerciseName),this.tryProceedToDeferredExercisesOrFinish(e)),this.currentExerciseIndex.set(d),this.currentSetIndex.set(c),t.exerciseIndex!==d&&e.exercises[d].id!==this.lastActivatedDeferredExerciseId&&(this.isPerformingDeferredExercise=!1,this.lastActivatedDeferredExerciseId=null),(g||v||i||t.exerciseIndex!==d)&&(this.lastPerformanceForCurrentExercise=null),g){let w=e.exercises[d];if(!w.supersetId||w.supersetOrder===0)this.totalBlockRounds.set(w.rounds??1);else{let F=e.exercises.find(M=>M.supersetId===w.supersetId&&M.supersetOrder===0);this.totalBlockRounds.set(F?.rounds??1)}}let S=t.setData.restAfterSet;S>0&&!i?this.startRestPeriod(S):(this.playerSubState.set("performing_set"),yield this.prepareCurrentSet())})}startRestPeriod(t,e=!1){if(this.playerSubState.set("resting"),this.restDuration.set(t),q(this.platformId)&&t>0){let i=this.routine();if(e)this.restTimerMainText.set(this.restTimerMainTextOnPause),this.restTimerNextUpText.set(this.restTimerNextUpTextOnPause);else{this.restTimerMainText.set("RESTING");let r=this.peekNextSetInfo(),o="Next Exercise";if(r&&r.exerciseData&&r.exerciseData.sets){let d=r.type==="warmup",c=d?this.getWarmupSetNumberForDisplay(r.exerciseData,r.setIndex):this.getWorkingSetNumberForDisplay(r.exerciseData,r.setIndex),g=d?this.getTotalWarmupSetsForExercise(r.exerciseData):this.getWorkingSetCountForExercise(r.exerciseData),y=r.exerciseData.exerciseName||"Exercise",v="";if(i){let k=r.exerciseData,P=k.rounds??0;if(k.supersetId&&k.supersetOrder!==null){let S=i.exercises.find(w=>w.supersetId===k.supersetId&&w.supersetOrder===0);S&&(P=S.rounds??1)}P>=1&&k.supersetSize!==void 0&&k.supersetSize!==null&&k.supersetSize>0&&(v=` (Round ${this.currentBlockRound()}/${P})`)}o=`${d?"Warm-up ":""}Set ${c}/${g} of ${y}${v}`}this.restTimerNextUpText.set(o)}this.playerSubState.set("resting"),this.restDuration.set(t),this.isRestTimerVisible.set(!0),this.updateRestTimerDisplay(t)}else this.isRestTimerVisible.set(!1),this.playerSubState.set("performing_set"),this.prepareCurrentSet()}peekNextSetInfo(){let t=this.routine(),e=this.currentExerciseIndex(),i=this.currentSetIndex();if(t&&t.exercises[e]&&t.exercises[e].sets[i]){let r=t.exercises[e],o=t.exercises[e].sets[i];return{exerciseIndex:e,setIndex:i,exerciseData:r,setData:o,type:o.type??"standard",isCompleted:!1}}return null}handleRestTimerFinished(){console.log("Rest timer finished."),this.isRestTimerVisible.set(!1),this.prepareCurrentSet()}handleRestTimerSkipped(){console.log("Rest timer skipped."),this.isRestTimerVisible.set(!1),this.toastService.info("Rest skipped.",2e3),this.playerSubState.set("performing_set"),this.prepareCurrentSet()}getDisabled(){return this.timedSetTimerState()==="running"||this.sessionState()==="paused"||this.playerSubState()==="preset_countdown"||this.playerSubState()==="resting"}handleMainAction(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Please resume to continue.",3e3,"Paused");return}switch(this.playerSubState()){case"performing_set":{this.completeAndLogCurrentSet();break}case"preset_countdown":this.skipPresetTimer();break;case"resting":this.skipRest();break}}shouldRunPresetTimerForCurrentSet=B(()=>{let t=this.appSettingsService.enablePresetTimer(),e=this.appSettingsService.presetTimerDurationSeconds();if(!t||e<=0)return!1;let i=this.routine(),r=this.currentExerciseIndex(),o=this.currentSetIndex();if(!i||!i.exercises[r]||!i.exercises[r].sets[o])return!1;let d=r===0&&o===0&&this.currentBlockRound()===1,c=1/0;if(o>0)c=i.exercises[r].sets[o-1].restAfterSet;else if(r>0){let g=i.exercises[r-1];c=g.sets[g.sets.length-1].restAfterSet}return d||c===0});getIncompleteExercises(){let t=this.routine(),e=this.currentWorkoutLogExercises();return t?t.exercises.filter(i=>{if(i.sessionStatus!=="pending")return!1;let r=e.find(o=>o.exerciseId===i.exerciseId);return r?r.sets.length<i.sets.length:!0}):[]}jumpToExercise(){return L(this,null,function*(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Resume to jump to an exercise.",3e3,"Paused"),this.closeWorkoutMenu();return}let t=this.routine();if(!t||!t.exercises||t.exercises.length===0){this.toastService.error("No exercises available to jump to.",0,"Error"),this.closeWorkoutMenu();return}let e=t.exercises.map((o,d)=>H(U({},o),{originalIndex:d,isFullyLogged:this.isExerciseFullyLogged(o.exerciseId,d,o.sets.length)})).filter(o=>!o.isFullyLogged||o.sessionStatus==="pending"||o.sessionStatus==="do_later"||o.sessionStatus==="skipped");if(e.length===0){this.toastService.info("All exercises are completed or no suitable exercises to jump to.",3e3),this.closeWorkoutMenu();return}let i=e.map(o=>{let d="";o.id===this.activeSetInfo()?.exerciseData.id&&o.sessionStatus==="pending"&&!o.isFullyLogged?d=" (Current)":o.isFullyLogged&&o.sessionStatus!=="skipped"&&o.sessionStatus!=="do_later"?d=" (Completed - Restart?)":o.sessionStatus==="skipped"?d=" (Skipped)":o.sessionStatus==="do_later"&&(d=" (Do Later)");let c="bg-gray-500 dark:bg-gray-700 dark:text-gray-100 hover:bg-gray-300 hover:text-gray-500 hover:dark:bg-gray-300 hover:dark:text-gray-500";switch(o.sessionStatus){case"pending":c=d.includes("Current")?"bg-blue-600 text-white":c;break;case"do_later":c="bg-orange-500 hover:bg-orange-600 text-white";break;case"skipped":c="bg-yellow-500 hover:bg-yellow-600 text-black";break;default:c="bg-gray-500 dark:bg-gray-700 dark:text-gray-100 hover:bg-gray-300 hover:text-gray-500 hover:dark:bg-gray-300 hover:dark:text-gray-500";break}return{text:`${o.exerciseName}${d}`,role:"confirm",data:o.originalIndex,cssClass:c}});i.push({text:"Cancel",role:"cancel",data:"cancel_jump"}),this.closeWorkoutMenu();let r=yield this.alertService.showConfirmationDialog("Jump to Exercise","Select an exercise to start or continue:",i);if(r&&r.data!=="cancel_jump"&&typeof r.data=="number"){let o=r.data,d=t.exercises[o];if(!d){this.toastService.error("Selected exercise not found.",0,"Error");return}console.log(`Jumping to exercise: ${d.exerciseName} at index ${o}`),this.stopOngoingTimers();let c=JSON.parse(JSON.stringify(t)),g=c.exercises[o],y=g.sessionStatus==="do_later"||g.sessionStatus==="skipped";if(g.sessionStatus="pending",this.routine.set(c),this.currentExerciseIndex.set(o),this.currentSetIndex.set(this.findFirstUnloggedSetIndex(d.exerciseId,d.sets.map(v=>v.id))||0),this.currentBlockRound.set(1),!d.supersetId||d.supersetOrder===0)this.totalBlockRounds.set(d.rounds??1);else{let v=c.exercises.find(k=>k.supersetId===d.supersetId&&k.supersetOrder===0);this.totalBlockRounds.set(v?.rounds??1)}this.lastPerformanceForCurrentExercise=null,this.isPerformingDeferredExercise=y,this.lastActivatedDeferredExerciseId=y?d.id:null,this.playerSubState.set("performing_set"),yield this.prepareCurrentSet(),this.toastService.info(`Jumped to ${d.exerciseName}.`,2500)}})}stopOngoingTimers(){this.isRestTimerVisible()&&this.isRestTimerVisible.set(!1),this.playerSubState(),this.playerSubState()==="preset_countdown"&&this.presetTimerSub&&(this.presetTimerSub.unsubscribe(),this.presetTimerSub=void 0,this.presetTimerCountdownDisplay.set(null)),this.timedSetTimerState()!=="idle"&&this.timedSetIntervalSub&&this.resetTimedSet()}loadAvailableExercises(){this.exerciseService.getExercises().pipe(z(1)).subscribe(t=>{this.availableExercises=t})}openExerciseSelectionModal(){if(this.sessionState()==="paused"){this.toastService.warning("Session is paused. Resume to add exercise.",3e3,"Paused");return}this.availableExercises.length===0&&this.loadAvailableExercises(),this.modalSearchTerm.set(""),this.isExerciseModalOpen.set(!0),this.closeWorkoutMenu()}closeExerciseSelectionModal(){this.isExerciseModalOpen.set(!1)}onModalSearchTermChange(t){let e=t.target;this.modalSearchTerm.set(e.value)}isExerciseDetailModalOpen=T(!1);isSimpleModalOpen=T(!1);exerciseDetailsId="";exerciseDetailsName="";performAction(){console.log("Action performed from modal footer!"),this.isExerciseDetailModalOpen.set(!1)}openModal(t){this.exerciseDetailsId=t.exerciseId,this.exerciseDetailsName=t.exerciseName||"Exercise details",this.isSimpleModalOpen.set(!0)}showCompletedSetsForExerciseInfo=T(!1);toggleCompletedSetsForExerciseInfo(){this.showCompletedSetsForExerciseInfo.update(t=>!t)}showCompletedSetsForDayInfo=T(!1);toggleCompletedSetsForDayInfo(){this.showCompletedSetsForDayInfo.update(t=>!t)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=Y({type:n,selectors:[["app-workout-player"]],hostBindings:function(e,i){e&1&&h("beforeunload",function(o){return i.unloadNotification(o)},It)},features:[Ge([ce])],decls:8,vars:10,consts:[["loadingOrError",""],["routineNotFound",""],["workoutCompleteOrError",""],["loadingBaseExIcon",""],["class","workout-player-container bg-gray-50 dark:bg-gray-950 min-h-screen flex flex-col",4,"ngIf","ngIfElse"],[3,"timerFinished","timerSkipped","isVisible","durationSeconds","mainText","nextUpText"],["class","fixed inset-0 z-50 bg-black/70 backdrop-blur-md flex flex-col items-center justify-center p-4 space-y-2 sm:space-y-3","style","padding-top: env(safe-area-inset-top); padding-bottom: env(safe-area-inset-bottom);",4,"ngIf"],["style","z-index: 100","class","fixed inset-0 bg-gray-900/70 dark:bg-black/80 backdrop-blur-md flex items-center justify-center p-4 transition-opacity duration-300 ease-in-out",4,"ngIf"],["class","fixed inset-0 bg-gray-700 bg-opacity-75 transition-opacity overflow-y-auto h-full w-full z-[70] flex items-center justify-center p-4",3,"click",4,"ngIf"],[3,"isOpen","modalTitle","isOpenChange",4,"ngIf"],[1,"workout-player-container","bg-gray-50","dark:bg-gray-950","min-h-screen","flex","flex-col"],["class","fixed inset-0 z-[60] bg-black/70 backdrop-blur-sm flex flex-col items-center justify-center space-y-6 p-4",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"fixed","inset-0","z-[60]","bg-black/70","backdrop-blur-sm","flex","flex-col","items-center","justify-center","space-y-6","p-4"],[1,"text-4xl","font-bold","text-white"],[1,"text-lg","text-gray-200"],[1,"bg-green-500","hover:bg-green-600","text-white","font-bold","py-3","px-8","rounded-lg","text-xl","shadow-lg","w-full","max-w-xs",3,"click"],[1,"text-m","text-red-300","hover:text-red-100","font-medium","py-2","px-4","rounded-md","border","border-red-300","hover:bg-red-700/30","w-full","max-w-xs","mt-2",3,"click"],[1,"fixed","top-0","left-0","right-0","z-30","bg-gray-50","dark:bg-gray-950","border-b","border-gray-200","dark:border-gray-800","p-2","flex","items-center","justify-between","h-14"],[1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-ml-1",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"text-center"],[1,"text-m","font-semibold","text-gray-700","dark:text-gray-300","uppercase","tracking-wider","truncate","max-w-[calc(100vw-120px)]",3,"title"],[1,"text-xs","text-gray-500","dark:text-gray-400"],[1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-mr-1","disabled:opacity-50",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-6","w-6"],["stroke-linecap","round","stroke-linejoin","round","d","M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"],[1,"flex-grow","overflow-y-auto","pt-10"],["class","p-4 max-w-md mx-auto",4,"ngIf","ngIfElse"],["class","fixed bottom-[76px] left-0 right-0 z-10 bg-gray-100 dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 p-2 text-center h-auto min-h-[60px] flex flex-col justify-center shadow-[0_-1px_3px_rgba(0,0,0,0.07)]",4,"ngIf"],[1,"p-4","max-w-md","mx-auto"],[1,"flex","text-center","justify-center","items-center","mb-1"],["class","mr-2 h-8 w-8 flex-shrink-0",4,"ngIf","ngIfElse"],[1,"text-2xl","font-bold","text-gray-800","dark:text-gray-100","truncate",3,"title"],["class","ml-2 cursor-pointer dark:text-white","title","Exercise details","width","20","height","20","viewBox","0 0 20 20","xmlns","http://www.w3.org/2000/svg",3,"click",4,"ngIf"],[1,"text-center","mb-2"],[1,"text-m","text-gray-500","dark:text-gray-400"],["class","text-blue-500 dark:text-blue-400",4,"ngIf"],[4,"ngIf"],["class","ml-2",4,"ngIf"],["class","ml-2 text-purple-500 dark:text-purple-400 italic",4,"ngIf"],["class","text-center mb-3",4,"ngIf"],["class","text-center mb-6 animate-fadeIn",4,"ngIf"],["class","left-0 right-0 z-20 p-3",4,"ngIf"],["class","text-wrap text-sm text-center text-gray-800 dark:text-gray-100 px-2 text-s",3,"title",4,"ngIf"],[1,"mr-2","h-8","w-8","flex-shrink-0"],["class","w-full h-full object-contain",3,"src","alt","ngClass",4,"ngIf"],[1,"w-full","h-full","object-contain",3,"src","alt","ngClass"],[1,"w-8","h-8","bg-gray-200","dark:bg-gray-700","rounded-md","animate-pulse","mr-2","flex-shrink-0"],["title","Exercise details","width","20","height","20","viewBox","0 0 20 20","xmlns","http://www.w3.org/2000/svg",1,"ml-2","cursor-pointer","dark:text-white",3,"click"],["cx","10","cy","10","r","9","stroke","currentColor","stroke-width","2","fill","none"],["cx","10","cy","6","r","1.5","fill","currentColor"],["x","9","y","9","width","2","height","7","fill","currentColor"],[1,"text-blue-500","dark:text-blue-400"],[1,"ml-2"],[1,"ml-2","text-purple-500","dark:text-purple-400","italic"],[1,"text-center","mb-3"],["class","px-2 py-0.5 text-xs font-semibold text-red-700 bg-red-100 dark:bg-red-900 dark:text-red-200 rounded-full",4,"ngIf"],["class","px-2 py-0.5 text-xs font-semibold text-yellow-700 bg-yellow-100 dark:bg-yellow-800 dark:text-yellow-200 rounded-full",4,"ngIf"],[1,"px-2","py-0.5","text-xs","font-semibold","text-red-700","bg-red-100","dark:bg-red-900","dark:text-red-200","rounded-full"],[1,"px-2","py-0.5","text-xs","font-semibold","text-yellow-700","bg-yellow-100","dark:bg-yellow-800","dark:text-yellow-200","rounded-full"],[1,"text-center","mb-6","animate-fadeIn"],[1,"text-xl","font-semibold","text-blue-600","dark:text-blue-400"],[1,"text-4xl","sm:text-5xl","font-bold","text-blue-500","dark:text-blue-300","my-3"],[1,"text-m","text-gray-600","dark:text-gray-400"],[1,"mt-4","text-xs","text-primary","dark:text-primary-light","hover:underline",3,"click"],[1,"space-y-4","mb-2",3,"formGroup"],[1,"mt-3"],["for","setNotes",1,"block","text-xs","font-medium","text-gray-500","dark:text-gray-400","uppercase","tracking-wider","text-center","mb-1"],["id","setNotes","formControlName","setNotes","rows","2","placeholder","e.g., felt good, struggled on last rep...",1,"w-full","p-2","border","border-gray-300","dark:border-gray-600","rounded-md","shadow-sm","focus:ring-primary","focus:border-primary","dark:bg-gray-800","dark:text-gray-200","text-m","disabled:opacity-60",3,"disabled"],[1,"block","text-xs","font-medium","text-gray-500","dark:text-gray-400","uppercase","tracking-wider","text-center","mb-1"],[1,"flex","items-center","justify-center","space-x-2"],["type","button","appLongPress","",1,"p-3","bg-gray-200","dark:bg-gray-700","rounded-lg","text-gray-700","dark:text-gray-200","hover:bg-gray-300","dark:hover:bg-gray-600","disabled:opacity-50",3,"mousedown","longPress","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M20 12H4"],[1,"w-28","text-center","text-3xl","font-bold","bg-transparent","p-0","text-gray-800","dark:text-gray-100","cursor-pointer","hover:bg-gray-100","dark:hover:bg-gray-800","rounded-md","py-1",3,"click"],["type","number","formControlName","actualWeight",1,"hidden"],[1,"text-lg","text-gray-700","dark:text-gray-200","-ml-1"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],["type","button",1,"p-3","bg-gray-200","dark:bg-gray-700","rounded-lg","text-gray-700","dark:text-gray-200","hover:bg-gray-300","dark:hover:bg-gray-600","disabled:opacity-50",3,"click","disabled"],["type","number","formControlName","actualReps","readonly","","placeholder","0",1,"w-28","text-center","text-3xl","font-bold","bg-transparent","border-none","p-0","focus:ring-0","text-gray-800","dark:text-gray-100"],["for","timedSetDisplay",1,"block","text-xs","font-medium","text-gray-500","dark:text-gray-400","uppercase","tracking-wider","text-center","mb-2"],["id","timedSetDisplay",1,"mt-1","block","w-full","p-3","border-none","text-3xl","font-bold","text-center","bg-transparent","focus:ring-0",3,"ngClass"],["type","number","formControlName","actualDuration",1,"hidden"],[1,"flex","space-x-2","mt-2","justify-center"],["type","button",1,"flex-grow","max-w-[150px]","text-white","font-medium","py-2","px-3","rounded-full","transition-colors","text-m","disabled:opacity-50",3,"click","disabled","ngClass"],["type","button","class","flex-grow max-w-[150px] bg-gray-300 hover:bg-gray-400 dark:bg-gray-700 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 font-medium py-2 px-3 rounded-md transition-colors text-m disabled:opacity-50",3,"disabled","click",4,"ngIf"],["type","button",1,"flex-grow","max-w-[150px]","bg-gray-300","hover:bg-gray-400","dark:bg-gray-700","dark:hover:bg-gray-500","text-gray-800","dark:text-gray-200","font-medium","py-2","px-3","rounded-md","transition-colors","text-m","disabled:opacity-50",3,"click","disabled"],[1,"left-0","right-0","z-20","p-3"],[1,"max-w-md","mx-auto"],[1,"w-full","font-bold","py-3.5","px-4","rounded-full","shadow-md","text-lg","transition-colors","focus:outline-none","focus:ring-2","disabled:opacity-70","text-white",3,"click","disabled","ngClass"],[1,"text-wrap","text-sm","text-center","text-gray-800","dark:text-gray-100","px-2","text-s",3,"title"],[1,"font-medium"],[1,"text-center","py-10","pt-16"],[1,"text-2xl","font-semibold","text-gray-700","dark:text-gray-200"],["class","text-gray-600 dark:text-gray-400 mt-2",4,"ngIf"],["class","mt-6 bg-primary hover:bg-primary-dark text-white font-bold py-3 px-6 rounded-lg shadow-md text-lg transition-colors",3,"click",4,"ngIf"],["routerLink","/workout","class","mt-6 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg shadow-md text-lg transition-colors",4,"ngIf"],["routerLink","/workout","class","mt-6 text-primary dark:text-primary-light hover:underline p-2",4,"ngIf"],[1,"text-gray-600","dark:text-gray-400","mt-2"],[1,"mt-6","bg-primary","hover:bg-primary-dark","text-white","font-bold","py-3","px-6","rounded-lg","shadow-md","text-lg","transition-colors",3,"click"],["routerLink","/workout",1,"mt-6","bg-gray-500","hover:bg-gray-600","text-white","font-bold","py-3","px-6","rounded-lg","shadow-md","text-lg","transition-colors"],["routerLink","/workout",1,"mt-6","text-primary","dark:text-primary-light","hover:underline","p-2"],[1,"fixed","bottom-[76px]","left-0","right-0","z-10","bg-gray-100","dark:bg-gray-900","border-t","border-gray-200","dark:border-gray-700","p-2","text-center","h-auto","min-h-[60px]","flex","flex-col","justify-center","shadow-[0_-1px_3px_rgba(0,0,0,0.07)]"],[1,"max-w-md","mx-auto","w-full"],[1,"text-xs","font-semibold","text-gray-500","dark:text-gray-400","uppercase","tracking-wider"],[1,"text-base","font-medium","text-gray-800","dark:text-gray-100","truncate","px-4",3,"title"],[1,"text-m","text-gray-600","dark:text-gray-300"],[1,"ml-2","text-xs","text-primary","dark:text-primary-light","hover:underline",3,"click"],[1,"text-xl","font-bold","text-blue-600","dark:text-blue-300"],[1,"mt-0.5","text-xs","text-primary","dark:text-primary-light","hover:underline",3,"click"],[1,"fixed","top-0","left-0","right-0","z-30","bg-gray-50","dark:bg-gray-950","border-b","border-gray-200","dark:border-gray-800","p-4","flex","items-center","justify-between","h-16"],[1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-ml-2",3,"click"],[1,"text-m","font-semibold","text-gray-700","dark:text-gray-300","uppercase","tracking-wider"],[1,"w-6"],[1,"text-center","py-20","pt-24"],[1,"text-2xl","font-semibold","text-red-600","dark:text-red-400","mb-4"],[1,"text-gray-600","dark:text-gray-400"],["routerLink","/workout",1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-ml-1"],[1,"fixed","inset-0","z-50","bg-black/70","backdrop-blur-md","flex","flex-col","items-center","justify-center","p-4","space-y-2","sm:space-y-3",2,"padding-top","env(safe-area-inset-top)","padding-bottom","env(safe-area-inset-bottom)"],[1,"flex","columns-3"],[1,"p-1.5","rounded-full","text-gray-500","hover:text-gray-700","dark:text-gray-400","dark:hover:text-gray-200","hover:bg-gray-100","dark:hover:bg-gray-700/70","focus:outline-none","transition-colors",3,"click"],["_ngcontent-ng-c2442506092","","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2.5",1,"h-6","w-6"],["_ngcontent-ng-c2442506092","","stroke-linecap","round","stroke-linejoin","round","d","M6 18L18 6M6 6l12 12"],[1,"text-2xl","sm:text-3xl","font-bold","text-white","mb-2"],[1,"flex","justify-center","items-center","w-full","max-w-xs","bg-yellow-500","hover:bg-yellow-600","text-white","font-bold","py-2.5","px-6","rounded-lg","text-lg","shadow-lg","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],["viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"h-5","w-5","text-white"],["cx","10","cy","10","r","8","fill","none","stroke","currentColor","stroke-width","2"],["x","7","y","7","width","2","height","7","rx","4","ry","4","fill","currentColor"],["x","11","y","7","width","2","height","7","rx","4","ry","4","fill","currentColor"],[1,"flex","justify-center","items-center","w-full","max-w-xs","bg-fuchsia-500","hover:bg-fuchsia-600","text-white","font-semibold","py-2","px-6","rounded-lg","text-md","shadow-md","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 400 500","width","55","height","20","fill","white"],["d","M96 64c0-17.7 14.3-32 32-32l32 0c17.7 0 32 14.3 32 32l0 160 0 64 0 160c0 17.7-14.3 32-32 32l-32 0c-17.7 0-32-14.3-32-32l0-64-32 0c-17.7 0-32-14.3-32-32l0-64c-17.7 0-32-14.3-32-32s14.3-32 32-32l0-64c0-17.7 14.3-32 32-32l32 0 0-64zm448 0l0 64 32 0c17.7 0 32 14.3 32 32l0 64c17.7 0 32 14.3 32 32s-14.3 32-32 32l0 64c0 17.7-14.3 32-32 32l-32 0 0 64c0 17.7-14.3 32-32 32l-32 0c-17.7 0-32-14.3-32-32l0-160 0-64 0-160c0-17.7 14.3-32 32-32l32 0c17.7 0 32 14.3 32 32zM416 224l0 64-192 0 0-64 192 0z"],[1,"flex","justify-center","align-center","w-full","max-w-xs","bg-cyan-500","hover:bg-cyan-600","text-white","font-semibold","py-2","px-6","rounded-lg","text-md","shadow-md","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","white","stroke-width","2",1,"h-5","w-5","text-gray-500","dark:text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","d","M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"],[1,"w-full","max-w-xs","bg-sky-500","hover:bg-sky-600","text-white","font-semibold","py-2","px-6","rounded-lg","text-md","shadow-md","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],["class","text-xs text-white ml-2",4,"ngIf"],[1,"w-full","max-w-xs","bg-purple-500","hover:bg-purple-600","text-white","font-semibold","py-2","px-6","rounded-lg","text-md","shadow-md","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","max-w-xs","bg-blue-500","hover:bg-blue-600","text-white","font-semibold","py-2","px-6","rounded-lg","text-md","shadow-md","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","max-w-xs","bg-indigo-500","hover:bg-indigo-600","text-white","font-semibold","py-2","px-6","rounded-lg","text-md","shadow-md","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","max-w-xs","bg-orange-500","hover:bg-orange-600","text-white","font-semibold","py-2","px-6","rounded-lg","text-md","shadow-md","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","max-w-xs","bg-teal-500","hover:bg-teal-600","text-white","font-semibold","py-2","px-6","rounded-lg","text-md","shadow-md","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","max-w-xs","text-red-300","hover:text-red-100","font-medium","py-2","px-6","rounded-lg","border","border-red-400","hover:bg-red-700/50","text-md",3,"click"],[1,"text-xs","text-white","ml-2"],[1,"fixed","inset-0","bg-gray-900/70","dark:bg-black/80","backdrop-blur-md","flex","items-center","justify-center","p-4","transition-opacity","duration-300","ease-in-out",2,"z-index","100"],[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-2xl","w-full","max-w-xl","max-h-[90vh]","flex","flex-col","overflow-hidden","transform","transition-all","duration-300","ease-in-out","scale-95","opacity-0","animate-modal-appear"],[1,"p-5","border-b","border-gray-200","dark:border-gray-700","flex","justify-between","items-center"],[1,"flex","items-center","gap-3"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-7","w-7","text-primary","dark:text-primary-light"],["stroke-linecap","round","stroke-linejoin","round","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-xl","font-semibold","text-gray-800","dark:text-gray-100"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2.5",1,"h-6","w-6"],["stroke-linecap","round","stroke-linejoin","round","d","M6 18L18 6M6 6l12 12"],["class","p-5 overflow-y-auto space-y-6 flex-grow custom-scrollbar",4,"ngIf"],[1,"p-4","bg-gray-50","dark:bg-gray-800","border-t","border-gray-200","dark:border-gray-700","text-right"],[1,"bg-primary","hover:bg-primary-dark","focus:ring-4","focus:ring-primary-focus","text-white","font-semibold","py-2.5","px-6","rounded-lg","text-sm","transition-colors","shadow-md","hover:shadow-lg",3,"click"],[1,"p-5","overflow-y-auto","space-y-6","flex-grow","custom-scrollbar"],[1,"rounded-lg","border","border-gray-200","dark:border-gray-700/80"],[1,"w-full","flex","items-center","justify-between","p-3","text-left","text-sm","font-medium","text-gray-700","dark:text-gray-300","hover:bg-gray-50","dark:hover:bg-gray-700/50","transition-colors","rounded-t-lg",3,"click"],[1,"flex","items-center","gap-2"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-5","w-5","text-gray-500","dark:text-gray-400"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-5","w-5","transform","transition-transform","duration-200",3,"ngClass"],["stroke-linecap","round","stroke-linejoin","round","d","M19 9l-7 7-7-7"],["class","bg-gray-50 dark:bg-gray-700/30 p-3 border-t border-gray-200 dark:border-gray-700/80 space-y-3 max-h-40 overflow-y-auto custom-scrollbar rounded-b-lg",4,"ngIf"],["class","p-3 text-xs text-center text-gray-500 dark:text-gray-400 border-t border-gray-200 dark:border-gray-700/80 rounded-b-lg",4,"ngIf"],["stroke-linecap","round","stroke-linejoin","round","d","M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"],["class","bg-gray-50 dark:bg-gray-700/30 p-3 border-t border-gray-200 dark:border-gray-700/80 space-y-3 max-h-48 overflow-y-auto custom-scrollbar rounded-b-lg",4,"ngIf"],["class","p-3 bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700 rounded-lg text-xs",4,"ngIf"],["class","p-3 bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 rounded-lg text-xs text-center text-gray-500 dark:text-gray-400 italic",4,"ngIf"],["class","p-3 bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-700 rounded-lg text-xs",4,"ngIf"],[1,"space-y-4","pt-4","border-t","border-gray-200","dark:border-gray-700"],[1,"text-sm","font-semibold","text-gray-700","dark:text-gray-200"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-4"],["class","p-3 bg-gray-50 dark:bg-gray-700/80 rounded-lg shadow",4,"ngIf"],["class","mt-4 p-3 bg-gray-100 dark:bg-gray-700/60 rounded-lg text-xs",4,"ngIf"],[1,"bg-gray-50","dark:bg-gray-700/30","p-3","border-t","border-gray-200","dark:border-gray-700/80","space-y-3","max-h-40","overflow-y-auto","custom-scrollbar","rounded-b-lg"],["class","text-xs p-2 bg-white dark:bg-gray-700 rounded-md shadow-sm border border-gray-200 dark:border-gray-600",4,"ngFor","ngForOf"],[1,"text-xs","p-2","bg-white","dark:bg-gray-700","rounded-md","shadow-sm","border","border-gray-200","dark:border-gray-600"],[1,"font-semibold","text-gray-700","dark:text-gray-200","mb-1"],["class","text-blue-600 dark:text-blue-400 font-normal",4,"ngIf"],[1,"grid","grid-cols-2","gap-x-2","gap-y-1","text-gray-600","dark:text-gray-300"],["class","col-span-2",4,"ngIf"],["class","mt-1.5 text-gray-500 dark:text-gray-400 italic text-2xs border-t border-gray-100 dark:border-gray-600 pt-1.5",4,"ngIf"],[1,"text-blue-600","dark:text-blue-400","font-normal"],[1,"dark:text-gray-100"],[1,"col-span-2"],[1,"mt-1.5","text-gray-500","dark:text-gray-400","italic","text-2xs","border-t","border-gray-100","dark:border-gray-600","pt-1.5"],[1,"p-3","text-xs","text-center","text-gray-500","dark:text-gray-400","border-t","border-gray-200","dark:border-gray-700/80","rounded-b-lg"],[1,"bg-gray-50","dark:bg-gray-700/30","p-3","border-t","border-gray-200","dark:border-gray-700/80","space-y-3","max-h-48","overflow-y-auto","custom-scrollbar","rounded-b-lg"],[1,"text-sm","text-primary","dark:text-primary-light"],[1,"p-3","bg-blue-50","dark:bg-blue-900/30","border","border-blue-200","dark:border-blue-700","rounded-lg","text-xs"],[1,"font-medium","text-blue-700","dark:text-blue-300","mb-1"],[1,"flex","items-center","gap-1.5"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-4","w-4"],["stroke-linecap","round","stroke-linejoin","round","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"list-none","space-y-0.5","ml-1","text-blue-600","dark:text-blue-400"],["class","flex items-center",4,"ngIf"],["class","mt-1 italic border-t border-blue-200 dark:border-blue-600 pt-1",4,"ngIf"],[1,"flex","items-center"],[1,"w-16"],[1,"dark:text-blue-200"],[1,"mt-1","italic","border-t","border-blue-200","dark:border-blue-600","pt-1"],[1,"p-3","bg-gray-50","dark:bg-gray-700/50","border","border-gray-200","dark:border-gray-600","rounded-lg","text-xs","text-center","text-gray-500","dark:text-gray-400","italic"],[1,"p-3","bg-yellow-50","dark:bg-yellow-900/30","border","border-yellow-200","dark:border-yellow-700","rounded-lg","text-xs"],[1,"font-medium","text-yellow-700","dark:text-yellow-300","mb-2"],["stroke-linecap","round","stroke-linejoin","round","d","M5 3v4M3 5h4M6 17v4m-2-2h4m5-12v4m-2-2h4m5 10v4m-2-2h4M5 3a2 2 0 00-2 2v1c0 1.1.9 2 2 2h4a2 2 0 002-2V6a2 2 0 00-2-2H5zm14 0a2 2 0 00-2 2v1c0 1.1.9 2 2 2h4a2 2 0 002-2V6a2 2 0 00-2-2h-4zM5 17a2 2 0 00-2 2v1c0 1.1.9 2 2 2h4a2 2 0 002-2v-1a2 2 0 00-2-2H5zm14 0a2 2 0 00-2 2v1c0 1.1.9 2 2 2h4a2 2 0 002-2v-1a2 2 0 00-2-2h-4z"],["class","grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-1 text-yellow-600 dark:text-yellow-400",4,"ngIf"],["class","italic text-yellow-600 dark:text-yellow-400",4,"ngIf"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-x-4","gap-y-1","text-yellow-600","dark:text-yellow-400"],[4,"ngFor","ngForOf"],[1,"dark:text-yellow-200"],[1,"text-yellow-500","dark:text-yellow-500","text-2xs","ml-1"],[1,"italic","text-yellow-600","dark:text-yellow-400"],[1,"p-3","bg-gray-50","dark:bg-gray-700/80","rounded-lg","shadow"],[1,"block","text-xs","font-medium","text-gray-500","dark:text-gray-400","mb-1"],["class","text-3xl font-bold text-primary dark:text-primary-light cursor-pointer hover:opacity-80 p-1.5 rounded-md min-h-[48px] flex items-center",3,"click",4,"ngIf"],["class","flex items-center space-x-2",4,"ngIf"],[1,"text-3xl","font-bold","text-primary","dark:text-primary-light","cursor-pointer","hover:opacity-80","p-1.5","rounded-md","min-h-[48px]","flex","items-center",3,"click"],[1,"flex","items-center","space-x-2"],["type","number","autofocus","",1,"w-24","p-2","text-2xl","border-gray-300","dark:border-gray-600","rounded-md","focus:ring-primary-focus","focus:border-primary-focus","dark:bg-gray-600","dark:text-gray-100","shadow-sm",3,"ngModelChange","keyup.enter","keyup.escape","ngModel"],[1,"p-2","text-green-600","hover:text-green-500","dark:text-green-400","dark:hover:text-green-300","rounded-full","hover:bg-green-100","dark:hover:bg-green-700/50",3,"click"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5"],["fill-rule","evenodd","d","M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule","evenodd"],[1,"p-2","text-red-600","hover:text-red-500","dark:text-red-400","dark:hover:text-red-300","rounded-full","hover:bg-red-100","dark:hover:bg-red-700/50",3,"click"],["fill-rule","evenodd","d","M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule","evenodd"],[1,"text-xl","ml-0.5"],[1,"text-xl","font-semibold","text-gray-700","dark:text-gray-100","p-1.5","block","min-h-[48px]","flex","items-center"],[1,"mt-4","p-3","bg-gray-100","dark:bg-gray-700/60","rounded-lg","text-xs"],[1,"font-medium","text-gray-600","dark:text-gray-300","mb-1"],["stroke-linecap","round","stroke-linejoin","round","d","M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"],[1,"text-gray-700","dark:text-gray-200","italic"],[1,"fixed","inset-0","bg-gray-700","bg-opacity-75","transition-opacity","overflow-y-auto","h-full","w-full","z-[70]","flex","items-center","justify-center","p-4",3,"click"],[1,"relative","transform","overflow-hidden","rounded-lg","bg-white","dark:bg-gray-700","text-left","shadow-xl","transition-all","sm:my-8","sm:w-full","sm:max-w-lg",3,"click"],[1,"bg-white","dark:bg-gray-700","px-4","pt-5","pb-4","sm:p-6","sm:pb-4"],[1,"flex","justify-between","items-center","pb-3"],[1,"text-xl","font-semibold","text-gray-900","dark:text-gray-100"],["type","button",1,"p-1","rounded-full","text-gray-400","hover:text-gray-600","dark:hover:text-gray-300","focus:outline-none",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","d","M6 18 18 6M6 6l12 12"],[1,"my-4"],["type","text","placeholder","Search exercises...",1,"w-full","p-2","border","border-gray-300","dark:border-gray-600","rounded-md","dark:bg-gray-700","dark:text-gray-200",3,"ngModelChange","ngModel"],[1,"mt-2","max-h-60","sm:max-h-80","overflow-y-auto","pr-2"],[1,"space-y-1"],["class","p-3 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md cursor-pointer transition-all duration-150 ease-in-out flex justify-between items-center",3,"click",4,"ngFor","ngForOf"],["class","text-gray-500 dark:text-gray-400 text-center p-4",4,"ngIf"],[1,"mt-4","pt-4","border-t","border-gray-200","dark:border-gray-600","text-center"],["type","button",1,"text-sm","text-primary","dark:text-primary-light","hover:underline",3,"click"],[1,"bg-gray-50","dark:bg-gray-800","px-4","py-3","sm:flex","sm:flex-row-reverse","sm:px-6"],["type","button",1,"mt-3","inline-flex","w-full","justify-center","rounded-md","bg-white","dark:bg-gray-600","px-3","py-2","text-sm","font-semibold","text-gray-900","dark:text-gray-200","shadow-sm","ring-1","ring-inset","ring-gray-300","dark:ring-gray-500","hover:bg-gray-50","dark:hover:bg-gray-500","sm:mt-0","sm:w-auto",3,"click"],[1,"p-3","hover:bg-gray-100","dark:hover:bg-gray-800","rounded-md","cursor-pointer","transition-all","duration-150","ease-in-out","flex","justify-between","items-center",3,"click"],[1,"font-medium","text-gray-800","dark:text-gray-200"],[1,"block","text-xs","text-gray-500","dark:text-gray-400"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"w-5","h-5","text-primary","dark:text-primary-light"],["fill-rule","evenodd","d","M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5V4.75Z","clip-rule","evenodd"],[1,"text-gray-500","dark:text-gray-400","text-center","p-4"],[1,"text-center","py-20"],[1,"text-xl","text-gray-600","dark:text-gray-400"],[3,"isOpenChange","isOpen","modalTitle"],[3,"id","isModal"]],template:function(e,i){if(e&1){let r=I();_(0,Rn,5,3,"div",4),s(1,"app-full-screen-rest-timer",5),h("timerFinished",function(){return x(r),f(i.handleRestTimerFinished())})("timerSkipped",function(){return x(r),f(i.handleRestTimerSkipped())}),a(),_(2,Vn,39,10,"div",6)(3,_o,15,1,"div",7)(4,bo,22,4,"div",8)(5,ko,3,0,"ng-template",null,0,ne)(7,wo,2,4,"app-modal",9)}if(e&2){let r=re(6);p("ngIf",i.routine()!==void 0)("ngIfElse",r),l(),p("isVisible",i.playerSubState()===i.PlayerSubState.Resting&&i.isRestTimerVisible())("durationSeconds",i.restDuration())("mainText",i.restTimerMainText())("nextUpText",i.restTimerNextUpText()),l(),p("ngIf",i.isWorkoutMenuVisible()),l(),p("ngIf",i.isPerformanceInsightsVisible()),l(),p("ngIf",i.isExerciseModalOpen()),l(3),p("ngIf",i.exerciseDetailsId)}},dependencies:[ee,He,de,X,ce,be,ke,Ee,it,Ye,ze,Qe,qe,Je,Ze,Xe,tt,Ke,ot,lt,dt,ct,Zt],styles:["@keyframes _ngcontent-%COMP%_modal-appear-animation{0%{opacity:0;transform:scale(.95) translateY(10px)}to{opacity:1;transform:scale(1) translateY(0)}}.animate-modal-appear[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_modal-appear-animation .3s ease-out forwards}.custom-scrollbar[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px;height:6px}.custom-scrollbar[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent;border-radius:3px}.custom-scrollbar[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#0003;border-radius:3px}.dark[_ngcontent-%COMP%]   .custom-scrollbar[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#fff3}.custom-scrollbar[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background-color:#0000004d}.dark[_ngcontent-%COMP%]   .custom-scrollbar[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background-color:#ffffff4d}"]})};function Eo(n,t){if(n&1&&(s(0,"div",17)(1,"span",18),m(2,"Total Volume:"),a(),s(3,"span",19),m(4),O(5,"number"),a()()),n&2){let e=u(2);l(4),G("",Z(5,2,e.sessionTotalVolume(),"1.0-0")," ",e.unitsService.getUnitLabel())}}function Io(n,t){if(n&1&&(s(0,"li",29)(1,"p",30),m(2),a(),s(3,"p",31),m(4),a()()),n&2){let e=t.$implicit;l(2),G("",e.exerciseName," - ",e.pbType," "),l(2),V(e.value)}}function Co(n,t){if(n&1&&(s(0,"div",25)(1,"h2",26),m(2," \u{1F389} New Personal Bests! \u{1F389} "),a(),s(3,"ul",27),_(4,Io,5,3,"li",28),a()()),n&2){let e=u(2);l(4),p("ngForOf",e.sessionPBs())}}function To(n,t){if(n&1&&(s(0,"div",32)(1,"h3",33),m(2,"Your Notes for this Session:"),a(),s(3,"p",34),m(4),a()()),n&2){let e=u().ngIf;l(4),V(e.notes)}}function Po(n,t){if(n&1){let e=I();te(0),s(1,"div",3)(2,"button",4),E(),s(3,"svg",5),b(4,"path",6),a()(),D(),s(5,"div",7)(6,"div",8),E(),s(7,"svg",9)(8,"defs")(9,"mask",10),b(10,"rect",11)(11,"path",12),a()(),b(12,"circle",13),a()(),D(),s(13,"h1",14),m(14,"Workout Complete!"),a(),s(15,"p",15),m(16,"Great job on finishing your session."),a()(),s(17,"div",16)(18,"div",17)(19,"span",18),m(20,"Routine:"),a(),s(21,"span",19),m(22),a()(),s(23,"div",17)(24,"span",18),m(25,"Date:"),a(),s(26,"span",19),m(27),O(28,"date"),a()(),s(29,"div",17)(30,"span",18),m(31,"Duration:"),a(),s(32,"span",19),m(33),a()(),_(34,Eo,6,5,"div",20),a(),_(35,Co,5,1,"div",21)(36,To,5,1,"div",22),s(37,"div",23)(38,"button",24),h("click",function(){x(e);let r=u();return f(r.viewFullLog())}),m(39," View Full Log Details "),a()()(),ie()}if(n&2){let e=t.ngIf,i=u();l(22),V(e.routineName||"Ad-hoc Workout"),l(5),V(Z(28,6,e.startTime,"fullDate")),l(6),C("",e.durationMinutes," minutes"),l(),p("ngIf",i.sessionTotalVolume()>0),l(),p("ngIf",i.sessionPBs().length>0),l(),p("ngIf",e.notes)}}function Ro(n,t){n&1&&(s(0,"div",35)(1,"p",36),m(2,"Loading workout summary..."),a()())}var mt=class n{route=R(we);router=R(ue);trackingService=R(me);exerciseService=R(pe);statsService=R(Xt);unitsService=R(Re);workoutLog=T(void 0);displayExercisesSummary=T([]);sessionPBs=T([]);sessionTotalVolume=T(0);logId;ngOnInit(){(this.logId?ge(this.logId):this.route.paramMap.pipe(Ve(e=>e.get("logId")))).pipe(Se(e=>e?this.trackingService.getWorkoutLogById(e):ge(null)),xe(e=>{e?(this.workoutLog.set(e),this.sessionTotalVolume.set(this.statsService.calculateWorkoutVolume(e)),this.prepareDisplayExercisesSummary(e.exercises),this.identifySessionPBs(e)):(this.workoutLog.set(null),this.displayExercisesSummary.set([]),this.sessionPBs.set([]))})).subscribe()}prepareDisplayExercisesSummary(t){if(!t||t.length===0){this.displayExercisesSummary.set([]);return}let e=t.map(i=>this.exerciseService.getExerciseById(i.exerciseId).pipe(Ve(r=>{let o=0;return i.sets.forEach(d=>{o+=(d.repsAchieved||0)*(d.weightUsed||0)}),H(U({},i),{baseExercise:r||null,sessionVolume:o})})));St(e).subscribe({next:i=>this.displayExercisesSummary.set(i),error:i=>{console.error("Error fetching exercise details for summary:",i),this.displayExercisesSummary.set(t.map(r=>H(U({},r),{baseExercise:null,sessionVolume:0})))}})}identifySessionPBs(t){let e=[];this.trackingService.personalBests$.pipe(z(1)).subscribe(i=>{t.exercises.forEach(o=>{let d=i[o.exerciseId];d&&o.sets.forEach(c=>{d.forEach(g=>{g.id===c.id&&g.timestamp===c.timestamp&&c.weightUsed===g.weightUsed&&c.repsAchieved===g.repsAchieved&&e.push({exerciseName:o.exerciseName,pbType:g.pbType,value:this.formatPbValueForSummary(g),isNewOrImproved:!0})})})});let r=Array.from(new Map(e.map(o=>[`${o.exerciseName}-${o.pbType}`,o])).values());this.sessionPBs.set(r)})}formatPbValueForSummary(t){let e="";return t.weightUsed!==void 0&&t.weightUsed!==null&&t.weightUsed!==0?(e+=`${t.weightUsed}kg`,t.repsAchieved>0&&(t.pbType.includes("Heaviest")||t.repsAchieved>1&&!t.pbType.includes("RM"))&&(e+=` x ${t.repsAchieved}`)):t.repsAchieved>0&&t.pbType.includes("Max Reps")?e=`${t.repsAchieved} reps`:t.durationPerformed&&t.durationPerformed>0&&t.pbType.includes("Max Duration")&&(e=`${t.durationPerformed}s`),e||"N/A"}viewFullLog(){this.workoutLog()&&this.router.navigate(["/history/log",this.workoutLog().id])}navigateToRoutines(){this.router.navigate(["/workout"])}startNewWorkout(){this.router.navigate(["/workout"])}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=Y({type:n,selectors:[["app-workout-summary"]],inputs:{logId:"logId"},decls:4,vars:2,consts:[["loadingOrNotFoundSummary",""],[1,"container","mx-auto","p-1"],[4,"ngIf","ngIfElse"],[1,"bg-white","dark:bg-gray-700","rounded-xl","shadow-2xl","p-6","md:p-8","max-w-2xl","mx-auto"],["routerLink","/history/list",1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-ml-1"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"text-center","mb-8"],[1,"flex","justify-center","text-center"],["width","36","height","36","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg",1,"w-16","h-16","text-green-500","mx-auto","mb-3"],["id","tickCutoutMask"],["x","0","y","0","width","24","height","24","fill","white"],["d","M7.5 12.5L10.5 15.5L16.5 9.5","stroke","black","stroke-width","2.5","stroke-linecap","round","stroke-linejoin","round","fill","none"],["cx","12","cy","12","r","10","fill","#2fd636","mask","url(#tickCutoutMask)"],[1,"text-4xl","font-bold","text-gray-800","dark:text-gray-100"],[1,"text-lg","text-gray-600","dark:text-gray-400","mt-1"],[1,"space-y-4","mb-8"],[1,"flex","justify-between","items-baseline","p-3","bg-gray-50","dark:bg-gray-700","rounded-md"],[1,"text-m","font-medium","text-gray-600","dark:text-gray-300"],[1,"text-md","font-semibold","text-gray-800","dark:text-gray-100"],["class","flex justify-between items-baseline p-3 bg-gray-50 dark:bg-gray-700 rounded-md",4,"ngIf"],["class","mb-8",4,"ngIf"],["class","mb-8 p-3 bg-yellow-50 dark:bg-yellow-900/30 rounded-md",4,"ngIf"],[1,"mt-8","pt-6","border-t","border-gray-200","dark:border-gray-700","space-y-3","md:space-y-0","md:flex","md:justify-center","md:space-x-4"],[1,"w-full","md:w-auto","flex","items-center","justify-center","px-6","py-3","border","border-transparent","rounded-md","shadow-sm","text-base","font-medium","text-white","bg-primary","hover:bg-primary-dark","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-primary-dark",3,"click"],[1,"mb-8"],[1,"text-xl","font-semibold","text-gray-700","dark:text-gray-300","mb-3","text-center","border-b","pb-2","dark:border-gray-700"],[1,"space-y-2","mt-3"],["class","p-2 bg-green-50 dark:bg-green-900/30 rounded-md text-center",4,"ngFor","ngForOf"],[1,"p-2","bg-green-50","dark:bg-green-900/30","rounded-md","text-center"],[1,"text-m","font-medium","text-green-700","dark:text-green-300"],[1,"text-lg","font-bold","text-green-600","dark:text-green-200"],[1,"mb-8","p-3","bg-yellow-50","dark:bg-yellow-900/30","rounded-md"],[1,"text-m","font-medium","text-yellow-800","dark:text-yellow-300","mb-1"],[1,"text-m","text-yellow-700","dark:text-yellow-200","italic","whitespace-pre-line"],[1,"text-center","py-20"],[1,"text-xl","text-gray-600","dark:text-gray-400"]],template:function(e,i){if(e&1&&(s(0,"div",1),_(1,Po,40,9,"ng-container",2)(2,Ro,3,0,"ng-template",null,0,ne),a()),e&2){let r=re(3);l(),p("ngIf",i.workoutLog())("ngIfElse",r)}},dependencies:[ee,de,X,ce,ke,Ee],encapsulation:2})};var nl=[{path:"",component:st,title:"My Routines"},{path:"routine/new",component:ae,data:{mode:"routineBuilder",isNew:!0},title:"Create New Routine"},{path:"routine/edit/:routineId",component:ae,data:{mode:"routineBuilder",isNew:!1},title:"Edit Routine"},{path:"routine/view/:routineId",component:ae,data:{mode:"routineBuilder",isNew:!1,isView:!0},title:"View Routine"},{path:"log/manual/new",component:ae,data:{mode:"manualLogEntry",isNew:!0},title:"Log Past Workout"},{path:"log/manual/new/from/:routineId",component:ae,data:{mode:"manualLogEntry",isNew:!0,prefillFromRoutine:!0},title:"Log Workout from Routine"},{path:"log/manual/edit/:logId",component:ae,data:{mode:"manualLogEntry",isNew:!1},title:"Edit Workout Log"},{path:"play/:routineId",component:ut,title:"Workout Session"},{path:"summary/:logId",component:mt,title:"Workout Summary"}];export{nl as WORKOUT_TRACKER_ROUTES};
