<!-- src/app/features/personal-gym/personal-gym-list/personal-gym-list.component.html -->
<div class="container mx-auto p-2 sm:p-4">
  <header class="flex justify-between items-center pb-4 border-b dark:border-gray-700 mb-4">
    <h1 class="text-2xl font-bold text-gray-800 dark:text-gray-200">My Personal Gym</h1>
    <button (click)="navigateToForm()" 
      class="flex items-center bg-primary hover:bg-primary-dark text-white font-semibold py-2 px-4 rounded-md shadow-sm">
      <app-icon name="plus-circle" class="w-6 h-6 mr-1"></app-icon>
      Add Equipment
    </button>
  </header>

  <!-- Filters Section -->
  <section class="mb-6 p-4 bg-white dark:bg-gray-700 rounded-md shadow">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <input type="text" id="search-term" placeholder="Search by name or brand..." [value]="searchTerm()" (input)="onSearchChange($event)"
        class="block w-full p-2 border rounded-md dark:bg-gray-600 dark:border-gray-500 dark:text-gray-200">
      
      <select id="category-filter" (change)="onCategoryChange($event)" [value]="selectedCategory() || ''"
        class="block w-full p-2 border rounded-md dark:bg-gray-600 dark:border-gray-500 dark:text-gray-200">
        <option value="">All Categories</option>
        <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
      </select>

      <button (click)="clearFilters()" 
        class="px-4 py-2 bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500 inline-flex items-center justify-center">
        <app-icon name="trash" class="h-6 w-6 mr-1"></app-icon>
        Clear Filters
      </button>
    </div>
  </section>

  <!-- Equipment List -->
  <div *ngIf="allEquipment().length > 0; else noEquipmentState">
    <div *ngIf="filteredEquipment().length > 0; else noFilterResultsState"
      class="grid grid-cols-2 md:grid-cols-2 lg:grid-cols-3 gap-4">
      
      <div *ngFor="let item of filteredEquipment(); trackBy: trackById" (click)="navigateToForm(item.id)"
        class="bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-xl transition-shadow cursor-pointer p-4 flex flex-col justify-between">
        <div>
          <h2 class="text-lg font-bold text-primary dark:text-primary-light">{{ item.name }}</h2>
          <p class="text-sm text-gray-500 dark:text-gray-400">
            {{ isCustom(item) ? item.customCategoryName : item.category }}
          </p>
          <div class="text-sm text-gray-600 dark:text-gray-300 mt-2">
            <p><strong>Quantity:</strong> {{ item.quantity }}</p>
            
            <!-- Using the type guard functions in the template -->
            <div *ngIf="isFixedWeight(item)">
              <p><strong>Weight:</strong> {{ item.weight }} kg</p>
            </div>
            
            <div *ngIf="isAdjustableWeight(item)">
              <p><strong>Range:</strong> {{ item.minweight }} - {{ item.maxweight }} kg</p>
            </div>

            <div *ngIf="isWeightPlate(item)">
              <p><strong>Weight:</strong> {{ item.weight }} kg</p>
            </div>

            <div *ngIf="isBand(item)">
              <p><strong>Type:</strong> {{ item.bandType }}</p>
            </div>
            
            <div *ngIf="isCustom(item)">
              <div *ngFor="let prop of item.properties">
                <p><strong>{{ prop.key }}:</strong> {{ prop.value }}</p>
              </div>
            </div>

          </div>
        </div>
        <div class="flex justify-end mt-4">
          <button (click)="deleteEquipment(item.id, $event)" 
            class="p-2 text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 rounded-full hover:bg-red-100 dark:hover:bg-red-900/50">
            <app-icon name="trash" class="w-5 h-5"></app-icon>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Template for when no equipment exists at all -->
  <ng-template #noEquipmentState>
    <div class="text-center py-12 px-6 bg-white dark:bg-gray-700 rounded-md shadow-md justify-center">
      <h3 class="text-xl font-semibold text-gray-700 dark:text-gray-300">Your Gym is Empty!</h3>
      <p class="text-gray-500 dark:text-gray-400 mt-2 mb-6">Start by adding the first piece of your equipment.</p>
      <button (click)="navigateToForm()" 
        class="bg-primary hover:bg-primary-dark text-white font-semibold py-2 px-6 rounded-md inline-flex items-center">
        <app-icon name="plus-circle" class="w-6 h-6 mr-1"></app-icon>
        Add First Item
      </button>
    </div>
  </ng-template>

  <!-- Template for when filters yield no results -->
  <ng-template #noFilterResultsState>
    <div class="text-center py-12 px-6 bg-white dark:bg-gray-700 rounded-md shadow-md">
      <h3 class="text-xl font-semibold text-gray-700 dark:text-gray-300">No Matches Found</h3>
      <p class="text-gray-500 dark:text-gray-400 mt-2">Try adjusting your filters to find your equipment.</p>
    </div>
  </ng-template>
</div>