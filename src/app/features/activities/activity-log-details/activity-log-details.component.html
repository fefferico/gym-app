<div class="container mx-auto max-w-2xl p-2 sm:p-4" *ngIf="activityLog() as log; else loading">
  <!-- Header row for Back button and Action Buttons -->
  <header class="flex items-center justify-between p-2 mb-4">
    <button (click)="goBack()"
      class="text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-primary-light p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
      <app-icon name="back" class="w-6 h-6"></app-icon>
    </button>

    <!-- Action Buttons Group -->
    <div class="flex items-center space-x-2 flex-shrink-0">
      <div class="relative">
        <button (click)="toggleActions(log.id, $event)"
          class="p-1.5 text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full focus:outline-none">
          <app-icon name="menu_action" class="h-5 w-5"></app-icon>
        </button>
        <app-action-menu *ngIf="areActionsVisible(log.id)"
          displayMode="dropdown"
          [items]="getLogDropdownActionItems(log)"
          [isVisible]="areActionsVisible(log.id)"
          (itemClick)="handleActionMenuItemClick($event)"
          (closeMenu)="onCloseActionMenu()">
        </app-action-menu>
      </div>
    </div>
  </header>

  <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md space-y-4">
    <div class="border-b border-gray-200 dark:border-gray-700 pb-4">
      <h1 class="text-3xl font-bold text-gray-800 dark:text-gray-200">{{ log.activityName }}</h1>
      <p class="text-gray-500 dark:text-gray-400 mt-1">{{ log.startTime | date:'fullDate' }}</p>
    </div>

    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 text-center pt-4">
      <!-- Duration -->
      <div class="p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
        <app-icon name="clock" class="w-8 h-8 mx-auto text-primary mb-2"></app-icon>
        <div class="text-sm text-gray-500 dark:text-gray-400">Duration</div>
        <div class="text-2xl font-semibold">{{ log.durationMinutes }} min</div>
      </div>
      <!-- Intensity -->
      <div class="p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
        <app-icon name="flame" class="w-8 h-8 mx-auto text-primary mb-2"></app-icon>
        <div class="text-sm text-gray-500 dark:text-gray-400">Intensity</div>
        <div class="text-2xl font-semibold">{{ log.intensity }}</div>
      </div>
      <!-- Distance -->
      <div *ngIf="log.distanceKm" class="p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
        <app-icon name="ruler" class="w-8 h-8 mx-auto text-primary mb-2"></app-icon>
        <div class="text-sm text-gray-500 dark:text-gray-400">Distance</div>
        <div class="text-2xl font-semibold">{{ log.distanceKm }} km</div>
      </div>
      <!-- Calories -->
      <div *ngIf="log.caloriesBurned" class="p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
        <app-icon name="calories" class="w-8 h-8 mx-auto text-primary mb-2"></app-icon>
        <div class="text-sm text-gray-500 dark:text-gray-400">Calories</div>
        <div class="text-2xl font-semibold">{{ log.caloriesBurned }} kcal</div>
      </div>
    </div>
    <!-- Notes -->
    <div *ngIf="log.notes" class="pt-4 border-t border-gray-200 dark:border-gray-700">
      <h3 class="text-lg font-semibold mb-2">Notes</h3>
      <p class="text-gray-700 dark:text-gray-300 whitespace-pre-wrap">{{ log.notes }}</p>
    </div>
  </div>
</div>

<ng-template #loading>
  <div class="text-center p-20">
      <p class="text-xl text-gray-600 dark:text-gray-400">Loading activity details...</p>
  </div>
</ng-template>