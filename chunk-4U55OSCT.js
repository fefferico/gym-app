import{a as M,b as j}from"./chunk-2FTV5APT.js";import{a as oe}from"./chunk-32U2KVAC.js";import{c as re,f,h as ie}from"./chunk-B6VPQKOY.js";import{a as te}from"./chunk-65W2CKOM.js";import{h as d,j as ne,n as y}from"./chunk-IGQ7KJPK.js";import{Bb as q,Cb as J,Db as Q,Ha as h,Ia as u,J as F,Ja as x,Ka as z,Lb as X,N as k,Ra as T,S as _,Sa as b,T as W,Ta as w,U as B,Ua as R,Ub as Z,Va as O,Wb as ee,aa as K,cb as $,eb as Y,ha as L,ia as v,mc as I,nc as P,qa as N,qc as S,rc as D,sc as A,ta as C,va as V,z as U}from"./chunk-AOY7JKU5.js";import{g as H}from"./chunk-GAL4ENT6.js";var ae=class a{decimalPipe=k(Z);unitsService=k(te);transform(t,e="1.0-2"){if(t==null)return null;let n=this.unitsService.convertWeight(t,"kg",this.unitsService.currentWeightUnit()),o=this.decimalPipe.transform(n,e),r=this.unitsService.getWeightUnitSuffix();return`${o} ${r}`}static \u0275fac=function(e){return new(e||a)};static \u0275pipe=C({name:"weightUnit",type:a,pure:!0})};var se=class a{transform(t){return t?.sets?.length?t.sets.some(n=>typeof n.weightUsed=="number"&&n.weightUsed>0||typeof n.weight=="number"&&n.weight>0||typeof n.targetWeight=="number"&&n.targetWeight>0):!1}static \u0275fac=function(e){return new(e||a)};static \u0275pipe=C({name:"isWeighted",type:a,pure:!0})};var pe=["*",[["","modal-footer",""]]],fe=["*","[modal-footer]"];function ge(a,t){if(a&1&&(u(0,"h3",11),$(1),x()),a&2){let e=w(3);v(),Y(" ",e.modalTitle()," ")}}function ke(a,t){if(a&1){let e=T();u(0,"div",6),V(1,ge,2,1,"h3",7),u(2,"button",8),b("click",function(){_(e);let o=w(2);return W(o.closeModal())}),B(),u(3,"svg",9),z(4,"path",10),x()()()}if(a&2){let e=w(2);v(),h("ngIf",e.modalTitle())}}function we(a,t){if(a&1){let e=T();u(0,"div",1),b("click",function(){_(e);let o=w();return W(o.closeModal())}),u(1,"div",2),b("click",function(o){_(e);let r=w();return W(r.onDialogClick(o))}),V(2,ke,5,1,"div",3),u(3,"div",4),O(4),x(),u(5,"div",5),O(6,1),x()()()}if(a&2){let e=w();h("@modalAnimation",e.animationState),v(),h("@dialogAnimation",e.animationState),v(),h("ngIf",e.modalTitle()||!0)}}var le=class a{elementRef=k(K);isOpen=Q(!1);modalTitle=J();closed=q();get animationState(){return this.isOpen()?"open":"closed"}closeModal(){this.isOpen.set(!1),this.closed.emit()}onDialogClick(t){t.stopPropagation()}onDocumentMouseDown(t){this.isOpen()&&this.elementRef.nativeElement.contains(t.target)&&t.target.classList.contains("modal-container")&&this.closeModal()}onEscapeKey(){this.isOpen()&&this.closeModal()}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=N({type:a,selectors:[["app-modal"]],hostBindings:function(e,n){e&1&&b("mousedown",function(r){return n.onDocumentMouseDown(r)},L)("keydown.escape",function(){return n.onEscapeKey()},L)},inputs:{isOpen:[1,"isOpen"],modalTitle:[1,"modalTitle"]},outputs:{isOpen:"isOpenChange",closed:"closed"},ngContentSelectors:fe,decls:1,vars:1,consts:[["class","modal-container fixed inset-0 z-[1000] flex items-center justify-center bg-black bg-opacity-60",3,"click",4,"ngIf"],[1,"modal-container","fixed","inset-0","z-[1000]","flex","items-center","justify-center","bg-black","bg-opacity-60",3,"click"],[1,"modal-dialog","mx-2","bg-white","dark:bg-gray-800","rounded-md","shadow-xl","min-w-[300px]","w-full","max-w-lg","md:max-w-xl","lg:max-w-2xl","max-h-[90vh]","flex","flex-col","overflow-hidden",3,"click"],["class","modal-header flex items-center justify-between ml-1 p-1 md:p-1 border-gray-200 dark:border-gray-700",4,"ngIf"],[1,"modal-body","p-1","md:p-1","space-y-4","overflow-y-auto","flex-grow","custom-scrollbar"],[1,"modal-footer","flex","items-center","p-4","md:p-5","border-t","border-gray-200","dark:border-gray-700","rounded-b"],[1,"modal-header","flex","items-center","justify-between","ml-1","p-1","md:p-1","border-gray-200","dark:border-gray-700"],["class","text-xl font-semibold text-gray-900 dark:text-white",4,"ngIf"],["type","button","aria-label","Close modal",1,"modal-close-button","text-gray-400","bg-transparent","hover:bg-gray-200","hover:text-gray-900","dark:hover:bg-gray-600","dark:hover:text-white","rounded-md","text-sm","w-8","h-8","ms-auto","inline-flex","justify-center","items-center",3,"click"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 14 14",1,"w-3","h-3"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"],[1,"text-xl","font-semibold","text-gray-900","dark:text-white"]],template:function(e,n){e&1&&(R(pe),V(0,we,7,3,"div",0)),e&2&&h("ngIf",n.isOpen())},dependencies:[ee,X],styles:[".modal-footer[_ngcontent-%COMP%]:empty{display:none}"],data:{animation:[I("modalAnimation",[D("closed",S({opacity:0,visibility:"hidden"})),D("open",S({opacity:1,visibility:"visible"})),A("closed <=> open",[P("300ms ease-in-out")])]),I("dialogAnimation",[D("closed",S({opacity:0,transform:"scale(0.95) translateY(20px)",visibility:"hidden"})),D("open",S({opacity:1,transform:"scale(1) translateY(0)",visibility:"visible"})),A("closed <=> open",[P("300ms ease-in-out")])])]}})};function ce(a){return t=>{let n=(a?Math[a]:Math.trunc)(t);return n===0?0:n}}function me(a,t,e){let n=re(a,t,e)/7;return ce(e?.roundingMethod)(n)}function E(a,t,e){let[n,o]=ne(e?.in,a,t);return+d(n,e)==+d(o,e)}var ue=class a{exerciseService=k(ie);constructor(){}calculateSetVolume(t){return(t.repsAchieved||0)*(t.weightUsed||0)}calculateWorkoutVolume(t){let e=0;return t.exercises.forEach(n=>{n.sets.forEach(o=>{e+=this.calculateSetVolume(o)})}),e}calculateTotalVolumeForAllLogs(t){return t.reduce((e,n)=>e+this.calculateWorkoutVolume(n),0)}getWeeklySummaries(t){if(!t||t.length===0)return[];let e={};return t.forEach(n=>{let o=f(n.date),r=d(o,{weekStartsOn:1}),i=M(o,{weekStartsOn:1}),l=y(r,"yyyy-MM-dd");e[l]||(e[l]={logs:[],startDate:r,endDate:i}),e[l].logs.push(n)}),Object.entries(e).map(([n,o])=>{let r=this.calculateTotalVolumeForAllLogs(o.logs);return{weekLabel:`Week of ${y(o.startDate,"MMM d")}`,workoutCount:o.logs.length,totalVolume:r,weekStartDate:o.startDate,weekEndDate:o.endDate}}).sort((n,o)=>o.weekStartDate.getTime()-n.weekStartDate.getTime())}calculateTotalVolume(t){return t.exercises.reduce((e,n)=>{let o=n.sets.reduce((r,i)=>r+(i.weightUsed??0)*(i.repsAchieved??0),0);return e+o},0)}getWeeklyVolumeForChart(t){if(!t||t.length===0)return[];let e={};return t.forEach(o=>{let r=f(o.date),i=d(r,{weekStartsOn:1}),l=y(i,"yyyy-MM-dd");e[l]||(e[l]={totalVolume:0,weekLabel:`W${y(i,"w")} '${y(i,"yy")}`}),e[l].totalVolume+=this.calculateTotalVolume(o)}),Object.keys(e).sort((o,r)=>new Date(o).getTime()-new Date(r).getTime()).map(o=>({date:f(o),weekLabel:e[o].weekLabel,totalVolume:e[o].totalVolume}))}getPerformanceByMuscleGroup(t){return H(this,null,function*(){if(!t||t.length===0)return[];let e=new Map,n=yield new Promise(r=>{this.exerciseService.getExercises().pipe(U(1)).subscribe(i=>r(i))}),o=new Map(n.map(r=>[r.id,r]));return t.forEach(r=>{let i=new Set;r.exercises.forEach(l=>{let m=o.get(l.exerciseId);if(m&&m.muscleGroups){let p=l.sets.reduce((s,c)=>s+this.calculateSetVolume(c),0);m.muscleGroups.forEach(s=>{let c=s.toLowerCase().trim();e.has(c)||e.set(c,{volume:0,workoutCountSet:new Set});let g=e.get(c);g.volume+=p,i.add(c)})}}),i.forEach(l=>{e.get(l)?.workoutCountSet.add(r.id)})}),Array.from(e.entries()).map(([r,i])=>({muscleGroup:r,volume:Math.round(i.volume),workoutCount:i.workoutCountSet.size})).sort((r,i)=>i.volume-r.volume)})}calculateCurrentWorkoutStreak(t,e){let n=[...t.map(c=>f(c.date)),...e.map(c=>f(c.date))];if(n.length===0)return{length:0};n.sort((c,g)=>g.getTime()-c.getTime());let o=new Date,r=d(o,{weekStartsOn:1}),i=0,l,m=n[0],p=j(o,7);if(!E(m,o,{weekStartsOn:1})&&!E(m,p,{weekStartsOn:1}))return{length:0};for(let c=0;c<260&&n.some(de=>E(de,r,{weekStartsOn:1}));c++)l||(l=M(r,{weekStartsOn:1})),i++,r=j(r,7);if(i===0)return{length:0};let s=d(oe(r,7),{weekStartsOn:1});return{length:i,startDate:s,endDate:l}}calculateLongestWorkoutStreak(t,e){let n=[...t.map(s=>f(s.date)),...e.map(s=>f(s.date))];if(n.length<2)return this.calculateCurrentWorkoutStreak(t,e);let o=Array.from(new Set(n.map(s=>y(d(s,{weekStartsOn:1}),"yyyy-MM-dd")))).map(s=>new Date(s)).sort((s,c)=>s.getTime()-c.getTime());if(o.length===0)return{length:0};let r=0,i=0,l,m,p;for(let s=0;s<o.length;s++)if(s===0)i=1,p=o[s];else{let c=o[s-1],g=o[s];me(g,c)===1?i++:(i>r&&(r=i,l=p,m=M(c,{weekStartsOn:1})),i=1,p=g)}return i>r&&(r=i,l=p,m=M(o[o.length-1],{weekStartsOn:1})),{length:r,startDate:l,endDate:m}}static \u0275fac=function(e){return new(e||a)};static \u0275prov=F({token:a,factory:a.\u0275fac,providedIn:"root"})};export{ae as a,se as b,le as c,ue as d};
