import{C as O,F as K,I as G,J as H,b as _,ba as q,d as I,da as A,f as P,h as U,j,la as J,o as w,t as R,w as x,z as k}from"./chunk-DKF37G4Q.js";import{Bd as C,Ed as B,M as F,Q as S,Z as M,l as T,zd as W}from"./chunk-RAZEFHXM.js";import{a as $,g as D}from"./chunk-GAL4ENT6.js";var Y=class N{unitsService=S(H);translate=S(C);appSettingsService=S(G);injector=S(M);_exerciseService;get exerciseService(){return this._exerciseService||(this._exerciseService=this.injector.get(J)),this._exerciseService}alertService=S(B);subscriptionService=S(q);ROUTINES_STORAGE_KEY="fitTrackPro_routines";PAUSED_WORKOUT_KEY="fitTrackPro_pausedWorkoutState";PAUSED_STATE_VERSION="1.2";toastService=S(W);progressiveOverloadService=S(K);formatMetricForLogged(e,s){switch(s){case"weight":if(e.type==="bodyweight")return"Bodyweight";if(e.type==="exact")return`${e.value}`;if(e.type==="percentage_1rm")return`${e.percentage}% 1RM`;if(e.type==="range")return`${e.min}-${e.max} kg`;break;case"reps":if(e.type==="exact")return`${e.value}`;if(e.type==="range")return`${e.min}-${e.max}`;break;case"duration":if(e.type==="exact")return`${e.seconds}`;if(e.type==="range")return`${e.minSeconds}-${e.maxSeconds}`;break;case"distance":if(e.type==="exact")return`${e.value}`;if(e.type==="range")return`${e.min}-${e.max}`;break;case"rest":if(e.type==="exact")return`${e.seconds}`;if(e.type==="range")return`${e.minSeconds}-${e.maxSeconds}`;break;default:return e.value?e.value.toString():"-"}return"-"}formatMetricTarget(e,s,a=!1){if(!e)return"-";if(a)return this.formatMetricForLogged(e,s);switch(s){case"weight":if(e.type==="bodyweight")return"Bodyweight";if(e.type==="exact")return`${e.value}`;if(e.type==="percentage_1rm")return`${e.percentage}% 1RM`;if(e.type==="range")return`${e.min}-${e.max}`;break;case"reps":if(e.type==="exact")return`${e.value}`;if(e.type==="range")return`${e.min}-${e.max}`;if(e.type==="max")return"Max reps";if(e.type==="amrap")return"AMRAP";break;case"duration":if(e.type==="exact")return`${e.seconds}`;if(e.type==="range")return`${e.minSeconds}-${e.maxSeconds}`;break;case"distance":if(e.type==="exact")return`${e.value}`;if(e.type==="range")return`${e.min}-${e.max}`;break;case"rest":if(e.type==="exact")return`${e.seconds}`;if(e.type==="range")return`${e.minSeconds}-${e.maxSeconds}`;break;default:return e.value?e.value.toString():"-"}return"-"}getRepsValue(e){if(e){if(e&&e.type==="exact")return e.value;if(e&&e.type==="range")return Math.floor((e.min+e.max)/2);if(e&&e.type==="min_plus")return e.value}}getWeightValue(e){if(e){if(e&&e.type==="exact")return e.value;if(e&&e.type==="range")return Math.floor((e.min+e.max)/2)}}getDurationValue(e){if(e){if(e&&e.type==="exact")return e.seconds;if(e&&e.type==="range")return Math.floor((e.minSeconds+e.maxSeconds)/2)}}getRestValue(e){if(e){if(e&&e.type==="exact")return e.seconds;if(e&&e.type==="range")return Math.floor((e.minSeconds+e.maxSeconds)/2)}}getDistanceValue(e){if(e){if(e&&e.type==="exact")return e.value;if(e&&e.type==="range")return Math.floor((e.min+e.max)/2)}}isTargetVisible(e,s){switch(s){case"reps":return this.isRepsTargetVisible(e);case"weight":return this.isWeightTargetVisible(e);case"duration":return this.isDurationTargetVisible(e);case"distance":return this.isDistanceTargetVisible(e);case"rest":return this.isRestTargetVisible(e);default:return!1}}isWeightTargetVisible(e){if(!e||typeof e!="object"||!("type"in e))return!1;switch(e.type){case"exact":return typeof e.value=="number"&&e.value>0;case"range":return typeof e.min=="number"&&typeof e.max=="number"&&(e.min>0||e.max>0);case"bodyweight":return!0;case"percentage_1rm":return typeof e.percentage=="number"&&e.percentage>0;default:return!1}}isRepsTargetVisible(e){if(!e||typeof e!="object"||!("type"in e))return!1;switch(e.type){case"exact":case"min_plus":return typeof e.value=="number"&&e.value>0;case"range":return typeof e.min=="number"&&typeof e.max=="number"&&(e.min>0||e.max>0);case"amrap":case"max":case"max_fraction":return!0;default:return!1}}isDurationTargetVisible(e){if(!e||typeof e!="object"||!("type"in e))return!1;switch(e.type){case"exact":return typeof e.seconds=="number"&&e.seconds>0;case"range":return typeof e.minSeconds=="number"&&typeof e.maxSeconds=="number"&&(e.minSeconds>0||e.maxSeconds>0);default:return!1}}isDistanceTargetVisible(e){if(!e||typeof e!="object"||!("type"in e))return!1;switch(e.type){case"exact":return typeof e.value=="number"&&e.value>0;case"range":return typeof e.min=="number"&&typeof e.max=="number"&&(e.min>0||e.max>0);default:return!1}}isRestTargetVisible(e){if(!e||typeof e!="object"||!("type"in e))return!1;switch(e.type){case"exact":return typeof e.seconds=="number"&&e.seconds>0;case"range":return typeof e.minSeconds=="number"&&typeof e.maxSeconds=="number"&&(e.minSeconds>0||e.maxSeconds>0);default:return!1}}getSetTargetDisplay(e,s){if(!e)return"";let a=-1,o=-1,i=-1;switch(s){case"reps":if(e.targetReps){if(e.targetReps.type==="range")a=e.targetReps.min,o=e.targetReps.max;else if(e.targetReps.type==="exact"||e.targetReps.type==="min_plus")i=e.targetReps.value;else if(e.targetReps.type==="amrap"||e.targetReps.type==="max")return"Max"}break;case"weight":if(e.targetWeight)if(e.targetWeight.type==="range")a=e.targetWeight.min,o=e.targetWeight.max;else if(e.targetWeight.type==="exact")i=e.targetWeight.value;else{if(e.targetWeight.type==="bodyweight")return"Bodyweight";if(e.targetWeight.type==="percentage_1rm")return`${e.targetWeight.percentage}% 1RM`}break;case"duration":if(e.targetDuration){if(e.targetDuration.type==="range")a=e.targetDuration.minSeconds,o=e.targetDuration.maxSeconds;else if(e.targetDuration.type==="exact")i=e.targetDuration.seconds;else if(e.targetDuration.type==="to_failure")return"To Failure"}break;case"distance":e.targetDistance&&(e.targetDistance.type==="range"?(a=e.targetDistance.min,o=e.targetDistance.max):e.targetDistance.type==="exact"&&(i=e.targetDistance.value));break;case"rest":e.targetRest&&(e.targetRest.type==="range"?(a=e.targetRest.minSeconds,o=e.targetRest.maxSeconds):e.targetRest.type==="exact"&&(i=e.targetRest.seconds));break;case"tempo":return e.targetTempo||"";default:break}return a>=0&&o>=0?a===o?a.toString():`${a}-${o}`:a>=0?`${a}+`:i>=0?i.toString():""}getSetWeightDisplay(e,s){let a=e.weightLogged,o=a!=null?this.getWeightValue(a):this.getWeightValue(e.targetWeight);return s?.categories?.find(i=>i==="cardio")||s?.categories?.find(i=>i==="stretching")?o!=null&&o>0?`${o} ${this.unitsService.getWeightUnitSuffix()}`:this.translate.instant("workoutService.display.weightNotApplicable"):s?.categories?.find(i=>i==="bodyweightCalisthenics")?o!=null&&o>0?`${o} ${this.unitsService.getWeightUnitSuffix()}`:this.translate.instant("workoutService.display.bodyweight"):o!=null&&o>0?`${o} ${this.unitsService.getWeightUnitSuffix()}`:o===0?this.translate.instant("workoutService.display.noAddedWeight"):this.translate.instant("workoutService.display.userDefined")}checkIfMetricIsVisible(e,s,a=!1){if(!e)return!1;let o=i=>{let r=!1,n=!1;switch(s){case"duration":let t=a?i?.durationLogged:i?.targetDuration;r=this.isDurationTargetVisible(t);break;case"weight":let l=a?i?.weightLogged:i?.targetWeight;r=this.isWeightTargetVisible(l);break;case"reps":let u=a?i?.repsLogged:i?.targetReps;r=this.isRepsTargetVisible(u);break;case"distance":let c=a?i?.distanceLogged:i?.targetDistance;r=this.isDistanceTargetVisible(c);break;case"rest":let p=a?i?.restLogged:i?.targetRest;r=this.isRestTargetVisible(p);break;default:return!1}if(this.isLoggedSet(i))switch(s){case"duration":n=this.isDurationTargetVisible(i?.durationLogged);break;case"weight":n=this.isWeightTargetVisible(i?.weightLogged);break;case"reps":n=this.isRepsTargetVisible(i?.repsLogged);break;case"distance":n=this.isDistanceTargetVisible(i?.distanceLogged);break;case"rest":n=this.isRestTargetVisible(i?.restLogged);break;default:n=!1}return r||n};if(typeof e.get=="function"){let i=typeof e.getRawValue=="function"?e.getRawValue():e.value;return i&&Array.isArray(i.sets)?i.sets.some(o):o(i)}return e.sets&&Array.isArray(e.sets)?e.sets.some(o):o(e)}getVisibleExerciseColumns(e,s,a=!1){let o=e.workoutExercises[s];if(!o||o.sets?.length===0)return{weight:!1,reps:!1,distance:!1,duration:!1,tempo:!1,rest:!1};let i=$({},o),r=$({},A(o)),n={};return a?n={weight:r.sets.some(t=>t.targetWeight)||r.sets.some(t=>t.fieldOrder&&t.fieldOrder.includes("weight")),reps:r.sets.some(t=>t.targetReps)||r.sets.some(t=>t.fieldOrder&&t.fieldOrder.includes("reps")),distance:r.sets.some(t=>t.targetDistance)||r.sets.some(t=>t.fieldOrder&&t.fieldOrder.includes("distance")),duration:r.sets.some(t=>t.targetDuration)||r.sets.some(t=>t.fieldOrder&&t.fieldOrder.includes("duration")),rest:r.sets.some(t=>t.targetRest)||r.sets.some(t=>t.fieldOrder&&t.fieldOrder.includes("rest")),tempo:r.sets.some(t=>t.targetTempo)||r.sets.some(t=>t.fieldOrder&&t.fieldOrder.includes("tempo"))}:n={weight:i.sets.some(t=>t.targetWeight)||i.sets.some(t=>t.fieldOrder&&t.fieldOrder.includes("weight")),reps:i.sets.some(t=>t.targetReps)||i.sets.some(t=>t.fieldOrder&&t.fieldOrder.includes("reps")),distance:i.sets.some(t=>t.targetDistance)||i.sets.some(t=>t.fieldOrder&&t.fieldOrder.includes("distance")),duration:i.sets.some(t=>t.targetDuration)||i.sets.some(t=>t.fieldOrder&&t.fieldOrder.includes("duration")),rest:i.sets.some(t=>t.targetRest)||i.sets.some(t=>t.fieldOrder&&t.fieldOrder.includes("rest")),tempo:i.sets.some(t=>t.targetTempo)||i.sets.some(t=>t.fieldOrder&&t.fieldOrder.includes("tempo"))},n}getVisibleSetColumns(e,s,a){let i=e.workoutExercises[s]?.sets[a];if(!i)return{weight:!1,reps:!1,distance:!1,duration:!1,tempo:!1};let r;if(this.isLoggedSet(i))r={weight:!!i.fieldOrder?.includes("weight"),reps:!!i.fieldOrder?.includes("reps"),distance:!!i.fieldOrder?.includes("distance"),duration:!!i.fieldOrder?.includes("duration"),tempo:!!(i.targetTempo?.trim()||i.fieldOrder?.includes("tempo")),rest:!!i.fieldOrder?.includes("rest")};else{let n=i;r={weight:!!(n.targetWeight||n.fieldOrder?.includes("weight")),reps:!!(n.targetReps||n.fieldOrder?.includes("reps")),distance:!!(n.targetDistance||n.fieldOrder?.includes("distance")),duration:!!(n.targetDuration||n.fieldOrder?.includes("duration")),tempo:!!(n.targetTempo?.trim()||n.fieldOrder?.includes("tempo")),rest:!!(n.targetRest||n.fieldOrder?.includes("rest"))}}return r}promptAddField(e,s,a,o=!1){return D(this,null,function*(){let{visible:i,hidden:r}=this.getFieldsForSet(e,s,a);if(r.length===0)return this.toastService.info(this.translate.instant("toasts.allMetricsAdded")),null;let n=!!e.workoutExercises[s].supersetId,t;if(n){let v=["weight","reps"];if(t=r.filter(f=>v.includes(f)),t.every(f=>!v.includes(f)))return this.toastService.info("Only 'Weight' and 'Reps' can be added to sets within a superset."),null}let l=t||r,u=this.appSettingsService.getSettings();if(l.length===0)return this.toastService.info(this.translate.instant("toasts.trueGymModeNoMetrics")),null;let c=l.map(v=>({text:this.translate.instant("metrics."+v),role:"add",data:v,icon:v}));c.push({text:this.translate.instant("common.cancel"),role:"cancel",data:null,icon:"cancel"});let p=yield this.alertService.showConfirmationDialog(this.translate.instant("workoutBuilder.prompts.addField.title"),this.translate.instant("workoutBuilder.prompts.addField.message",{setNumber:a+1}),c,{showCloseButton:!0});if(!p||!p.data)return null;let g=p.data,b=this.translate.instant("metrics."+g),d=this.translate.instant("workoutBuilder.prompts.setTarget.title",{field:b}),m=0;switch(g){case"weight":d+=` (${this.unitsService.getWeightUnitSuffix()})`,m=10;break;case"reps":m=8;break;case"duration":d+=" (s)",m=60;break;case"rest":d+=" (s)",m=60;break;case"distance":d+=` (${this.unitsService.getDistanceUnitSuffix()})`,m=1;break;case"tempo":m="2-0-1-0";break}let h=g!=="tempo"?{min:"0",step:"any"}:{},E=yield this.alertService.showPromptDialog(this.translate.instant("workoutBuilder.prompts.setTarget.title",{field:b}),this.translate.instant("workoutBuilder.prompts.setTarget.message",{setNumber:a+1}),[{name:"targetValue",type:g==="tempo"?"text":"number",label:this.translate.instant("metrics."+g),value:m,attributes:h}],this.translate.instant("workoutBuilder.prompts.setTarget.applyButton"));if(!E||E.targetValue===null||E.targetValue===void 0)return null;let y=E.targetValue;return Array.isArray(y)&&(y=y[0]??0),this.addFieldToSet(e,s,a,g,y)})}defaultHiddenFields(){return{visible:[],hidden:this.getDefaultFields()}}getRepsAndWeightFields(){return["reps","weight"]}getDefaultFields(){return["reps","weight","distance","duration","tempo","rest"]}getFieldsForSet(e,s,a){let o=this.getDefaultFields(),i=this.getVisibleSetColumns(e,s,a),r=o.filter(t=>i[t]),n=o.filter(t=>!r.includes(t));return{visible:r,hidden:n}}addFieldToSet(e,s,a,o,i){let r=JSON.parse(JSON.stringify(e)),n=r.workoutExercises[s].sets[a];if(!n.fieldOrder){let{visible:t}=this.getFieldsForSet(e,s,a);n.fieldOrder=t}switch(n.fieldOrder.includes(o)||n.fieldOrder.push(o),o){case"weight":{let t;typeof i=="number"?t=R(i):typeof i=="string"&&!isNaN(Number(i))?t=R(Number(i)):typeof i=="object"&&i&&"type"in i?t=i:t=R(0),n.targetWeight=t,this.isLoggedRoutine(e)&&(n.weightLogged=t,delete n.targetWeight);break}case"reps":{let t;typeof i=="number"?t=w(i):typeof i=="string"&&!isNaN(Number(i))?t=w(Number(i)):typeof i=="object"&&i&&"type"in i?t=i:t=w(0),n.targetReps=t,this.isLoggedRoutine(e)&&(n.repsLogged=t,delete n.targetReps);break}case"distance":{let t;typeof i=="number"?t=k(i):typeof i=="string"&&!isNaN(Number(i))?t=k(Number(i)):typeof i=="object"&&i&&"type"in i?t=i:t=k(0),n.targetDistance=t,this.isLoggedRoutine(e)&&(n.distanceLogged=t,delete n.targetDistance);break}case"duration":{let t;typeof i=="number"?t=x(i):typeof i=="string"&&!isNaN(Number(i))?t=x(Number(i)):typeof i=="object"&&i&&"type"in i?t=i:t=x(0),n.targetDuration=t,this.isLoggedRoutine(e)&&(n.durationLogged=t,delete n.targetDuration);break}case"rest":{let t;typeof i=="number"?t=O(i):typeof i=="string"&&!isNaN(Number(i))?t=O(Number(i)):typeof i=="object"&&i&&"type"in i?t=i:t=O(0),n.targetRest=t,this.isLoggedRoutine(e)&&(n.restLogged=t,delete n.targetRest);break}case"tempo":{let t=typeof i=="string"?i:"";n.targetTempo=t,this.isLoggedRoutine(e)&&(n.tempoLogged=t);break}default:{o in n&&(n[o]=i);break}}return r}promptRemoveField(e,s,a,o=!1){return D(this,null,function*(){let i=this.getVisibleSetColumns(e,s,a),r=Object.keys(i).filter(d=>i[d]),n=this.appSettingsService.getSettings();if(o&&(r=r.filter(d=>d!=="rest")),r.length===0){let d=yield T(this.translate.get("workoutService.alerts.removeField.noFieldsToast"));return this.toastService.info(d),e}if(r.length===1){let d=yield T(this.translate.get("workoutService.alerts.removeField.atLeastOneMetric"));return this.toastService.info(d),e}let l=["workoutService.alerts.removeField.title","workoutService.alerts.removeField.message","common.cancel",...r.map(d=>`metrics.${d}`)],u=yield T(this.translate.get(l)),c=r.map(d=>({text:u[`metrics.${d}`],role:"remove",data:d,icon:d,cssClass:"bg-red-500 hover:bg-red-600"}));c.push({text:u["common.cancel"],role:"cancel",data:null,icon:"cancel"});let p=yield this.alertService.showConfirmationDialog(u["workoutService.alerts.removeField.title"],u["workoutService.alerts.removeField.message"],c,{showCloseButton:!0});if(!p||!p.data)return null;let g=p.data;return this.removeMetricFromSet(e,s,a,g)})}removeMetricFromSet(e,s,a,o){let i=JSON.parse(JSON.stringify(e)),r=i.workoutExercises[s].sets[a];return this.isLoggedRoutine(i)?r[`${o}Logged`]=void 0:(r[`target${o.charAt(0).toUpperCase()+o.slice(1)}`]=void 0,r[`target${o.charAt(0).toUpperCase()+o.slice(1)}Min`]=void 0,r[`target${o.charAt(0).toUpperCase()+o.slice(1)}Max`]=void 0,r[`${o}Used`]=void 0,r[`${o}Achieved`]=void 0,r[`${o}AfterSet`]=void 0),r.fieldOrder&&(r.fieldOrder=r.fieldOrder.filter(n=>n!==o)),this.toastService.info(this.translate.instant("toasts.fieldRemovedFromSet",{fieldToRemove:this.translate.instant(`metrics.${o}`).toUpperCase(),setIndex:a+1})),i}getSetFieldOrderByStrings(e,s,a){let i=this.getExerciseById(e,s)?.sets?.find(r=>r.id===a);if(i&&Array.isArray(i.fieldOrder)){let r=this.getDefaultFields();return[...i.fieldOrder].sort((n,t)=>{let l=r.indexOf(n),u=r.indexOf(t);return l===-1&&u===-1?0:l===-1?1:u===-1?-1:l-u})}return null}getSetFieldOrder(e,s,a){let i=e?.workoutExercises?.[s]?.sets?.[a];if(i&&Array.isArray(i.fieldOrder)){let r=this.getDefaultFields();return[...i.fieldOrder].sort((n,t)=>{let l=r.indexOf(n),u=r.indexOf(t);return l===-1&&u===-1?0:l===-1?1:u===-1?-1:l-u})}return null}isLoggedSet(e){return e&&e.workoutLogId&&(typeof e.repsLogged<"u"||typeof e.weightLogged<"u"||typeof e.durationLogged<"u"||typeof e.distanceLogged<"u"||typeof e.tempoLogged<"u")}getSetFieldValue(e,s){if(!e)return"-";if(this.isLoggedSet(e))switch(s){case"reps":return(this.getRepsValue(e.repsLogged)??"-").toString();case"weight":return e.weightLogged!=null?(this.getWeightValue(e.weightLogged)??"-").toString():"-";case"distance":return(this.getDistanceValue(e.distanceLogged)??"-").toString();case"duration":return e.durationLogged!==void 0&&e.durationLogged!==null&&this.getDurationValue(e.durationLogged)!==void 0?this.formatSecondsToTime(this.getDurationValue(e.durationLogged).toString()):"-";case"rest":return e.restLogged!==void 0&&e.restLogged!==null&&this.getRestValue(e.restLogged)!==void 0?this.formatSecondsToTime(this.getRestValue(e.restLogged).toString()):"-";case"tempo":return e.tempoLogged||"-";default:return"-"}else{let a=e;switch(s){case"reps":return a.targetReps&&a.targetReps.type==="range"?Math.floor((a.targetReps.min+a.targetReps.max)/2).toString():(this.getRepsValue(a.targetReps)??"-").toString();case"weight":return a.targetWeight&&a.targetWeight.type==="range"?Math.floor((a.targetWeight.min+a.targetWeight.max)/2).toString():(this.getWeightValue(a.targetWeight)??"-").toString();case"distance":return a.targetDistance&&a.targetDistance.type==="range"?Math.floor((a.targetDistance.min+a.targetDistance.max)/2).toString():(this.getDistanceValue(a.targetDistance)??"-").toString();case"duration":return a.targetDuration&&a.targetDuration.type==="range"?Math.floor((a.targetDuration.minSeconds+a.targetDuration.maxSeconds)/2).toString():(this.getDurationValue(a.targetDuration)??"-").toString();case"rest":return a.targetRest&&a.targetRest.type==="range"?Math.floor((a.targetRest.minSeconds+a.targetRest.maxSeconds)/2).toString():(this.getRestValue(a.targetRest)??"-").toString();case"tempo":return a.targetTempo||"-";default:return"-"}}}_formatSingleSecondValue(e){let s;if(typeof e=="number")s=e;else{let i=e.trim().toLowerCase();if(i.includes(":")){let r=i.split(":");if(r.length===2){let n=parseFloat(r[0]),t=parseFloat(r[1]);if(!isNaN(n)&&!isNaN(t))s=n*60+t;else return""}else return""}else if(i.includes("m")||i.includes("minute")){let r=parseFloat(i.replace(/m|minute|minutes/g,""));if(!isNaN(r))s=r*60;else return""}else if(i.includes("s")||i.includes("second")){let r=parseFloat(i.replace(/s|second|seconds/g,""));if(!isNaN(r))s=r;else return""}else if(s=parseFloat(i),isNaN(s))return""}let a=String(Math.floor(s/60)).padStart(2,"0"),o=String(s%60).padStart(2,"0");return`${a}:${o}`}formatSecondsToTime(e){if(e==null||e==="")return"";if(typeof e=="string"&&e.includes("-")){let[s,a]=e.split("-"),o=this._formatSingleSecondValue(s),i=this._formatSingleSecondValue(a);return`${o}-${i}`}return this._formatSingleSecondValue(e)}getAvailableRepsSchemes(e){return _.filter(a=>e==="builder"?a.availableInBuilder:a.availableInPlayer).map(a=>({type:a.type,label:this.translate.instant(a.labelKey)}))}getAvailableWeightSchemes(e){return I.filter(s=>e==="builder"?s.availableInBuilder:s.availableInPlayer).map(s=>({type:s.type,label:this.translate.instant(s.labelKey)}))}repsTargetAsString(e){if(!e)return"";switch(e.type){case"exact":return`${e.value}`;case"range":return`${e.min}-${e.max}`;case"amrap":return"AMRAP";case"min_plus":return`${e.value}+`;default:return""}}weightTargetAsString(e){if(!e)return"";switch(e.type){case"exact":return`${e.value}`;case"range":return`${e.min}-${e.max}`;case"bodyweight":return this.translate.instant("weightSchemes.bodyweight");case"percentage_1rm":return`${e.percentage}% 1RM`;default:return""}}getAvailableDurationSchemes(e){return P.filter(s=>e==="builder"?s.availableInBuilder:s.availableInPlayer).map(s=>({type:s.type,label:this.translate.instant(s.labelKey)}))}durationTargetAsString(e){if(!e)return"";switch(e.type){case"exact":return`${e.seconds}`;case"range":return`${e.minSeconds}-${e.maxSeconds}`;case"to_failure":return this.translate.instant("durationSchemes.toFailure");default:return""}}getAvailableDistanceSchemes(e){return U.filter(s=>e==="builder"?s.availableInBuilder:s.availableInPlayer).map(s=>({type:s.type,label:this.translate.instant(s.labelKey)}))}distanceTargetAsString(e){if(!e)return"";switch(e.type){case"exact":return`${e.value}`;case"range":return`${e.min}-${e.max}`;default:return""}}getAvailableRestSchemes(e){return j.filter(s=>e==="builder"?s.availableInBuilder:s.availableInPlayer).map(s=>({type:s.type,label:this.translate.instant(s.labelKey)}))}restTargetAsString(e){if(!e)return"";switch(e.type){case"exact":return`${e.seconds}`;case"range":return`${e.minSeconds}-${e.maxSeconds}`;default:return""}}showSchemeModal(e,s,a){return D(this,null,function*(){let o=a.map(u=>{let c="pin";return u.type.includes("range")&&(c="range"),u.type.includes("percentage")&&(c="percentage"),u.type.includes("max")&&(c="max_performance"),u.type.includes("fraction")&&(c="fraction"),u.type.includes("amrap")&&(c="repeat"),u.type.includes("min_plus")&&(c="plus-circle"),u.type.includes("bodyweight")&&(c="weight"),{text:this.translate.instant(u.labelKey),role:"select",data:u.type,icon:c}}),i=yield this.alertService.showConfirmationDialog(this.translate.instant("schemes.titles.selectType",{metric:this.translate.instant(`metrics.${e}`)}),"",o,{customButtonDivCssClass:o.length>1?"grid grid-cols-2 gap-3":"grid grid-cols-1 gap-3",showCloseButton:!0});if(!i||!i.data)return null;let r=i.data,n=null,t=[],l=`schemes.titles.set${r.charAt(0).toUpperCase()+r.slice(1)}`;switch(r){case"exact":case"exact":case"exact":t.push({name:"value",type:"number",label:this.translate.instant(`metrics.${e}`),value:s?.value??8,attributes:{min:0,required:!0}});break;case"exact":case"exact":t.push({name:"seconds",type:"number",label:this.translate.instant(`metrics.${e}`),value:s?.value??30,attributes:{min:0,required:!0}});break;case"min_plus":t.push({name:"min",type:"number",label:this.translate.instant("common.atLeast"),value:s?.min??5,attributes:{min:0,required:!0}});break;case"max_fraction":t.push({name:"divisor",type:"number",label:this.translate.instant("common.fractionOfMax"),value:s?.divisor??2,attributes:{min:1,required:!0}});break;case"range":case"range":case"range":case"range":case"range":t.push({name:"min",type:"number",label:this.translate.instant("common.min"),value:s?.min??8,attributes:{min:0,required:!0}},{name:"max",type:"number",label:this.translate.instant("common.max"),value:s?.max??12,attributes:{min:0,required:!0}});break;case"percentage_1rm":t.push({name:"percentage",type:"number",label:"% 1RM",value:s?.percentage??80,attributes:{min:1,max:150,required:!0}});break}if(t.length>0){let u=yield this.alertService.showPromptDialog(this.translate.instant(l),"",t);if(!u)return null;switch(e){case"reps":switch(r){case"exact":n={type:r,value:Number(u.value)};break;case"range":n={type:r,min:Number(u.min),max:Number(u.max)};break;case"min_plus":n={type:r,value:Number(u.min)};break;case"max_fraction":n={type:r,divisor:Number(u.divisor)};break}break;case"weight":switch(r){case"exact":n={type:r,value:Number(u.value)};break;case"range":n={type:r,min:Number(u.min),max:Number(u.max)};break;case"percentage_1rm":n={type:r,percentage:Number(u.percentage)};break}break;case"duration":switch(r){case"exact":n={type:r,seconds:Number(u.value)};break;case"range":n={type:r,minSeconds:Number(u.min),maxSeconds:Number(u.max)};break;case"to_failure":n={type:r};break}break;case"rest":switch(r){case"exact":n={type:r,seconds:Number(u.value)};break;case"range":n={type:r,minSeconds:Number(u.min),maxSeconds:Number(u.max)};break}break;case"distance":switch(r){case"exact":n={type:r,value:Number(u.value)};break;case"range":n={type:r,min:Number(u.min),max:Number(u.max)};break}break}}else n={type:r};return n?{role:"confirm",data:n}:null})}isLoggedRoutine(e){return"workoutLogId"in e}getVisibleSetColumnsByStrings(e,s,a){let i=e.workoutExercises.find(n=>n.id===s)?.sets.find(n=>n.id===a);if(!i)return{weight:!1,reps:!1,distance:!1,duration:!1,tempo:!1};let r;if(this.isLoggedSet(i))r={weight:!!i.fieldOrder?.includes("weight"),reps:!!i.fieldOrder?.includes("reps"),distance:!!i.fieldOrder?.includes("distance"),duration:!!i.fieldOrder?.includes("duration"),tempo:!!(i.targetTempo?.trim()||i.fieldOrder?.includes("tempo")),rest:!!i.fieldOrder?.includes("rest")};else{let n=i;r={weight:!!(n.targetWeight||n.fieldOrder?.includes("weight")),reps:!!(n.targetReps||n.fieldOrder?.includes("reps")),distance:!!(n.targetDistance||n.fieldOrder?.includes("distance")),duration:!!(n.targetDuration||n.fieldOrder?.includes("duration")),tempo:!!(n.targetTempo?.trim()||n.fieldOrder?.includes("tempo")),rest:!!(n.targetRest||n.fieldOrder?.includes("rest"))}}return r}isExerciseInSuperset(e,s){if(e.workoutExercises&&Array.isArray(e.workoutExercises)){for(let a of e.workoutExercises)if(a.supersetId&&a.id===s)return!0}return!1}promptAddFieldByStrings(e,s,a,o=!1){return D(this,null,function*(){let{visible:i,hidden:r}=this.getFieldsForSetByStrings(e,s,a);if(r.length===0)return this.toastService.info(this.translate.instant("toasts.allMetricsAdded")),null;let t=e.workoutExercises.find(f=>f.id===s)?this.isExerciseInSuperset(e,s):!1,l;if(t){let f=["weight","reps"];if(l=r.filter(X=>f.includes(X)),l.length===0)return this.toastService.info("Only 'Weight' and 'Reps' can be added to sets within a supersets group."),null}let u=l||r;if(u.length===0)return this.toastService.info(this.translate.instant("toasts.trueGymModeNoMetrics")),null;let c=u.map(f=>({text:this.translate.instant("metrics."+f),role:"add",data:f,icon:f}));c.push({text:this.translate.instant("common.cancel"),role:"cancel",data:null,icon:"cancel"});let p=e.workoutExercises.find(f=>f.id===s)?.sets.findIndex(f=>f.id===a)??0,g=yield this.alertService.showConfirmationDialog(this.translate.instant("workoutBuilder.prompts.addField.title"),this.translate.instant("workoutBuilder.prompts.addField.message",{setNumber:p+1}),c,{showCloseButton:!0});if(!g||!g.data)return null;let b=g.data,d=this.translate.instant("metrics."+b),m=this.translate.instant("workoutBuilder.prompts.setTarget.title",{field:d}),h=0;switch(b){case"weight":m+=` (${this.unitsService.getWeightUnitSuffix()})`,h=10;break;case"reps":h=8;break;case"duration":m+=" (s)",h=60;break;case"rest":m+=" (s)",h=60;break;case"distance":m+=` (${this.unitsService.getDistanceUnitSuffix()})`,h=1;break;case"tempo":h="2-0-1-0";break}let E=b!=="tempo"?{min:"0",step:"any"}:{},y=yield this.alertService.showPromptDialog(this.translate.instant("workoutBuilder.prompts.setTarget.title",{field:d}),this.translate.instant("workoutBuilder.prompts.setTarget.message",{setNumber:p+1}),[{name:"targetValue",type:b==="tempo"?"text":"number",label:this.translate.instant("metrics."+b),value:h,attributes:E}],this.translate.instant("workoutBuilder.prompts.setTarget.applyButton"));if(!y||y.targetValue===null||y.targetValue===void 0)return null;let L=y.targetValue;return Array.isArray(L)&&(L=L[0]??0),this.addFieldToSetByStrings(e,s,a,b,L)})}getFieldsForSetByStrings(e,s,a){let o=this.getDefaultFields(),i=this.getVisibleSetColumnsByStrings(e,s,a),r=o.filter(t=>i[t]),n=o.filter(t=>!r.includes(t));return{visible:r,hidden:n}}promptRemoveFieldByStrings(e,s,a,o=!1){return D(this,null,function*(){let i=this.getVisibleSetColumnsByStrings(e,s,a),r=Object.keys(i).filter(d=>i[d]),n=this.appSettingsService.getSettings();if(o&&(r=r.filter(d=>d!=="rest")),r.length===0){let d=yield T(this.translate.get("workoutService.alerts.removeField.noFieldsToast"));return this.toastService.info(d),e}if(r.length===1){let d=yield T(this.translate.get("workoutService.alerts.removeField.atLeastOneMetric"));return this.toastService.info(d),e}let l=["workoutService.alerts.removeField.title","workoutService.alerts.removeField.message","common.cancel",...r.map(d=>`metrics.${d}`)],u=yield T(this.translate.get(l)),c=r.map(d=>({text:u[`metrics.${d}`],role:"remove",data:d,icon:d,cssClass:"bg-red-500 hover:bg-red-600"}));c.push({text:u["common.cancel"],role:"cancel",data:null,icon:"cancel"});let p=yield this.alertService.showConfirmationDialog(u["workoutService.alerts.removeField.title"],u["workoutService.alerts.removeField.message"],c,{showCloseButton:!0});if(!p||!p.data)return null;let g=p.data;return this.removeMetricFromSetByStrings(e,s,a,g)})}removeMetricFromSetByStrings(e,s,a,o){let i=JSON.parse(JSON.stringify(e)),r=i.workoutExercises.find(t=>t.id===s)?.sets.find(t=>t.id===a);this.isLoggedRoutine(i)?r[`${o}Logged`]=void 0:(r[`target${o.charAt(0).toUpperCase()+o.slice(1)}`]=void 0,r[`target${o.charAt(0).toUpperCase()+o.slice(1)}Min`]=void 0,r[`target${o.charAt(0).toUpperCase()+o.slice(1)}Max`]=void 0,r[`${o}Used`]=void 0,r[`${o}Achieved`]=void 0,r[`${o}AfterSet`]=void 0),r.fieldOrder&&(r.fieldOrder=r.fieldOrder.filter(t=>t!==o));let n=i.workoutExercises.find(t=>t.id===s)?.sets.findIndex(t=>t.id===a)??0;return this.toastService.info(this.translate.instant("toasts.fieldRemovedFromSet",{fieldToRemove:this.translate.instant(`metrics.${o}`).toUpperCase(),setIndex:n+1})),i}addFieldToSetByStrings(e,s,a,o,i){let r=JSON.parse(JSON.stringify(e)),n=r.workoutExercises.find(l=>l.id===s)?.sets.find(l=>l.id===a);if(!n)return null;let t=n;if(!t.fieldOrder){let{visible:l}=this.getFieldsForSetByStrings(e,s,a);t.fieldOrder=l}switch(t.fieldOrder.includes(o)||t.fieldOrder.push(o),o){case"weight":{let l;typeof i=="number"?l=R(i):typeof i=="string"&&!isNaN(Number(i))?l=R(Number(i)):typeof i=="object"&&i&&"type"in i?l=i:l=R(0),t.targetWeight=l,this.isLoggedRoutine(e)&&(t.weightLogged=l,delete t.targetWeight);break}case"reps":{let l;typeof i=="number"?l=w(i):typeof i=="string"&&!isNaN(Number(i))?l=w(Number(i)):typeof i=="object"&&i&&"type"in i?l=i:l=w(0),t.targetReps=l,this.isLoggedRoutine(e)&&(t.repsLogged=l,delete t.targetReps);break}case"distance":{let l;typeof i=="number"?l=k(i):typeof i=="string"&&!isNaN(Number(i))?l=k(Number(i)):typeof i=="object"&&i&&"type"in i?l=i:l=k(0),t.targetDistance=l,this.isLoggedRoutine(e)&&(t.distanceLogged=l,delete t.targetDistance);break}case"duration":{let l;typeof i=="number"?l=x(i):typeof i=="string"&&!isNaN(Number(i))?l=x(Number(i)):typeof i=="object"&&i&&"type"in i?l=i:l=x(0),t.targetDuration=l,this.isLoggedRoutine(e)&&(t.durationLogged=l,delete t.targetDuration);break}case"rest":{let l;typeof i=="number"?l=O(i):typeof i=="string"&&!isNaN(Number(i))?l=O(Number(i)):typeof i=="object"&&i&&"type"in i?l=i:l=O(0),t.targetRest=l,this.isLoggedRoutine(e)&&(t.restLogged=l,delete t.targetRest);break}case"tempo":{let l=typeof i=="string"?i:"";t.targetTempo=l,this.isLoggedRoutine(e)&&(t.tempoLogged=l);break}default:{o in t&&(t[o]=i);break}}return r}getVisibleExerciseColumnsByStrings(e,s,a=!1){let o=e.workoutExercises.find(t=>t.id===s);if(!o||o.sets?.length===0)return{weight:!1,reps:!1,distance:!1,duration:!1,tempo:!1,rest:!1};let i=$({},o),r=$({},A(o)),n={};return a?n={weight:r.sets.some(t=>t.targetWeight)||r.sets.some(t=>t.fieldOrder&&t.fieldOrder.includes("weight")),reps:r.sets.some(t=>t.targetReps)||r.sets.some(t=>t.fieldOrder&&t.fieldOrder.includes("reps")),distance:r.sets.some(t=>t.targetDistance)||r.sets.some(t=>t.fieldOrder&&t.fieldOrder.includes("distance")),duration:r.sets.some(t=>t.targetDuration)||r.sets.some(t=>t.fieldOrder&&t.fieldOrder.includes("duration")),rest:r.sets.some(t=>t.targetRest)||r.sets.some(t=>t.fieldOrder&&t.fieldOrder.includes("rest")),tempo:r.sets.some(t=>t.targetTempo)||r.sets.some(t=>t.fieldOrder&&t.fieldOrder.includes("tempo"))}:n={weight:i.sets.some(t=>t.targetWeight)||i.sets.some(t=>t.fieldOrder&&t.fieldOrder.includes("weight")),reps:i.sets.some(t=>t.targetReps)||i.sets.some(t=>t.fieldOrder&&t.fieldOrder.includes("reps")),distance:i.sets.some(t=>t.targetDistance)||i.sets.some(t=>t.fieldOrder&&t.fieldOrder.includes("distance")),duration:i.sets.some(t=>t.targetDuration)||i.sets.some(t=>t.fieldOrder&&t.fieldOrder.includes("duration")),rest:i.sets.some(t=>t.targetRest)||i.sets.some(t=>t.fieldOrder&&t.fieldOrder.includes("rest")),tempo:i.sets.some(t=>t.targetTempo)||i.sets.some(t=>t.fieldOrder&&t.fieldOrder.includes("tempo"))},n}getExerciseById(e,s){if(!(!e||!e.workoutExercises))return e.workoutExercises.find(a=>a.id===s)}_convertLoggedSetsToPlanned(e){return e.map(s=>({id:s.id,targetReps:s.repsLogged,targetWeight:s.weightLogged,targetDuration:s.durationLogged,targetDistance:s.distanceLogged,targetRest:s.restLogged,targetTempo:s.tempoLogged,notes:s.notes,type:s.type,fieldOrder:s.fieldOrder}))}static \u0275fac=function(s){return new(s||N)};static \u0275prov=F({token:N,factory:N.\u0275fac,providedIn:"root"})};export{Y as a};
