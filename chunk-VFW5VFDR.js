import{a as te,b as re,d as ie,e as ne}from"./chunk-NY7YMSTP.js";import{a as ee}from"./chunk-DCBND6VH.js";import"./chunk-4PTIEP3X.js";import{g as K,h as Q}from"./chunk-SQTVDFOT.js";import{a as J}from"./chunk-V6XZS7JT.js";import{a as q}from"./chunk-BA4WUUC6.js";import{$ as g,B as M,Ga as d,H as B,Ha as a,Ia as n,Ja as v,Lb as W,Mb as z,Q as m,Qa as T,Ra as h,Rc as Z,Sa as p,U as y,Ub as b,V as _,W as C,X as w,Xb as Y,Yb as I,bb as l,cb as O,db as x,ea as N,eb as P,fc as X,ga as R,hc as j,ic as G,k as f,ka as F,lb as U,ma as o,nb as H,p as D,pa as V,q as E,sb as k,ua as $,ub as S,z as A,za as u,zb as L}from"./chunk-73CHABTJ.js";import"./chunk-GAL4ENT6.js";var oe=r=>["/history/log",r];function se(r,t){r&1&&(a(0,"div",9)(1,"p",10),l(2,"Loading trend data..."),n(),v(3,"div",11),n())}function le(r,t){if(r&1){let e=T();a(0,"div",12)(1,"p",13),C(),a(2,"svg",14),v(3,"path",15),n(),l(4),n(),w(),a(5,"button",16),h("click",function(){y(e);let s=p();return _(s.goBack())}),l(6," Back to Personal Bests "),n()()}if(r&2){let e=p();o(4),x(" ",e.errorMessage()," ")}}function de(r,t){if(r&1&&(a(0,"div"),l(1),n()),r&2){let e=p().model;o(),x("Reps: ",e.extra.reps)}}function ce(r,t){if(r&1&&(a(0,"div",25),l(1),n()),r&2){let e=p().model;o(),x("Notes: ",e.extra.notes)}}function me(r,t){r&1&&(a(0,"div",26),l(1,"Click to view log"),n())}function pe(r,t){if(r&1&&(a(0,"div",21)(1,"div")(2,"strong"),l(3),k(4,"date"),n()(),a(5,"div"),l(6),n(),u(7,de,2,1,"div",22)(8,ce,2,1,"div",23)(9,me,2,0,"div",24),n()),r&2){let e=t.model,i=p(2);o(3),O(S(4,6,e.name,"mediumDate")),o(3),P("Value: ",e.value," ",i.yAxisLabel().split(" ")[0]),o(),d("ngIf",e.extra==null?null:e.extra.reps),o(),d("ngIf",e.extra==null?null:e.extra.notes),o(),d("ngIf",e.extra==null?null:e.extra.workoutLogId)}}function ue(r,t){r&1&&(a(0,"th",32),l(1," Reps "),n())}function xe(r,t){if(r&1&&(a(0,"td",40),l(1),n()),r&2){let e=p().$implicit;o(),x(" ",e.extra==null?null:e.extra.reps," ")}}function ge(r,t){if(r&1&&(a(0,"a",44),l(1," View Log "),n()),r&2){let e=p().$implicit;d("routerLink",H(1,oe,e.extra==null?null:e.extra.workoutLogId))}}function he(r,t){if(r&1&&(a(0,"tr",38)(1,"td",39),l(2),k(3,"date"),n(),a(4,"td",40),l(5),n(),u(6,xe,2,1,"td",41),a(7,"td",42),u(8,ge,2,3,"a",43),n()()),r&2){let e=t.$implicit,i=p(3);o(2),x(" ",S(3,4,e.name,"mediumDate")," "),o(3),x(" ",e.value," "),o(),d("ngIf",(i.currentPbType==null?null:i.currentPbType.includes("RM"))||(i.currentPbType==null?null:i.currentPbType.includes("Heaviest Lifted"))),o(2),d("ngIf",e.extra==null?null:e.extra.workoutLogId)}}function fe(r,t){if(r&1&&(a(0,"div",27)(1,"h2",28),l(2," Personal Best History "),n(),a(3,"div",29)(4,"table",30)(5,"thead",31)(6,"tr")(7,"th",32),l(8," Date "),n(),a(9,"th",32),l(10),n(),u(11,ue,2,0,"th",33),a(12,"th",34)(13,"span",35),l(14,"View Log"),n()()()(),a(15,"tbody",36),u(16,he,9,7,"tr",37),n()()()()),r&2){let e=p(2);o(10),x(" ",e.yAxisLabel()," "),o(),d("ngIf",(e.currentPbType==null?null:e.currentPbType.includes("RM"))||(e.currentPbType==null?null:e.currentPbType.includes("Heaviest Lifted"))),o(5),d("ngForOf",e.historyTableData())}}function ve(r,t){if(r&1){let e=T();a(0,"div",17)(1,"ngx-charts-line-chart",18),h("select",function(s){y(e);let c=p();return _(c.onChartSelect(s))}),u(2,pe,10,9,"ng-template",19),n(),u(3,fe,17,3,"div",20),n()}if(r&2){let e=p();o(),d("view",e.view)("scheme",e.chartColorScheme())("results",e.chartData())("legend",e.legend)("xAxis",e.xAxis)("yAxis",e.yAxis)("showXAxisLabel",e.showXAxisLabel)("showYAxisLabel",e.showYAxisLabel)("xAxisLabel","Date")("yAxisLabel",e.yAxisLabel())("timeline",e.timeline)("autoScale",e.autoScale)("roundDomains",e.roundDomains)("xAxisTickFormatting",e.xAxisTickFormatting),o(2),d("ngIf",e.historyTableData().length>0)}}var ae=class r{route=m(X);router=m(j);trackingService=m(Q);exerciseService=m(K);unitsService=m(J);toastService=m(Z);platformId=m(R);datePipe=new b("en-US");appSettingsService=m(q);themeService=m(ee);renderer=m(V);el=m(N);themeSubscription;chartData=g(null);isLoading=g(!0);errorMessage=g(null);historyTableData=L(()=>{let t=this.chartData();return!t||!t[0]||!t[0].series?[]:[...t[0].series].sort((e,i)=>i.name.getTime()-e.name.getTime())});currentExerciseId=null;currentPbType=null;currentExerciseName=g("Exercise");yAxisLabel=g("Value");view=[700,400];legend=!1;showXAxisLabel=!0;showYAxisLabel=!0;xAxis=!0;yAxis=!0;timeline=!0;autoScale=!0;roundDomains=!0;chartColorScheme=L(()=>{let t=this.themeService.isDarkTheme();return{name:"pbTrendScheme",selectable:!0,group:re.Ordinal,domain:t?["#70C0AE","#E9724C","#F0C24B","#CCCCCC"]:["#5AA454","#A10A28","#C7B42C","#333333"]}});xAxisTickFormatting=t=>t instanceof Date?this.datePipe.transform(t,"MMM d, yy")||"":String(t);constructor(){}ngOnInit(){I(this.platformId)&&(this.view=[window.innerWidth>768?700:window.innerWidth-40,400],this.updateChartTextColors(this.themeService.isDarkTheme())),this.route.paramMap.pipe(M(1),B(t=>{this.isLoading.set(!0),this.errorMessage.set(null),this.chartData.set(null);let e=t.get("exerciseId"),i=t.get("pbType");if(!e||!i)return this.errorMessage.set("Exercise ID or PB Type missing in URL."),this.isLoading.set(!1),f({pb:null,exercise:null,error:"Missing parameters"});this.currentExerciseId=e;try{this.currentPbType=decodeURIComponent(i)}catch{return this.errorMessage.set("Invalid PB Type in URL."),this.isLoading.set(!1),f({pb:null,exercise:null,error:"Invalid PB Type"})}return this.setYAxisLabel(this.currentPbType),E([this.trackingService.getPersonalBestForExerciseByType(this.currentExerciseId,this.currentPbType),this.exerciseService.getExerciseById(this.currentExerciseId)]).pipe(D(([s,c])=>({pb:s,exercise:c,error:null})),A(s=>(console.error("Error fetching PB trend data:",s),this.errorMessage.set("Failed to load data for the trend chart."),f({pb:null,exercise:null,error:"Fetch error"}))))})).subscribe(({pb:t,exercise:e,error:i})=>{if(i){this.isLoading.set(!1);return}this.currentExerciseName.set(e?.name||"Selected Exercise"),t?this.prepareChartData(t):this.errorMessage.set(`No Personal Best data found for "${this.currentExerciseName()}" of type "${this.currentPbType}"`),this.isLoading.set(!1)})}updateChartTextColors(t){let e=t?"#E5E7EB":"#374151";this.renderer.setStyle(this.el.nativeElement,"--ngx-charts-text-color",e)}setYAxisLabel(t){t.includes("RM")||t.includes("Heaviest Lifted")?this.yAxisLabel.set(`Weight (${this.unitsService.getWeightUnitSuffix()})`):t.includes("Max Reps")?this.yAxisLabel.set("Repetitions"):t.includes("Max Duration")?this.yAxisLabel.set("Duration (seconds)"):this.yAxisLabel.set("Value")}prepareChartData(t){let e=[],i=this.extractValueForChart(t,t.pbType);if(i!==null&&t.timestamp&&e.push({name:new Date(t.timestamp),value:i,extra:{reps:t.repsAchieved,notes:t.notes,workoutLogId:t.workoutLogId}}),t.history&&t.history.forEach(s=>{let c=this.extractValueForChart(s,t.pbType);c!==null&&s.timestamp&&e.push({name:new Date(s.timestamp),value:c,extra:{reps:s.repsAchieved,notes:void 0,workoutLogId:s.workoutLogId}})}),e.length===0){this.errorMessage.set(`Not enough data points to plot a trend for "${this.currentExerciseName()}" - ${t.pbType}`),this.chartData.set(null);return}if(e.length===1){this.errorMessage.set(`Only one data point available for "${this.currentExerciseName()}" - ${t.pbType}. Trend line cannot be drawn`);let s=e[0],c=new Date(s.name.getTime()-1440*60*1e3);e.unshift({name:c,value:s.value,extra:s.extra})}e.sort((s,c)=>s.name.getTime()-c.name.getTime()),this.chartData.set([{name:`${this.currentPbType||"PB"} Trend`,series:e}])}extractValueForChart(t,e){return e.includes("RM")||e.includes("Heaviest Lifted")?t.weightUsed??null:e.includes("Max Reps")?t.repsAchieved??null:e.includes("Max Duration")?t.durationPerformed??null:t.weightUsed&&t.weightUsed>0?t.weightUsed:t.repsAchieved>0?t.repsAchieved:t.durationPerformed&&t.durationPerformed>0?t.durationPerformed:null}onChartSelect(t){t&&t.extra&&t.extra.workoutLogId?this.router.navigate(["/workout/summary",t.extra.workoutLogId]):t&&t.extra&&this.toastService.info(`PB achieved: ${t.value} ${this.yAxisLabel().split(" ")[0]} on ${this.datePipe.transform(t.name,"mediumDate")}. ${t.extra.reps?"Reps: "+t.extra.reps:""} ${t.extra.notes?"Notes: "+t.extra.notes:""}`,5e3,"PB Detail")}goBack(){this.router.navigate(["/profile/personal-bests"])}onResize(t){if(I(this.platformId)){let e=t.target;this.view=[e.innerWidth>768?700:e.innerWidth-40,400]}}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=$({type:r,selectors:[["app-pb-trend-chart"]],features:[U([te])],decls:10,vars:5,consts:[[1,"container","mx-auto","p-4",3,"resize"],[1,"mb-6","flex","items-center"],[1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-ml-2","rounded-full","focus:outline-none","focus:ring-2","focus:ring-primary-focus",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"text-xl","sm:text-2xl","font-bold","text-gray-800","dark:text-gray-200","ml-2"],["class","text-center py-10",4,"ngIf"],["class","text-center py-10 bg-red-50 dark:bg-red-900/30 p-4 rounded-md shadow",4,"ngIf"],["class","bg-white dark:bg-gray-800 p-2 sm:p-4 rounded-md shadow-xl",4,"ngIf"],[1,"text-center","py-10"],[1,"text-lg","text-gray-600","dark:text-gray-400"],[1,"mt-4","animate-spin","rounded-full","h-12","w-12","border-b-2","border-primary","mx-auto"],[1,"text-center","py-10","bg-red-50","dark:bg-red-900/30","p-4","rounded-md","shadow"],[1,"text-lg","font-semibold","text-red-700","dark:text-red-300"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-6","h-6","inline-block","mr-2","align-middle"],["stroke-linecap","round","stroke-linejoin","round","d","M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"],[1,"mt-4","px-4","py-2","bg-primary","text-white","rounded-md","hover:bg-primary-dark","transition-colors",3,"click"],[1,"bg-white","dark:bg-gray-800","p-2","sm:p-4","rounded-md","shadow-xl"],[1,"pb-chart-container",3,"select","view","scheme","results","legend","xAxis","yAxis","showXAxisLabel","showYAxisLabel","xAxisLabel","yAxisLabel","timeline","autoScale","roundDomains","xAxisTickFormatting"],["ngx-charts-tooltip-template",""],["class","mt-8",4,"ngIf"],[1,"chart-tooltip","bg-gray-700","text-white","p-2","rounded","shadow-lg","text-xs"],[4,"ngIf"],["class","max-w-xs truncate",4,"ngIf"],["class","mt-1 text-indigo-300",4,"ngIf"],[1,"max-w-xs","truncate"],[1,"mt-1","text-indigo-300"],[1,"mt-8"],[1,"text-lg","font-semibold","text-gray-700","dark:text-gray-300","mb-4","border-t","pt-4","dark:border-gray-700"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-gray-200","dark:divide-gray-600"],[1,"bg-gray-50","dark:bg-gray-700"],["scope","col",1,"px-4","py-3","text-left","text-xs","font-medium","text-gray-500","dark:text-gray-400","uppercase","tracking-wider"],["scope","col","class","px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",4,"ngIf"],["scope","col",1,"relative","px-4","py-3"],[1,"sr-only"],[1,"bg-white","dark:bg-gray-800","divide-y","divide-gray-200","dark:divide-gray-700"],["class","hover:bg-gray-50 dark:hover:bg-gray-700/50",4,"ngFor","ngForOf"],[1,"hover:bg-gray-50","dark:hover:bg-gray-700/50"],[1,"px-4","py-4","whitespace-nowrap","text-sm","font-medium","text-gray-900","dark:text-gray-200"],[1,"px-4","py-4","whitespace-nowrap","text-sm","text-gray-500","dark:text-gray-300"],["class","px-4 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",4,"ngIf"],[1,"px-4","py-4","whitespace-nowrap","text-right","text-sm","font-medium"],["class","inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-focus dark:focus:ring-offset-gray-800",3,"routerLink",4,"ngIf"],[1,"inline-flex","items-center","px-3","py-1.5","border","border-transparent","text-xs","font-medium","rounded-md","shadow-sm","text-white","bg-primary","hover:bg-primary-dark","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-primary-focus","dark:focus:ring-offset-gray-800",3,"routerLink"]],template:function(e,i){e&1&&(a(0,"div",0),h("resize",function(c){return i.onResize(c)},F),a(1,"div",1)(2,"button",2),h("click",function(){return i.goBack()}),C(),a(3,"svg",3),v(4,"path",4),n()(),w(),a(5,"h1",5),l(6),n()(),u(7,se,4,0,"div",6)(8,le,7,1,"div",7)(9,ve,4,15,"div",8),n()),e&2&&(o(6),P(" ",i.currentExerciseName()," - ",i.currentPbType||"PB Trend"," "),o(),d("ngIf",i.isLoading()),o(),d("ngIf",i.errorMessage()),o(),d("ngIf",!i.isLoading()&&!i.errorMessage()&&i.chartData()))},dependencies:[Y,W,z,ne,ie,G,b],styles:["[_nghost-%COMP%]{--ngx-charts-text-color: #374151}[_nghost-%COMP%]     .ngx-charts text{fill:var(--ngx-charts-text-color)!important}[_nghost-%COMP%]     .ngx-charts .axis-label, [_nghost-%COMP%]     .ngx-charts .legend-label{fill:var(--ngx-charts-text-color)!important}.pb-chart-container[_ngcontent-%COMP%]     .ngx-charts{overflow:visible!important}  .chart-tooltip{pointer-events:none;font-size:.75rem}  .chart-tooltip strong{font-weight:600}"],changeDetection:0})};export{ae as PbTrendChartComponent};
