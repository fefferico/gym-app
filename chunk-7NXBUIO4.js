import{a as p,b as v}from"./chunk-7NIL2WQP.js";import{a as S}from"./chunk-JXRYYZHC.js";import{a as M}from"./chunk-63MC5BRW.js";import{N as g,R as V,Y as k,_ as f,ja as E,la as O,p as D,s as h}from"./chunk-QH663V6A.js";import{L as b,P as w,rd as L,z as x}from"./chunk-4G4FKAW4.js";import{g as W}from"./chunk-GAL4ENT6.js";var C=class l{cardColors=["#7f1d1d","#86198f","#4a044e","#1e1b4b","#1e3a8a","#064e3b","#14532d","#b91c1c","#c026d3","#701a75","#312e81","#2563eb","#047857","#15803d","#f97316","#ca8a04","#4d7c0f","#0f766e","#0369a1","#1d4ed8","#5b21b6"];getCardColors(){return this.cardColors}getTailwindColorClass(o){return o?{"#7f1d1d":"border-routine-red-800","#86198f":"border-routine-purple-800","#4a044e":"border-routine-purple-900","#1e1b4b":"border-routine-indigo-900","#1e3a8a":"border-routine-blue-800","#064e3b":"border-routine-green-900","#14532d":"border-routine-green-800","#b91c1c":"border-routine-red-700","#c026d3":"border-routine-purple-700","#701a75":"border-routine-purple-850","#312e81":"border-routine-indigo-800","#2563eb":"border-routine-blue-700","#047857":"border-routine-green-700","#15803d":"border-routine-green-600","#f97316":"border-routine-orange-500","#ca8a04":"border-routine-yellow-600","#4d7c0f":"border-routine-lime-700","#0f766e":"border-routine-teal-700","#0369a1":"border-routine-teal-600","#1d4ed8":"border-routine-blue-900","#5b21b6":"border-routine-violet-700"}[o]||"bg-gray-200":""}static \u0275fac=function(e){return new(e||l)};static \u0275prov=b({token:l,factory:l.\u0275fac,providedIn:"root"})};function T(l){return o=>{let n=(l?Math[l]:Math.trunc)(o);return n===0?0:n}}function I(l,o,e){let n=V(l,o,e)/7;return T(e?.roundingMethod)(n)}var A=class l{exerciseService=w(O);translate=w(L);muscleService=w(E);constructor(){}calculateSetVolume(o){return(D(o.repsLogged)||0)*(h(o.weightLogged)||0)}calculateWorkoutVolume(o){let e=0;return o.exercises.forEach(n=>{n.sets.forEach(a=>{e+=this.calculateSetVolume(a)})}),e}calculateTotalVolumeForAllLogs(o){return o.reduce((e,n)=>e+this.calculateWorkoutVolume(n),0)}getWeeklySummaries(o){if(!o||o.length===0)return[];let e={};o.forEach(a=>{let r=f(a.date),t=g(r,{weekStartsOn:1}),s=p(r,{weekStartsOn:1}),u=k(t,"yyyy-MM-dd");e[u]||(e[u]={logs:[],startDate:t,endDate:s}),e[u].logs.push(a)});let n=this.translate.instant("statsService.weekOf");return Object.entries(e).map(([a,r])=>{let t=this.calculateTotalVolumeForAllLogs(r.logs);return{weekLabel:`${n} ${k(r.startDate,"MMM d")}`,workoutCount:r.logs.length,totalVolume:t,weekStartDate:r.startDate,weekEndDate:r.endDate}}).sort((a,r)=>r.weekStartDate.getTime()-a.weekStartDate.getTime())}calculateTotalVolume(o){return o.exercises.reduce((e,n)=>{let a=n.sets.reduce((r,t)=>r+(h(t.weightLogged)??0)*(D(t.repsLogged)??0),0);return e+a},0)}getWeeklyVolumeForChart(o){if(!o||o.length===0)return[];let e={},n=this.translate.instant("statsService.weekPrefix");return o.forEach(r=>{let t=f(r.date),s=g(t,{weekStartsOn:1}),u=k(s,"yyyy-MM-dd");e[u]||(e[u]={totalVolume:0,weekLabel:`${n}${k(s,"w")} '${k(s,"yy")}`}),e[u].totalVolume+=this.calculateTotalVolume(r)}),Object.keys(e).sort((r,t)=>new Date(r).getTime()-new Date(t).getTime()).map(r=>({date:f(r),weekLabel:e[r].weekLabel,totalVolume:e[r].totalVolume}))}getPerformanceByMuscleGroup(o){return W(this,null,function*(){if(!o||o.length===0)return[];let e=new Map,a=(yield new Promise(t=>{this.exerciseService.getHydratedExercises().pipe(x(1)).subscribe(s=>t(s))})).map(t=>this.exerciseService.mapHydratedExerciseToExercise(t)),r=new Map(a.map(t=>[t.id,t]));return o.forEach(t=>{let s=new Set;t.exercises.forEach(u=>{let m=r.get(u.exerciseId);if(m&&m.muscleGroups){let i=u.sets.reduce((c,d)=>c+this.calculateSetVolume(d),0);m.muscleGroups.forEach(c=>{c.includes("flexors")&&console.log("here");let d=this.translate.instant("muscles."+this.muscleService.getCanonicalMuscleId(c.toLowerCase().trim()));e.has(d)||e.set(d,{volume:0,workoutCountSet:new Set});let y=e.get(d);y.volume+=i,s.add(d)})}}),s.forEach(u=>{e.get(u)?.workoutCountSet.add(t.id)})}),Array.from(e.entries()).map(([t,s])=>({muscleGroup:t,volume:Math.round(s.volume),workoutCount:s.workoutCountSet.size})).sort((t,s)=>s.volume-t.volume)})}calculateCurrentWorkoutStreak(o,e){let n=[...o.map(c=>f(c.date)),...e.map(c=>f(c.date))];if(n.length===0)return{length:0};n.sort((c,d)=>d.getTime()-c.getTime());let a=new Date,r=g(a,{weekStartsOn:1}),t=0,s,u=n[0],m=v(a,7);if(!S(u,a,{weekStartsOn:1})&&!S(u,m,{weekStartsOn:1}))return{length:0};for(let c=0;c<260&&n.some(y=>S(y,r,{weekStartsOn:1}));c++)s||(s=p(r,{weekStartsOn:1})),t++,r=v(r,7);if(t===0)return{length:0};let i=g(M(r,7),{weekStartsOn:1});return{length:t,startDate:i,endDate:s}}calculateLongestWorkoutStreak(o,e){let n=[...o.map(i=>f(i.date)),...e.map(i=>f(i.date))];if(n.length<2)return this.calculateCurrentWorkoutStreak(o,e);let a=Array.from(new Set(n.map(i=>k(g(i,{weekStartsOn:1}),"yyyy-MM-dd")))).map(i=>new Date(i)).sort((i,c)=>i.getTime()-c.getTime());if(a.length===0)return{length:0};let r=0,t=0,s,u,m;for(let i=0;i<a.length;i++)if(i===0)t=1,m=a[i];else{let c=a[i-1],d=a[i];I(d,c)===1?t++:(t>r&&(r=t,s=m,u=p(c,{weekStartsOn:1})),t=1,m=d)}return t>r&&(r=t,s=m,u=p(a[a.length-1],{weekStartsOn:1})),{length:r,startDate:s,endDate:u}}static \u0275fac=function(e){return new(e||l)};static \u0275prov=b({token:l,factory:l.\u0275fac,providedIn:"root"})};export{C as a,A as b};
