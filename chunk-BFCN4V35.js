import{$c as v,E as M,H as R,J as T,N as F,R as S,Tc as V,Uc as _,Vc as j,Xc as U,Zc as H,_c as k,a as g,ad as A,b as m,g as h,k as P,p as b,qc as w,r as N,s as f,t as L}from"./chunk-W4Y6YFX6.js";function B(c){let e=v(c),r=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return r.setUTCFullYear(e.getFullYear()),+c-+r}function D(c,...e){let r=k.bind(null,c||e.find(o=>typeof o=="object"));return e.map(r)}function W(c,e){let r=v(c,e?.in);return r.setHours(0,0,0,0),r}function $(c,e,r){let[o,t]=D(r?.in,c,e),a=W(o),n=W(t),i=+a-B(a),s=+n-B(n);return Math.round((i-s)/H)}function x(c,e,r){let[o,t]=D(r?.in,c,e),a=E(o,t),n=Math.abs($(o,t));o.setDate(o.getDate()-a*n);let i=+(E(o,t)===-a),s=a*(n-i);return s===0?0:s}function E(c,e){let r=c.getFullYear()-e.getFullYear()||c.getMonth()-e.getMonth()||c.getDate()-e.getDate()||c.getHours()-e.getHours()||c.getMinutes()-e.getMinutes()||c.getSeconds()-e.getSeconds()||c.getMilliseconds()-e.getMilliseconds();return r<0?-1:r>0?1:r}function C(c,e){let[r,o]=D(c,e.start,e.end);return{start:r,end:o}}function G(c,e){let{start:r,end:o}=C(e?.in,c),t=+r>+o,a=t?+r:+o,n=t?o:r;n.setHours(0,0,0,0);let i=e?.step??1;if(!i)return[];i<0&&(i=-i,t=!t);let s=[];for(;+n<=a;)s.push(k(r,n)),n.setDate(n.getDate()+i),n.setHours(0,0,0,0);return t?s.reverse():s}function I(c,e){return v(c,e?.in).getDay()}var Y=[{id:"7fefb7b9-040f-4043-a1ad-9e9540cb744a",name:"Tonificazione 3",goals:["skill acquisition","power / explosiveness","tabata","muscular endurance","fat loss / body composition"],description:"",programNotes:void 0,startDate:"2025-07-01",cycleLength:void 0,schedule:[{id:"444d2b71-464d-4bbc-8870-761746a90b8d",dayOfWeek:2,routineId:"toning-3-giorno-1",routineName:"Toning 3 - Day 1",notes:"",timeOfDay:"",programId:"7fefb7b9-040f-4043-a1ad-9e9540cb744a"},{id:"15374416-5f25-4f1f-ada7-ebf9aa263df7",dayOfWeek:4,routineId:"toning-3-giorno-2",routineName:"Toning 3 - Day 2",notes:"",timeOfDay:"",programId:"7fefb7b9-040f-4043-a1ad-9e9540cb744a"}],programType:"cycled",isActive:!0},{id:"prog-beginner-3day-v1",name:"Beginner Full-Body Foundation",goals:["strength","hypertrophy","beginner","muscle building"],description:"A 3-day per week program perfect for those new to weight training. You will alternate between two full-body workouts (A and B) to build a solid foundation of strength and muscle across your entire body.",programNotes:"Focus on proper form before increasing weight. The goal is consistency. In week 2, you will perform B-A-B.",startDate:void 0,cycleLength:14,schedule:[{id:"sch-beg-1",dayOfWeek:1,routineId:"beginner-workout-v1-a",routineName:"Beginner Weight Training - Workout A (V1)",notes:"Workout A",timeOfDay:"",programId:"prog-beginner-3day-v1"},{id:"sch-beg-2",dayOfWeek:3,routineId:"beginner-workout-v1-b",routineName:"Beginner Weight Training - Workout B (V1)",notes:"Workout B",timeOfDay:"",programId:"prog-beginner-3day-v1"},{id:"sch-beg-3",dayOfWeek:5,routineId:"beginner-workout-v1-a",routineName:"Beginner Weight Training - Workout A (V1)",notes:"Workout A",timeOfDay:"",programId:"prog-beginner-3day-v1"}],programType:"cycled",isActive:!1},{id:"prog-hypertrophy-4day-v1",name:"Classic Upper/Lower Hypertrophy",goals:["hypertrophy","strength","muscle building"],description:"A classic 4-day upper/lower split designed to maximize muscle growth (hypertrophy). Each major muscle group is trained twice a week with a focus on volume and intensity to stimulate growth.",programNotes:"Ensure you are eating in a caloric surplus to support muscle growth. Rest days on Wednesday, Saturday, and Sunday are crucial for recovery.",startDate:void 0,cycleLength:7,schedule:[{id:"sch-hyper-1",dayOfWeek:1,routineId:"muscle-building-v1-upper-a",routineName:"Muscle Building - Upper Body A (V1)",notes:"Upper Body - Chest & Back focus",timeOfDay:"",programId:"prog-hypertrophy-4day-v1"},{id:"sch-hyper-2",dayOfWeek:2,routineId:"muscle-building-v1-lower-a",routineName:"Muscle Building - Lower Body A (V1)",notes:"Lower Body - Hamstring & Glute focus",timeOfDay:"",programId:"prog-hypertrophy-4day-v1"},{id:"sch-hyper-3",dayOfWeek:4,routineId:"muscle-building-v1-upper-b",routineName:"Muscle Building - Upper Body B (V1)",notes:"Upper Body - Shoulders & Arms focus",timeOfDay:"",programId:"prog-hypertrophy-4day-v1"},{id:"sch-hyper-4",dayOfWeek:5,routineId:"muscle-building-v1-lower-b",routineName:"Muscle Building - Lower Body B (V1)",notes:"Lower Body - Squat pattern focus",timeOfDay:"",programId:"prog-hypertrophy-4day-v1"}],programType:"cycled",isActive:!1},{id:"prog-gpp-kettlebell-3day",name:"Functional Kettlebell GPP",goals:["GPP","functional strength","muscular endurance","power / explosiveness"],description:"A 3-day program focused on building General Physical Preparedness (GPP). It combines intense, kettlebell-centric workouts for the upper body with a heavy leg day to forge well-rounded functional strength and conditioning.",programNotes:"These workouts are intense. Do not be afraid to use a lighter kettlebell to maintain form, especially on the arm and shoulder days.",startDate:void 0,cycleLength:7,schedule:[{id:"sch-gpp-1",dayOfWeek:1,routineId:"f4f6e3c1-4b7e-4b1e-8c3b-2f1a6e9a0b1d",routineName:"Build 3-Dimensional Shoulders",notes:"Focus on shoulder stability and endurance.",timeOfDay:"",programId:"prog-gpp-kettlebell-3day"},{id:"sch-gpp-2",dayOfWeek:3,routineId:"muscle-building-v1-lower-b",routineName:"Muscle Building - Lower Body B (V1)",notes:"Strength and power for the lower body.",timeOfDay:"",programId:"prog-gpp-kettlebell-3day"},{id:"sch-gpp-3",dayOfWeek:5,routineId:"b3c4d5e6-1",routineName:"50 Rep Kettlebell Arm Blaster",notes:"High-volume arm workout for muscular endurance.",timeOfDay:"",programId:"prog-gpp-kettlebell-3day"}],programType:"cycled",isActive:!1},{id:"prog-fatloss-5day-hiit",name:"High-Intensity Fat Loss Circuit",goals:["fat loss / body composition","muscular endurance","cardio","tabata"],description:"A 5-day high-frequency program designed for maximum fat loss and metabolic conditioning. It alternates total-body toning days with brutally intense Tabata circuits to keep your metabolism elevated all week.",programNotes:"Recovery is key. Ensure adequate sleep and nutrition to handle the high frequency of this program. The Tabata days are meant to be performed with maximum intensity.",startDate:void 0,cycleLength:7,schedule:[{id:"sch-fatloss-1",dayOfWeek:1,routineId:"toning-3-giorno-1",routineName:"Toning 3 - Day 1",timeOfDay:"",programId:"prog-fatloss-5day-hiit"},{id:"sch-fatloss-2",dayOfWeek:2,routineId:"a2b3c4d5-1",routineName:"BRUTALLY Intense 4 Minute Kettlebell Fat Loss Routine",timeOfDay:"",programId:"prog-fatloss-5day-hiit"},{id:"sch-fatloss-3",dayOfWeek:3,routineId:"toning-3-giorno-2",routineName:"Toning 3 - Day 2",timeOfDay:"",programId:"prog-fatloss-5day-hiit"},{id:"sch-fatloss-4",dayOfWeek:4,routineId:"a2b3c4d5-1",routineName:"BRUTALLY Intense 4 Minute Kettlebell Fat Loss Routine",timeOfDay:"",programId:"prog-fatloss-5day-hiit"},{id:"sch-fatloss-5",dayOfWeek:5,routineId:"toning-3-giorno-1",routineName:"Toning 3 - Day 1",timeOfDay:"",programId:"prog-fatloss-5day-hiit"}],programType:"cycled",isActive:!1},{id:"prog-advanced-hypertrophy-4day",name:"Advanced Hypertrophy (Superset Focus)",goals:["hypertrophy","advanced","muscular endurance"],description:"An advanced 4-day upper/lower split for experienced lifters. This program utilizes supersets to increase workout density, intensity, and metabolic stress, helping to push past plateaus and stimulate new muscle growth.",programNotes:"This is a high-volume, high-intensity program. It is not recommended for beginners. Ensure your recovery and nutrition are dialed in.",startDate:void 0,cycleLength:7,schedule:[{id:"sch-advhyper-1",dayOfWeek:2,routineId:"muscle-building-v4-upper-a",routineName:"Muscle Building - Upper Body A (V4)",timeOfDay:"",programId:"prog-advanced-hypertrophy-4day"},{id:"sch-advhyper-2",dayOfWeek:3,routineId:"muscle-building-v4-lower-a",routineName:"Muscle Building - Lower Body A (V4)",timeOfDay:"",programId:"prog-advanced-hypertrophy-4day"},{id:"sch-advhyper-3",dayOfWeek:5,routineId:"muscle-building-v4-upper-b",routineName:"Muscle Building - Upper Body B (V4)",timeOfDay:"",programId:"prog-advanced-hypertrophy-4day"},{id:"sch-advhyper-4",dayOfWeek:6,routineId:"muscle-building-v4-lower-b",routineName:"Muscle Building - Lower Body B (V4)",timeOfDay:"",programId:"prog-advanced-hypertrophy-4day"}],programType:"cycled",isActive:!1},{id:"prog-strength-5x5-inspired-3day",name:"Starting Strength Inspired (3-Day)",goals:["strength","beginner","muscle building"],description:"Inspired by classic 3-day full-body programs like 5x5, this schedule uses two alternating workouts to drive progress on core compound lifts. While it uses a 3x10 rep scheme from the base routines, the focus is on linear progression: consistently adding a small amount of weight to the bar each week.",programNotes:"Alternate Workout A and B every time you train. Week 1 is A-B-A. Week 2 will be B-A-B. Your number one goal is to add a little weight to your main lifts each session.",startDate:void 0,cycleLength:14,schedule:[{id:"sch-5x5-1",dayOfWeek:1,routineId:"beginner-workout-v1-a",routineName:"Beginner Weight Training - Workout A (V1)",timeOfDay:"",programId:"prog-strength-5x5-inspired-3day"},{id:"sch-5x5-2",dayOfWeek:3,routineId:"beginner-workout-v1-b",routineName:"Beginner Weight Training - Workout B (V1)",timeOfDay:"",programId:"prog-strength-5x5-inspired-3day"},{id:"sch-5x5-3",dayOfWeek:5,routineId:"beginner-workout-v1-a",routineName:"Beginner Weight Training - Workout A (V1)",timeOfDay:"",programId:"prog-strength-5x5-inspired-3day"}],programType:"cycled",isActive:!1},{id:"prog-strength-531-inspired-4day",name:"5/3/1 Structure Inspired (4-Day)",goals:["strength","hypertrophy","intermediate"],description:"This program is structured like Jim Wendler's 5/3/1, dedicating each day to one main compound lift followed by accessory work. While it doesn't use the specific 5/3/1 percentage and rep schemes, it follows the proven principle of focusing your energy on one heavy lift per session for consistent strength gains.",programNotes:"The main lift is the first exercise of each routine. Focus on progressive overload on this lift over a 4-6 week cycle.",startDate:void 0,cycleLength:7,schedule:[{id:"sch-531-1",dayOfWeek:1,routineId:"wendler-531-day1-ohp",routineName:"5/3/1 - Overhead Press Day",notes:"Main Lift: Overhead Press",timeOfDay:"",programId:"prog-strength-531-inspired-4day"},{id:"sch-531-2",dayOfWeek:2,routineId:"wendler-531-day2-deadlift",routineName:"5/3/1 - Deadlift Day",notes:"Main Lift: Deadlift",timeOfDay:"",programId:"prog-strength-531-inspired-4day"},{id:"sch-531-3",dayOfWeek:4,routineId:"wendler-531-day3-bench",routineName:"5/3/1 - Bench Press Day",notes:"Main Lift: Bench Press",timeOfDay:"",programId:"prog-strength-531-inspired-4day"},{id:"sch-531-4",dayOfWeek:5,routineId:"wendler-531-day4-squat",routineName:"5/3/1 - Squat Day",notes:"Main Lift: Squat",timeOfDay:"",programId:"prog-strength-531-inspired-4day"}],programType:"cycled",isActive:!1},{id:"prog-athletic-performance-4day",name:"Athletic Performance (4-Day)",goals:["power / explosiveness","GPP","functional strength","strength"],description:"A 4-day program for athletes looking to improve overall performance. It balances two heavy strength days with two days focused on explosive power, conditioning, and functional movement patterns using kettlebells and high-intensity circuits.",programNotes:"The goal on strength days is moving heavy weight with good form. The goal on conditioning days is high work-rate and intensity.",startDate:void 0,cycleLength:7,schedule:[{id:"sch-ath-1",dayOfWeek:1,routineId:"muscle-building-v2-lower-b",routineName:"Muscle Building - Lower Body B (V2)",notes:"Maximal Strength & Power",timeOfDay:"",programId:"prog-athletic-performance-4day"},{id:"sch-ath-2",dayOfWeek:2,routineId:"muscle-building-v2-upper-a",routineName:"Muscle Building - Upper Body A (V2)",notes:"Upper Body Strength",timeOfDay:"",programId:"prog-athletic-performance-4day"},{id:"sch-ath-3",dayOfWeek:4,routineId:"f4f6e3c1-4b7e-4b1e-8c3b-2f1a6e9a0b1d",routineName:"Build 3-Dimensional Shoulders",notes:"Kettlebell Power & Conditioning",timeOfDay:"",programId:"prog-athletic-performance-4day"},{id:"sch-ath-4",dayOfWeek:5,routineId:"toning-3-giorno-2",routineName:"Toning 3 - Day 2",notes:"General Physical Preparedness (GPP)",timeOfDay:"",programId:"prog-athletic-performance-4day"}],programType:"cycled",isActive:!1},{id:"prog-time-crunched-3day",name:"Time-Crunched Pro (3-Day)",goals:["GPP","muscular endurance","hypertrophy"],description:"A 3-day program for busy individuals who want maximum results in minimum time. It uses a full-body approach with a mix of heavy lifting and higher-rep toning work to cover all bases efficiently.",programNotes:"Focus on keeping rest periods strict to get the workout done in a timely manner.",startDate:void 0,cycleLength:7,schedule:[{id:"sch-tc-1",dayOfWeek:1,routineId:"beginner-workout-v2-a",routineName:"Beginner Weight Training - Workout A (V2)",timeOfDay:"",programId:"prog-time-crunched-3day"},{id:"sch-tc-2",dayOfWeek:3,routineId:"beginner-workout-v2-b",routineName:"Beginner Weight Training - Workout B (V2)",timeOfDay:"",programId:"prog-time-crunched-3day"},{id:"sch-tc-3",dayOfWeek:5,routineId:"toning-3-giorno-1",routineName:"Toning 3 - Day 1",timeOfDay:"",programId:"prog-time-crunched-3day"}],programType:"cycled",isActive:!1},{id:"prog-bodybuilding-5day-split",name:"Advanced Bodybuilding Split (5-Day)",goals:["hypertrophy","muscle building","advanced"],description:"A high-volume, 5-day split for the serious bodybuilder. This program follows an Upper/Lower split for four days and adds a fifth day dedicated to blasting the arms for maximum growth.",programNotes:"This is an advanced program. Ensure your nutrition, sleep, and recovery are optimal to handle the volume.",startDate:void 0,cycleLength:7,schedule:[{id:"sch-bb-1",dayOfWeek:1,routineId:"muscle-building-v3-upper-a",routineName:"Muscle Building - Upper Body A (V3)",notes:"Upper Body Volume",timeOfDay:"",programId:"prog-bodybuilding-5day-split"},{id:"sch-bb-2",dayOfWeek:2,routineId:"muscle-building-v3-lower-a",routineName:"Muscle Building - Lower Body A (V3)",notes:"Lower Body Volume",timeOfDay:"",programId:"prog-bodybuilding-5day-split"},{id:"sch-bb-3",dayOfWeek:4,routineId:"muscle-building-v3-upper-b",routineName:"Muscle Building - Upper Body B (V3)",notes:"Upper Body Strength",timeOfDay:"",programId:"prog-bodybuilding-5day-split"},{id:"sch-bb-4",dayOfWeek:5,routineId:"muscle-building-v3-lower-b",routineName:"Muscle Building - Lower Body B (V3)",notes:"Lower Body Strength",timeOfDay:"",programId:"prog-bodybuilding-5day-split"},{id:"sch-bb-5",dayOfWeek:6,routineId:"b3c4d5e6-1",routineName:"50 Rep Kettlebell Arm Blaster",notes:"Arm Specialization Day",timeOfDay:"",programId:"prog-bodybuilding-5day-split"}],programType:"cycled",isActive:!1},{id:"prog-strength-5x5-classic-3day",name:"Classic 5x5 Strength Program",goals:["strength","muscle building","beginner","powerlifting"],description:"A classic and highly effective 3-day strength program for beginners. This program is built on the principle of linear progression, focusing on getting stronger in the most important compound lifts by alternating two full-body workouts (A and B).",programNotes:"The schedule is 3 non-consecutive days a week (e.g., Mon/Wed/Fri). You alternate workouts each session. Week 1: A, B, A. Week 2: B, A, B. Your primary goal is to add a small amount of weight to each exercise in every workout.",startDate:void 0,cycleLength:14,schedule:[{id:"sch-5x5-classic-1",dayOfWeek:1,routineId:"5x5-workout-a",routineName:"5x5 Strength - Workout A",timeOfDay:"",programId:"prog-strength-5x5-classic-3day"},{id:"sch-5x5-classic-2",dayOfWeek:3,routineId:"5x5-workout-b",routineName:"5x5 Strength - Workout B",timeOfDay:"",programId:"prog-strength-5x5-classic-3day"},{id:"sch-5x5-classic-3",dayOfWeek:5,routineId:"5x5-workout-a",routineName:"5x5 Strength - Workout A",timeOfDay:"",programId:"prog-strength-5x5-classic-3day"}],programType:"cycled",isActive:!1}];var z=class c{storageService=S(_);workoutService=S(U);alertService=S(V);toastService=S(j);PROGRAMS_STORAGE_KEY="fitTrackPro_trainingPrograms";programsSubject=new P(this._loadProgramsFromStorage());programs$=this.programsSubject.asObservable();isLoadingProgramsSubject=new P(!0);isLoadingPrograms$=this.isLoadingProgramsSubject.asObservable();constructor(){this.isLoadingProgramsSubject.next(!0);let e=this._loadProgramsFromStorage();this.programsSubject=new P(e),this.programs$=this.programsSubject.asObservable().pipe(R(1)),this._seedAndMergeProgramsFromStaticData(e)}_loadProgramsFromStorage(){let e=this.storageService.getItem(this.PROGRAMS_STORAGE_KEY);return e||[]}_saveProgramsToStorage(e){this.storageService.setItem(this.PROGRAMS_STORAGE_KEY,e),this.programsSubject.next([...e])}_seedAndMergeProgramsFromStaticData(e){try{let r=Y.map(a=>m(g({},a),{programType:a.programType==="cycled"?"cycled":"linear"})),o=new Set(e.map(a=>a.id)),t=r.filter(a=>!o.has(a.id));if(t.length>0){console.log(`Seeding ${t.length} new training programs from static data`);let a=[...e,...t];this._saveProgramsToStorage(a)}else console.log("No new training programs to seed. All default programs are present in storage")}catch(r){console.error("Failed to process or seed training programs from static data:",r)}finally{this.isLoadingProgramsSubject.next(!1)}}getAllPrograms(){return this.programs$}getProgramsByRoutineId(e){return e?this.programs$.pipe(f(r=>r.filter(o=>o.schedule.some(t=>t.routineId===e)))):b([])}getProgramById(e){return this.programs$.pipe(f(r=>{let o=r.find(t=>t.id===e);if(o&&Array.isArray(o.history)){let t=[...o.history].sort((a,n)=>(n.date?new Date(n.date).getTime():0)-(a.date?new Date(a.date).getTime():0));return m(g({},o),{history:t})}return o}))}addProgram(e){return h(this,null,function*(){let r=this.programsSubject.getValue(),o=m(g({},e),{id:w(),isActive:!1,schedule:e.schedule.map(a=>m(g({},a),{id:w()}))}),t=[...r,o];return this._saveProgramsToStorage(t),this.toastService.success(`Program "${o.name}" created.`,3e3,"Program Created"),o})}updateProgram(e){return h(this,null,function*(){let r=this.programsSubject.getValue(),o=r.findIndex(t=>t.id===e.id);if(o>-1){let t=e.schedule.map(i=>m(g({},i),{id:i.id||w()})),a=m(g({},e),{schedule:t}),n=[...r];return n[o]=a,this._saveProgramsToStorage(n),this.toastService.success(`Program "${a.name}" updated.`,3e3,"Program Updated"),a}this.toastService.error(`Program with ID ${e.id} not found.`,0,"Update Error")})}deleteProgram(e){return h(this,null,function*(){let r=yield N(this.getProgramById(e).pipe(M(1)));if(!r){this.toastService.error("Program not found",0,"Delete Error");return}let o=yield this.alertService.showConfirmationDialog("Delete Program",`Are you sure you want to delete the program "${r.name}"? This action cannot be undone.`,[{text:"Cancel",role:"cancel",data:!1,cssClass:"bg-gray-400 hover:bg-gray-600",icon:"cancel"},{text:"Delete Program",role:"confirm",data:!0,cssClass:"bg-primary hover:bg-primary-dark",icon:"done"}]);if(o&&o.data){let a=this.programsSubject.getValue().filter(n=>n.id!==e);this._saveProgramsToStorage(a),this.toastService.info(`Program "${r.name}" deleted.`,3e3,"Program Deleted")}})}toggleProgramActivation(e,r="completed"){return h(this,null,function*(){let t=this.programsSubject.getValue().find(i=>i.id===e);if(!t){this.toastService.error("Program not found to update",0,"Update Error");return}let a=new Date().toISOString();this.updateProgramHistory(e,r,a);let n=this.programsSubject.getValue().map(i=>i.id===e?m(g({},i),{isActive:!i.isActive,startDate:r==="active"?a:i.startDate,endDate:r==="completed"||r==="cancelled"?a:"-"}):i);if(this._saveProgramsToStorage(n),!t.isActive)this.toastService.success(`Program "${t.name}" is now active.`,3e3,"Program Activated");else{let i="";switch(r){case"completed":i=`Program "${t.name}" marked as completed.`;break;case"archived":i=`Program "${t.name}" archived.`;break;case"cancelled":i=`Program "${t.name}" cancelled.`;break;default:i=`Program "${t.name}" deactivated.`;break}this.toastService.info(i,3e3,"Program Status Updated")}})}deactivateAllPrograms(){return h(this,null,function*(){let e=this.programsSubject.getValue();if(e.length>0){let r=e.map(o=>m(g({},o),{isActive:!1}));this._saveProgramsToStorage(r)}})}deactivateProgram(e,r="completed"){return h(this,null,function*(){let t=this.programsSubject.getValue().find(n=>n.id===e);if(!t){this.toastService.error("Program not found to deactivate",0,"Deactivation Error");return}if(!t.isActive){this.toastService.info(`Program "${t.name}" is already inactive.`,3e3,"Already Inactive");return}this.updateProgramHistory(e,r);let a=this.programsSubject.getValue().map(n=>n.id===e?m(g({},n),{isActive:!1}):n);this._saveProgramsToStorage(a),this.toastService.info(`Program "${t.name}" has been deactivated.`,3e3,"Program Deactivated")})}getActiveProgram(){return this.programs$.pipe(f(e=>e.find(r=>r.isActive)))}getActivePrograms(){return this.programs$.pipe(f(e=>e.filter(r=>r.isActive)))}getDataForBackup(){return this.programsSubject.getValue()}mergeData(e){if(!Array.isArray(e)){console.error("TrainingProgramService: Imported data for programs is not an array."),this.toastService.error("Import failed: Invalid program data file.",0,"Import Error");return}let r=this.programsSubject.getValue(),o=new Map(r.map(i=>[i.id,i])),t=0,a=0;e.forEach(i=>{if(!i.id||!i.name){console.warn("Skipping invalid program during import:",i);return}o.has(i.id)?t++:a++,o.set(i.id,i)});let n=Array.from(o.values());this._saveProgramsToStorage(n),console.log(`TrainingProgramService: Merged imported data. Updated: ${t}, Added: ${a}`),this.toastService.success(`Import complete. ${t} programs updated, ${a} added.`,6e3,"Programs Merged")}findRoutineForDayInProgram(e,r){if(!r||!r.schedule||r.schedule.length===0)return null;let o;if(r.cycleLength&&r.cycleLength>0&&r.startDate){let t=A(r.startDate);if(e<t)return null;let a=Math.abs(e.getTime()-t.getTime()),i=Math.floor(a/(1e3*60*60*24))%r.cycleLength+1;o=r.schedule.find(s=>s.dayOfWeek===i)}else{let t=I(e);o=r.schedule.find(a=>a.dayOfWeek===t)}if(o){let t=this.workoutService.getRoutineByIdSync(o.routineId);if(t)return{routine:t,scheduledDayInfo:o}}return null}getRoutineForDay(e){return this.getActiveProgram().pipe(T(r=>{if(!r)return b(null);let o;if(r.cycleLength&&r.cycleLength>0&&r.startDate){let a=new Date(r.startDate),n=Math.abs(e.getTime()-a.getTime()),s=Math.floor(n/(1e3*60*60*24))%r.cycleLength+1;o=d=>d.dayOfWeek===Number(s)}else{let a=I(e);o=n=>n.dayOfWeek===Number(a)}let t=r.schedule.find(o);return t?this.workoutService.getRoutineById(t.routineId).pipe(f(a=>a?{routine:a,scheduledDayInfo:t}:(console.warn(`Routine with ID ${t.routineId} not found for scheduled day`),null))):b(null)}))}getScheduledRoutinesForDateRange(e,r){return this.getActiveProgram().pipe(T(o=>{if(!o||!o.schedule||o.schedule.length===0)return b([]);let t=[],a=new Date(e);for(;a<=r;){let n,i=new Date(a);if(o.cycleLength&&o.cycleLength>0&&o.startDate){let d=new Date(o.startDate),l=Math.abs(i.getTime()-d.getTime()),u=i>=d?Math.floor(l/(1e3*60*60*24)):-1;if(u>=0){let y=u%o.cycleLength+1;n=p=>p.dayOfWeek===y}else n=()=>!1}else{let d=I(i);n=l=>l.dayOfWeek===d}let s=o.schedule.find(n);s&&t.push(this.workoutService.getRoutineById(s.routineId).pipe(f(d=>d?{date:i,routine:d,scheduledDayInfo:s}:null))),a.setDate(a.getDate()+1)}return t.length===0?b([]):L(t).pipe(f(n=>n.filter(i=>i!==null)))}))}getScheduledRoutinesForDateRangeByProgramId(e,r,o){return this.getProgramById(e).pipe(f(t=>{if(!t||!t.schedule?.length&&!t.weeks?.length)return[];let a=G({start:r,end:o}),n=[],i=t.startDate?A(t.startDate):new Date(1970,0,1);if(t.programType==="linear"&&t.weeks?.length)a.forEach(s=>{if(s<i)return;let d=x(s,i);if(d<0)return;let l=Math.floor(d/7),u=t.weeks[l];if(u){let y=I(s),p=u.schedule.find(O=>O.dayOfWeek===y);p&&n.push({date:s,scheduledDayInfo:p})}});else if(t.programType==="cycled"&&t.schedule?.length){let s=t.cycleLength&&t.cycleLength>0?t.cycleLength:7,d=new Map;t.schedule.forEach(l=>{let u=l.dayOfWeek;d.set(u,l)}),a.forEach(l=>{if(l<i)return;let u;if(s===7){let y=I(l);u=d.get(y)}else{let p=x(l,i)%s+1;u=d.get(p)}u&&n.push({date:l,scheduledDayInfo:u})})}return n}))}updateProgramHistory(e,r,o,t){return h(this,null,function*(){let a=this.programsSubject.getValue(),n=a.findIndex(u=>u.id===e);if(n===-1){this.toastService.error("Program not found to update history",0,"Update Error");return}let i=a[n],s=Array.isArray(i.history)?[...i.history]:[],d;if(typeof r=="object"&&r.id){let u=s.findIndex(y=>y.id===r.id);if(u!==-1){s[u]=g(g({},s[u]),r);let y=s.some(p=>p.status==="active");d=m(g({},i),{history:s,isActive:y}),this.toastService.success("History entry updated.",3e3,"History Updated")}else{this.toastService.error("History entry not found to update.",0,"Update Error");return}}else if(typeof r=="string"){let u=r;if(!i.startDate&&u!=="active"){this.toastService.error("Program does not have a 'starting date'",0,"Finish Error");return}let y=new Date().toISOString(),p=s.findIndex(O=>O.status==="active");p!==-1?s[p]=m(g({},s[p]),{endDate:t||(u==="active"?"-":y),status:u,date:new Date().toISOString()}):s.push({endDate:t||(u==="active"?"-":y),programId:i.id,id:w(),startDate:o||i.startDate,date:new Date().toISOString(),status:u}),d=m(g({},i),{history:s})}else{console.error("Invalid call to updateProgramHistory");return}let l=[...a];l[n]=d,this._saveProgramsToStorage(l)})}removeProgramHistoryEntry(e,r){return h(this,null,function*(){let o=this.programsSubject.getValue(),t=o.find(d=>d.id===e);if(!t){this.toastService.error("Program not found",0,"Remove History Error");return}let a=(t.history||[]).filter(d=>d.id!==r),n=t.isActive;if(t.history&&t.history.length>0){let d=t.history.find(l=>l.id===r);d&&d.status==="active"&&(n=!1)}let i=m(g({},t),{history:a,isActive:n}),s=o.map(d=>d.id===e?i:d);this._saveProgramsToStorage(s),this.toastService.success("History entry removed.",3e3,"History Updated")})}static \u0275fac=function(r){return new(r||c)};static \u0275prov=F({token:c,factory:c.\u0275fac,providedIn:"root"})};export{D as a,W as b,$ as c,x as d,G as e,z as f};
