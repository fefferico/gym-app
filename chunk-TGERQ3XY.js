import{j as S,n as g}from"./chunk-257RQBZP.js";import{$ as P,M as d,Pc as h,Q as m,Qc as y,e as f,p as v}from"./chunk-MSHJ7S43.js";import{a as i,b as n,g as b}from"./chunk-GAL4ENT6.js";var p=class u{storageService=m(y);alertService=m(h);USER_PROFILE_KEY="fitTrackPro_userProfile";IS_WIP=!0;userProfileSubject;userProfile$;username=P(void 0);isPremium=P(!1);constructor(){let e=this.storageService.getItem(this.USER_PROFILE_KEY);this.userProfileSubject=new f(e),this.userProfile$=this.userProfileSubject.asObservable(),this.userProfile$.subscribe(r=>{this.username.set(r?.username),this.isPremium.set(r?.isPremium??!1)}),this.showWipDisclaimer(),this.migrateLegacyMeasurements()}updatePremiumStatus(e){let r=this.getProfile()||{};this.saveProfile(n(i({},r),{isPremium:e}))}showWipDisclaimer(){return b(this,null,function*(){if(this.IS_WIP&&!this.getHideWipDisclaimer()){let e=yield this.alertService.present({header:"Work-in-Progress Disclaimer",message:"DISCLAIMER: This is a work-in-progress, browser-based app. This means your workout data won't be saved when you close the browser or clear your browser data. Be sure to regularly export your data and import it again when you return to the app.",backdropDismiss:!1,inputs:[{type:"checkbox",name:"hideDisclaimer",label:"Don't show this message again",value:!1}],buttons:[{text:"OK",role:"confirm"}]});e?.role==="confirm"&&e.values?.hideDisclaimer&&this.updateHideWipDisclaimer(!0)}})}getHideWipDisclaimer(){return this.userProfileSubject.getValue()?.hideWipDisclaimer??!1}updateHideWipDisclaimer(e){let r=this.getProfile()||{};this.saveProfile(n(i({},r),{hideWipDisclaimer:e}))}getProfile(){return this.userProfileSubject.getValue()}getUsername(){return this.userProfileSubject.getValue()?.username}updateUsername(e){let r=this.getProfile()||{};this.saveProfile(n(i({},r),{username:e}))}updateMeasurements(e){let r=this.getProfile()||{},t=i(i({},r.measurements||{}),e);this.saveProfile(n(i({},r),{measurements:t}))}updateGender(e){let r=this.getProfile()||{};this.saveProfile(n(i({},r),{gender:e}))}getDataForBackup(){return this.getProfile()}clearUserProfile_DEV_ONLY(){this.replaceData(null),console.log("User profile data cleared.")}migrateLegacyMeasurements(){let e=this.getProfile();if(e&&e.measurements&&!e.measurementHistory){let r=g(new Date,"yyyy-MM-dd"),t=i({date:r},e.measurements);e.measurementHistory=[t],delete e.measurements,this.saveProfile(e),console.log("Successfully migrated legacy measurements to history format.")}}addOrUpdateMeasurementEntry(e){let r=this.getProfile()||{},t=r.measurementHistory||[];e.date||(e.date=g(S(new Date),"yyyy-MM-dd"));let s=t.findIndex(a=>a.date===e.date);s>-1?t[s]=i(i({},t[s]),e):t.push(e),t.sort((a,l)=>new Date(a.date).getTime()-new Date(l.date).getTime()),this.saveProfile(n(i({},r),{measurementHistory:t}))}getMeasurements(){let e=this.getProfile()?.measurementHistory;return e&&e.length>0?e[e.length-1]:null}saveGoals(e){let r=this.getProfile()||{};this.saveProfile(n(i({},r),{measurementGoals:e}))}calculateBMI(e,r){if(!e||!r)return null;let t=r/100;return parseFloat((e/(t*t)).toFixed(1))}calculateBodyFatNavy(e,r){let{waist:t,neck:s,height:a,hips:l}=r;if(!e||!t||!s||!a)return null;let c=0;if(e==="male")c=86.01*Math.log10(t-s)-70.041*Math.log10(a)+36.76;else if(e==="female"){if(!l)return null;c=163.205*Math.log10(t+l-s)-97.684*Math.log10(a)-78.387}else return null;return parseFloat(c.toFixed(1))}deleteMeasurementEntry(e){let r=this.getProfile();if(!r||!r.measurementHistory)return;let t=r.measurementHistory.filter(s=>s.date!==e);this.saveProfile(n(i({},r),{measurementHistory:t}))}saveProfile(e){let r=this.getProfile()||{},t=i(i({},r),e);e.measurementHistory&&e.measurementHistory.length>0&&(e.measurementHistory.sort((s,a)=>new Date(s.date).getTime()-new Date(a.date).getTime()),e.measurements=i(i({},e.measurements),e.measurementHistory[e.measurementHistory.length-1])),t.measurementHistory&&t.measurementHistory.sort((s,a)=>new Date(s.date).getTime()-new Date(a.date).getTime()),this.storageService.setItem(this.USER_PROFILE_KEY,t),this.userProfileSubject.next(t)}replaceData(e){e?(this.storageService.setItem(this.USER_PROFILE_KEY,e),this.userProfileSubject.next(e)):(this.storageService.removeItem(this.USER_PROFILE_KEY),this.userProfileSubject.next(null))}mergeData(e){if(!e)return;let r=this.getProfile()||{},t=r.measurementHistory||[],s=e.measurementHistory||[],a=new Map;t.forEach(o=>a.set(o.date,o)),s.forEach(o=>a.set(o.date,o));let l=Array.from(a.values()),c={username:e.username??r.username,gender:e.gender??r.gender,height:e.height??r.height,hideWipDisclaimer:e.hideWipDisclaimer??r.hideWipDisclaimer,measurementGoals:i(i({},r.measurementGoals),e.measurementGoals),measurementHistory:l};this.saveProfile(c)}static \u0275fac=function(r){return new(r||u)};static \u0275prov=d({token:u,factory:u.\u0275fac,providedIn:"root"})};var M=(o=>(o.FOCUS_PLAYER="focus_player",o.TABATA_PLAYER="tabata_player",o.UNLIMITED_ROUTINES="unlimited_routines",o.PROGRESSIVE_OVERLOAD="progressive_overload",o.PERSONAL_GYM="personal_gym",o.MENU_MODE="menu_mode",o.ACTIVITY="activity",o.TRAINING_PROGRAMS="training_programs",o))(M||{}),E=class u{userProfileService=m(p);alertService=m(h);isPremium$=this.userProfileService.userProfile$.pipe(v(e=>e?.isPremium??!1));isPremiumSubject=new f(!1);featureLimits=new Map([["unlimited_routines",3]]);constructor(){this.isPremium$.subscribe(e=>this.isPremiumSubject.next(e))}isPremium(){return this.isPremiumSubject.getValue()}canAccess(e,r){if(this.isPremium())return!0;let t=this.featureLimits.get(e);return t!==void 0&&r!==void 0?r<t:!1}showUpgradeModal(e){return this.alertService.showAlert("Premium Feature",e||"This feature is available for Premium users. Upgrade now to unlock this and much more!")}togglePremium_DEV_ONLY(){let e=this.isPremium();this.userProfileService.updatePremiumStatus(!e)}static \u0275fac=function(r){return new(r||u)};static \u0275prov=d({token:u,factory:u.\u0275fac,providedIn:"root"})};export{p as a,M as b,E as c};
