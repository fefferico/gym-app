import{a as xe}from"./chunk-VDSUTJ77.js";import{f as pe,g as ce,h as ue,j as me,k as ge}from"./chunk-YNLBEOD3.js";import{a as de}from"./chunk-RC7X3TVY.js";import{J as oe,ea as se,la as le,p as B}from"./chunk-QH663V6A.js";import{Bb as G,H as W,Ja as d,Ka as o,La as a,Ma as T,Nb as Z,Ob as q,P as c,Qa as D,Ra as C,Sa as u,U as S,V as P,W as I,X as M,Xb as k,_ as v,_b as J,ac as A,ba as U,bb as s,cb as f,da as z,db as m,h as w,ha as Y,ja as i,l as V,m as O,mb as j,ob as L,od as te,pb as E,pd as re,qa as $,qc as K,rd as ie,sc as Q,sd as ne,tc as ee,td as ae,ua as X,ub as l,vb as g,wb as b,x as N,z as H,za as h}from"./chunk-4G4FKAW4.js";import{a as R}from"./chunk-GAL4ENT6.js";var fe=(r,e)=>({exercise:r,pbType:e}),ve=(r,e)=>({value:r,unit:e}),be=r=>({reps:r}),ye=r=>({notes:r}),_e=r=>["/history/log",r];function Te(r,e){r&1&&(o(0,"div",9)(1,"p",10),s(2),l(3,"translate"),a(),T(4,"div",11),a()),r&2&&(i(2),f(g(3,1,"pbTrend.loading")))}function Ce(r,e){if(r&1){let t=D();o(0,"div",12)(1,"p",13),I(),o(2,"svg",14),T(3,"path",15),a(),s(4),a(),M(),o(5,"button",16),C("click",function(){S(t);let p=u();return P(p.goBack())}),s(6),l(7,"translate"),a()()}if(r&2){let t=u();i(4),m(" ",t.errorMessage()," "),i(2),m(" ",g(7,2,"pbTrend.backButton")," ")}}function we(r,e){if(r&1&&(o(0,"div"),s(1),l(2,"translate"),a()),r&2){let t=u().model;i(),f(b(2,1,"pbTrend.chart.tooltip.reps",L(4,be,t.extra.reps)))}}function Le(r,e){if(r&1&&(o(0,"div",25),s(1),l(2,"translate"),a()),r&2){let t=u().model;i(),f(b(2,1,"pbTrend.chart.tooltip.notes",L(4,ye,t.extra.notes)))}}function ke(r,e){r&1&&(o(0,"div",26),s(1),l(2,"translate"),a()),r&2&&(i(),f(g(2,1,"pbTrend.chart.tooltip.viewLog")))}function Se(r,e){if(r&1&&(o(0,"div",21)(1,"div")(2,"strong"),s(3),l(4,"date"),a()(),o(5,"div"),s(6),l(7,"translate"),a(),h(8,we,3,6,"div",22)(9,Le,3,6,"div",23)(10,ke,3,3,"div",24),a()),r&2){let t=e.model,n=u(2);i(3),f(b(4,5,t.name,"mediumDate")),i(3),f(b(7,8,"pbTrend.chart.tooltip.value",E(11,ve,t.value,n.yAxisLabel().split(" ")[0]))),i(2),d("ngIf",t.extra==null?null:t.extra.reps),i(),d("ngIf",t.extra==null?null:t.extra.notes),i(),d("ngIf",t.extra==null?null:t.extra.workoutLogId)}}function Pe(r,e){r&1&&(o(0,"th",33),s(1),l(2,"translate"),a()),r&2&&(i(),m(" ",g(2,1,"pbTrend.history.repsHeader")," "))}function Ie(r,e){if(r&1&&(o(0,"td",41),s(1),a()),r&2){let t=u().$implicit;i(),m(" ",t.extra==null?null:t.extra.reps," ")}}function Me(r,e){if(r&1&&(o(0,"a",45),T(1,"app-icon",46),s(2),l(3,"translate"),a()),r&2){let t=u().$implicit;d("routerLink",L(4,_e,t.extra==null?null:t.extra.workoutLogId)),i(2),m(" ",g(3,2,"pbTrend.history.viewLog")," ")}}function De(r,e){if(r&1&&(o(0,"tr",39)(1,"td",40),s(2),l(3,"date"),a(),o(4,"td",41),s(5),a(),h(6,Ie,2,1,"td",42),o(7,"td",43),h(8,Me,4,6,"a",44),a()()),r&2){let t=e.$implicit,n=u(3);i(2),m(" ",b(3,4,t.name,"mediumDate")," "),i(3),m(" ",n.formatTableValue(t)," "),i(),d("ngIf",(n.currentPbType==null?null:n.currentPbType.includes("RM"))||(n.currentPbType==null?null:n.currentPbType.includes("Heaviest Lifted"))),i(2),d("ngIf",t.extra==null?null:t.extra.workoutLogId)}}function Ee(r,e){if(r&1&&(o(0,"div",27)(1,"h2",28),s(2),l(3,"translate"),a(),o(4,"div",29)(5,"table",30)(6,"thead",31)(7,"tr")(8,"th",32),s(9),l(10,"translate"),a(),o(11,"th",33),s(12),a(),h(13,Pe,3,3,"th",34),o(14,"th",35)(15,"span",36),s(16),l(17,"translate"),a()()()(),o(18,"tbody",37),h(19,De,9,7,"tr",38),a()()()()),r&2){let t=u(2);i(2),m(" ",g(3,6,"pbTrend.history.title")," "),i(7),m(" ",g(10,8,"pbTrend.history.dateHeader")," "),i(3),m(" ",t.yAxisLabel()," "),i(),d("ngIf",(t.currentPbType==null?null:t.currentPbType.includes("RM"))||(t.currentPbType==null?null:t.currentPbType.includes("Heaviest Lifted"))),i(3),f(g(17,10,"pbTrend.history.logHeader")),i(3),d("ngForOf",t.historyTableData())}}function Ae(r,e){if(r&1){let t=D();o(0,"div",17)(1,"ngx-charts-line-chart",18),l(2,"translate"),C("select",function(p){S(t);let y=u();return P(y.onChartSelect(p))}),h(3,Se,11,14,"ng-template",19),a(),h(4,Ee,20,12,"div",20),a()}if(r&2){let t=u();i(),d("view",t.view)("scheme",t.chartColorScheme)("results",t.chartData())("legend",t.legend)("xAxis",t.xAxis)("yAxis",t.yAxis)("showXAxisLabel",t.showXAxisLabel)("showYAxisLabel",t.showYAxisLabel)("xAxisLabel",g(2,17,"pbTrend.chart.xAxisLabel"))("yAxisLabel",t.yAxisLabel())("timeline",t.timeline)("autoScale",t.autoScale)("roundDomains",t.roundDomains)("xAxisTickFormatting",t.xAxisTickFormatting)("curve",t.lineChartCurve)("referenceLines",t.lineChartReferenceLines()),i(3),d("ngIf",t.historyTableData().length>0)}}var he=class r{route=c(K);router=c(Q);trackingService=c(se);exerciseService=c(le);unitsService=c(oe);toastService=c(re);platformId=c(z);datePipe=new k("en-US");themeService=c(de);renderer=c($);el=c(U);translate=c(ie);workoutUtilsService=c(xe);themeSubscription;chartData=v(null);isLoading=v(!0);errorMessage=v(null);historyTableData=G(()=>{let e=this.chartData();return!e||!e[0]||!e[0].series?[]:[...e[0].series].sort((t,n)=>n.name.getTime()-t.name.getTime())});currentExerciseId=null;currentPbType=null;currentExerciseName=v("Exercise");yAxisLabel=v("Value");lineChartReferenceLines=v([]);view=[700,400];legend=!1;showXAxisLabel=!0;showYAxisLabel=!0;xAxis=!0;yAxis=!0;timeline=!0;autoScale=!0;roundDomains=!0;lineChartCurve=pe;chartColorScheme={name:"fitTrackProScheme",selectable:!0,group:ue.Ordinal,domain:["#10B981","#3B82F6","#F97316","#8B5CF6","#F59E0B","#EC4899","#14B8A6","#6366F1"]};xAxisTickFormatting=e=>e instanceof Date?this.datePipe.transform(e,"MMM d, yy")||"":String(e);constructor(){}ngOnInit(){A(this.platformId)&&(this.view=[window.innerWidth>768?700:window.innerWidth-40,400],this.updateChartTextColors(this.themeService.isDarkTheme())),this.themeService.isDarkTheme()?this.updateChartTextColors(!0):this.updateChartTextColors(!1),this.route.paramMap.pipe(H(1),W(e=>{this.isLoading.set(!0),this.errorMessage.set(null),this.chartData.set(null);let t=e.get("exerciseId"),n=e.get("pbType");if(!t||!n)return this.errorMessage.set(this.translate.instant("pbTrend.error.missingParams")),this.isLoading.set(!1),w({pb:null,exercise:null,error:"Missing parameters"});this.currentExerciseId=t;try{this.currentPbType=decodeURIComponent(n)}catch{return this.errorMessage.set(this.translate.instant("pbTrend.error.invalidPbType")),this.isLoading.set(!1),w({pb:null,exercise:null,error:"Invalid PB Type"})}return this.setYAxisLabel(this.currentPbType),O([this.trackingService.getPersonalBestForExerciseByType(this.currentExerciseId,this.currentPbType),this.exerciseService.getExerciseById(this.currentExerciseId)]).pipe(V(([p,y])=>({pb:p,exercise:y,error:null})),N(p=>(console.error("Error fetching PB trend data:",p),this.errorMessage.set(this.translate.instant("pbTrend.error.fetchFailed")),w({pb:null,exercise:null,error:"Fetch error"}))))})).subscribe(({pb:e,exercise:t,error:n})=>{if(n){this.isLoading.set(!1);return}this.currentExerciseName.set(t?.name||"Selected Exercise"),e?this.prepareChartData(e):this.errorMessage.set(this.translate.instant("pbTrend.error.noData",{exercise:this.currentExerciseName(),pbType:this.currentPbType})),this.isLoading.set(!1)})}updateChartTextColors(e){let t=e?"#E5E7EB":"#374151";this.renderer.setStyle(this.el.nativeElement,"--ngx-charts-text-color",t)}setYAxisLabel(e){e.includes("RM")||e.includes("Heaviest Lifted")?this.yAxisLabel.set(this.translate.instant("pbTrend.yAxis.weight",{unit:this.unitsService.getWeightUnitSuffix()})):e.includes("Max Reps")?this.yAxisLabel.set(this.translate.instant("pbTrend.yAxis.reps")):e.includes("Max Duration")?this.yAxisLabel.set(this.translate.instant("pbTrend.yAxis.duration")):e.includes("Max Distance")?this.yAxisLabel.set(this.translate.instant("pbTrend.yAxis.distance",{unit:this.unitsService.getDistanceMeasureUnitSuffix()})):this.yAxisLabel.set(this.translate.instant("pbTrend.yAxis.value"))}prepareChartData(e){let t=[],n=R({},e);e.repsLogged&&(n.repsLogged=B(e.repsLogged));let p=this.extractValueForChart(n,e.pbType);if(p!==null&&e.timestamp&&t.push({name:new Date(e.timestamp),value:p,extra:{reps:B(e.repsLogged),notes:e.notes,workoutLogId:e.workoutLogId}}),e.history&&e.history.forEach(x=>{let _=this.extractValueForChart(x,e.pbType);_!==null&&x.timestamp&&t.push({name:new Date(x.timestamp),value:_,extra:{reps:x.repsLogged,notes:void 0,workoutLogId:x.workoutLogId}})}),t.length<2){this.errorMessage.set(this.translate.instant("pbTrend.error.notEnoughData")),this.chartData.set(null),this.lineChartReferenceLines.set([]);return}t.sort((x,_)=>x.name.getTime()-_.name.getTime());let F=t.reduce((x,_)=>x+_.value,0)/t.length;this.lineChartReferenceLines.set([{name:this.translate.instant("pbTrend.chart.averageLine",{value:F.toFixed(1)}),value:F}]),this.chartData.set([{name:`${this.currentPbType||"PB"} Trend`,series:t}])}extractValueForChart(e,t){return t.includes("RM")||t.includes("Heaviest Lifted")?e.weightLogged??null:t.includes("Max Reps")?e.repsLogged??null:t.includes("Max Duration")?e.durationLogged??null:t.includes("Max Distance")?e.distanceLogged??null:e.weightLogged&&e.weightLogged>0?e.weightLogged:e.repsLogged&&e.repsLogged>0?e.repsLogged:e.durationLogged&&e.durationLogged>0?e.durationLogged:e.distanceLogged&&e.distanceLogged>0?e.distanceLogged:null}onChartSelect(e){e&&e.extra&&e.extra.workoutLogId?this.router.navigate(["/history/log",e.extra.workoutLogId]):e&&e.extra&&this.toastService.info(this.translate.instant("pbTrend.chart.tooltip.value",{value:e.value,unit:this.yAxisLabel().split(" ")[0]})+` on ${this.datePipe.transform(e.name,"mediumDate")}. ${e.extra.reps?this.translate.instant("pbTrend.chart.tooltip.reps",{reps:e.extra.reps}):""}`,5e3,"PB Detail")}goBack(){this.router.navigate(["/profile/personal-bests"])}onResize(e){if(A(this.platformId)){let t=e.target;this.view=[t.innerWidth>768?700:t.innerWidth-40,400]}}formatTableValue(e){return this.currentPbType?.includes("Max Duration")&&this.workoutUtilsService.formatSecondsToTime(e.value)||e.value.toString()}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=X({type:r,selectors:[["app-pb-trend-chart"]],features:[j([ce])],decls:12,vars:12,consts:[[1,"container","mx-auto","p-4",3,"resize"],[1,"mb-6","flex","items-center"],[1,"text-gray-600","dark:text-gray-300","hover:text-primary","dark:hover:text-primary-light","p-2","-ml-2","rounded-full","focus:outline-none","focus:ring-2","focus:ring-primary-focus",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"text-xl","sm:text-2xl","font-bold","text-gray-800","dark:text-gray-200","ml-2"],["class","text-center py-10",4,"ngIf"],["class","text-center py-10 bg-red-50 dark:bg-red-900/30 p-4 rounded-md shadow",4,"ngIf"],["class","bg-white dark:bg-gray-800 p-2 sm:p-4 rounded-md shadow-xl",4,"ngIf"],[1,"text-center","py-10"],[1,"text-lg","text-gray-600","dark:text-gray-400"],[1,"mt-4","animate-spin","rounded-full","h-12","w-12","border-b-2","border-primary","mx-auto"],[1,"text-center","py-10","bg-red-50","dark:bg-red-900/30","p-4","rounded-md","shadow"],[1,"text-lg","font-semibold","text-red-700","dark:text-red-300"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-6","h-6","inline-block","mr-2","align-middle"],["stroke-linecap","round","stroke-linejoin","round","d","M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"],[1,"mt-4","px-4","py-2","bg-primary","text-white","rounded-md","hover:bg-primary-dark","transition-colors",3,"click"],[1,"bg-white","dark:bg-gray-800","p-2","sm:p-4","rounded-md","shadow-xl"],[1,"pb-chart-container",3,"select","view","scheme","results","legend","xAxis","yAxis","showXAxisLabel","showYAxisLabel","xAxisLabel","yAxisLabel","timeline","autoScale","roundDomains","xAxisTickFormatting","curve","referenceLines"],["ngx-charts-tooltip-template",""],["class","mt-8",4,"ngIf"],[1,"chart-tooltip","bg-gray-700","text-white","p-2","rounded","shadow-lg","text-xs"],[4,"ngIf"],["class","max-w-xs truncate",4,"ngIf"],["class","mt-1 text-indigo-300",4,"ngIf"],[1,"max-w-xs","truncate"],[1,"mt-1","text-indigo-300"],[1,"mt-8"],[1,"text-lg","font-semibold","text-gray-700","dark:text-gray-300","mb-4","border-t","pt-4","dark:border-gray-700"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-gray-200","dark:divide-gray-600"],[1,"bg-gray-50","dark:bg-gray-700"],["scope","col",1,"px-4","py-3","text-left","text-xs","font-medium","text-gray-500","dark:text-gray-400","uppercase","tracking-wider","rounded-tl-md"],["scope","col",1,"px-4","py-3","text-left","text-xs","font-medium","text-gray-500","dark:text-gray-400","uppercase","tracking-wider"],["scope","col","class","px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",4,"ngIf"],["scope","col",1,"relative","px-4","py-3","border-l-0","rounded-tr-md"],[1,"sr-only"],[1,"bg-white","dark:bg-gray-800","divide-y","divide-gray-200","dark:divide-gray-700"],["class","hover:bg-gray-50 dark:hover:bg-gray-700/50",4,"ngFor","ngForOf"],[1,"hover:bg-gray-50","dark:hover:bg-gray-700/50"],[1,"px-4","py-4","whitespace-nowrap","text-sm","font-medium","text-gray-900","dark:text-gray-200"],[1,"px-4","py-4","whitespace-nowrap","text-sm","text-gray-500","dark:text-gray-300"],["class","px-4 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",4,"ngIf"],[1,"px-4","py-4","whitespace-nowrap","text-right","text-sm","font-medium"],["class","inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-focus dark:focus:ring-offset-gray-800",3,"routerLink",4,"ngIf"],[1,"inline-flex","items-center","px-3","py-1.5","border","border-transparent","text-xs","font-medium","rounded-md","shadow-sm","text-white","bg-primary","hover:bg-primary-dark","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-primary-focus","dark:focus:ring-offset-gray-800",3,"routerLink"],["name","eye",1,"h-5","w-5","mr-1"]],template:function(t,n){t&1&&(o(0,"div",0),C("resize",function(y){return n.onResize(y)},Y),o(1,"div",1)(2,"button",2),C("click",function(){return n.goBack()}),I(),o(3,"svg",3),T(4,"path",4),a()(),M(),o(5,"h1",5),s(6),l(7,"translate"),l(8,"translate"),a()(),h(9,Te,5,3,"div",6)(10,Ce,8,4,"div",7)(11,Ae,5,19,"div",8),a()),t&2&&(i(6),m(" ",b(8,6,"pbTrend.title",E(9,fe,n.currentExerciseName(),n.currentPbType||g(7,4,"pbTrend.defaultTitle")))," "),i(3),d("ngIf",n.isLoading()),i(),d("ngIf",n.errorMessage()),i(),d("ngIf",!n.isLoading()&&!n.errorMessage()&&n.chartData()))},dependencies:[J,Z,q,ge,me,ee,te,ae,k,ne],styles:["[_nghost-%COMP%]{--ngx-charts-text-color: #374151}[_nghost-%COMP%]     .ngx-charts text{fill:var(--ngx-charts-text-color)!important}[_nghost-%COMP%]     .ngx-charts .axis-label, [_nghost-%COMP%]     .ngx-charts .legend-label{fill:var(--ngx-charts-text-color)!important}.pb-chart-container[_ngcontent-%COMP%]     .ngx-charts{overflow:visible!important}  .chart-tooltip{pointer-events:none;font-size:.75rem}  .chart-tooltip strong{font-weight:600}","[_nghost-%COMP%]     .pb-chart-container .line-series .circle{fill:#fff;stroke:#10b981;stroke-width:2px;r:4px!important}[_nghost-%COMP%]     .pb-chart-container .x.axis .tick text{transform:rotate(-45deg) translate(-10px,-5px);text-anchor:end!important}[_nghost-%COMP%]     .pb-chart-container .ngx-charts-outer, [_nghost-%COMP%]     .pb-chart-container .axis-label, [_nghost-%COMP%]     .pb-chart-container .tick text{fill:var(--ngx-charts-text-color, #374151)}"],changeDetection:0})};export{he as PbTrendChartComponent};
