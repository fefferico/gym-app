import{a as vt}from"./chunk-MIW232FQ.js";import{a as mt}from"./chunk-QTPL5QNR.js";import{x as st}from"./chunk-NZW5CWOI.js";import{Cb as K,Da as w,Ja as l,Ka as r,La as a,Ma as g,Mb as $,Na as M,Nb as q,Oa as O,Ob as R,Oc as J,P as f,Pc as b,Qa as k,Qc as U,Ra as x,Rc as W,Sa as h,U as I,Ub as G,V as T,Vc as Y,Wc as Q,Za as V,_ as E,_b as H,_c as X,bb as c,bd as Z,cb as m,cd as tt,db as y,dd as et,eb as D,ed as it,ja as o,jd as nt,kd as ot,ld as at,ob as _,od as rt,pd as lt,q as N,qc as j,rd as pt,sc as z,sd as dt,td as ct,ua as P,ub as p,vb as d,z as A,za as u}from"./chunk-WBXHX4E4.js";import{a as B}from"./chunk-GAL4ENT6.js";var S=i=>({"input-invalid":i});function gt(i,e){i&1&&(r(0,"span"),c(1),p(2,"translate"),a()),i&2&&(o(),m(d(2,1,"logActivity.logTitle")))}function yt(i,e){i&1&&(r(0,"span"),c(1),p(2,"translate"),a()),i&2&&(o(),m(d(2,1,"logActivity.editTitle")))}function ft(i,e){i&1&&(r(0,"span"),c(1),p(2,"translate"),a()),i&2&&(o(),m(d(2,1,"logActivity.logSubtitle")))}function bt(i,e){i&1&&(r(0,"span"),c(1),p(2,"translate"),a()),i&2&&(o(),m(d(2,1,"logActivity.editSubtitle")))}function ht(i,e){if(i&1&&(r(0,"option",37),c(1),a()),i&2){let t=e.$implicit;l("value",t.id),o(),D(" ",t.name," (",t.category,") ")}}function At(i,e){i&1&&(r(0,"div",38),c(1),p(2,"translate"),a()),i&2&&(o(),y(" ",d(2,1,"logActivity.activityRequired")," "))}function xt(i,e){i&1&&(r(0,"div",38),c(1),p(2,"translate"),a()),i&2&&(o(),y(" ",d(2,1,"logActivity.dateRequired")," "))}function _t(i,e){i&1&&(r(0,"div",38),c(1),p(2,"translate"),a()),i&2&&(o(),y(" ",d(2,1,"logActivity.startTimeRequired")," "))}function It(i,e){i&1&&(r(0,"div",38),c(1),p(2,"translate"),a()),i&2&&(o(),y(" ",d(2,1,"logActivity.endTimeRequired")," "))}function Tt(i,e){i&1&&(r(0,"div",38),c(1),p(2,"translate"),a()),i&2&&(o(),y(" ",d(2,1,"logActivity.timeInvalid")," "))}function St(i,e){if(i&1&&(r(0,"option",37),c(1),a()),i&2){let t=e.$implicit;l("value",t.id),o(),y(" ",t.label," ")}}function Lt(i,e){if(i&1&&(r(0,"div")(1,"label",39),c(2),p(3,"translate"),a(),r(4,"select",40)(5,"option",41),c(6),p(7,"translate"),a(),u(8,St,2,2,"option",11),a()()),i&2){let t=h();o(2),m(d(3,3,"logActivity.locationLabel")),o(4),m(d(7,5,"logActivity.locationPlaceholder")),o(2),l("ngForOf",t.locationService.allLocationTypes())}}function Ct(i,e){if(i&1&&g(0,"option",37),i&2){let t=e.$implicit;l("value",t)}}function Et(i,e){if(i&1){let t=k();r(0,"div")(1,"label",42),c(2),p(3,"translate"),a(),r(4,"input",43,0),p(6,"translate"),x("focus",function(){I(t);let s=V(5),v=h();return T(v.onLocationNameFocus(s))})("input",function(s){I(t);let v=h();return T(v.onLocationNameInput(s))}),a(),r(7,"datalist",44),u(8,Ct,1,1,"option",11),a()()}if(i&2){let t=h();o(2),y(" ",d(3,4,"workoutBuilder.logEntry.locationLabel")," "),o(2),l("placeholder",d(6,6,"workoutBuilder.logEntry.locationPlaceholder")),w("list","locationName-list"),o(4),l("ngForOf",t.activityService.getActivityLocations())}}function wt(i,e){i&1&&(r(0,"div")(1,"label",45),c(2),p(3,"translate"),a(),g(4,"input",46),p(5,"translate"),a()),i&2&&(o(2),m(d(3,2,"logActivity.distanceLabel")),o(2),l("placeholder",d(5,4,"logActivity.distancePlaceholder")))}function kt(i,e){i&1&&(r(0,"div")(1,"label",47),c(2),p(3,"translate"),a(),g(4,"input",48),p(5,"translate"),a()),i&2&&(o(2),m(d(3,2,"logActivity.caloriesLabel")),o(2),l("placeholder",d(5,4,"logActivity.caloriesPlaceholder")))}function Ft(i,e){if(i&1&&g(0,"option",37),i&2){let t=e.$implicit;l("value",t)}}function Bt(i,e){if(i&1){let t=k();M(0),r(1,"span",49),x("click",function(){let s=I(t).$implicit,v=h();return T(v.removePerson(s))}),c(2),g(3,"app-icon",50),a(),O()}if(i&2){let t=e.$implicit;o(2),y(" ",t," ")}}function Nt(i,e){i&1&&(r(0,"span"),c(1),p(2,"translate"),a()),i&2&&(o(),m(d(2,1,"logActivity.logButton")))}function Pt(i,e){i&1&&(r(0,"span"),c(1),p(2,"translate"),a()),i&2&&(o(),m(d(2,1,"logActivity.updateButton")))}function Mt(i,e){return t=>{let n=t.get(i)?.value,s=t.get(e)?.value;return n&&s&&n>=s?{timeInvalid:!0}:null}}var ut=class i{fb=f(nt);activityService=f(mt);locationService=f(vt);toastService=f(lt);router=f(z);route=f(j);subscriptionService=f(st);translate=f(pt);logActivityForm;availableActivities$;selectedActivity=E(null);isEditMode=E(!1);editingLogId=null;constructor(){this.logActivityForm=this.fb.group({activityId:["",[b.required]],date:[new Date().toISOString().split("T")[0],[b.required]],startTime:["12:00",[b.required]],endTime:["13:00",[b.required]],intensity:["Medium",[b.required]],locationId:["",[]],locationName:["",[]],distanceKm:[{value:null,disabled:!0},[b.min(0)]],caloriesBurned:[{value:null,disabled:!0},[b.min(0)]],people:[[]],notes:[""]},{validators:Mt("startTime","endTime")}),this.availableActivities$=this.activityService.getActivities(),K(()=>{this.updateFormForSelectedActivity(this.selectedActivity())})}ngOnInit(){this.subscriptionService.canAccess("activity")||this.subscriptionService.showUpgradeModal().then(()=>{this.router.navigate(["profile"])}),this.route.paramMap.pipe(A(1)).subscribe(e=>{let t=e.get("id");t&&(this.isEditMode.set(!0),this.editingLogId=t,this.loadLogForEditing(t))}),this.logActivityForm.get("activityId")?.valueChanges.subscribe(e=>{this.activityService.getActivities().pipe(A(1)).subscribe(t=>{let n=t.find(s=>s.id===e);this.selectedActivity.set(n||null)})}),this.filteredPeople=this.getActivityPeople()}loadLogForEditing(e){N({log:this.activityService.getActivityLogById(e).pipe(A(1)),activities:this.activityService.getActivities().pipe(A(1))}).subscribe(({log:t,activities:n})=>{if(t&&n){let s=n.find(C=>C.id===t.activityId);s&&this.selectedActivity.set(s);let v=new Date(t.startTime),L=t.endTime?new Date(t.endTime):new Date(t.startTime+t.durationMinutes*6e4),F=C=>C.toTimeString().substring(0,5);this.logActivityForm.patchValue({activityId:t.activityId,date:t.date,startTime:F(v),endTime:F(L),intensity:t.intensity,locationId:t.locationId,locationName:t.locationName,distanceKm:t.distanceKm,caloriesBurned:t.caloriesBurned,people:t.people,notes:t.notes})}else this.toastService.error(this.translate.instant("logActivity.toasts.editError"),0),this.router.navigate(["/history"])})}updateFormForSelectedActivity(e){if(!e){this.logActivityForm.get("distanceKm")?.disable(),this.logActivityForm.get("caloriesBurned")?.disable();return}this.logActivityForm.get("intensity")?.setValue(e.intensity,{emitEvent:!1});let t=e.defaultTrackingMetrics;t.distance?this.logActivityForm.get("distanceKm")?.enable():this.logActivityForm.get("distanceKm")?.disable(),t.calories?this.logActivityForm.get("caloriesBurned")?.enable():this.logActivityForm.get("caloriesBurned")?.disable(),this.logActivityForm.updateValueAndValidity()}onSubmit(){if(this.logActivityForm.invalid){this.toastService.error(this.translate.instant("logActivity.toasts.invalidForm"),0,this.translate.instant("logActivity.toasts.invalidFormTitle")),Object.values(this.logActivityForm.controls).forEach(e=>{e.markAsTouched()});return}this.isEditMode()?this.updateLog():this.createLog()}createLog(){let e=this.prepareLogData();e&&(this.activityService.addActivityLog(e),this.router.navigate(["/history"]))}updateLog(){if(!this.editingLogId)return;let e=this.prepareLogData();if(!e)return;let t=B({id:this.editingLogId},e);this.activityService.updateActivityLog(t),this.router.navigate(["/activities/log",this.editingLogId])}prepareLogData(){let e=this.logActivityForm.getRawValue(),t=this.selectedActivity();if(!t)return null;let n=e.date,s=new Date(`${n}T${e.startTime}`).getTime(),v=new Date(`${n}T${e.endTime}`).getTime(),L=Math.round((v-s)/6e4);return{activityId:t.id,activityName:t.name,date:e.date,startTime:s,endTime:v,durationMinutes:L,intensity:e.intensity,locationId:e.locationId,locationName:e.locationName,distanceKm:e.distanceKm,caloriesBurned:e.caloriesBurned,people:e.people,notes:e.notes}}get f(){return this.logActivityForm.controls}getActivityPeople(){return this.activityService.getActivityPeople()}getActivityLocations(){return this.activityService.getActivityLocations()}getLocationTypeLabel(){let e=this.logActivityForm.get("locationId")?.value,t=this.locationService.allLocationTypes().find(n=>n.id===e);return t?t.label:""}onLocationNameFocus(e){e&&(e.value=e.value,e.setSelectionRange(e.value.length,e.value.length))}onLocationNameInput(e){let t=e.target;t.value.endsWith(" ")&&(t.value=t.value,t.blur(),t.focus())}onPeopleInput(e){let t=e.target.value.toLowerCase(),n=this.getActivityPeople();this.filteredPeople=n.filter(s=>s.toLowerCase().includes(t)&&!this.f.people.value.includes(s))}addPersonFromInput(e){let t="";if(e&&e.target?t=e.target.value.trim():t=this.peopleInput.trim(),!t)return;let n=this.f.people.value;n.includes(t)||(this.f.people.setValue([...n,t]),this.f.people.markAsDirty()),this.peopleInput="",this.filteredPeople=this.getActivityPeople().filter(s=>!this.f.people.value.includes(s))}removePerson(e){let t=this.f.people.value;this.f.people.setValue(t.filter(n=>n!==e)),this.f.people.markAsDirty(),this.filteredPeople=this.getActivityPeople().filter(n=>!this.f.people.value.includes(n))}togglePerson(e){let t=this.f.people.value;t.includes(e)?this.removePerson(e):(this.f.people.setValue([...t,e]),this.f.people.markAsDirty()),this.filteredPeople=this.getActivityPeople().filter(n=>!this.f.people.value.includes(n))}peopleInput="";filteredPeople=[];static \u0275fac=function(t){return new(t||i)};static \u0275cmp=P({type:i,selectors:[["app-log-activity"]],decls:81,vars:72,consts:[["locationNameInput",""],[1,"container","mx-auto","max-w-2xl","p-4","sm:p-6"],[1,"mb-6"],[1,"text-3xl","font-bold","text-gray-800","dark:text-gray-200","flex","items-center"],["name","clipboard-list",1,"w-8","h-8","mr-3","text-primary"],[4,"ngIf"],[1,"text-gray-500","dark:text-gray-400","mt-1"],[1,"space-y-6","bg-white","dark:bg-gray-800","p-6","rounded-lg","shadow-md",3,"ngSubmit","formGroup"],["for","activityId",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-1"],["id","activityId","formControlName","activityId",1,"input-field",3,"ngClass"],["value","","disabled",""],[3,"value",4,"ngFor","ngForOf"],["class","validation-message",4,"ngIf"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],["for","date",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-1"],["type","date","id","date","formControlName","date",1,"input-field","dark:text-gray-300","dark:[color-scheme:dark]",3,"ngClass"],["for","startTime",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-1"],["type","time","id","startTime","formControlName","startTime",1,"input-field","dark:text-gray-300","dark:[color-scheme:dark]",3,"ngClass"],["for","endTime",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-1"],["type","time","id","endTime","formControlName","endTime",1,"input-field","dark:text-gray-300","dark:[color-scheme:dark]",3,"ngClass"],["for","intensity",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-1"],["id","intensity","formControlName","intensity",1,"input-field"],["value","Low"],["value","Medium"],["value","High"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],["for","people",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-1"],["id","people","type","text","placeholder","...","autocomplete","off",1,"input-field","mb-2",3,"input","keydown.enter","value"],["id","people-list"],[1,"flex","flex-wrap","gap-2"],[4,"ngFor","ngForOf"],["type","hidden","formControlName","people"],["for","notes",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-1"],["id","notes","formControlName","notes","rows","3",1,"input-field",3,"placeholder"],[1,"pt-4","border-t","border-gray-200","dark:border-gray-700","flex","justify-center"],["type","submit",1,"flex","items-center","text-m","bg-primary","text-white","hover:bg-primary-dark","font-semibold","rounded-md","disabled:opacity-50","p-2",3,"disabled"],["name","save",1,"w-5","h-5","mr-1"],[3,"value"],[1,"validation-message"],["for","locationId",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-1"],["id","locationId","formControlName","locationId",1,"input-field"],["value",""],["for","locationName",1,"block","text-m","font-medium","text-gray-700","dark:text-gray-200"],["id","locationName","type","text","formControlName","locationName","autocomplete","off",1,"mt-1","block","w-full","p-2","border","border-gray-300","dark:border-gray-500","rounded-xl","shadow-sm","dark:bg-gray-600","text-gray-700","dark:text-gray-200",3,"focus","input","placeholder"],["id","locationName-list"],["for","distanceKm",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-1"],["type","number","id","distanceKm","formControlName","distanceKm",1,"input-field",3,"placeholder"],["for","caloriesBurned",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-1"],["type","number","id","caloriesBurned","formControlName","caloriesBurned",1,"input-field",3,"placeholder"],[1,"inline-flex","items-center","px-3","py-1","rounded-full","text-sm","font-medium","bg-primary","text-white","cursor-pointer",3,"click"],["name","x",1,"ml-2","w-3","h-3"]],template:function(t,n){t&1&&(r(0,"div",1)(1,"header",2)(2,"h1",3),g(3,"app-icon",4),u(4,gt,3,3,"span",5)(5,yt,3,3,"span",5),a(),r(6,"p",6),u(7,ft,3,3,"span",5)(8,bt,3,3,"span",5),a()(),r(9,"form",7),x("ngSubmit",function(){return n.onSubmit()}),r(10,"div")(11,"label",8),c(12),p(13,"translate"),a(),r(14,"select",9)(15,"option",10),c(16),p(17,"translate"),a(),u(18,ht,2,3,"option",11),p(19,"async"),a(),u(20,At,3,3,"div",12),a(),r(21,"div",13)(22,"div")(23,"label",14),c(24),p(25,"translate"),a(),g(26,"input",15),u(27,xt,3,3,"div",12),a(),r(28,"div")(29,"label",16),c(30),p(31,"translate"),a(),g(32,"input",17),u(33,_t,3,3,"div",12),a(),r(34,"div")(35,"label",18),c(36),p(37,"translate"),a(),g(38,"input",19),u(39,It,3,3,"div",12)(40,Tt,3,3,"div",12),a()(),r(41,"div")(42,"label",20),c(43),p(44,"translate"),a(),r(45,"select",21)(46,"option",22),c(47),p(48,"translate"),a(),r(49,"option",23),c(50),p(51,"translate"),a(),r(52,"option",24),c(53),p(54,"translate"),a()()(),r(55,"div",25),u(56,Lt,9,7,"div",5)(57,Et,9,8,"div",5)(58,wt,6,6,"div",5)(59,kt,6,6,"div",5),a(),r(60,"div")(61,"label",26),c(62),p(63,"translate"),a(),r(64,"input",27),x("input",function(v){return n.onPeopleInput(v)})("keydown.enter",function(v){return n.addPersonFromInput(v),v.preventDefault()}),a(),r(65,"datalist",28),u(66,Ft,1,1,"option",11),a(),r(67,"div",29),u(68,Bt,4,1,"ng-container",30),a(),g(69,"input",31),a(),r(70,"div")(71,"label",32),c(72),p(73,"translate"),a(),g(74,"textarea",33),p(75,"translate"),a(),r(76,"div",34)(77,"button",35),g(78,"app-icon",36),u(79,Nt,3,3,"span",5)(80,Pt,3,3,"span",5),a()()()()),t&2&&(o(4),l("ngIf",!n.isEditMode()),o(),l("ngIf",n.isEditMode()),o(2),l("ngIf",!n.isEditMode()),o(),l("ngIf",n.isEditMode()),o(),l("formGroup",n.logActivityForm),o(3),m(d(13,38,"logActivity.activityLabel")),o(2),l("ngClass",_(64,S,n.f.activityId.touched&&n.f.activityId.invalid)),o(2),m(d(17,40,"logActivity.selectActivity")),o(2),l("ngForOf",d(19,42,n.availableActivities$)),o(2),l("ngIf",n.f.activityId.touched&&n.f.activityId.invalid),o(4),m(d(25,44,"logActivity.dateLabel")),o(2),l("ngClass",_(66,S,n.f.date.touched&&n.f.date.invalid)),o(),l("ngIf",n.f.date.touched&&n.f.date.invalid),o(3),m(d(31,46,"logActivity.startTimeLabel")),o(2),l("ngClass",_(68,S,n.f.startTime.touched&&n.f.startTime.invalid)),o(),l("ngIf",n.f.startTime.touched&&n.f.startTime.invalid),o(3),m(d(37,48,"logActivity.endTimeLabel")),o(2),l("ngClass",_(70,S,n.f.endTime.touched&&n.f.endTime.invalid||n.logActivityForm.hasError("timeInvalid"))),o(),l("ngIf",n.f.endTime.touched&&n.f.endTime.invalid),o(),l("ngIf",n.logActivityForm.hasError("timeInvalid")&&n.f.endTime.touched),o(3),m(d(44,50,"logActivity.intensityLabel")),o(4),m(d(48,52,"logActivity.intensityOptions.low")),o(3),m(d(51,54,"logActivity.intensityOptions.medium")),o(3),m(d(54,56,"logActivity.intensityOptions.high")),o(3),l("ngIf",n.f.locationId.enabled),o(),l("ngIf",n.f.locationName.enabled),o(),l("ngIf",n.f.distanceKm.enabled),o(),l("ngIf",n.f.caloriesBurned.enabled),o(3),y(" ",d(63,58,"logActivity.peopleLabel")," "),o(2),l("value",n.peopleInput),w("list","people-list"),o(2),l("ngForOf",n.filteredPeople),o(2),l("ngForOf",n.f.people.value),o(4),m(d(73,60,"logActivity.notesLabel")),o(2),l("placeholder",d(75,62,"logActivity.notesPlaceholder")),o(3),l("disabled",n.logActivityForm.invalid),o(2),l("ngIf",!n.isEditMode()),o(),l("ngIf",n.isEditMode()))},dependencies:[H,$,q,R,at,Y,et,it,J,Q,tt,U,W,X,Z,rt,ct,ot,G,dt],styles:[".input-field[_ngcontent-%COMP%]{display:block;width:100%;border-radius:.375rem;border-width:1px;--tw-border-opacity: 1;border-color:rgb(209 213 219 / var(--tw-border-opacity, 1));padding:.5rem;--tw-shadow: 0 1px 2px 0 rgb(0 0 0 / .05);--tw-shadow-colored: 0 1px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.input-field[_ngcontent-%COMP%]:focus{--tw-border-opacity: 1;border-color:rgb(224 70 13 / var(--tw-border-opacity, 1));--tw-ring-opacity: 1;--tw-ring-color: rgb(224 70 13 / var(--tw-ring-opacity, 1)) }.input-field[_ngcontent-%COMP%]:disabled{opacity:.5}.input-field[_ngcontent-%COMP%]:is(.dark *){--tw-border-opacity: 1;border-color:rgb(75 85 99 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(55 65 81 / var(--tw-bg-opacity, 1));--tw-text-opacity: 1;color:rgb(229 231 235 / var(--tw-text-opacity, 1))}.input-invalid[_ngcontent-%COMP%]{--tw-border-opacity: 1;border-color:rgb(239 68 68 / var(--tw-border-opacity, 1));--tw-ring-opacity: 1;--tw-ring-color: rgb(239 68 68 / var(--tw-ring-opacity, 1)) }.validation-message[_ngcontent-%COMP%]{margin-top:.25rem;font-size:.75rem;line-height:1rem;--tw-text-opacity: 1;color:rgb(239 68 68 / var(--tw-text-opacity, 1))}"]})};export{ut as LogActivityComponent,Mt as timeOrderValidator};
